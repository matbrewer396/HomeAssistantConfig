[
  {
    "id": "cd950567.f864b8",
    "type": "tab",
    "label": "leaving / arriving",
    "disabled": false,
    "info": ""
  },
  {
    "id": "1e454935.091dd7",
    "type": "tab",
    "label": "Set input values",
    "disabled": false,
    "info": ""
  },
  {
    "id": "b8a16318.b66a5",
    "type": "tab",
    "label": "Maintenance",
    "disabled": false,
    "info": ""
  },
  {
    "id": "df1fdc74.468a3",
    "type": "tab",
    "label": "Flow 4",
    "disabled": false,
    "info": ""
  },
  {
    "id": "99d64a3d.f4e418",
    "type": "tab",
    "label": "Sun State Change",
    "disabled": false,
    "info": ""
  },
  {
    "id": "d73100a9.0d64d",
    "type": "tab",
    "label": "Auto Night",
    "disabled": false,
    "info": ""
  },
  {
    "id": "a068bd5.28a8d4",
    "type": "tab",
    "label": "Presence Detection (Old)",
    "disabled": true,
    "info": ""
  },
  {
    "id": "73f354e0.89c88c",
    "type": "tab",
    "label": "Presence Detection",
    "disabled": false,
    "info": ""
  },
  {
    "id": "f92add19.c43b9",
    "type": "tab",
    "label": "Input Selecter Handle",
    "disabled": true,
    "info": ""
  },
  {
    "id": "a0a4859f.5a2a48",
    "type": "tab",
    "label": "Alarm",
    "disabled": true,
    "info": ""
  },
  {
    "id": "a3158433.9d1f78",
    "type": "tab",
    "label": "Home / Away",
    "disabled": false,
    "info": ""
  },
  {
    "id": "dceb45d8.425368",
    "type": "tab",
    "label": "Matt Lunch Time",
    "disabled": true,
    "info": ""
  },
  {
    "id": "48ba348c.61270c",
    "type": "tab",
    "label": "(OId) - Fault Detection",
    "disabled": true,
    "info": ""
  },
  {
    "id": "9cb589d.fe06478",
    "type": "tab",
    "label": "Fault Detection",
    "disabled": false,
    "info": ""
  },
  {
    "id": "21d6efde.d0943",
    "type": "tab",
    "label": "Bedroom",
    "disabled": false,
    "info": ""
  },
  {
    "id": "a0cdc0f9.a362b",
    "type": "tab",
    "label": "BathRoom (Old)",
    "disabled": true,
    "info": ""
  },
  {
    "id": "acf12371.2c1ae",
    "type": "tab",
    "label": "Old - Office",
    "disabled": true,
    "info": ""
  },
  {
    "id": "c7191d19.c1e7b",
    "type": "tab",
    "label": "How Long In Bed",
    "disabled": true,
    "info": ""
  },
  {
    "id": "6e74caff.7ad1f4",
    "type": "tab",
    "label": "Kitchen",
    "disabled": true,
    "info": ""
  },
  {
    "id": "84ed1066.f22de",
    "type": "tab",
    "label": "Fridge / Freezer",
    "disabled": false,
    "info": ""
  },
  {
    "id": "d1172b8b.3d3298",
    "type": "tab",
    "label": "Hallway / DoorBell",
    "disabled": true,
    "info": ""
  },
  {
    "id": "babe2ac9.4e2738",
    "type": "tab",
    "label": "Living Room",
    "disabled": true,
    "info": ""
  },
  {
    "id": "9a341993.fbc528",
    "type": "tab",
    "label": "TV",
    "disabled": true,
    "info": ""
  },
  {
    "id": "e361c01.ee9f54",
    "type": "tab",
    "label": "Hot Tub",
    "disabled": true,
    "info": ""
  },
  {
    "id": "8a69107f.14257",
    "type": "tab",
    "label": "Library",
    "disabled": true,
    "info": ""
  },
  {
    "id": "6a3dc053.8b5b6",
    "type": "tab",
    "label": "Apple Watch",
    "disabled": false,
    "info": ""
  },
  {
    "id": "c5288811.25f9e8",
    "type": "tab",
    "label": "Test - Breaker",
    "disabled": true,
    "info": ""
  },
  {
    "id": "d3802138.c1529",
    "type": "tab",
    "label": "Test - Is Dask",
    "disabled": true,
    "info": ""
  },
  {
    "id": "1f9e3480.5be75c",
    "type": "tab",
    "label": "Test - Alexa",
    "disabled": true,
    "info": ""
  },
  {
    "id": "5625076e.ee59e8",
    "type": "tab",
    "label": "Test - Notication stuff",
    "disabled": false,
    "info": ""
  },
  {
    "id": "826a5f7f.19967",
    "type": "tab",
    "label": "Test - Camera 2",
    "disabled": true,
    "info": ""
  },
  {
    "id": "594d2dae.a157a4",
    "type": "tab",
    "label": "Test - Camera",
    "disabled": true,
    "info": ""
  },
  {
    "id": "80866e71.966c6",
    "type": "tab",
    "label": "Alexa Inbound",
    "disabled": false,
    "info": ""
  },
  {
    "id": "6d7fc63f.5adbe8",
    "type": "tab",
    "label": "Xmas lights",
    "disabled": true,
    "info": ""
  },
  {
    "id": "c9dd75c4.1c8078",
    "type": "tab",
    "label": "decon",
    "disabled": false,
    "info": ""
  },
  {
    "id": "ea5aca0.33b1a38",
    "type": "tab",
    "label": "Bin Day",
    "disabled": true,
    "info": ""
  },
  {
    "id": "e6716385.6d8c2",
    "type": "tab",
    "label": "Ground Toliet",
    "disabled": false,
    "info": ""
  },
  {
    "id": "e0877ac4.f74e78",
    "type": "tab",
    "label": "Bathroom",
    "disabled": false,
    "info": ""
  },
  {
    "id": "813b32cf.d0663",
    "type": "tab",
    "label": "Landing / Hallway",
    "disabled": false,
    "info": ""
  },
  {
    "id": "127f96c9.345c09",
    "type": "tab",
    "label": "Office",
    "disabled": false,
    "info": ""
  },
  {
    "id": "8374deef.6aa85",
    "type": "tab",
    "label": "Flow 1",
    "disabled": false,
    "info": ""
  },
  {
    "id": "dd183e38.f4949",
    "type": "tab",
    "label": "Kic",
    "disabled": false,
    "info": ""
  },
  {
    "id": "cf065444.e48a48",
    "type": "tab",
    "label": "Shower Room",
    "disabled": false,
    "info": ""
  },
  {
    "id": "a9ef1830.1cde38",
    "type": "tab",
    "label": "Spare Room",
    "disabled": false,
    "info": ""
  },
  {
    "id": "e57ebed4.1e648",
    "type": "tab",
    "label": "Flow 2",
    "disabled": false,
    "info": ""
  },
  {
    "id": "c36ca323.83d468",
    "type": "tab",
    "label": "Flow 5",
    "disabled": false,
    "info": ""
  },
  {
    "id": "fbc51eb1.42cde",
    "type": "tab",
    "label": "Flow 3",
    "disabled": false,
    "info": ""
  },
  {
    "id": "a83e69e1.4b2ab8",
    "type": "subflow",
    "name": "Send Message",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 180,
        "wires": [
          {
            "id": "28fa280.0f108d8"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": ""
      },
      {
        "name": "who",
        "type": "str",
        "value": ""
      },
      {
        "name": "notification_id",
        "type": "str",
        "value": ""
      },
      {
        "name": "title",
        "type": "str",
        "value": ""
      },
      {
        "name": "category",
        "type": "str",
        "value": ""
      }
    ],
    "color": "#DDAA99"
  },
  {
    "id": "47bc2d66.1132e4",
    "type": "subflow",
    "name": "Alexa",
    "info": "Pass in msg.say",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 60,
        "wires": [
          {
            "id": "c6c0af75.98fa5"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1440,
        "y": 60,
        "wires": [
          {
            "id": "275d0587.9c0bba",
            "port": 0
          }
        ]
      }
    ]
  },
  {
    "id": "a0cc6149.1f76e",
    "type": "subflow",
    "name": "Send Email",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 50,
        "y": 30,
        "wires": []
      }
    ],
    "out": []
  },
  {
    "id": "f5eab19a.7cf17",
    "type": "subflow",
    "name": "Error Handler",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 60,
        "y": 60,
        "wires": [
          {
            "id": "35126fda.6e6b4"
          },
          {
            "id": "27296b10.af2594"
          }
        ]
      }
    ],
    "out": []
  },
  {
    "id": "c9b308f8.01ef68",
    "type": "subflow",
    "name": "Good Night",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 60,
        "y": 40,
        "wires": [
          {
            "id": "4ad3a3ca.e993fc"
          },
          {
            "id": "24eb6a57.aef116"
          },
          {
            "id": "5a47e076.9bd83"
          },
          {
            "id": "367929a4.b81d46"
          },
          {
            "id": "7eab6e39.2c36a"
          }
        ]
      }
    ],
    "out": []
  },
  {
    "id": "20dffe5a.37e8a2",
    "type": "subflow",
    "name": "Forward Light Comands",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 50,
        "y": 30,
        "wires": [
          {
            "id": "681f52a2.6e388c"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 700,
        "y": 40,
        "wires": [
          {
            "id": "a14e6e3.6e53b9",
            "port": 0
          }
        ]
      }
    ]
  },
  {
    "id": "7df159d5.618c58",
    "type": "subflow",
    "name": "Set Bed Lights",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 80,
        "wires": [
          {
            "id": "e890483e.ef37a8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1020,
        "y": 60,
        "wires": [
          {
            "id": "54664ccd.b262b4",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "Light Level",
        "type": "str",
        "value": ""
      }
    ],
    "color": "#DDAA99"
  },
  {
    "id": "56368b94.f11494",
    "type": "subflow",
    "name": "Is Dark",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 40,
        "y": 80,
        "wires": [
          {
            "id": "228d3470.7e90ac"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1160,
        "y": 80,
        "wires": [
          {
            "id": "76978b35.4c91e4",
            "port": 0
          },
          {
            "id": "228d3470.7e90ac",
            "port": 0
          },
          {
            "id": "8c895b54.0a9588",
            "port": 0
          }
        ]
      },
      {
        "x": 1160,
        "y": 140,
        "wires": [
          {
            "id": "76978b35.4c91e4",
            "port": 1
          },
          {
            "id": "8c895b54.0a9588",
            "port": 1
          }
        ]
      },
      {
        "x": 1140,
        "y": 300,
        "wires": []
      }
    ],
    "env": [],
    "color": "#DDAA99",
    "outputLabels": [
      "True",
      "False",
      "Unknown"
    ]
  },
  {
    "id": "2aff94ce.fdbbdc",
    "type": "subflow",
    "name": "Turn off computer",
    "info": "",
    "category": "sences",
    "in": [
      {
        "x": 60,
        "y": 80,
        "wires": [
          {
            "id": "97ee681f.882eb8"
          },
          {
            "id": "831923d6.979ec"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 740,
        "y": 120,
        "wires": [
          {
            "id": "2554c135.8f322e",
            "port": 0
          }
        ]
      }
    ],
    "env": []
  },
  {
    "id": "fec14295.8a46d",
    "type": "subflow",
    "name": "PayLoad Status",
    "info": "",
    "category": "MSB Core",
    "in": [
      {
        "x": 100,
        "y": 140,
        "wires": [
          {
            "id": "3889bd46.c46682"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 480,
        "y": 40,
        "wires": [
          {
            "id": "3889bd46.c46682",
            "port": 0
          },
          {
            "id": "3889bd46.c46682",
            "port": 1
          },
          {
            "id": "3889bd46.c46682",
            "port": 2
          },
          {
            "id": "3889bd46.c46682",
            "port": 3
          }
        ]
      },
      {
        "x": 480,
        "y": 200,
        "wires": [
          {
            "id": "3889bd46.c46682",
            "port": 4
          },
          {
            "id": "3889bd46.c46682",
            "port": 5
          },
          {
            "id": "3889bd46.c46682",
            "port": 6
          },
          {
            "id": "3889bd46.c46682",
            "port": 7
          }
        ]
      },
      {
        "x": 480,
        "y": 320,
        "wires": [
          {
            "id": "3889bd46.c46682",
            "port": 8
          }
        ]
      }
    ],
    "env": []
  },
  {
    "id": "cdbc6ec6.2e0ec",
    "type": "subflow",
    "name": "Is any on home?",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 40,
        "y": 60,
        "wires": [
          {
            "id": "49841f4d.0e0a6"
          },
          {
            "id": "1f3dd269.5d463e"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 880,
        "y": 40,
        "wires": [
          {
            "id": "78367767.3a14a8",
            "port": 0
          }
        ]
      },
      {
        "x": 880,
        "y": 100,
        "wires": [
          {
            "id": "78367767.3a14a8",
            "port": 1
          }
        ]
      }
    ],
    "env": [],
    "outputLabels": [
      "True",
      "False"
    ]
  },
  {
    "id": "85970b46.61e358",
    "type": "subflow",
    "name": "Allow Notication",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 50,
        "y": 30,
        "wires": [
          {
            "id": "b4c7c6f4.4d91b8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1020,
        "y": 20,
        "wires": [
          {
            "id": "9488063b.727978",
            "port": 0
          }
        ]
      },
      {
        "x": 1020,
        "y": 60,
        "wires": [
          {
            "id": "9488063b.727978",
            "port": 1
          }
        ]
      }
    ],
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "NOTHING"
      }
    ]
  },
  {
    "id": "7355692b.0038c8",
    "type": "subflow",
    "name": "Sec to Readable",
    "info": "",
    "category": "MSB Core",
    "in": [
      {
        "x": 50,
        "y": 30,
        "wires": [
          {
            "id": "93417511.0ebcd8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 500,
        "y": 100,
        "wires": [
          {
            "id": "93417511.0ebcd8",
            "port": 0
          }
        ]
      }
    ],
    "env": []
  },
  {
    "id": "e2e6b53d.b747f8",
    "type": "subflow",
    "name": "Automation Enabled",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 100,
        "wires": [
          {
            "id": "893e72ad.8293c"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1180,
        "y": 80,
        "wires": [
          {
            "id": "a101232f.6bc5e",
            "port": 0
          }
        ]
      },
      {
        "x": 1180,
        "y": 160,
        "wires": [
          {
            "id": "a0f16bbd.44df68",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "BreakerName",
        "type": "str",
        "value": ""
      },
      {
        "name": "InputPrefix",
        "type": "str",
        "value": "input_boolean.automation_"
      },
      {
        "name": "DefaultState",
        "type": "bool",
        "value": "true"
      }
    ]
  },
  {
    "id": "50a84f0.9f6dbb",
    "type": "subflow",
    "name": "Turn Off TV",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 100,
        "wires": [
          {
            "id": "a9849a45.2e7158"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 780,
        "y": 200,
        "wires": [
          {
            "id": "a9849a45.2e7158",
            "port": 1
          },
          {
            "id": "8ee5a185.8fd4e",
            "port": 0
          }
        ]
      }
    ],
    "env": []
  },
  {
    "id": "3b25c31e.848f5c",
    "type": "subflow",
    "name": "Record Cam",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 120,
        "y": 40,
        "wires": [
          {
            "id": "85cc4ab.9a2d9b8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1620,
        "y": 60,
        "wires": [
          {
            "id": "99bd274d.f1fcf8",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "CameraName",
        "type": "str",
        "value": ""
      },
      {
        "name": "RecordType",
        "type": "str",
        "value": "mp4"
      },
      {
        "name": "Duration",
        "type": "num",
        "value": "30"
      },
      {
        "name": "MQTT Topic",
        "type": "str",
        "value": "camera/???/record"
      }
    ],
    "color": "#DDAA99",
    "status": {
      "x": 780,
      "y": 240,
      "wires": [
        {
          "id": "72567fc8.5b251",
          "port": 0
        },
        {
          "id": "70f3f692.647568",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "42cea594.a055ac",
    "type": "subflow",
    "name": "Should Office Light Come On",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 220,
        "wires": [
          {
            "id": "bf61daf5.994bf8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1360,
        "y": 200,
        "wires": [
          {
            "id": "f11b6517.78b028",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "color": "#DDAA99"
  },
  {
    "id": "484cfc13.181de4",
    "type": "subflow",
    "name": "Fault Status",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 300,
        "y": 140,
        "wires": [
          {
            "id": "d183e95.6471018"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "fault.name",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "en-US": "Name of fault"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool",
              "json",
              "bin",
              "env"
            ]
          }
        }
      },
      {
        "name": "fault.item",
        "type": "str",
        "value": "",
        "ui": {
          "icon": "font-awesome/fa-desktop",
          "label": {
            "en-US": "Device Name"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool",
              "json",
              "bin",
              "env"
            ]
          }
        }
      },
      {
        "name": "fault.actiontofix",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "en-US": "How To Fix"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool",
              "json",
              "bin",
              "env"
            ]
          }
        }
      },
      {
        "name": "availbility.topic",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "en-US": "Availbility Topic"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool",
              "json",
              "bin",
              "env"
            ]
          }
        }
      }
    ],
    "color": "#DDAA99"
  },
  {
    "id": "3c093842.944ef8",
    "type": "subflow",
    "name": "Button Counter",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 280,
        "y": 160,
        "wires": [
          {
            "id": "77d14996.4e69c8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1180,
        "y": 160,
        "wires": [
          {
            "id": "394a27fa.aac8a8",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "color": "#DDAA99"
  },
  {
    "id": "c47facfc.ae997",
    "type": "subflow",
    "name": "Ikea On/Off Forwarder",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 140,
        "y": 260,
        "wires": [
          {
            "id": "d8e04257.04393"
          },
          {
            "id": "26881f2d.3efa3"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 2080,
        "y": 200,
        "wires": [
          {
            "id": "f8ad17dc.a40718",
            "port": 0
          },
          {
            "id": "cdfdc29a.34927",
            "port": 0
          },
          {
            "id": "77827cb0.c1bc04",
            "port": 0
          },
          {
            "id": "f77eb657.3b7508",
            "port": 0
          }
        ]
      },
      {
        "x": 1340,
        "y": 240,
        "wires": [
          {
            "id": "b42e742c.1cf258",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "entity_id",
        "type": "str",
        "value": ""
      }
    ],
    "color": "#DDAA99",
    "outputLabels": [
      "On / Light Level Changed",
      "Off"
    ]
  },
  {
    "id": "7341bbf9.74a0c4",
    "type": "subflow",
    "name": "PD Data",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 100,
        "y": 100,
        "wires": [
          {
            "id": "4de8d384.a15afc"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 540,
        "y": 80,
        "wires": []
      }
    ],
    "env": [
      {
        "name": "Location",
        "type": "str",
        "value": ""
      },
      {
        "name": "Trusted",
        "type": "bool",
        "value": "true"
      },
      {
        "name": "Trigger Alarm",
        "type": "bool",
        "value": "true"
      },
      {
        "name": "Trigger Alert",
        "type": "bool",
        "value": "true"
      },
      {
        "name": "Exturnal",
        "type": "bool",
        "value": "false"
      }
    ],
    "color": "#DDAA99"
  },
  {
    "id": "5ee4d578.f7736c",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "eef5a84.da24f58",
    "type": "server",
    "z": "",
    "name": "Home Assistant",
    "legacy": false,
    "addon": true,
    "rejectUnauthorizedCerts": true
  },
  {
    "id": "1b6bc4ba.56ff4b",
    "type": "mqtt-broker",
    "z": "",
    "name": "monitor",
    "broker": "192.168.1.253",
    "port": "1883",
    "clientid": "",
    "usetls": false,
    "compatmode": true,
    "keepalive": "60",
    "cleansession": true,
    "birthTopic": "",
    "birthQos": "0",
    "birthPayload": "Hassio",
    "closeTopic": "",
    "closeQos": "0",
    "closePayload": "",
    "willTopic": "",
    "willQos": "0",
    "willPayload": ""
  },
  {
    "id": "525afe76.43e05",
    "type": "light-scheduler-settings",
    "z": "",
    "name": "Home",
    "latitude": "51.398660",
    "longitude": "-1.316950"
  },
  {
    "id": "152fa50f.b6f93b",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "56ac32d7.54222c",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "fe14a53.c42df58",
    "type": "light-scheduler-settings",
    "z": "",
    "name": "my settings",
    "latitude": "45.5490814",
    "longitude": "-22.44234640000001"
  },
  {
    "id": "abf0af3d.05949",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "90568782.0ff848",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "88eacd55.1ede5",
    "type": "ui_base",
    "theme": {
      "name": "theme-light",
      "lightTheme": {
        "default": "#0094CE",
        "baseColor": "#0094CE",
        "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
        "edited": true,
        "reset": false
      },
      "darkTheme": {
        "default": "#097479",
        "baseColor": "#097479",
        "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
        "edited": false
      },
      "customTheme": {
        "name": "Untitled Theme 1",
        "default": "#4B7930",
        "baseColor": "#4B7930",
        "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
      },
      "themeState": {
        "base-color": {
          "default": "#0094CE",
          "value": "#0094CE",
          "edited": false
        },
        "page-titlebar-backgroundColor": {
          "value": "#0094CE",
          "edited": false
        },
        "page-backgroundColor": {
          "value": "#fafafa",
          "edited": false
        },
        "page-sidebar-backgroundColor": {
          "value": "#ffffff",
          "edited": false
        },
        "group-textColor": {
          "value": "#1bbfff",
          "edited": false
        },
        "group-borderColor": {
          "value": "#ffffff",
          "edited": false
        },
        "group-backgroundColor": {
          "value": "#ffffff",
          "edited": false
        },
        "widget-textColor": {
          "value": "#111111",
          "edited": false
        },
        "widget-backgroundColor": {
          "value": "#0094ce",
          "edited": false
        },
        "widget-borderColor": {
          "value": "#ffffff",
          "edited": false
        },
        "base-font": {
          "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
        }
      },
      "angularTheme": {
        "primary": "indigo",
        "accents": "blue",
        "warn": "red",
        "background": "grey"
      }
    },
    "site": {
      "name": "Node-RED Dashboard",
      "hideToolbar": "false",
      "allowSwipe": "false",
      "allowTempTheme": "true",
      "dateFormat": "DD/MM/YYYY",
      "sizes": {
        "sx": 48,
        "sy": 48,
        "gx": 6,
        "gy": 6,
        "cx": 6,
        "cy": 6,
        "px": 0,
        "py": 0
      }
    }
  },
  {
    "id": "9f26169c.88edf8",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "b630936b.d17eb",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "a71d0a02.2b45f8",
    "type": "server",
    "z": "",
    "name": "Home Assistant",
    "legacy": false,
    "rejectUnauthorizedCerts": false
  },
  {
    "id": "e0e223e3.be824",
    "type": "ui_group",
    "z": "",
    "name": "Bulb switch",
    "tab": "c788498.02a4db8",
    "disp": true,
    "width": "6",
    "collapse": false
  },
  {
    "id": "c788498.02a4db8",
    "type": "ui_tab",
    "z": "",
    "name": "Lights",
    "icon": "dashboard"
  },
  {
    "id": "3fa4c0fe.0f3ed",
    "type": "alexa-home-conf",
    "z": "",
    "username": "matbrewer396@gmail.com"
  },
  {
    "id": "404b4ef1.dd9e5",
    "type": "ui_group",
    "z": "",
    "name": "Default",
    "tab": "daa13738.1a9ba8",
    "disp": false,
    "width": "6"
  },
  {
    "id": "daa13738.1a9ba8",
    "type": "ui_tab",
    "z": "",
    "name": "Test",
    "icon": "dashboard",
    "order": 1
  },
  {
    "id": "6cdab321.f08dec",
    "type": "telegrambot-config",
    "z": "",
    "botname": "msbhouse_bot",
    "usernames": "",
    "chatIds": "945067103, -1001177434321",
    "pollInterval": "300"
  },
  {
    "id": "1fe7db2c.ec1355",
    "type": "server",
    "z": "",
    "name": "Home Assistant"
  },
  {
    "id": "aa6b80a.3524d8",
    "type": "server",
    "z": "",
    "name": "Home Assistant",
    "legacy": false,
    "rejectUnauthorizedCerts": false,
    "ha_boolean": "y|yes|true|on|home|open"
  },
  {
    "id": "e26b9e79.671e3",
    "type": "deconz-server",
    "z": "",
    "name": "deconz",
    "ip": "core-deconz",
    "port": "40850",
    "apikey": "BC4AD30F4E",
    "ws_port": "40860",
    "secure": false,
    "polling": "15"
  },
  {
    "id": "c2620092.1c7fe",
    "type": "mqtt-broker",
    "z": "8374deef.6aa85",
    "broker": "localhost",
    "port": "1883",
    "clientid": "Node-Red",
    "usetls": false,
    "compatmode": true,
    "keepalive": "60",
    "cleansession": true,
    "birthTopic": "",
    "birthQos": "0",
    "birthPayload": "",
    "willTopic": "",
    "willQos": "0",
    "willPayload": ""
  },
  {
    "id": "84be4026.05f42",
    "type": "ui_group",
    "z": "",
    "name": "Boiler Control",
    "tab": "4b2eb9fc.d69088",
    "order": 7,
    "disp": true,
    "width": "6",
    "collapse": false
  },
  {
    "id": "31807cef.86bda4",
    "type": "ui_group",
    "z": "",
    "name": "Circulating Pump Control",
    "tab": "4b2eb9fc.d69088",
    "order": 6,
    "disp": true,
    "width": "6",
    "collapse": false
  },
  {
    "id": "4b2eb9fc.d69088",
    "type": "ui_tab",
    "z": "",
    "name": "CURTIN house main page",
    "icon": "dashboard",
    "order": 1
  },
  {
    "id": "839c216a.4a97d",
    "type": "api-call-service",
    "z": "a83e69e1.4b2ab8",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "",
    "data": "{}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 710,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "c5f11237.56983",
    "type": "function",
    "z": "47bc2d66.1132e4",
    "name": "Build Data",
    "func": "msg.payload = {\n    \"data\":\n        { \"message\": msg.say\n        ,\"data\": {\"type\":\"tts\"}\n        , \"target\": msg.pri_alexa }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 770,
    "y": 60,
    "wires": [
      [
        "275d0587.9c0bba"
      ]
    ]
  },
  {
    "id": "275d0587.9c0bba",
    "type": "api-call-service",
    "z": "47bc2d66.1132e4",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "alexa_media",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1190,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "c6c0af75.98fa5",
    "type": "switch",
    "z": "47bc2d66.1132e4",
    "name": "",
    "property": "alexa",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "down",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "up",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "office",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Kitchen",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "bath",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 6,
    "x": 230,
    "y": 180,
    "wires": [
      [
        "dfc50416.e4f068"
      ],
      [
        "f378f617.7ecbe8"
      ],
      [
        "2704ac25.a7fd64"
      ],
      [
        "3d3fb4fe.b5ba7c"
      ],
      [
        "7447c294.cedd9c"
      ],
      [
        "f3a398d3.2da708"
      ]
    ]
  },
  {
    "id": "f3a398d3.2da708",
    "type": "change",
    "z": "47bc2d66.1132e4",
    "name": "All",
    "rules": [
      {
        "t": "set",
        "p": "pri_alexa",
        "pt": "msg",
        "to": "[\"media_player.bedroom_2\",\"media_player.living_room_2\",\"media_player.kitten\",\"media_player.office\",\"media_player.barthroom_2\"]",
        "tot": "json"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 300,
    "wires": [
      [
        "c5f11237.56983"
      ]
    ]
  },
  {
    "id": "2704ac25.a7fd64",
    "type": "change",
    "z": "47bc2d66.1132e4",
    "name": "Office",
    "rules": [
      {
        "t": "set",
        "p": "pri_alexa",
        "pt": "msg",
        "to": "[\"media_player.office\"]",
        "tot": "json"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 220,
    "wires": [
      [
        "c5f11237.56983"
      ]
    ]
  },
  {
    "id": "dfc50416.e4f068",
    "type": "change",
    "z": "47bc2d66.1132e4",
    "name": "Down",
    "rules": [
      {
        "t": "set",
        "p": "pri_alexa",
        "pt": "msg",
        "to": "[\"media_player.kitten\",\"media_player.living_room_2\",\"media_player.office\"]",
        "tot": "json"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 140,
    "wires": [
      [
        "c5f11237.56983"
      ]
    ]
  },
  {
    "id": "f378f617.7ecbe8",
    "type": "change",
    "z": "47bc2d66.1132e4",
    "name": "Up",
    "rules": [
      {
        "t": "set",
        "p": "pri_alexa",
        "pt": "msg",
        "to": "[\"media_player.bedroom_2\",\"media_player.barthroom_2\"]",
        "tot": "json"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 180,
    "wires": [
      [
        "c5f11237.56983"
      ]
    ]
  },
  {
    "id": "f3c4fe69.bcf49",
    "type": "server-state-changed",
    "z": "a3158433.9d1f78",
    "name": "Danni Home/Away",
    "server": "eef5a84.da24f58",
    "version": 1,
    "entityidfilter": "device_tracker.life360_danni",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 150,
    "y": 452,
    "wires": [
      [
        "b15702d1.3a09"
      ]
    ]
  },
  {
    "id": "8bff2496.0f9698",
    "type": "server-state-changed",
    "z": "a3158433.9d1f78",
    "name": "Matt Home/Away",
    "server": "eef5a84.da24f58",
    "version": 1,
    "entityidfilter": "device_tracker.life360_matt",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 140,
    "y": 492,
    "wires": [
      [
        "57ce7fd6.512fb"
      ]
    ]
  },
  {
    "id": "2040e4b1.d5c3fc",
    "type": "function",
    "z": "a3158433.9d1f78",
    "name": "Home/Away State Change",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1180,
    "y": 520,
    "wires": [
      [
        "728fde3f.09ce9",
        "688dba9c.79d5d4",
        "28fe8ca4.275294",
        "e7ea3a2f.0a3d58"
      ]
    ]
  },
  {
    "id": "53c7d5e.0294d2c",
    "type": "inject",
    "z": "a3158433.9d1f78",
    "name": "Started",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "360",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 661,
    "wires": [
      [
        "2040e4b1.d5c3fc"
      ]
    ]
  },
  {
    "id": "688dba9c.79d5d4",
    "type": "api-current-state",
    "z": "a3158433.9d1f78",
    "name": "",
    "server": "eef5a84.da24f58",
    "outputs": 1,
    "halt_if": "",
    "override_topic": true,
    "entity_id": "device_tracker.life360_matt",
    "override_payload": true,
    "override_data": true,
    "x": 1520,
    "y": 480,
    "wires": [
      [
        "5d6e628f.7aa7fc"
      ]
    ]
  },
  {
    "id": "728fde3f.09ce9",
    "type": "api-current-state",
    "z": "a3158433.9d1f78",
    "name": "",
    "server": "eef5a84.da24f58",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "device_tracker.life360_danni",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 1530,
    "y": 440,
    "wires": [
      [
        "5d6e628f.7aa7fc"
      ]
    ]
  },
  {
    "id": "5d6e628f.7aa7fc",
    "type": "join",
    "z": "a3158433.9d1f78",
    "name": "",
    "mode": "custom",
    "build": "array",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "accumulate": false,
    "timeout": "1",
    "count": "4",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "num",
    "reduceFixup": "",
    "x": 1850,
    "y": 591,
    "wires": [
      [
        "4f9fd6c1.ad5b48"
      ]
    ]
  },
  {
    "id": "4f9fd6c1.ad5b48",
    "type": "function",
    "z": "a3158433.9d1f78",
    "name": "Is Anyone Home",
    "func": "var currentstate = msg.payload[3];\n\n// is someone home?\nif (msg.payload[0] == \"home\" || msg.payload[1] == \"home\" || msg.payload[2] == \"on\") {\n    msg.payload=\"home\";\n} else {\n    msg.payload=\"away\";\n}\n\n// check if status need changing\nif ( (msg.payload==\"home\" && currentstate ==\"off\") || (msg.payload==\"away\" && currentstate ==\"on\") ) {\n    return msg; // Status Changed\n}\n//Else do nothin",
    "outputs": 1,
    "noerr": 0,
    "x": 2020,
    "y": 591,
    "wires": [
      [
        "4d55b523.00f95c",
        "452803e9.c2df6c"
      ]
    ]
  },
  {
    "id": "21652d70.72b232",
    "type": "switch",
    "z": "a3158433.9d1f78",
    "name": "Is Anyone Home?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "home",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "away",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 2770,
    "y": 588,
    "wires": [
      [
        "634ad6f8.7dd188",
        "883e0b57.4516a8",
        "eed11822.6bddf8"
      ],
      [
        "6ee79555.3f313c",
        "da51fb26.c7d168"
      ]
    ]
  },
  {
    "id": "5833b5e2.1eff2c",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Is Any One Home - Bluetooth",
    "info": "",
    "x": 180,
    "y": 180,
    "wires": []
  },
  {
    "id": "28fe8ca4.275294",
    "type": "api-current-state",
    "z": "a3158433.9d1f78",
    "name": "Do we  have guests?",
    "server": "eef5a84.da24f58",
    "outputs": 1,
    "halt_if": "",
    "override_topic": true,
    "entity_id": "input_boolean.guestmode",
    "override_payload": true,
    "x": 1460,
    "y": 600,
    "wires": [
      [
        "5d6e628f.7aa7fc"
      ]
    ]
  },
  {
    "id": "eaeaafd.b8a8f5",
    "type": "server-state-changed",
    "z": "a3158433.9d1f78",
    "name": "Guest Mode Change",
    "server": "eef5a84.da24f58",
    "version": "1",
    "entityidfilter": "input_boolean.guestmode",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 150,
    "y": 601,
    "wires": [
      [
        "cab70747.d77428"
      ]
    ]
  },
  {
    "id": "1614fe61.738122",
    "type": "link in",
    "z": "a3158433.9d1f78",
    "name": "Home",
    "links": [
      "634ad6f8.7dd188"
    ],
    "x": 75,
    "y": 912,
    "wires": [
      [
        "aea97881.44ab78",
        "a2cfceb9.6eebc",
        "23bafa9c.c59eb6"
      ]
    ],
    "outputLabels": [
      "Home"
    ]
  },
  {
    "id": "634ad6f8.7dd188",
    "type": "link out",
    "z": "a3158433.9d1f78",
    "name": "Welcome Home",
    "links": [
      "1614fe61.738122",
      "2eee0fe3.6615e",
      "f7740640.c80dd8",
      "7b16b22f.9b719c",
      "75a9b44f.1ad8bc",
      "62e65b11.82cb44"
    ],
    "x": 2995,
    "y": 500,
    "wires": [],
    "inputLabels": [
      "Home"
    ]
  },
  {
    "id": "70cd6553.d9d7cc",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Some one is now home",
    "info": "",
    "x": 160,
    "y": 861,
    "wires": []
  },
  {
    "id": "e7ea3a2f.0a3d58",
    "type": "api-current-state",
    "z": "a3158433.9d1f78",
    "name": "Current State Is Any One Home?",
    "server": "eef5a84.da24f58",
    "version": "1",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.isanyonehome",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1500,
    "y": 640,
    "wires": [
      [
        "5d6e628f.7aa7fc"
      ]
    ]
  },
  {
    "id": "a849bd7.c3a3a4",
    "type": "light-scheduler",
    "z": "b8a16318.b66a5",
    "settings": "525afe76.43e05",
    "events": "[]",
    "topic": "",
    "name": "Minutely",
    "onPayload": "ON",
    "onPayloadType": "str",
    "offPayload": "OFF",
    "offPayloadType": "str",
    "onlyWhenDark": true,
    "sunElevationThreshold": 6,
    "sunShowElevationInStatus": false,
    "outputfreq": "output.minutely",
    "x": 80,
    "y": 180,
    "wires": [
      [
        "b8da62bc.cac9f"
      ]
    ]
  },
  {
    "id": "b8da62bc.cac9f",
    "type": "api-call-service",
    "z": "b8a16318.b66a5",
    "name": "trigger",
    "server": "5ee4d578.f7736c",
    "service_domain": "input_boolean",
    "service": "toggle",
    "data": "{\"entity_id\":\"input_boolean.node_red\"}",
    "mergecontext": "",
    "x": 450,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "cf21f0fb.2f7f3",
    "type": "server-state-changed",
    "z": "b8a16318.b66a5",
    "name": "",
    "server": "5ee4d578.f7736c",
    "entityidfilter": "input_boolean.node_red",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "haltifstate": "",
    "outputs": 1,
    "x": 180,
    "y": 240,
    "wires": [
      [
        "ec2a3737.b71338"
      ]
    ]
  },
  {
    "id": "ec2a3737.b71338",
    "type": "change",
    "z": "b8a16318.b66a5",
    "name": "Ok",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "ok",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 470,
    "y": 240,
    "wires": [
      [
        "9214255.4c06fd8"
      ]
    ]
  },
  {
    "id": "9214255.4c06fd8",
    "type": "mqtt out",
    "z": "b8a16318.b66a5",
    "name": "Check In",
    "topic": "checkIn/nodeRED",
    "qos": "0",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 720,
    "y": 240,
    "wires": []
  },
  {
    "id": "f4d0131e.967c4",
    "type": "link out",
    "z": "a3158433.9d1f78",
    "name": "No One Home",
    "links": [
      "cf6185e1.eca748"
    ],
    "x": 3475,
    "y": 660,
    "wires": [],
    "inputLabels": [
      "NoOneHome"
    ]
  },
  {
    "id": "cb6f8d7b.e7f43",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Holiday Day Mode",
    "info": "",
    "x": 150,
    "y": 1140,
    "wires": []
  },
  {
    "id": "cf6185e1.eca748",
    "type": "link in",
    "z": "a3158433.9d1f78",
    "name": "No One Home",
    "links": [
      "f4d0131e.967c4"
    ],
    "x": 275,
    "y": 1320,
    "wires": [
      [
        "10c5642a.86179c",
        "606db896.9f2128",
        "b0c86ed5.ad287",
        "dc2626b6.cb8a88",
        "740c59e5.4fccd8",
        "4d9f4167.b65e1",
        "9e7450fb.4d726"
      ]
    ]
  },
  {
    "id": "10c5642a.86179c",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "",
    "op1": "",
    "op2": "1",
    "op1type": "nul",
    "op2type": "str",
    "duration": "24",
    "extend": false,
    "units": "hr",
    "reset": "some_one_home",
    "bytopic": "all",
    "outputs": 1,
    "x": 850,
    "y": 1380,
    "wires": [
      [
        "c29bf2f6.ae361",
        "6fd0fa0d.478324"
      ]
    ]
  },
  {
    "id": "2eee0fe3.6615e",
    "type": "link in",
    "z": "a3158433.9d1f78",
    "name": "",
    "links": [
      "634ad6f8.7dd188"
    ],
    "x": 275,
    "y": 1360,
    "wires": [
      [
        "ab10961d.96e4e8",
        "52988821.c30f68"
      ]
    ]
  },
  {
    "id": "b7036f12.99341",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "No One Home",
    "info": "",
    "x": 130,
    "y": 1320,
    "wires": []
  },
  {
    "id": "12b35117.aa471f",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Some one home",
    "info": "",
    "x": 140,
    "y": 1360,
    "wires": []
  },
  {
    "id": "ab10961d.96e4e8",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "some_one_home",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 460,
    "y": 1360,
    "wires": [
      [
        "10c5642a.86179c",
        "606db896.9f2128"
      ]
    ]
  },
  {
    "id": "c29bf2f6.ae361",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Activing holiday - Message",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"I miss you! Activing holiday mode\",\"data\":{\"push\":{\"badge\":5,\"category\":\"missyou\"}}}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1100,
    "y": 1380,
    "wires": [
      []
    ]
  },
  {
    "id": "6fd0fa0d.478324",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Active Holiday Mode",
    "server": "eef5a84.da24f58",
    "service_domain": "input_boolean",
    "service": "turn_on",
    "data": "{\"entity_id\":\"input_boolean.holidaymode\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1080,
    "y": 1420,
    "wires": [
      []
    ]
  },
  {
    "id": "7bfe7445.6fe4ec",
    "type": "api-call-service",
    "z": "99d64a3d.f4e418",
    "name": "Turn Off Lights",
    "server": "eef5a84.da24f58",
    "version": "1",
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.hue_lightstrip_plus_1",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1140,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "626c9c60.30cf24",
    "type": "delay",
    "z": "99d64a3d.f4e418",
    "name": "wait 25 min",
    "pauseType": "delay",
    "timeout": "10",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 890,
    "y": 40,
    "wires": [
      [
        "7bfe7445.6fe4ec"
      ]
    ]
  },
  {
    "id": "c097e9b2.498308",
    "type": "server-state-changed",
    "z": "d1172b8b.3d3298",
    "name": "Press Door Bell",
    "server": "eef5a84.da24f58",
    "version": "1",
    "entityidfilter": "sensor.doorbell",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 120,
    "y": 180,
    "wires": [
      [
        "20c3a105.50479e"
      ]
    ]
  },
  {
    "id": "20c3a105.50479e",
    "type": "switch",
    "z": "d1172b8b.3d3298",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "Ding",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 730,
    "y": 180,
    "wires": [
      [
        "758d40c5.72f3a",
        "ae019a30.ff6f78",
        "dcdab32e.51851",
        "9f0fb26a.fe3a3"
      ]
    ]
  },
  {
    "id": "d5016157.07bab",
    "type": "server-state-changed",
    "z": "99d64a3d.f4e418",
    "name": "Sun Changes",
    "server": "eef5a84.da24f58",
    "version": 1,
    "entityidfilter": "sun.sun",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 130,
    "y": 200,
    "wires": [
      [
        "65dc3645.de0718"
      ]
    ]
  },
  {
    "id": "90da2e6b.cdc5f",
    "type": "function",
    "z": "99d64a3d.f4e418",
    "name": "Check if sun is up",
    "func": "var oldstatus=global.get('sunstate') || \"unknown\";\n\nif (msg.payload == \"above_horizon\" && oldstatus == \"below_horizon\") {\n    global.set('sunstate', msg.payload)\n    return [msg, null];\n} else if ( oldstatus !== msg.payload ) {\n    global.set('sunstate', msg.payload)\n    return [null, msg];\n}",
    "outputs": 2,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "x": 550,
    "y": 200,
    "wires": [
      [
        "626c9c60.30cf24",
        "6125c1be.4d871",
        "7186346f.4ab48c",
        "203edcd4.c6a1f4"
      ],
      [
        "16141182.94e26e",
        "f228fea8.09dd9"
      ]
    ]
  },
  {
    "id": "6e45a7ed.2c8728",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Is it Bed time - Matt",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "notify",
    "service": "mattiphone",
    "entityId": "",
    "data": "{\"message\":\"Bed time? I'm turning everything off in 5 minutes\",\"data\":{\"push\":{\"badge\":5,\"category\":\"goodnight\"}}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 2630,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "42b9d4f8.a38aac",
    "type": "server-events",
    "z": "d73100a9.0d64d",
    "name": "All",
    "server": "eef5a84.da24f58",
    "event_type": "ios.notification_action_fired",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "x": 90,
    "y": 580,
    "wires": [
      [
        "719c46bb.4eab48"
      ]
    ]
  },
  {
    "id": "719c46bb.4eab48",
    "type": "switch",
    "z": "d73100a9.0d64d",
    "name": "",
    "property": "payload.event.actionName",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "STILL_AWAKE_30",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "STILL_AWAKE_60",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "STILL_AWAKE_180",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "GOOD_NIGHT_NOW",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "DISABLE_AUTO_NIGHT",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 5,
    "x": 290,
    "y": 580,
    "wires": [
      [
        "99df83ab.46e3b",
        "8a9e4a8c.294d28"
      ],
      [
        "99df83ab.46e3b",
        "be9e3159.3ea59"
      ],
      [
        "99df83ab.46e3b",
        "69a40cbb.df3674"
      ],
      [
        "33d67a23.de0b26"
      ],
      [
        "99df83ab.46e3b"
      ]
    ]
  },
  {
    "id": "3ba7ec90.402494",
    "type": "light-scheduler",
    "z": "d73100a9.0d64d",
    "settings": "525afe76.43e05",
    "events": "[{\"start\":{\"dow\":6,\"mod\":1365},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":1350},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":1,\"mod\":0},\"end\":{\"dow\":1,\"mod\":360}},{\"start\":{\"dow\":3,\"mod\":0},\"end\":{\"dow\":3,\"mod\":360}},{\"start\":{\"dow\":4,\"mod\":0},\"end\":{\"dow\":4,\"mod\":360}},{\"start\":{\"dow\":6,\"mod\":0},\"end\":{\"dow\":6,\"mod\":360}},{\"start\":{\"dow\":0,\"mod\":0},\"end\":{\"dow\":0,\"mod\":360}},{\"start\":{\"dow\":2,\"mod\":1290},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":1290},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":1290},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":1290},\"end\":{\"dow\":1,\"mod\":30}},{\"start\":{\"dow\":1,\"mod\":1200},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":1200},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":3,\"mod\":1200},\"end\":{\"dow\":3,\"mod\":1290}},{\"start\":{\"dow\":4,\"mod\":1200},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":0,\"mod\":1200},\"end\":{\"dow\":0,\"mod\":1290}},{\"start\":{\"dow\":6,\"mod\":1320},\"end\":{\"dow\":6,\"mod\":1365}},{\"start\":{\"dow\":5,\"mod\":1320},\"end\":{\"dow\":5,\"mod\":1350}},{\"start\":{\"dow\":6,\"mod\":1305},\"end\":{\"dow\":6,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":1305},\"end\":{\"dow\":5,\"mod\":1320}},{\"start\":{\"dow\":1,\"mod\":1140},\"end\":{\"dow\":1,\"mod\":1200}},{\"start\":{\"dow\":2,\"mod\":1140},\"end\":{\"dow\":2,\"mod\":1200}},{\"start\":{\"dow\":3,\"mod\":1140},\"end\":{\"dow\":3,\"mod\":1200}},{\"start\":{\"dow\":0,\"mod\":1140},\"end\":{\"dow\":0,\"mod\":1200}},{\"start\":{\"dow\":4,\"mod\":1140},\"end\":{\"dow\":4,\"mod\":1200}},{\"start\":{\"dow\":5,\"mod\":0},\"end\":{\"dow\":5,\"mod\":360}},{\"start\":{\"dow\":2,\"mod\":0},\"end\":{\"dow\":2,\"mod\":360}}]",
    "topic": "",
    "name": "Auto Good Night",
    "onPayload": "On",
    "onPayloadType": "str",
    "offPayload": "Off",
    "offPayloadType": "str",
    "onlyWhenDark": false,
    "sunElevationThreshold": 6,
    "sunShowElevationInStatus": false,
    "outputfreq": "output.statechange.startup",
    "x": 120,
    "y": 380,
    "wires": [
      [
        "6f09f51.c3f470c"
      ]
    ]
  },
  {
    "id": "76161c80.f91cb4",
    "type": "rbe",
    "z": "d73100a9.0d64d",
    "name": "RBE",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 450,
    "y": 360,
    "wires": [
      [
        "3ab9d8ee.d56268"
      ]
    ]
  },
  {
    "id": "3ab9d8ee.d56268",
    "type": "switch",
    "z": "d73100a9.0d64d",
    "name": "Is it night",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "On",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 620,
    "y": 360,
    "wires": [
      [
        "e259c26a.e4ce5",
        "3f4805be.d14eba"
      ],
      [
        "8f58fd59.491a9"
      ]
    ]
  },
  {
    "id": "99df83ab.46e3b",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Disabled minutes timer",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 742,
    "y": 510,
    "wires": [
      [
        "ef7cb132.ad547",
        "4ebb4395.792b0c",
        "a9920411.01ba78",
        "94c4fb0a.6129d8",
        "b399da43.7ff288",
        "c73f668c.f7ef28",
        "72c3ab65.ad95e4",
        "fc10e2c0.0607"
      ]
    ]
  },
  {
    "id": "ef7cb132.ad547",
    "type": "trigger",
    "z": "d73100a9.0d64d",
    "name": "",
    "op1": "",
    "op2": "on",
    "op1type": "nul",
    "op2type": "str",
    "duration": "30",
    "extend": true,
    "units": "min",
    "reset": "off",
    "bytopic": "all",
    "outputs": 1,
    "x": 972,
    "y": 610,
    "wires": [
      [
        "5d68af75.25cde"
      ]
    ]
  },
  {
    "id": "4ebb4395.792b0c",
    "type": "trigger",
    "z": "d73100a9.0d64d",
    "name": "",
    "op1": "",
    "op2": "on",
    "op1type": "nul",
    "op2type": "str",
    "duration": "60",
    "extend": true,
    "units": "min",
    "reset": "off",
    "bytopic": "all",
    "outputs": 1,
    "x": 972,
    "y": 670,
    "wires": [
      [
        "5d68af75.25cde"
      ]
    ]
  },
  {
    "id": "a9920411.01ba78",
    "type": "trigger",
    "z": "d73100a9.0d64d",
    "name": "",
    "op1": "",
    "op2": "on",
    "op1type": "nul",
    "op2type": "str",
    "duration": "180",
    "extend": true,
    "units": "min",
    "reset": "off",
    "bytopic": "all",
    "outputs": 1,
    "x": 982,
    "y": 730,
    "wires": [
      [
        "5d68af75.25cde"
      ]
    ]
  },
  {
    "id": "5d68af75.25cde",
    "type": "link out",
    "z": "d73100a9.0d64d",
    "name": "Good Night Message",
    "links": [
      "53134777.f235d8"
    ],
    "x": 1162,
    "y": 630,
    "wires": []
  },
  {
    "id": "8a9e4a8c.294d28",
    "type": "delay",
    "z": "d73100a9.0d64d",
    "name": "",
    "pauseType": "delay",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 742,
    "y": 610,
    "wires": [
      [
        "ef7cb132.ad547"
      ]
    ]
  },
  {
    "id": "be9e3159.3ea59",
    "type": "delay",
    "z": "d73100a9.0d64d",
    "name": "",
    "pauseType": "delay",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 742,
    "y": 670,
    "wires": [
      [
        "4ebb4395.792b0c"
      ]
    ]
  },
  {
    "id": "69a40cbb.df3674",
    "type": "delay",
    "z": "d73100a9.0d64d",
    "name": "",
    "pauseType": "delay",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 742,
    "y": 730,
    "wires": [
      [
        "a9920411.01ba78"
      ]
    ]
  },
  {
    "id": "e259c26a.e4ce5",
    "type": "api-current-state",
    "z": "d73100a9.0d64d",
    "name": "Holiday Mode",
    "server": "eef5a84.da24f58",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.holidaymode",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": true,
    "x": 820,
    "y": 360,
    "wires": [
      [],
      [
        "6ea9b8b4.f2d438"
      ]
    ]
  },
  {
    "id": "4fe60a4.0699df4",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"message\":\"ding-dong. someone is at the door ding dong ding\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 560,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "33cd10bc.f8f8d",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 290,
    "y": 60,
    "wires": [
      [
        "4fe60a4.0699df4"
      ]
    ]
  },
  {
    "id": "de1dc5d2.7f3ee8",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"media_player.everywhere\",\"message\":\"ding-dong. someone is at the door ding dong ding\"}",
    "mergecontext": "",
    "x": 620,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "9b8fbc9.c6f7f4",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "Everywhere doesnt work",
    "info": "",
    "x": 330,
    "y": 160,
    "wires": []
  },
  {
    "id": "3df4c611.fbbcda",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Hallway Motion",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.hallway_motion_sensor",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 160,
    "y": 760,
    "wires": [
      [
        "c8944506.30f148",
        "e04902ac.5849e"
      ]
    ]
  },
  {
    "id": "84d7dd65.ad146",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Bath Room Motion",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.bathroom_sensor_motion",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 170,
    "y": 920,
    "wires": [
      [
        "8d007ed4.b4b9",
        "90fde8f7.a26cb8"
      ]
    ]
  },
  {
    "id": "64a723bb.a421cc",
    "type": "switch",
    "z": "a068bd5.28a8d4",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 910,
    "y": 1020,
    "wires": [
      [
        "297e3f11.045a3"
      ]
    ]
  },
  {
    "id": "3b5bbfbe.77c1d",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "Stop Timer - Good Night Triggered",
    "links": [
      "766b8cf0.e8b514"
    ],
    "x": 55,
    "y": 480,
    "wires": [
      [
        "7b1a73dc.d70fec"
      ]
    ]
  },
  {
    "id": "7b1a73dc.d70fec",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "On",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 200,
    "y": 480,
    "wires": [
      [
        "99df83ab.46e3b"
      ]
    ]
  },
  {
    "id": "55cdae2b.c2b73",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Good Night Triggerd",
    "info": "",
    "x": 130,
    "y": 440,
    "wires": []
  },
  {
    "id": "65dc3645.de0718",
    "type": "rbe",
    "z": "99d64a3d.f4e418",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 330,
    "y": 200,
    "wires": [
      [
        "90da2e6b.cdc5f"
      ]
    ]
  },
  {
    "id": "2fb494b2.81f1ac",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Living Room Cam",
    "server": "5ee4d578.f7736c",
    "entityidfilter": " input_boolean.motionlivingroom",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "haltifstate": "",
    "outputs": 1,
    "x": 170,
    "y": 1191,
    "wires": [
      [
        "2c51c6d4.5f6e0a",
        "8fb9ba5e.40ec38"
      ]
    ]
  },
  {
    "id": "c8944506.30f148",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Hallway Motion Detected",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Hallway Motion Detected",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "image",
        "pt": "msg",
        "to": "https://msb396.duckdns.org/api/camera_proxy/camera.living_room?token=6bf07bbf33a0a37622a7fd25c019ed1fb1169449b4a0b808fafdb5800b2e5c3f",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 490,
    "y": 760,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "8d007ed4.b4b9",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Bathroom Motion Detected",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Bathroom Motion Detected",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 500,
    "y": 920,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "2c51c6d4.5f6e0a",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Living Motion Detected",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Living Room Motion Detected",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "image",
        "pt": "msg",
        "to": "https://msb396.duckdns.org/api/camera_proxy/camera.living_room?token=6bf07bbf33a0a37622a7fd25c019ed1fb1169449b4a0b808fafdb5800b2e5c3f",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "trusted",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 480,
    "y": 1191,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "8fb9ba5e.40ec38",
    "type": "api-current-state",
    "z": "a068bd5.28a8d4",
    "name": "Main Light Status On?",
    "server": "9f26169c.88edf8",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.bed_room_lamp",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 720,
    "y": 1620,
    "wires": [
      [
        "59366fbb.88318"
      ]
    ]
  },
  {
    "id": "17dd0169.527b5f",
    "type": "api-current-state",
    "z": "a068bd5.28a8d4",
    "name": "Good Night Been Trigger",
    "server": "9f26169c.88edf8",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.goodnight_beentriggered",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1190,
    "y": 1620,
    "wires": [
      [
        "805e34e0.934a48"
      ]
    ]
  },
  {
    "id": "a961f727.8da2a8",
    "type": "api-call-service",
    "z": "99d64a3d.f4e418",
    "name": "Reset - Has Been Triggered",
    "server": "5ee4d578.f7736c",
    "service_domain": "input_boolean",
    "service": "turn_off",
    "data": "{\"entity_id\":\"input_boolean.goodnight_beentriggered\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1160,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "59366fbb.88318",
    "type": "switch",
    "z": "a068bd5.28a8d4",
    "name": "On / Off",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 920,
    "y": 1620,
    "wires": [
      [
        "17dd0169.527b5f"
      ],
      []
    ]
  },
  {
    "id": "805e34e0.934a48",
    "type": "switch",
    "z": "a068bd5.28a8d4",
    "name": "On / Off",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1440,
    "y": 1620,
    "wires": [
      [
        "dee4af6a.215dc"
      ],
      []
    ]
  },
  {
    "id": "dee4af6a.215dc",
    "type": "debug",
    "z": "a068bd5.28a8d4",
    "name": "Trigger Light",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1660,
    "y": 1620,
    "wires": []
  },
  {
    "id": "f0d43a70.70bbb8",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "Set 60%",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "volume_set",
    "data": "{\"entity_id\":\"media_player.bedroom\",\"volume_level\":\"0.67\"}",
    "mergecontext": "",
    "x": 600,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "34f12c36.4e6ae4",
    "type": "function",
    "z": "1f9e3480.5be75c",
    "name": "Data",
    "func": "msg.payload.data = \n{\n    \"entity_id\": \"media_player.bedroom\",\n    \"volume_level\": \"1\"\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 730,
    "y": 360,
    "wires": [
      [
        "92091263.aba56"
      ]
    ]
  },
  {
    "id": "9dbceeb3.9578e",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 220,
    "y": 260,
    "wires": [
      [
        "f0d43a70.70bbb8"
      ]
    ]
  },
  {
    "id": "d21e3ef6.d533a",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 360,
    "wires": [
      [
        "7189aa7c.e53204"
      ]
    ]
  },
  {
    "id": "7189aa7c.e53204",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "Office Alexa",
    "rules": [
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "media_player.bedroom",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 360,
    "wires": [
      [
        "34f12c36.4e6ae4"
      ]
    ]
  },
  {
    "id": "92091263.aba56",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "Set vol",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "volume_set",
    "data": "{}",
    "mergecontext": "",
    "x": 930,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "38f95fb7.ba333",
    "type": "template",
    "z": "1f9e3480.5be75c",
    "name": "Format Floor Lamp Right State",
    "field": "payload",
    "fieldType": "msg",
    "format": "json",
    "syntax": "mustache",
    "template": "{\n\"data\":\n    {\n        \"entity_id\" : \"media_player.bedroom\",\n        \"volume_level\": \"0.20\"\n    }\n}",
    "output": "json",
    "x": 530,
    "y": 460,
    "wires": [
      [
        "973b70d3.bdda1"
      ]
    ]
  },
  {
    "id": "c668dad9.6b1c18",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 460,
    "wires": [
      [
        "38f95fb7.ba333"
      ]
    ]
  },
  {
    "id": "973b70d3.bdda1",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "Set vol",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "volume_set",
    "data": "{\"entity_id\":\"matt\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 790,
    "y": 460,
    "wires": [
      []
    ]
  },
  {
    "id": "8dac45ba.71e228",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "Set 20%",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "volume_set",
    "data": "{\"entity_id\":\"media_player.bedroom\",\"volume_level\":\"0.20\"}",
    "mergecontext": "",
    "x": 600,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "f6a57dd8.6de63",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 220,
    "y": 320,
    "wires": [
      [
        "8dac45ba.71e228"
      ]
    ]
  },
  {
    "id": "2e171eab.0e1fc2",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 300,
    "y": 200,
    "wires": [
      [
        "de1dc5d2.7f3ee8"
      ]
    ]
  },
  {
    "id": "ed7b3a6b.a4ef58",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"media_player.bedroom\"}",
    "mergecontext": "",
    "x": 840,
    "y": 660,
    "wires": [
      []
    ]
  },
  {
    "id": "4518df0d.a41ba",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 210,
    "y": 660,
    "wires": [
      [
        "825f5454.f76ac8"
      ]
    ]
  },
  {
    "id": "825f5454.f76ac8",
    "type": "function",
    "z": "1f9e3480.5be75c",
    "name": "Data",
    "func": "msg.payload = { \"data\" : { \"message\":\"test\" } }\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 510,
    "y": 660,
    "wires": [
      [
        "ed7b3a6b.a4ef58",
        "10ca0df.86a63f2"
      ]
    ]
  },
  {
    "id": "38428bfe.d283b4",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"media_player.bedroom\",\"message\":\"test\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 880,
    "y": 1060,
    "wires": [
      []
    ]
  },
  {
    "id": "1fc1ff4c.9939c1",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 520,
    "y": 1060,
    "wires": [
      [
        "38428bfe.d283b4"
      ]
    ]
  },
  {
    "id": "768e9aa2.a56d04",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "hello",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 420,
    "y": 860,
    "wires": [
      [
        "345154d3.e49bec",
        "cd8d0050.ddd2f"
      ]
    ]
  },
  {
    "id": "7c316de.10cbf94",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"media_player.bedroom\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 960,
    "y": 860,
    "wires": [
      []
    ]
  },
  {
    "id": "5a1e1a57.4d3ef4",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 200,
    "y": 860,
    "wires": [
      [
        "768e9aa2.a56d04"
      ]
    ]
  },
  {
    "id": "345154d3.e49bec",
    "type": "function",
    "z": "1f9e3480.5be75c",
    "name": "Data",
    "func": "msg.payload = { \"data\" : { \"message\": msg.payload } }\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 690,
    "y": 860,
    "wires": [
      [
        "7c316de.10cbf94",
        "e4d47da3.2e518"
      ]
    ]
  },
  {
    "id": "10ca0df.86a63f2",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 760,
    "y": 740,
    "wires": []
  },
  {
    "id": "e4d47da3.2e518",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 920,
    "y": 960,
    "wires": []
  },
  {
    "id": "cd8d0050.ddd2f",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 690,
    "y": 960,
    "wires": []
  },
  {
    "id": "6ba76e86.90686",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "love you",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 400,
    "y": 1180,
    "wires": [
      [
        "c5a87f6b.b1fb",
        "b77a59e9.4e7f28"
      ]
    ]
  },
  {
    "id": "ffce4eb3.c9188",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"{{payload.entity_id}}\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 940,
    "y": 1180,
    "wires": [
      []
    ]
  },
  {
    "id": "8fddd837.d98638",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 180,
    "y": 1180,
    "wires": [
      [
        "6ba76e86.90686"
      ]
    ]
  },
  {
    "id": "c5a87f6b.b1fb",
    "type": "function",
    "z": "1f9e3480.5be75c",
    "name": "Data",
    "func": "msg.payload = { \"data\" : { \"message\": msg.payload, \"entity_id\": \"media_player.bedroom\" } }\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 670,
    "y": 1180,
    "wires": [
      [
        "ffce4eb3.c9188",
        "8650fb98.c4a298"
      ]
    ]
  },
  {
    "id": "8650fb98.c4a298",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 900,
    "y": 1280,
    "wires": []
  },
  {
    "id": "b77a59e9.4e7f28",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 670,
    "y": 1280,
    "wires": []
  },
  {
    "id": "76c30690.5cb578",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "Works",
    "info": "",
    "x": 170,
    "y": 760,
    "wires": []
  },
  {
    "id": "c57a7609.c118d8",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "Works",
    "info": "",
    "x": 210,
    "y": 960,
    "wires": []
  },
  {
    "id": "e12688a5.5e1d08",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "Works",
    "info": "",
    "x": 190,
    "y": 1280,
    "wires": []
  },
  {
    "id": "93e63b6f.e1c968",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 610,
    "y": 1400,
    "wires": []
  },
  {
    "id": "5021d846.7283b8",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 110,
    "y": 1380,
    "wires": [
      []
    ]
  },
  {
    "id": "9854b95.7c0d448",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"{{payload.entity_id}}\"}",
    "mergecontext": "",
    "x": 920,
    "y": 1580,
    "wires": [
      []
    ]
  },
  {
    "id": "8e0b0daf.d15a4",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 160,
    "y": 1580,
    "wires": [
      [
        "8dbda0c1.7e531"
      ]
    ]
  },
  {
    "id": "aa63685c.307798",
    "type": "function",
    "z": "1f9e3480.5be75c",
    "name": "Data",
    "func": "msg.payload = { \"data\" : { \"message\": msg.say, \"entity_id\": \"media_player.bedroom\" } }\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 650,
    "y": 1580,
    "wires": [
      [
        "9854b95.7c0d448",
        "8547ff42.d9c95"
      ]
    ]
  },
  {
    "id": "8547ff42.d9c95",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 860,
    "y": 1680,
    "wires": []
  },
  {
    "id": "4abbb0cb.f3a51",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 630,
    "y": 1680,
    "wires": []
  },
  {
    "id": "2e3e3fc4.55f1",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "Works",
    "info": "",
    "x": 170,
    "y": 1680,
    "wires": []
  },
  {
    "id": "e6de8d04.cf81f",
    "type": "template",
    "z": "1f9e3480.5be75c",
    "name": "",
    "field": "say",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "Hello there",
    "output": "str",
    "x": 380,
    "y": 1800,
    "wires": [
      [
        "ae8ac878.0b0e98"
      ]
    ]
  },
  {
    "id": "7388c377.5ca32c",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 130,
    "y": 1800,
    "wires": [
      [
        "e6de8d04.cf81f"
      ]
    ]
  },
  {
    "id": "ae8ac878.0b0e98",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 590,
    "y": 1800,
    "wires": []
  },
  {
    "id": "55bf0f12.25166",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 150,
    "y": 1880,
    "wires": [
      [
        "b9c01971.4fe2f8"
      ]
    ]
  },
  {
    "id": "54fbc760.47ff98",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 610,
    "y": 1880,
    "wires": []
  },
  {
    "id": "b9c01971.4fe2f8",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "custom",
        "pt": "msg",
        "to": "import",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 380,
    "y": 1880,
    "wires": [
      [
        "54fbc760.47ff98"
      ]
    ]
  },
  {
    "id": "8dbda0c1.7e531",
    "type": "template",
    "z": "1f9e3480.5be75c",
    "name": "",
    "field": "say",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "Hello there",
    "output": "str",
    "x": 380,
    "y": 1580,
    "wires": [
      [
        "aa63685c.307798",
        "4abbb0cb.f3a51"
      ]
    ]
  },
  {
    "id": "91e2836.c76578",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 150,
    "y": 2060,
    "wires": [
      [
        "48cf8fc4.1d1d5"
      ]
    ]
  },
  {
    "id": "48cf8fc4.1d1d5",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 350,
    "y": 2060,
    "wires": [
      [
        "498b12ab.93bcac"
      ]
    ]
  },
  {
    "id": "c2c37fd1.f00b",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 148,
    "y": 2400,
    "wires": [
      [
        "52fcb4b.6d9df4c"
      ]
    ]
  },
  {
    "id": "52fcb4b.6d9df4c",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "media_player",
    "service": "play_media",
    "data": "{\"entity_id\":\"media_player.office\",\"media_content_id\":\"spotify:playlist:Matt Awesomeness\",\"media_content_type\":\"SPOTIFY\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 488,
    "y": 2400,
    "wires": [
      []
    ]
  },
  {
    "id": "8a97349b.6d30a8",
    "type": "delay",
    "z": "1f9e3480.5be75c",
    "name": "",
    "pauseType": "delay",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 760,
    "y": 2200,
    "wires": [
      [
        "96af5032.9920e"
      ]
    ]
  },
  {
    "id": "96af5032.9920e",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Warning - Unauthorised access detected, police are on route, live camera footage is now broadcasting",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 950,
    "y": 2200,
    "wires": [
      []
    ]
  },
  {
    "id": "498b12ab.93bcac",
    "type": "delay",
    "z": "1f9e3480.5be75c",
    "name": "",
    "pauseType": "delay",
    "timeout": "10",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 600,
    "y": 2120,
    "wires": [
      [
        "6d4f455d.b0630c",
        "8a97349b.6d30a8"
      ]
    ]
  },
  {
    "id": "6d4f455d.b0630c",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Police notification complete",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 2120,
    "wires": [
      []
    ]
  },
  {
    "id": "6437b20a.d659fc",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Unauthorised access detected....",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 440,
    "y": 506,
    "wires": [
      [
        "6cee5fb.dff59a",
        "6a34c1de.08787",
        "d9df1088.5d408"
      ]
    ]
  },
  {
    "id": "91f48a4b.fab718",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Warning - Unauthorised access...",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Warning - Unauthorised access detected, police are on route, live camera footage is now broadcasting",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "all",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1460,
    "y": 620,
    "wires": [
      [
        "bc3ee15b.fdf2f",
        "98087ce9.c3e1c"
      ]
    ]
  },
  {
    "id": "6cee5fb.dff59a",
    "type": "delay",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "pauseType": "delay",
    "timeout": "10",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 980,
    "y": 580,
    "wires": [
      [
        "f7fc0936.ff5968",
        "c86c5f24.b123f"
      ]
    ]
  },
  {
    "id": "f7fc0936.ff5968",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Police notification complete",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Police notification complete",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1440,
    "y": 560,
    "wires": [
      [
        "bc3ee15b.fdf2f",
        "98087ce9.c3e1c"
      ]
    ]
  },
  {
    "id": "f2f1fbdd.6f99a8",
    "type": "api-current-state",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm State",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "halt_if": "",
    "override_topic": true,
    "entity_id": "alarm_control_panel.home_alarm",
    "override_payload": true,
    "override_data": true,
    "x": 390,
    "y": 180,
    "wires": [
      [
        "ddc8f250.0fbf6"
      ]
    ]
  },
  {
    "id": "96f1c335.74979",
    "type": "switch",
    "z": "a0a4859f.5a2a48",
    "name": "Away Arm?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "armed_away",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 730,
    "y": 186,
    "wires": [
      [
        "379940a7.fafb9"
      ],
      [
        "6aaf5f6d.8996c"
      ]
    ]
  },
  {
    "id": "379940a7.fafb9",
    "type": "function",
    "z": "a0a4859f.5a2a48",
    "name": "Data",
    "func": "msg.payload = \n{\n  \"data\": \n  {\n    \"message\": msg.location,\n    \"data\": \n    {\n      \"push\": {\n            \"badge\": 5,\n            \"category\": \"alarm\"\n        },\"attachment\": \n      {\n        \"url\": msg.image,\n        \"content-type\": \"jpeg\",\n        \"hide-thumbnail\": false\n      }\n    }\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 950,
    "y": 186,
    "wires": [
      [
        "99c603ae.2957",
        "7825ad5c.712c84",
        "4766ddd2.ac3f44"
      ]
    ]
  },
  {
    "id": "297e3f11.045a3",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Motion Detected",
    "links": [
      "7f31a2c4.2e726c"
    ],
    "x": 1075,
    "y": 1020,
    "wires": []
  },
  {
    "id": "7f31a2c4.2e726c",
    "type": "link in",
    "z": "a0a4859f.5a2a48",
    "name": "Trigger Alarm",
    "links": [
      "297e3f11.045a3"
    ],
    "x": 235,
    "y": 220,
    "wires": [
      [
        "f2f1fbdd.6f99a8"
      ]
    ]
  },
  {
    "id": "6635c661.8eab48",
    "type": "switch",
    "z": "a0a4859f.5a2a48",
    "name": "Disarmed?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "disarmed",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 390,
    "y": 846,
    "wires": [
      [
        "865758e5.35ac18",
        "ecc17d46.07f9f",
        "9bb7e742.fe6778"
      ]
    ]
  },
  {
    "id": "3c657c4b.85c364",
    "type": "server-state-changed",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm State Changes",
    "server": "5ee4d578.f7736c",
    "entityidfilter": "alarm_control_panel.home_alarm",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 180,
    "y": 846,
    "wires": [
      [
        "6635c661.8eab48",
        "ada5b377.defe8"
      ]
    ]
  },
  {
    "id": "c86c5f24.b123f",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "pay",
    "duration": "-12",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1150,
    "y": 620,
    "wires": [
      [
        "91f48a4b.fab718"
      ]
    ]
  },
  {
    "id": "865758e5.35ac18",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm Disarmed",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 600,
    "y": 620,
    "wires": [
      [
        "c86c5f24.b123f",
        "6a34c1de.08787",
        "acec5703.4eb318",
        "99c603ae.2957",
        "ef97081d.287ae8",
        "7825ad5c.712c84"
      ]
    ]
  },
  {
    "id": "ecc17d46.07f9f",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm Disarmed",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Alarm Disarmed",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 840,
    "y": 820,
    "wires": [
      [
        "1ff7fcd1.1bdbe3",
        "5207bd7b.39f254"
      ]
    ]
  },
  {
    "id": "ada5b377.defe8",
    "type": "switch",
    "z": "a0a4859f.5a2a48",
    "name": "Arming?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "pending",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 400,
    "y": 1000,
    "wires": [
      [
        "5cbf4f55.ced48"
      ]
    ]
  },
  {
    "id": "88b513bf.db837",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm is arming",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Alarm is arming.. you have 25 seconds",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1060,
    "y": 940,
    "wires": [
      [
        "1ff7fcd1.1bdbe3"
      ]
    ]
  },
  {
    "id": "5f3ed30a.fb17ac",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm Armed",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Alarm is armed",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 1080,
    "wires": [
      [
        "1ff7fcd1.1bdbe3"
      ]
    ]
  },
  {
    "id": "e1b8ad57.cdca",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "10 Seconds",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "10 Seconds",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 1020,
    "wires": [
      [
        "1ff7fcd1.1bdbe3"
      ]
    ]
  },
  {
    "id": "6a34c1de.08787",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "pay",
    "duration": "-1600",
    "extend": false,
    "units": "ms",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1020,
    "y": 700,
    "wires": [
      [
        "445092e8.5863ac",
        "69c11c8f.e0f004"
      ]
    ]
  },
  {
    "id": "445092e8.5863ac",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "light",
    "service": "turn_on",
    "data": "{\"entity_id\":\"group.all_lights\",\"rgb_color\":[255,0,0],\"brightness_pct\":100,\"transition\":0}",
    "mergecontext": "",
    "x": 1270,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "69c11c8f.e0f004",
    "type": "delay",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "pauseType": "delay",
    "timeout": "800",
    "timeoutUnits": "milliseconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 1250,
    "y": 700,
    "wires": [
      [
        "b9d838fa.304b58"
      ]
    ]
  },
  {
    "id": "acec5703.4eb318",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "Only Retrigger Once Every 15 Minute",
    "op1": "1",
    "op2": "",
    "op1type": "str",
    "op2type": "nul",
    "duration": "15",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 930,
    "y": 340,
    "wires": [
      [
        "6437b20a.d659fc"
      ]
    ]
  },
  {
    "id": "b9d838fa.304b58",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "light",
    "service": "turn_off",
    "data": "{\"entity_id\":\"group.all_lights\",\"transition\":0}",
    "mergecontext": "",
    "x": 1470,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "72d4be48.c6af7",
    "type": "comment",
    "z": "a0a4859f.5a2a48",
    "name": "Flash All Lights",
    "info": "",
    "x": 1000,
    "y": 660,
    "wires": []
  },
  {
    "id": "d9df1088.5d408",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 260,
    "y": 726,
    "wires": [
      [
        "82b8c853.e3ad78"
      ]
    ]
  },
  {
    "id": "82b8c853.e3ad78",
    "type": "delay",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "pauseType": "delay",
    "timeout": "5",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 460,
    "y": 726,
    "wires": [
      [
        "6a34c1de.08787",
        "1c6435f7.2b5b4a"
      ]
    ]
  },
  {
    "id": "fc1c2aa.3cadfd8",
    "type": "comment",
    "z": "a0a4859f.5a2a48",
    "name": "Diabled flashing lisghts after 5 minutes",
    "info": "",
    "x": 330,
    "y": 686,
    "wires": []
  },
  {
    "id": "4a0d618f.9e4e3",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 150,
    "y": 2560,
    "wires": [
      [
        "cd0f8311.b8f6"
      ]
    ]
  },
  {
    "id": "cd0f8311.b8f6",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "hello",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 350,
    "y": 2560,
    "wires": [
      []
    ]
  },
  {
    "id": "758d40c5.72f3a",
    "type": "change",
    "z": "d1172b8b.3d3298",
    "name": "The door bell has been pressed The door bell has been pressed",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "The door bell has been pressed The door bell has been pressed",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 220,
    "wires": [
      [
        "eabcdf61.a106d"
      ]
    ]
  },
  {
    "id": "ff31cac4.b7b148",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "3 minutes",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "I'll be turning everything off in 3 minutes",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 3180,
    "y": 320,
    "wires": [
      [
        "747f847d.8cf0ec"
      ]
    ]
  },
  {
    "id": "5990015c.a324",
    "type": "switch",
    "z": "f92add19.c43b9",
    "name": "What is it?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "None",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Autonight - Wait 30 Minutes",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Autonight - Wait An Hour",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Autonight - Wait 3 Hour",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Bed Room - Night",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Living Room - Natural",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 6,
    "x": 350,
    "y": 460,
    "wires": [
      [],
      [
        "8322431a.be704"
      ],
      [
        "d89c7a04.840df8"
      ],
      [
        "5866fa08.5976e4"
      ],
      [],
      [
        "3a998864.180dc8"
      ]
    ]
  },
  {
    "id": "8322431a.be704",
    "type": "link out",
    "z": "f92add19.c43b9",
    "name": "Autonight - Wait 30 Minutes",
    "links": [
      "f7000620.ba0c58"
    ],
    "x": 515,
    "y": 220,
    "wires": []
  },
  {
    "id": "d89c7a04.840df8",
    "type": "link out",
    "z": "f92add19.c43b9",
    "name": "Autonight - Wait An Hour",
    "links": [
      "7534d7f.7558128"
    ],
    "x": 515,
    "y": 260,
    "wires": []
  },
  {
    "id": "5866fa08.5976e4",
    "type": "link out",
    "z": "f92add19.c43b9",
    "name": "Autonight - Wait 3 Hour",
    "links": [
      "e00bbec2.02f19"
    ],
    "x": 515,
    "y": 300,
    "wires": []
  },
  {
    "id": "e00bbec2.02f19",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "Rec - Autonight - Wait 3 Hour",
    "links": [
      "5866fa08.5976e4"
    ],
    "x": 495,
    "y": 780,
    "wires": [
      [
        "69a40cbb.df3674",
        "99df83ab.46e3b"
      ]
    ]
  },
  {
    "id": "7534d7f.7558128",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "Rec - Autonight - Wait An Hour",
    "links": [
      "d89c7a04.840df8"
    ],
    "x": 494,
    "y": 740,
    "wires": [
      [
        "be9e3159.3ea59",
        "99df83ab.46e3b"
      ]
    ]
  },
  {
    "id": "f7000620.ba0c58",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "Rec - Autonight - Wait 30 Minute",
    "links": [
      "8322431a.be704"
    ],
    "x": 494,
    "y": 700,
    "wires": [
      [
        "8a9e4a8c.294d28",
        "99df83ab.46e3b"
      ]
    ]
  },
  {
    "id": "a79f32af.f0649",
    "type": "api-call-service",
    "z": "f92add19.c43b9",
    "name": "Set to none",
    "server": "5ee4d578.f7736c",
    "service_domain": "input_select",
    "service": "select_option",
    "data": "{\"entity_id\":\"input_select.set_scenes\",\"option\":\"None\"}",
    "mergecontext": "",
    "x": 350,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "cd0bc73b.5cabd8",
    "type": "switch",
    "z": "f92add19.c43b9",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "None",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 110,
    "y": 360,
    "wires": [
      [],
      [
        "a79f32af.f0649"
      ]
    ]
  },
  {
    "id": "c63b1959.997848",
    "type": "server-state-changed",
    "z": "f92add19.c43b9",
    "name": "On Change",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "entityidfilter": "input_select.set_scenes",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 110,
    "y": 460,
    "wires": [
      [
        "5990015c.a324",
        "cd0bc73b.5cabd8"
      ]
    ]
  },
  {
    "id": "3a998864.180dc8",
    "type": "api-call-service",
    "z": "f92add19.c43b9",
    "name": "Living Room - Natural",
    "server": "5ee4d578.f7736c",
    "service_domain": "light",
    "service": "turn_on",
    "data": "{\"entity_id\":\"group.all_lights\",\"color_temp\":393,\"brightness_pct\":100,\"transition\":0}",
    "mergecontext": "",
    "x": 640,
    "y": 540,
    "wires": [
      []
    ]
  },
  {
    "id": "7de48d03.0ee034",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm is still active",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Alarm is still active... YOU HAVE 60 SECONDS... Alarm is still active",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1770,
    "y": 360,
    "wires": [
      [
        "e5e95e2e.4d267"
      ]
    ]
  },
  {
    "id": "99c603ae.2957",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "wait 60 seconds",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "80",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 820,
    "y": 280,
    "wires": [
      [
        "acec5703.4eb318"
      ]
    ]
  },
  {
    "id": "adc4fcb0.0b27d",
    "type": "server-events",
    "z": "a0a4859f.5a2a48",
    "name": "All",
    "server": "eef5a84.da24f58",
    "event_type": "ios.notification_action_fired",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "x": 110,
    "y": 1580,
    "wires": [
      [
        "10e0084a.b4fab8"
      ]
    ]
  },
  {
    "id": "10e0084a.b4fab8",
    "type": "switch",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "property": "payload.event.actionName",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "SILENCE_ALARM",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "SOUND_ALARM",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 250,
    "y": 1580,
    "wires": [
      [
        "85e36c72.09a89"
      ],
      [
        "6437b20a.d659fc"
      ]
    ]
  },
  {
    "id": "85e36c72.09a89",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "Disarm Alarm",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "alarm_control_panel",
    "service": "alarm_disarm",
    "entityId": "alarm_control_panel.home_alarm",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 480,
    "y": 1574,
    "wires": [
      []
    ]
  },
  {
    "id": "50c77ae0.374734",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Office Door Changed",
    "server": "5ee4d578.f7736c",
    "entityidfilter": " binary_sensor.office_door",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 180,
    "y": 1720,
    "wires": [
      [
        "5f4591ce.85447",
        "aa78949c.41c9a8"
      ]
    ]
  },
  {
    "id": "68e6824a.2d889c",
    "type": "comment",
    "z": "a068bd5.28a8d4",
    "name": "Office Door",
    "info": "",
    "x": 150,
    "y": 1680,
    "wires": []
  },
  {
    "id": "d1510a6c.f071b8",
    "type": "comment",
    "z": "a068bd5.28a8d4",
    "name": "Trun on Lving Room Light ",
    "info": "",
    "x": 730,
    "y": 1580,
    "wires": []
  },
  {
    "id": "5f4591ce.85447",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Office Door Open",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Office Door Open",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 470,
    "y": 1513,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "6c7165c5.5f018c",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Font Door Open",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": " binary_sensor.font_door",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 160,
    "y": 1411,
    "wires": [
      [
        "cc4f8d1.d9d097",
        "ae6cd96b.088a18"
      ]
    ]
  },
  {
    "id": "9c585f5f.3d0d4",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Font Door Open",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Font Door Open",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 700,
    "y": 1413,
    "wires": [
      [
        "64a723bb.a421cc",
        "f6396294.e81f6",
        "f4e9b89.fd1c548"
      ]
    ]
  },
  {
    "id": "ef97081d.287ae8",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "Send Once",
    "op1": "",
    "op2": "0",
    "op1type": "pay",
    "op2type": "str",
    "duration": "0",
    "extend": false,
    "units": "ms",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1570,
    "y": 360,
    "wires": [
      [
        "7de48d03.0ee034"
      ]
    ]
  },
  {
    "id": "f6396294.e81f6",
    "type": "switch",
    "z": "a068bd5.28a8d4",
    "name": "Open?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 850,
    "y": 1480,
    "wires": [
      [
        "cc2fcdb8.ee0ea"
      ],
      [
        "82e7bf66.f63d3"
      ]
    ],
    "outputLabels": [
      "Yes",
      null
    ]
  },
  {
    "id": "a7e0ed6.c09071",
    "type": "comment",
    "z": "a068bd5.28a8d4",
    "name": "Todo - disable if camera is offline",
    "info": "",
    "x": 1710,
    "y": 1580,
    "wires": []
  },
  {
    "id": "cc2fcdb8.ee0ea",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Font Door Open",
    "links": [
      "564fc868.c06818",
      "58e8e0e0.d64e4",
      "ccedfcf.8e988",
      "f7740640.c80dd8",
      "75a9b44f.1ad8bc",
      "2102539f.96c77c",
      "deda2f49.2eff4",
      "e947642c.3c9798",
      "62e65b11.82cb44"
    ],
    "x": 1035,
    "y": 1400,
    "wires": []
  },
  {
    "id": "ccedfcf.8e988",
    "type": "link in",
    "z": "dceb45d8.425368",
    "name": "",
    "links": [
      "cc2fcdb8.ee0ea"
    ],
    "x": 75,
    "y": 100,
    "wires": [
      [
        "912e1c7f.de2ae"
      ]
    ]
  },
  {
    "id": "ce93041d.165928",
    "type": "light-scheduler",
    "z": "dceb45d8.425368",
    "settings": "525afe76.43e05",
    "events": "[{\"start\":{\"dow\":1,\"mod\":705},\"end\":{\"dow\":1,\"mod\":900}},{\"start\":{\"dow\":2,\"mod\":705},\"end\":{\"dow\":2,\"mod\":900}},{\"start\":{\"dow\":3,\"mod\":705},\"end\":{\"dow\":3,\"mod\":900}},{\"start\":{\"dow\":4,\"mod\":705},\"end\":{\"dow\":4,\"mod\":900}},{\"start\":{\"dow\":5,\"mod\":705},\"end\":{\"dow\":5,\"mod\":900}},{\"start\":{\"dow\":3,\"mod\":660},\"end\":{\"dow\":3,\"mod\":705}},{\"start\":{\"dow\":4,\"mod\":660},\"end\":{\"dow\":4,\"mod\":705}},{\"start\":{\"dow\":5,\"mod\":660},\"end\":{\"dow\":5,\"mod\":705}},{\"start\":{\"dow\":2,\"mod\":600},\"end\":{\"dow\":2,\"mod\":705}},{\"start\":{\"dow\":1,\"mod\":600},\"end\":{\"dow\":1,\"mod\":705}},{\"start\":{\"dow\":3,\"mod\":600},\"end\":{\"dow\":3,\"mod\":660}},{\"start\":{\"dow\":4,\"mod\":600},\"end\":{\"dow\":4,\"mod\":660}},{\"start\":{\"dow\":5,\"mod\":600},\"end\":{\"dow\":5,\"mod\":660}}]",
    "topic": "",
    "name": "Lunch Time",
    "onPayload": "On",
    "onPayloadType": "str",
    "offPayload": "Off",
    "offPayloadType": "str",
    "onlyWhenDark": false,
    "sunElevationThreshold": 6,
    "sunShowElevationInStatus": false,
    "outputfreq": "output.statechange.startup",
    "x": 130,
    "y": 40,
    "wires": [
      [
        "d0306c25.0b7d6"
      ]
    ]
  },
  {
    "id": "d0306c25.0b7d6",
    "type": "change",
    "z": "dceb45d8.425368",
    "name": "SET LunchTime Var",
    "rules": [
      {
        "t": "set",
        "p": "LunchTime",
        "pt": "global",
        "to": "payload",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "LunchTimeBeenTrigged",
        "pt": "global",
        "to": "off",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 400,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "bb795d4b.f8fac",
    "type": "switch",
    "z": "dceb45d8.425368",
    "name": "Is Lunch Time?",
    "property": "LunchTime",
    "propertyType": "global",
    "rules": [
      {
        "t": "eq",
        "v": "On",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1300,
    "y": 100,
    "wires": [
      [
        "653873b9.0eb50c",
        "15e0bafe.3d9b75",
        "a68116a7.421e68",
        "4bc559fe.71cd38",
        "d6eda8a.8082c58",
        "744b9657.394938"
      ]
    ]
  },
  {
    "id": "15e0bafe.3d9b75",
    "type": "change",
    "z": "dceb45d8.425368",
    "name": "Have a good lunch",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Have a good lunch. Timer set",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "LunchTime.BeenTrigged",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1730,
    "y": 100,
    "wires": [
      [
        "bb3f35b4.b93fa8"
      ]
    ]
  },
  {
    "id": "912e1c7f.de2ae",
    "type": "delay",
    "z": "dceb45d8.425368",
    "name": "",
    "pauseType": "rate",
    "timeout": "20",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "2",
    "rateUnits": "hour",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 380,
    "y": 100,
    "wires": [
      [
        "22eeb88e.7e8268"
      ]
    ]
  },
  {
    "id": "f6271c50.692e3",
    "type": "change",
    "z": "dceb45d8.425368",
    "name": "You been home for 50 minutes",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "You been home for 50 minutes... almost time for you to go back",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1770,
    "y": 160,
    "wires": [
      [
        "bb3f35b4.b93fa8"
      ]
    ]
  },
  {
    "id": "653873b9.0eb50c",
    "type": "delay",
    "z": "dceb45d8.425368",
    "name": "",
    "pauseType": "delay",
    "timeout": "50",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 1510,
    "y": 160,
    "wires": [
      [
        "f6271c50.692e3",
        "b8fb1826.2cb798"
      ]
    ]
  },
  {
    "id": "c10515b6.577c78",
    "type": "change",
    "z": "dceb45d8.425368",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1040,
    "y": 280,
    "wires": [
      [
        "653873b9.0eb50c",
        "4bc559fe.71cd38",
        "b46723fe.38fbf"
      ]
    ]
  },
  {
    "id": "741edf94.e15ec",
    "type": "change",
    "z": "dceb45d8.425368",
    "name": "You been home for an hour",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "You been home for an hour - got back to work",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1760,
    "y": 260,
    "wires": [
      [
        "bb3f35b4.b93fa8",
        "b46723fe.38fbf"
      ]
    ]
  },
  {
    "id": "4bc559fe.71cd38",
    "type": "delay",
    "z": "dceb45d8.425368",
    "name": "",
    "pauseType": "delay",
    "timeout": "60",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 1510,
    "y": 260,
    "wires": [
      [
        "741edf94.e15ec",
        "9a499cf3.62e0b"
      ]
    ]
  },
  {
    "id": "b3c666ee.88c4a8",
    "type": "function",
    "z": "cd950567.f864b8",
    "name": "Data",
    "func": "msg.payloadvalue = msg.payload\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": \"is Matt here: \" + msg.payload\n  }\n}\n\nif (0 < msg.payloadvalue && msg.payloadvalue < 100) {\n    msg.goodpayload = true \n} else {\n    msg.goodpayload = false\n}\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1190,
    "y": 220,
    "wires": [
      [
        "d1dbd941.ea1448",
        "45afa583.e70c9c"
      ]
    ]
  },
  {
    "id": "4d976d7c.19f594",
    "type": "server-state-changed",
    "z": "cd950567.f864b8",
    "name": "Matt BT",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "sensor.matt_living_room",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "unavailable",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 130,
    "y": 240,
    "wires": [
      [
        "57c6dcb1.08eb84",
        "c4bb67ee.814568"
      ],
      [
        "377ccb85.03bec4"
      ]
    ]
  },
  {
    "id": "3e1e5c2e.53cbe4",
    "type": "server-state-changed",
    "z": "cd950567.f864b8",
    "name": "Danni BT",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "sensor.danni_living_room",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "unavailable",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 140,
    "y": 420,
    "wires": [
      [
        "57c6dcb1.08eb84",
        "f95eff10.16fd5"
      ],
      [
        "f1a3f9ea.3e39d8"
      ]
    ]
  },
  {
    "id": "3939d20a.94fe3e",
    "type": "mqtt out",
    "z": "cd950567.f864b8",
    "name": "Scan For Who Left",
    "topic": "btmonitor/scan/depart",
    "qos": "2",
    "retain": "false",
    "broker": "1b6bc4ba.56ff4b",
    "x": 830,
    "y": 780,
    "wires": []
  },
  {
    "id": "55bdf0a5.df3c4",
    "type": "trigger",
    "z": "cd950567.f864b8",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "pay",
    "duration": "-15",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 570,
    "y": 780,
    "wires": [
      [
        "3939d20a.94fe3e"
      ]
    ]
  },
  {
    "id": "60eb60ce.fc86c",
    "type": "inject",
    "z": "cd950567.f864b8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 580,
    "y": 860,
    "wires": [
      [
        "3939d20a.94fe3e"
      ]
    ]
  },
  {
    "id": "82e7bf66.f63d3",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Font Door Close",
    "links": [
      "3d0ad1be.cff38e",
      "3f687ec7.49a272",
      "688dc601.8b0c68"
    ],
    "x": 975,
    "y": 1540,
    "wires": []
  },
  {
    "id": "3d0ad1be.cff38e",
    "type": "link in",
    "z": "cd950567.f864b8",
    "name": "",
    "links": [
      "82e7bf66.f63d3"
    ],
    "x": 95,
    "y": 740,
    "wires": [
      [
        "a4fe4e36.81ffd",
        "ab08cc66.4d35a"
      ]
    ]
  },
  {
    "id": "a4fe4e36.81ffd",
    "type": "trigger",
    "z": "cd950567.f864b8",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "10",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 270,
    "y": 780,
    "wires": [
      [
        "55bdf0a5.df3c4"
      ]
    ]
  },
  {
    "id": "ab08cc66.4d35a",
    "type": "trigger",
    "z": "cd950567.f864b8",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "5",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 270,
    "y": 680,
    "wires": [
      [
        "57c6dcb1.08eb84"
      ]
    ]
  },
  {
    "id": "57c6dcb1.08eb84",
    "type": "change",
    "z": "cd950567.f864b8",
    "name": "Disable Rescan",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 540,
    "y": 680,
    "wires": [
      [
        "55bdf0a5.df3c4",
        "a4fe4e36.81ffd"
      ]
    ]
  },
  {
    "id": "89f71aea.e8f178",
    "type": "comment",
    "z": "cd950567.f864b8",
    "name": "Blue Tooth Tracker",
    "info": "",
    "x": 170,
    "y": 200,
    "wires": []
  },
  {
    "id": "6827bf6c.c4045",
    "type": "comment",
    "z": "cd950567.f864b8",
    "name": "Font Door Closed",
    "info": "",
    "x": 160,
    "y": 620,
    "wires": []
  },
  {
    "id": "a631dd8.5d2e22",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Font Door Open For More 20 Minutes",
    "info": "",
    "x": 210,
    "y": 360,
    "wires": []
  },
  {
    "id": "564fc868.c06818",
    "type": "link in",
    "z": "48ba348c.61270c",
    "name": "Door Open",
    "links": [
      "cc2fcdb8.ee0ea"
    ],
    "x": 75,
    "y": 420,
    "wires": [
      [
        "88571fc3.58e4c"
      ]
    ]
  },
  {
    "id": "3f687ec7.49a272",
    "type": "link in",
    "z": "48ba348c.61270c",
    "name": "Door Closed",
    "links": [
      "82e7bf66.f63d3"
    ],
    "x": 75,
    "y": 480,
    "wires": [
      [
        "6ecdefb4.76dc2"
      ]
    ]
  },
  {
    "id": "88571fc3.58e4c",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 410,
    "y": 420,
    "wires": [
      [
        "da0bfd7.66d92"
      ]
    ]
  },
  {
    "id": "6ecdefb4.76dc2",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Clear",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 210,
    "y": 480,
    "wires": [
      [
        "88571fc3.58e4c"
      ]
    ]
  },
  {
    "id": "da0bfd7.66d92",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Font Door Open for More Then 20 Minutes",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Font Door Sensor",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart office node mcu. Note open the office door",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 670,
    "y": 420,
    "wires": [
      [
        "82cfabc3.c2c478"
      ]
    ]
  },
  {
    "id": "82cfabc3.c2c478",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 875,
    "y": 420,
    "wires": []
  },
  {
    "id": "a0fe31c8.e093b",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "info": "",
    "x": 140,
    "y": 200,
    "wires": []
  },
  {
    "id": "a0436269.f0533",
    "type": "e-mail",
    "z": "a0cc6149.1f76e",
    "server": "smtp.gmail.com",
    "port": "465",
    "secure": true,
    "name": "matbrewer396@gmail.com",
    "dname": "Send email",
    "x": 610,
    "y": 40,
    "wires": []
  },
  {
    "id": "bc4d59ad.37cb48",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 500,
    "y": 500,
    "wires": [
      [
        "da0bfd7.66d92"
      ]
    ]
  },
  {
    "id": "8ee737f2.2dc868",
    "type": "function",
    "z": "f5eab19a.7cf17",
    "name": "Bulid Message",
    "func": "msg = {\n   \n   to:\"matbrewer396@gmail.com\",\n   topic: \"Error Handler - \" + msg.error.message,\n   payload: \"Error Message: \"  + msg.error.message + \"\\nStack: \" + msg.error.stack + \"\\nmsg: \" + JSON.stringify(msg)\n};\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 600,
    "y": 180,
    "wires": [
      [
        "605540a6.9e19d"
      ]
    ]
  },
  {
    "id": "605540a6.9e19d",
    "type": "subflow:a0cc6149.1f76e",
    "z": "f5eab19a.7cf17",
    "name": "",
    "x": 850,
    "y": 180,
    "wires": []
  },
  {
    "id": "6a988d08.ea81a4",
    "type": "catch",
    "z": "48ba348c.61270c",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "c600d799.d43db8"
      ]
    ]
  },
  {
    "id": "c600d799.d43db8",
    "type": "subflow:f5eab19a.7cf17",
    "z": "48ba348c.61270c",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "b13f59.51b620a8",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "33d0326a.f58f6e",
    "type": "catch",
    "z": "dceb45d8.425368",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 400,
    "wires": [
      [
        "18b03c93.6dde53"
      ]
    ]
  },
  {
    "id": "18b03c93.6dde53",
    "type": "subflow:f5eab19a.7cf17",
    "z": "dceb45d8.425368",
    "name": "",
    "x": 350,
    "y": 400,
    "wires": []
  },
  {
    "id": "dbb967e1.d73fe8",
    "type": "comment",
    "z": "dceb45d8.425368",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 360,
    "wires": []
  },
  {
    "id": "75add89.a073b28",
    "type": "catch",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "scope": null,
    "x": 140,
    "y": 80,
    "wires": [
      [
        "dea2d204.a3696"
      ]
    ]
  },
  {
    "id": "dea2d204.a3696",
    "type": "subflow:f5eab19a.7cf17",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "x": 370,
    "y": 80,
    "wires": []
  },
  {
    "id": "7d109bd.4b04e64",
    "type": "comment",
    "z": "a0a4859f.5a2a48",
    "name": "Error Handler",
    "info": "",
    "x": 150,
    "y": 40,
    "wires": []
  },
  {
    "id": "ae08baef.481318",
    "type": "catch",
    "z": "cd950567.f864b8",
    "name": "",
    "scope": null,
    "x": 140,
    "y": 80,
    "wires": [
      [
        "fd8af2a8.a89f8"
      ]
    ]
  },
  {
    "id": "fd8af2a8.a89f8",
    "type": "subflow:f5eab19a.7cf17",
    "z": "cd950567.f864b8",
    "name": "",
    "env": [],
    "x": 370,
    "y": 80,
    "wires": []
  },
  {
    "id": "ccfe093f.2bd2f8",
    "type": "comment",
    "z": "cd950567.f864b8",
    "name": "Error Handler",
    "info": "",
    "x": 150,
    "y": 40,
    "wires": []
  },
  {
    "id": "12c91848.692d98",
    "type": "catch",
    "z": "f92add19.c43b9",
    "name": "",
    "scope": null,
    "x": 100,
    "y": 80,
    "wires": [
      [
        "57855714.0ccd88"
      ]
    ]
  },
  {
    "id": "57855714.0ccd88",
    "type": "subflow:f5eab19a.7cf17",
    "z": "f92add19.c43b9",
    "name": "",
    "x": 330,
    "y": 80,
    "wires": []
  },
  {
    "id": "285eecda.fca384",
    "type": "comment",
    "z": "f92add19.c43b9",
    "name": "Error Handler",
    "info": "",
    "x": 110,
    "y": 40,
    "wires": []
  },
  {
    "id": "53afba59.94cd24",
    "type": "catch",
    "z": "a068bd5.28a8d4",
    "name": "",
    "scope": null,
    "x": 100,
    "y": 80,
    "wires": [
      [
        "1e9a78cb.b78cc7"
      ]
    ]
  },
  {
    "id": "1e9a78cb.b78cc7",
    "type": "subflow:f5eab19a.7cf17",
    "z": "a068bd5.28a8d4",
    "name": "",
    "x": 330,
    "y": 80,
    "wires": []
  },
  {
    "id": "c269451e.f6d8d8",
    "type": "comment",
    "z": "a068bd5.28a8d4",
    "name": "Error Handler",
    "info": "",
    "x": 110,
    "y": 40,
    "wires": []
  },
  {
    "id": "b2e2aedc.7117d",
    "type": "catch",
    "z": "d73100a9.0d64d",
    "name": "",
    "scope": null,
    "x": 100,
    "y": 80,
    "wires": [
      [
        "1982b0d2.f9443f"
      ]
    ]
  },
  {
    "id": "1982b0d2.f9443f",
    "type": "subflow:f5eab19a.7cf17",
    "z": "d73100a9.0d64d",
    "name": "",
    "x": 330,
    "y": 80,
    "wires": []
  },
  {
    "id": "68a1ed88.1aaa84",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Error Handler",
    "info": "",
    "x": 110,
    "y": 40,
    "wires": []
  },
  {
    "id": "242a2aaa.ee74b6",
    "type": "catch",
    "z": "b8a16318.b66a5",
    "name": "",
    "scope": [
      "db6f141.f0d81e8",
      "e4ae5383.2ab6e",
      "91a25b55.043368"
    ],
    "x": 70,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "de155525.5f5328",
    "type": "subflow:f5eab19a.7cf17",
    "z": "b8a16318.b66a5",
    "name": "",
    "x": 310,
    "y": 80,
    "wires": []
  },
  {
    "id": "86a0baf9.b8cff8",
    "type": "comment",
    "z": "b8a16318.b66a5",
    "name": "Error Handler",
    "info": "",
    "x": 90,
    "y": 40,
    "wires": []
  },
  {
    "id": "c0de7131.1686b",
    "type": "catch",
    "z": "a3158433.9d1f78",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "879f1d84.3c4b6"
      ]
    ]
  },
  {
    "id": "879f1d84.3c4b6",
    "type": "subflow:f5eab19a.7cf17",
    "z": "a3158433.9d1f78",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "a5b767c6.469a78",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "545ec4ed.99005c",
    "type": "catch",
    "z": "99d64a3d.f4e418",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 120,
    "wires": [
      [
        "f420f60b.9e3a88"
      ]
    ]
  },
  {
    "id": "f420f60b.9e3a88",
    "type": "subflow:f5eab19a.7cf17",
    "z": "99d64a3d.f4e418",
    "name": "",
    "x": 350,
    "y": 120,
    "wires": []
  },
  {
    "id": "30d4c722.2476b8",
    "type": "comment",
    "z": "99d64a3d.f4e418",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 80,
    "wires": []
  },
  {
    "id": "80401489.e84f88",
    "type": "catch",
    "z": "d1172b8b.3d3298",
    "name": "",
    "scope": null,
    "x": 100,
    "y": 80,
    "wires": [
      [
        "5ce21bd9.903e14"
      ]
    ]
  },
  {
    "id": "5ce21bd9.903e14",
    "type": "subflow:f5eab19a.7cf17",
    "z": "d1172b8b.3d3298",
    "name": "",
    "x": 340,
    "y": 80,
    "wires": []
  },
  {
    "id": "fcc53040.d1dd7",
    "type": "comment",
    "z": "d1172b8b.3d3298",
    "name": "Error Handler",
    "info": "",
    "x": 110,
    "y": 40,
    "wires": []
  },
  {
    "id": "4d7db1db.68172",
    "type": "catch",
    "z": "1e454935.091dd7",
    "name": "",
    "scope": null,
    "uncaught": false,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "33052106.48eb7e"
      ]
    ]
  },
  {
    "id": "33052106.48eb7e",
    "type": "subflow:f5eab19a.7cf17",
    "z": "1e454935.091dd7",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "6d8cc228.7b4ecc",
    "type": "comment",
    "z": "1e454935.091dd7",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "2cf95ee5.b42bd2",
    "type": "catch",
    "z": "9a341993.fbc528",
    "name": "",
    "scope": null,
    "x": 100,
    "y": 80,
    "wires": [
      [
        "63def445.f2b16c"
      ]
    ]
  },
  {
    "id": "63def445.f2b16c",
    "type": "subflow:f5eab19a.7cf17",
    "z": "9a341993.fbc528",
    "name": "",
    "env": [],
    "x": 330,
    "y": 80,
    "wires": []
  },
  {
    "id": "86e81af9.0b95d8",
    "type": "comment",
    "z": "9a341993.fbc528",
    "name": "Error Handler",
    "info": "",
    "x": 110,
    "y": 40,
    "wires": []
  },
  {
    "id": "35126fda.6e6b4",
    "type": "debug",
    "z": "f5eab19a.7cf17",
    "name": "Error Handler",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 220,
    "y": 180,
    "wires": []
  },
  {
    "id": "2b671e1d.f76fd2",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Is Any One Home - Life 360",
    "info": "",
    "x": 180,
    "y": 400,
    "wires": []
  },
  {
    "id": "a963880c.9251f8",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "10",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1430,
    "y": 320,
    "wires": [
      [
        "209f26a6.4bd9ba"
      ]
    ]
  },
  {
    "id": "41325690.252b68",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Confirm Via 360",
    "info": "",
    "x": 1060,
    "y": 280,
    "wires": []
  },
  {
    "id": "aea97881.44ab78",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Disarm Alarm",
    "server": "5ee4d578.f7736c",
    "service_domain": "alarm_control_panel",
    "service": "alarm_disarm",
    "data": "{\"entity_id\":\"alarm_control_panel.home_alarm\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 240,
    "y": 912,
    "wires": [
      []
    ]
  },
  {
    "id": "34d4aee9.cd2842",
    "type": "api-current-state",
    "z": "a3158433.9d1f78",
    "name": "Alarm State",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "alarm_control_panel.home_alarm",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1050,
    "y": 320,
    "wires": [
      [
        "46fd8d3a.619004"
      ]
    ]
  },
  {
    "id": "46fd8d3a.619004",
    "type": "switch",
    "z": "a3158433.9d1f78",
    "name": "Away Arm?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "armed_away",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1235,
    "y": 320,
    "wires": [
      [
        "a963880c.9251f8"
      ]
    ]
  },
  {
    "id": "209f26a6.4bd9ba",
    "type": "api-current-state",
    "z": "a3158433.9d1f78",
    "name": "Current State Is Any One Home?",
    "server": "eef5a84.da24f58",
    "outputs": 1,
    "halt_if": "",
    "override_topic": true,
    "entity_id": "input_boolean.isanyonehome",
    "override_payload": true,
    "override_data": true,
    "x": 1701,
    "y": 320,
    "wires": [
      [
        "b6af2fa1.e4bed"
      ]
    ]
  },
  {
    "id": "b6af2fa1.e4bed",
    "type": "switch",
    "z": "a3158433.9d1f78",
    "name": "360 Confirms",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1975,
    "y": 320,
    "wires": [
      [],
      [
        "c95bfc57.f496a",
        "c869da06.29c528"
      ]
    ]
  },
  {
    "id": "e14e20ef.1b779",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Active Alarm",
    "server": "5ee4d578.f7736c",
    "service_domain": "alarm_control_panel",
    "service": "alarm_arm_away",
    "data": "{\"entity_id\":\"alarm_control_panel.home_alarm\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 2458,
    "y": 328,
    "wires": [
      []
    ]
  },
  {
    "id": "3cb54a9.5114fb6",
    "type": "link out",
    "z": "a3158433.9d1f78",
    "name": "",
    "links": [],
    "x": 2403,
    "y": 368,
    "wires": []
  },
  {
    "id": "c95bfc57.f496a",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "Wait 20 Seconds",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 2238,
    "y": 328,
    "wires": [
      [
        "e14e20ef.1b779",
        "3cb54a9.5114fb6"
      ]
    ]
  },
  {
    "id": "c869da06.29c528",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "Alarm is still active",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Life 360 failed to comfirm GPS... Activing alarm",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2236,
    "y": 288,
    "wires": [
      []
    ]
  },
  {
    "id": "91a25b55.043368",
    "type": "api-call-service",
    "z": "b8a16318.b66a5",
    "name": "trigger",
    "server": "5ee4d578.f7736c",
    "service_domain": "hassio",
    "service": "snapshot_full",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 710,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "ada41b1a.6921a8",
    "type": "comment",
    "z": "b8a16318.b66a5",
    "name": "Watch Dog",
    "info": "",
    "x": 80,
    "y": 140,
    "wires": []
  },
  {
    "id": "39c59c56.fad0d4",
    "type": "comment",
    "z": "b8a16318.b66a5",
    "name": "Backup",
    "info": "",
    "x": 70,
    "y": 320,
    "wires": []
  },
  {
    "id": "db6f141.f0d81e8",
    "type": "light-scheduler",
    "z": "b8a16318.b66a5",
    "settings": "525afe76.43e05",
    "events": "[{\"start\":{\"dow\":2,\"mod\":240},\"end\":{\"dow\":2,\"mod\":255}},{\"start\":{\"dow\":3,\"mod\":240},\"end\":{\"dow\":3,\"mod\":255}},{\"start\":{\"dow\":4,\"mod\":240},\"end\":{\"dow\":4,\"mod\":255}},{\"start\":{\"dow\":5,\"mod\":240},\"end\":{\"dow\":5,\"mod\":255}},{\"start\":{\"dow\":6,\"mod\":240},\"end\":{\"dow\":6,\"mod\":255}},{\"start\":{\"dow\":0,\"mod\":240},\"end\":{\"dow\":0,\"mod\":255}},{\"start\":{\"dow\":1,\"mod\":240},\"end\":{\"dow\":1,\"mod\":255}}]",
    "topic": "",
    "name": "4am",
    "onPayload": "true",
    "onPayloadType": "bool",
    "offPayload": "false",
    "offPayloadType": "bool",
    "onlyWhenDark": true,
    "sunElevationThreshold": 6,
    "sunShowElevationInStatus": false,
    "outputfreq": "output.statechange",
    "x": 70,
    "y": 380,
    "wires": [
      [
        "92457156.7ed4e"
      ]
    ]
  },
  {
    "id": "e4ae5383.2ab6e",
    "type": "switch",
    "z": "b8a16318.b66a5",
    "name": "Only On",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 440,
    "y": 380,
    "wires": [
      [
        "91a25b55.043368"
      ]
    ]
  },
  {
    "id": "908042fb.5ade1",
    "type": "inject",
    "z": "b8a16318.b66a5",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 100,
    "y": 440,
    "wires": [
      [
        "91a25b55.043368"
      ]
    ]
  },
  {
    "id": "4ad3a3ca.e993fc",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Turn Off Light Group",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "group.light_goodnight",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 260,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "adc7b89a.d6d8a8",
    "type": "comment",
    "z": "c9b308f8.01ef68",
    "name": "Lights",
    "info": "",
    "x": 210,
    "y": 40,
    "wires": []
  },
  {
    "id": "d87f007e.fe521",
    "type": "comment",
    "z": "c9b308f8.01ef68",
    "name": "Switches",
    "info": "",
    "x": 480,
    "y": 40,
    "wires": []
  },
  {
    "id": "96315aaf.436ea8",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Library Plug",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{\"entity_id\":\"switch.plug_06\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 490,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "df1fe7a6.c64e78",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Living Room Plug",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{\"entity_id\":\"switch.plug_03\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 510,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "bc86c7f4.0d9708",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Dryer",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{\"entity_id\":\"switch.51268403dc4f2233b115\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 470,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "2971d7cd.f71318",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Reset Request",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1140,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "ddfafa57.793b48",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Turn off PC",
    "server": "eef5a84.da24f58",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{\"entity_id\":\"switch.mattpc\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 490,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "5a47e076.9bd83",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Confirm Trigger",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.goodnight_beentriggered",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 900,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "6f951353.3c766c",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "BedRoom Availability",
    "info": "",
    "x": 160,
    "y": 580,
    "wires": []
  },
  {
    "id": "bbc4a0fd.013b2",
    "type": "mqtt in",
    "z": "48ba348c.61270c",
    "name": "",
    "topic": "checkIn/bedroomMCU",
    "qos": "2",
    "broker": "1b6bc4ba.56ff4b",
    "x": 160,
    "y": 620,
    "wires": [
      [
        "ba0f14ff.fbf9f8",
        "246c516.4b14bae"
      ]
    ]
  },
  {
    "id": "ba0f14ff.fbf9f8",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "4",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 600,
    "wires": [
      [
        "c7b3c2cc.794f6",
        "ddf2b558.0a23f8",
        "18bb5523.688fcb"
      ]
    ]
  },
  {
    "id": "c7b3c2cc.794f6",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/bedroomMCU",
    "topic": "availability/bedroomMCU",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 770,
    "y": 660,
    "wires": []
  },
  {
    "id": "246c516.4b14bae",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 640,
    "wires": [
      [
        "c7b3c2cc.794f6"
      ]
    ]
  },
  {
    "id": "be55b0fe.1cdef",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Bedroom Node MCU - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 980,
    "y": 620,
    "wires": [
      []
    ]
  },
  {
    "id": "d0b308ee.2b6718",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Office Availability",
    "info": "",
    "x": 140,
    "y": 740,
    "wires": []
  },
  {
    "id": "ce89f0f5.323d5",
    "type": "mqtt in",
    "z": "48ba348c.61270c",
    "name": "",
    "topic": "checkIn/OfficeMCU",
    "qos": "2",
    "broker": "1b6bc4ba.56ff4b",
    "x": 150,
    "y": 780,
    "wires": [
      [
        "17046a13.6635d6",
        "2478e925.50b0a6"
      ]
    ]
  },
  {
    "id": "17046a13.6635d6",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "8",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 760,
    "wires": [
      [
        "a1464cf1.f62f5",
        "c8b5465c.584e48",
        "a8227300.13432"
      ]
    ]
  },
  {
    "id": "a1464cf1.f62f5",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/OfficeMCU",
    "topic": "availability/OfficeMCU",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 760,
    "y": 820,
    "wires": []
  },
  {
    "id": "2478e925.50b0a6",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.office",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 800,
    "wires": [
      [
        "a1464cf1.f62f5"
      ]
    ]
  },
  {
    "id": "cad6c4a0.0570e8",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Office Node MCU - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 960,
    "y": 780,
    "wires": [
      []
    ]
  },
  {
    "id": "42ae3ca6.5e2724",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "DoorBell Availability",
    "info": "",
    "x": 150,
    "y": 880,
    "wires": []
  },
  {
    "id": "c92cc768.f09d78",
    "type": "mqtt in",
    "z": "48ba348c.61270c",
    "name": "",
    "topic": "checkIn/doorbellMCU",
    "qos": "2",
    "broker": "1b6bc4ba.56ff4b",
    "x": 160,
    "y": 920,
    "wires": [
      [
        "ea63a6c3.d7ce48",
        "12fd2314.e17cad"
      ]
    ]
  },
  {
    "id": "ea63a6c3.d7ce48",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "8",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 900,
    "wires": [
      [
        "7164f4a4.e5a42c",
        "b0bc999f.9ff708",
        "21d9c69d.9f8e7a"
      ]
    ]
  },
  {
    "id": "7164f4a4.e5a42c",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/doorbellMCU",
    "topic": "availability/doorbellMCU",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 770,
    "y": 960,
    "wires": []
  },
  {
    "id": "12fd2314.e17cad",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.doorbell",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 940,
    "wires": [
      [
        "7164f4a4.e5a42c"
      ]
    ]
  },
  {
    "id": "ac6c25a0.3f1b98",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"BeNode MCU - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 960,
    "y": 920,
    "wires": [
      []
    ]
  },
  {
    "id": "ddf2b558.0a23f8",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Bedroom Node MCU has not checked in",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Bedroom Node MCU",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart bedroom node mcu",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 580,
    "wires": [
      [
        "20b5a1d8.a650fe"
      ]
    ]
  },
  {
    "id": "20b5a1d8.a650fe",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 935,
    "y": 580,
    "wires": []
  },
  {
    "id": "c8b5465c.584e48",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Bedroom Node MCU has not checked in",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Bedroom Node MCU",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart office node mcu. Note open the office door",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.office",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 740,
    "wires": [
      [
        "a1cec523.a181e8"
      ]
    ]
  },
  {
    "id": "a1cec523.a181e8",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 935,
    "y": 740,
    "wires": []
  },
  {
    "id": "b0bc999f.9ff708",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Door Beel Node MCU has not checked in",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Doorbell Node MCU",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart doorbell node mcu",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.doorbell",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 880,
    "wires": [
      [
        "f7cb7ddf.cc703"
      ]
    ]
  },
  {
    "id": "f7cb7ddf.cc703",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 935,
    "y": 880,
    "wires": []
  },
  {
    "id": "9567c19f.3fa0b",
    "type": "subflow:c9b308f8.01ef68",
    "z": "1e454935.091dd7",
    "name": "",
    "env": [],
    "x": 450,
    "y": 280,
    "wires": []
  },
  {
    "id": "9bdbae6b.e8281",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Bedroom Window Changed",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "entityidfilter": "binary_sensor.bedroom_window",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 200,
    "y": 580,
    "wires": [
      [
        "53670de2.10b724"
      ]
    ]
  },
  {
    "id": "53670de2.10b724",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Bedroom Window",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Bedroom Window",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 470,
    "y": 580,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "7323ca0e.ee9ac4",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Reset on start",
    "info": "",
    "x": 130,
    "y": 160,
    "wires": []
  },
  {
    "id": "9876b938.b17e98",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Wait for us to both be in bed",
    "info": "",
    "x": 2100,
    "y": 220,
    "wires": []
  },
  {
    "id": "a2ee88e7.636588",
    "type": "alexa-home",
    "z": "1f9e3480.5be75c",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51092",
    "acknoledge": true,
    "name": "Lights",
    "topic": "",
    "x": 190,
    "y": 3020,
    "wires": [
      [
        "ad70c306.9adcd",
        "415a0565.3a3dac"
      ]
    ]
  },
  {
    "id": "ad70c306.9adcd",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 550,
    "y": 3020,
    "wires": []
  },
  {
    "id": "bb3f35b4.b93fa8",
    "type": "subflow:47bc2d66.1132e4",
    "z": "dceb45d8.425368",
    "name": "",
    "env": [],
    "x": 2200,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "bc3ee15b.fdf2f",
    "type": "subflow:47bc2d66.1132e4",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "x": 1710,
    "y": 560,
    "wires": [
      []
    ]
  },
  {
    "id": "1ff7fcd1.1bdbe3",
    "type": "subflow:47bc2d66.1132e4",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "x": 1350,
    "y": 940,
    "wires": [
      []
    ]
  },
  {
    "id": "eabcdf61.a106d",
    "type": "subflow:47bc2d66.1132e4",
    "z": "d1172b8b.3d3298",
    "name": "",
    "x": 1550,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "415a0565.3a3dac",
    "type": "api-render-template",
    "z": "1f9e3480.5be75c",
    "name": "last alexa",
    "server": "5ee4d578.f7736c",
    "template": "{%- for entity in states.media_player -%}\n    {%- if state_attr(entity.entity_id, 'last_called') == True -%}\n      {{ entity.entity_id }}\n    {%- endif -%}\n{%- endfor -%}",
    "x": 440,
    "y": 3080,
    "wires": [
      [
        "56203d03.1384b4"
      ]
    ]
  },
  {
    "id": "56203d03.1384b4",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "x": 670,
    "y": 3080,
    "wires": []
  },
  {
    "id": "20a92ac4.9495e6",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51159",
    "acknoledge": true,
    "name": "Living Room Lights",
    "topic": "",
    "x": 150,
    "y": 160,
    "wires": [
      [
        "666e0981.f04888"
      ]
    ]
  },
  {
    "id": "666e0981.f04888",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "light",
        "pt": "msg",
        "to": "light.living_room_lights",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 370,
    "y": 160,
    "wires": [
      [
        "91ab16e5.33d3e8"
      ]
    ]
  },
  {
    "id": "681f52a2.6e388c",
    "type": "function",
    "z": "20dffe5a.37e8a2",
    "name": "",
    "func": "light = msg.light\ncommad = \"turn_on\"\nif (msg.command == \"TurnOffRequest\") {\n    commad = \"turn_off\"\n}\n\nif (msg.command == \"SetPercentageRequest\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : commad,\n     \"data\" : \n        { \n            \"entity_id\" : light,\n            \"brightness_pct\": msg.payload\n        } \n    }\n} else  if (msg.command == \"SetColorRequest\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : commad,\n     \"data\" : \n        { \n            \"entity_id\" : light,\n            \"hs_color\": [msg.payload.hue,80 ]\n        } \n    }\n\n\n} else {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : commad,\n     \"data\" : \n        { \n            \"entity_id\" : light\n        } \n    }\n}\n\n    \n\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 270,
    "y": 40,
    "wires": [
      [
        "a14e6e3.6e53b9"
      ]
    ],
    "outputLabels": [
      "On"
    ]
  },
  {
    "id": "a14e6e3.6e53b9",
    "type": "api-call-service",
    "z": "20dffe5a.37e8a2",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "",
    "service": "",
    "entityId": "",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 530,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "91ab16e5.33d3e8",
    "type": "subflow:20dffe5a.37e8a2",
    "z": "80866e71.966c6",
    "name": "",
    "x": 600,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "5b59c84c.9553a8",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51160",
    "acknoledge": true,
    "name": "Bedroom Light",
    "topic": "",
    "x": 140,
    "y": 220,
    "wires": [
      [
        "980377c2.231538"
      ]
    ]
  },
  {
    "id": "980377c2.231538",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "light",
        "pt": "msg",
        "to": "light.bed_room_light",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 370,
    "y": 220,
    "wires": [
      [
        "b7f733d5.5494"
      ]
    ]
  },
  {
    "id": "b7f733d5.5494",
    "type": "subflow:20dffe5a.37e8a2",
    "z": "80866e71.966c6",
    "name": "",
    "x": 600,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "b7351a9a.445f48",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51162",
    "acknoledge": true,
    "name": "Library Lights",
    "topic": "",
    "x": 130,
    "y": 280,
    "wires": [
      [
        "ccb7686f.ae6c38"
      ]
    ]
  },
  {
    "id": "ccb7686f.ae6c38",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "light",
        "pt": "msg",
        "to": "light.library_lights",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 370,
    "y": 280,
    "wires": [
      [
        "1cbdb8cf.6331d7"
      ]
    ]
  },
  {
    "id": "1cbdb8cf.6331d7",
    "type": "subflow:20dffe5a.37e8a2",
    "z": "80866e71.966c6",
    "name": "",
    "env": [],
    "x": 600,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "dec4310e.4d01c",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Bluetooth Tracker Availability",
    "info": "",
    "x": 180,
    "y": 1060,
    "wires": []
  },
  {
    "id": "1fdc6496.317dbb",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "20",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 710,
    "y": 1080,
    "wires": [
      [
        "96e20405.870f58",
        "80752034.8088",
        "38de4a13.9e07c6",
        "644d8797.711c28"
      ]
    ]
  },
  {
    "id": "96e20405.870f58",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/bluetoothtracker",
    "topic": "availability/bluetoothtracker",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1060,
    "y": 1140,
    "wires": []
  },
  {
    "id": "51c0fbb2.abfe34",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 690,
    "y": 1120,
    "wires": [
      [
        "96e20405.870f58"
      ]
    ]
  },
  {
    "id": "cbb5e819.633268",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Bluetooth Tracker - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1260,
    "y": 1100,
    "wires": [
      []
    ]
  },
  {
    "id": "80752034.8088",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Can not ping bluetooth tracker",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Bluetooth Tracker Pi Zero",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart Bluetooth Tracker Pi Zero",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1010,
    "y": 1060,
    "wires": [
      [
        "48a7f807.8583d8"
      ]
    ]
  },
  {
    "id": "48a7f807.8583d8",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 1215,
    "y": 1060,
    "wires": []
  },
  {
    "id": "b8badc29.ed561",
    "type": "ping",
    "z": "48ba348c.61270c",
    "name": "Check BT On Every 2 Minutes",
    "host": "192.168.1.205",
    "timer": "120",
    "inputs": 0,
    "x": 180,
    "y": 1120,
    "wires": [
      [
        "124b807c.ce19b"
      ]
    ]
  },
  {
    "id": "124b807c.ce19b",
    "type": "switch",
    "z": "48ba348c.61270c",
    "name": "Is offline?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "false"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 440,
    "y": 1120,
    "wires": [
      [],
      [
        "51c0fbb2.abfe34",
        "1fdc6496.317dbb"
      ]
    ]
  },
  {
    "id": "2c5e4896.5acbd8",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "RM Mini Availability",
    "info": "",
    "x": 150,
    "y": 1240,
    "wires": []
  },
  {
    "id": "a9b99e17.0b437",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "8",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 710,
    "y": 1260,
    "wires": [
      [
        "a5e82cce.9e94c",
        "d8742850.a3fb68",
        "8d22476.bf1ffb8"
      ]
    ]
  },
  {
    "id": "899c25f0.69a088",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 690,
    "y": 1300,
    "wires": [
      [
        "8d22476.bf1ffb8"
      ]
    ]
  },
  {
    "id": "4b56562a.e13668",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"RM min - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1240,
    "y": 1280,
    "wires": [
      []
    ]
  },
  {
    "id": "a5e82cce.9e94c",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Can not ping RM Mimi",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "RM Mimi",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Check RM Mini network connection / power supply ",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1010,
    "y": 1240,
    "wires": [
      [
        "a6165491.aa9ba8"
      ]
    ]
  },
  {
    "id": "a6165491.aa9ba8",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 1215,
    "y": 1240,
    "wires": []
  },
  {
    "id": "40fb610.df8f4a",
    "type": "ping",
    "z": "48ba348c.61270c",
    "name": "Check RM Mini On Every 2 Minutes",
    "host": "192.168.30.202",
    "timer": "120",
    "inputs": 0,
    "x": 200,
    "y": 1300,
    "wires": [
      [
        "24f7770e.b891b8"
      ]
    ]
  },
  {
    "id": "24f7770e.b891b8",
    "type": "switch",
    "z": "48ba348c.61270c",
    "name": "Is offline?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "false"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 440,
    "y": 1300,
    "wires": [
      [],
      [
        "899c25f0.69a088",
        "a9b99e17.0b437"
      ]
    ]
  },
  {
    "id": "6d2e1465.714b2c",
    "type": "inject",
    "z": "b8a16318.b66a5",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 240,
    "y": 140,
    "wires": [
      [
        "b8da62bc.cac9f"
      ]
    ]
  },
  {
    "id": "a68116a7.421e68",
    "type": "api-call-service",
    "z": "dceb45d8.425368",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Have a good lunch. Timer set\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1720,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "85dabb98.674a08",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Actvice Alarm",
    "server": "5ee4d578.f7736c",
    "service_domain": "alarm_control_panel",
    "service": "alarm_arm_away",
    "data": "{\"entity_id\":\"alarm_control_panel.home_alarm\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1080,
    "y": 1260,
    "wires": [
      []
    ]
  },
  {
    "id": "606db896.9f2128",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "40",
    "extend": false,
    "units": "s",
    "reset": "some_one_home",
    "bytopic": "all",
    "outputs": 1,
    "x": 850,
    "y": 1260,
    "wires": [
      [
        "85dabb98.674a08",
        "86692ab8.010d38",
        "404814cc.c2c46c",
        "f6c97631.876a78",
        "72c8674b.8e3c38",
        "6ff4d6e.b277128"
      ]
    ]
  },
  {
    "id": "103364c9.218bfb",
    "type": "link in",
    "z": "a0a4859f.5a2a48",
    "name": "Arming Alarm",
    "links": [
      "b0c86ed5.ad287"
    ],
    "x": 435,
    "y": 1034,
    "wires": [
      [
        "2e706b9a.44a264"
      ]
    ]
  },
  {
    "id": "2e706b9a.44a264",
    "type": "function",
    "z": "a0a4859f.5a2a48",
    "name": "Join",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 690,
    "y": 1000,
    "wires": [
      [
        "88b513bf.db837",
        "6b2ad87a.0e91f8",
        "87cfb997.596a08"
      ]
    ]
  },
  {
    "id": "b0c86ed5.ad287",
    "type": "link out",
    "z": "a3158433.9d1f78",
    "name": "",
    "links": [
      "103364c9.218bfb"
    ],
    "x": 735,
    "y": 1220,
    "wires": []
  },
  {
    "id": "9a499cf3.62e0b",
    "type": "api-call-service",
    "z": "dceb45d8.425368",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Lunch is over\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1720,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "b8fb1826.2cb798",
    "type": "api-call-service",
    "z": "dceb45d8.425368",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Its been 50 minutes\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1720,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "22eeb88e.7e8268",
    "type": "switch",
    "z": "dceb45d8.425368",
    "name": "Has been triggered?",
    "property": "LunchTimeBeenTrigged",
    "propertyType": "global",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 620,
    "y": 100,
    "wires": [
      [],
      [
        "4dca5a14.453ec4"
      ]
    ]
  },
  {
    "id": "6125c1be.4d871",
    "type": "change",
    "z": "99d64a3d.f4e418",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "LunchTime.BeenTrigged",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "92457156.7ed4e",
    "type": "rbe",
    "z": "b8a16318.b66a5",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 260,
    "y": 380,
    "wires": [
      [
        "e4ae5383.2ab6e"
      ]
    ]
  },
  {
    "id": "4c78e362.ee846c",
    "type": "inject",
    "z": "dceb45d8.425368",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1460,
    "y": 60,
    "wires": [
      [
        "a68116a7.421e68"
      ]
    ]
  },
  {
    "id": "9a49fe8e.6bfee",
    "type": "trigger",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "45",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 910,
    "y": 860,
    "wires": [
      [
        "9d9f388a.1c7c88",
        "53f58fe.617107"
      ]
    ]
  },
  {
    "id": "e9f4888d.6daf78",
    "type": "server-state-changed",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Time",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.bathtime",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 160,
    "y": 1080,
    "wires": [
      [
        "bc8fc4c1.1f1378"
      ]
    ]
  },
  {
    "id": "bc8fc4c1.1f1378",
    "type": "switch",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 370,
    "y": 1080,
    "wires": [
      [
        "9a49fe8e.6bfee",
        "c6d28a61.3da988",
        "4675f80a.f6fb08",
        "66750501.150e8c"
      ],
      [
        "762ebe4.e14ea4"
      ]
    ]
  },
  {
    "id": "8b85e6e3.f5e478",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Turn Off Bathroom light",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": " light.bathroom_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1390,
    "y": 1080,
    "wires": [
      []
    ]
  },
  {
    "id": "52c7bf3f.bee33",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Turn Off Bath Time",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.bathtime",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1390,
    "y": 820,
    "wires": [
      []
    ]
  },
  {
    "id": "9d9f388a.1c7c88",
    "type": "trigger",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "10",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1190,
    "y": 860,
    "wires": [
      [
        "8b85e6e3.f5e478"
      ]
    ]
  },
  {
    "id": "a4d35f77.97058",
    "type": "catch",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "8079fb7e.7d99e8"
      ]
    ]
  },
  {
    "id": "8079fb7e.7d99e8",
    "type": "subflow:f5eab19a.7cf17",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "9c1e7371.cd6ba",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "90fde8f7.a26cb8",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Bathroom Motion Detected",
    "links": [
      "4fe3f102.783b3",
      "f76b8f5.fc5af7",
      "ba09070a.220758"
    ],
    "x": 395,
    "y": 960,
    "wires": []
  },
  {
    "id": "4fe3f102.783b3",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Turn On Light",
    "links": [
      "90fde8f7.a26cb8"
    ],
    "x": 135,
    "y": 480,
    "wires": [
      [
        "9edcd817.aed998"
      ]
    ]
  },
  {
    "id": "9edcd817.aed998",
    "type": "switch",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 610,
    "y": 480,
    "wires": [
      [
        "dfbfea55.092c18"
      ],
      [
        "bc7a046f.08cac8"
      ]
    ]
  },
  {
    "id": "95a4dd4.cece52",
    "type": "trigger",
    "z": "a0cdc0f9.a362b",
    "name": "Assume Failure After 40 Minutes",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "40",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1170,
    "y": 500,
    "wires": [
      [
        "918f0fb5.9a267"
      ]
    ]
  },
  {
    "id": "bc7a046f.08cac8",
    "type": "trigger",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "5",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1110,
    "y": 540,
    "wires": [
      [
        "35d5239.16e63dc"
      ]
    ]
  },
  {
    "id": "63f156bc.aed608",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Dim Lights",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bathroom_light",
    "data": "{\"brightness_pct\":25,\"transition\":0}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1970,
    "y": 580,
    "wires": [
      [
        "4a2e8ced.86f9d4"
      ]
    ]
  },
  {
    "id": "4a2e8ced.86f9d4",
    "type": "trigger",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": true,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 2170,
    "y": 640,
    "wires": [
      [
        "7cd2befd.6212"
      ]
    ]
  },
  {
    "id": "7cd2befd.6212",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Turn off Lights",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.bathroom_light",
    "data": "{\"transition\":15}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 2360,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "35d5239.16e63dc",
    "type": "api-current-state",
    "z": "a0cdc0f9.a362b",
    "name": "Bathtime Set?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.bathtime",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1321,
    "y": 560,
    "wires": [
      [],
      [
        "918f0fb5.9a267"
      ]
    ]
  },
  {
    "id": "72d8e323.abf5dc",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Dim Lights",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bathroom_light",
    "data": "{\"brightness_pct\":10}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1970,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "78facd5e.ed58b4",
    "type": "time-range-switch",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "lat": "",
    "lon": "",
    "startTime": "06:45",
    "endTime": "22:00",
    "startOffset": 0,
    "endOffset": 0,
    "x": 1730,
    "y": 320,
    "wires": [
      [
        "8b43d993.76bf28"
      ],
      [
        "72d8e323.abf5dc"
      ]
    ],
    "outputLabels": [
      "trur",
      "false"
    ]
  },
  {
    "id": "8b43d993.76bf28",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Full Lights",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bathroom_light",
    "data": "{\"brightness_pct\":100}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1960,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "9d078a72.d4b5a8",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 960,
    "wires": [
      [
        "9a49fe8e.6bfee"
      ]
    ]
  },
  {
    "id": "70e711fa.a2035",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Living Room Motion",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.living_room_motion",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 170,
    "y": 440,
    "wires": [
      [
        "46820b01.32dab4",
        "224d137d.2e20dc"
      ]
    ]
  },
  {
    "id": "46820b01.32dab4",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Living Room Motion (PIR)",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Living Room Motion (PIR)",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 490,
    "y": 440,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "224d137d.2e20dc",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Living Room Motion (PIR)",
    "links": [
      "8f80ab0d.e271b8",
      "bc5dc5ef.bc51a8",
      "688dc601.8b0c68",
      "a76f3a0f.d1fb38",
      "b46a8ce3.5b6ed",
      "dfd9170e.807548",
      "23f2e7cd.7ad698"
    ],
    "x": 395,
    "y": 400,
    "wires": []
  },
  {
    "id": "e04902ac.5849e",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Hallway Motion",
    "links": [
      "c215726b.e66d5",
      "a2f7cd26.7ec92",
      "c3e890f4.9c742",
      "ba09070a.220758",
      "cb9341a7.ef2ad",
      "b6655c35.3097a",
      "1430c409.2b12ec",
      "e947642c.3c9798"
    ],
    "x": 395,
    "y": 800,
    "wires": []
  },
  {
    "id": "86692ab8.010d38",
    "type": "subflow:c9b308f8.01ef68",
    "z": "a3158433.9d1f78",
    "name": "",
    "x": 1070,
    "y": 1220,
    "wires": []
  },
  {
    "id": "404814cc.c2c46c",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Turn Off Lights",
    "server": "eef5a84.da24f58",
    "service_domain": "light",
    "service": "turn_off",
    "data": "{\"entity_id\":\"light.hue_lightstrip_plus_1\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1080,
    "y": 1180,
    "wires": [
      []
    ]
  },
  {
    "id": "15e204de.45b3bb",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "BathRoom Availability",
    "info": "",
    "x": 160,
    "y": 1540,
    "wires": []
  },
  {
    "id": "8ef2eef7.7fb0c",
    "type": "mqtt in",
    "z": "48ba348c.61270c",
    "name": "",
    "topic": "checkIn/bathroomMCU",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 160,
    "y": 1580,
    "wires": [
      [
        "1c55810f.6df78f",
        "d9d4b9f.8725548"
      ]
    ]
  },
  {
    "id": "1c55810f.6df78f",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "8",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 1560,
    "wires": [
      [
        "de82ca98.6d5598",
        "49e35126.2d4f",
        "a119708f.86aad"
      ]
    ]
  },
  {
    "id": "de82ca98.6d5598",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/bathroomMCU",
    "topic": "availability/bathroomMCU",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 770,
    "y": 1620,
    "wires": []
  },
  {
    "id": "d9d4b9f.8725548",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 1600,
    "wires": [
      [
        "de82ca98.6d5598"
      ]
    ]
  },
  {
    "id": "d6c5ee0b.dd471",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Bath Node MCU - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1040,
    "y": 1580,
    "wires": [
      []
    ]
  },
  {
    "id": "49e35126.2d4f",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Bathroom Node MCU has not checked in",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Bathroom Node MCU",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart Bathroom node mcu",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bathroom",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 1540,
    "wires": [
      [
        "f6daaed4.01e24"
      ]
    ]
  },
  {
    "id": "f6daaed4.01e24",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 935,
    "y": 1540,
    "wires": []
  },
  {
    "id": "d6fa96e8.148b68",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Turn Light ON",
    "info": "",
    "x": 1230,
    "y": 260,
    "wires": []
  },
  {
    "id": "125fd92.83d6a27",
    "type": "alexa-home",
    "z": "a0a4859f.5a2a48",
    "conf": "3fa4c0fe.0f3ed",
    "device": "53496",
    "acknoledge": true,
    "name": "Red Alert",
    "topic": "",
    "x": 120,
    "y": 460,
    "wires": [
      [
        "6437b20a.d659fc",
        "6f9e018d.2605f",
        "8dd6735b.05853"
      ]
    ]
  },
  {
    "id": "e5e95e2e.4d267",
    "type": "subflow:47bc2d66.1132e4",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "x": 1950,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "8dd6735b.05853",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Red Alert Triggered\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 420,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "6f9e018d.2605f",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "Let Danni Know ",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "danniiphone",
    "data": "{\"message\":\"Red Alert Triggered\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 420,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "87cfb997.596a08",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "12",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 950,
    "y": 1020,
    "wires": [
      [
        "e1b8ad57.cdca"
      ]
    ]
  },
  {
    "id": "6b2ad87a.0e91f8",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "22",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 950,
    "y": 1080,
    "wires": [
      [
        "5f3ed30a.fb17ac"
      ]
    ]
  },
  {
    "id": "9bb7e742.fe6778",
    "type": "change",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 640,
    "y": 934,
    "wires": [
      [
        "87cfb997.596a08",
        "6b2ad87a.0e91f8"
      ]
    ]
  },
  {
    "id": "b15702d1.3a09",
    "type": "rbe",
    "z": "a3158433.9d1f78",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 380,
    "y": 480,
    "wires": [
      [
        "ed273171.7f05f"
      ]
    ]
  },
  {
    "id": "57ce7fd6.512fb",
    "type": "rbe",
    "z": "a3158433.9d1f78",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 380,
    "y": 520,
    "wires": [
      [
        "ed273171.7f05f"
      ]
    ]
  },
  {
    "id": "cab70747.d77428",
    "type": "rbe",
    "z": "a3158433.9d1f78",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 378,
    "y": 560,
    "wires": [
      [
        "2040e4b1.d5c3fc"
      ]
    ]
  },
  {
    "id": "4d55b523.00f95c",
    "type": "switch",
    "z": "a3158433.9d1f78",
    "name": "Start up complete",
    "property": "StartUpCompleted",
    "propertyType": "global",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 2236,
    "y": 591,
    "wires": [
      [
        "379963b.1349f9c",
        "21652d70.72b232"
      ]
    ]
  },
  {
    "id": "121df473.76cdfc",
    "type": "comment",
    "z": "b8a16318.b66a5",
    "name": "Start Up",
    "info": "",
    "x": 100,
    "y": 520,
    "wires": []
  },
  {
    "id": "4ae824ff.6456fc",
    "type": "inject",
    "z": "b8a16318.b66a5",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0.5",
    "topic": "Starting",
    "payload": "",
    "payloadType": "str",
    "x": 100,
    "y": 560,
    "wires": [
      [
        "cdb49bda.24b898",
        "a1c74ed7.4353b",
        "9451899f.67b3e8"
      ]
    ]
  },
  {
    "id": "561911f5.ea224",
    "type": "inject",
    "z": "b8a16318.b66a5",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "120",
    "topic": "",
    "payload": "Started",
    "payloadType": "str",
    "x": 120,
    "y": 820,
    "wires": [
      [
        "e459e773.cc4ca8",
        "d09e9ffd.22858"
      ]
    ]
  },
  {
    "id": "cdb49bda.24b898",
    "type": "change",
    "z": "b8a16318.b66a5",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "StartUpCompleted",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 320,
    "y": 560,
    "wires": [
      []
    ]
  },
  {
    "id": "e459e773.cc4ca8",
    "type": "change",
    "z": "b8a16318.b66a5",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "StartUpCompleted",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 340,
    "y": 780,
    "wires": [
      []
    ]
  },
  {
    "id": "d09e9ffd.22858",
    "type": "time-range-switch",
    "z": "b8a16318.b66a5",
    "name": "",
    "lat": "",
    "lon": "",
    "startTime": "09:00",
    "endTime": "20:00",
    "startOffset": 0,
    "endOffset": 0,
    "x": 290,
    "y": 840,
    "wires": [
      [
        "3aea71b8.ac593e"
      ],
      []
    ]
  },
  {
    "id": "f2f81d70.02f45",
    "type": "api-current-state",
    "z": "48ba348c.61270c",
    "name": "Bathroom Light",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bathroom_light",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 400,
    "y": 1740,
    "wires": [
      [
        "e52e2bae.e37f08"
      ]
    ]
  },
  {
    "id": "e52e2bae.e37f08",
    "type": "switch",
    "z": "48ba348c.61270c",
    "name": "Is on?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 630,
    "y": 1740,
    "wires": [
      [
        "32a12bfb.202554"
      ]
    ]
  },
  {
    "id": "829f4cff.e7ef9",
    "type": "switch",
    "z": "48ba348c.61270c",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gte",
        "v": "80",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1050,
    "y": 1740,
    "wires": [
      [
        "ceef5649.2c1e28",
        "6554bcd1.9b1094"
      ]
    ]
  },
  {
    "id": "32a12bfb.202554",
    "type": "function",
    "z": "48ba348c.61270c",
    "name": "How many minutes?",
    "func": "var startTime = new Date(msg.data.last_changed); \nvar endTime = new Date(Date.now());\nvar difference = endTime.getTime() - startTime.getTime(); // This will give difference in milliseconds\nvar resultInMinutes = Math.round(difference / 60000);\nmsg.payload = resultInMinutes\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 840,
    "y": 1740,
    "wires": [
      [
        "829f4cff.e7ef9"
      ]
    ]
  },
  {
    "id": "ceef5649.2c1e28",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Bathroom Light is still on after 80 minutes",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Bathroom Light Is Still",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Auto fix - tunring off light",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1210,
    "y": 1740,
    "wires": [
      [
        "ab9413e4.3c106"
      ]
    ]
  },
  {
    "id": "ab9413e4.3c106",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 1355,
    "y": 1740,
    "wires": []
  },
  {
    "id": "a8b7b552.c40c58",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "Every 5 Minutes",
    "repeat": "300",
    "crontab": "",
    "once": true,
    "onceDelay": "60",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 150,
    "y": 1740,
    "wires": [
      [
        "f2f81d70.02f45"
      ]
    ]
  },
  {
    "id": "bb7358f3.65e0f8",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "BathRoom Light",
    "info": "",
    "x": 140,
    "y": 1680,
    "wires": []
  },
  {
    "id": "6554bcd1.9b1094",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Turn Off Bathroom light",
    "server": "5ee4d578.f7736c",
    "service_domain": "light",
    "service": "turn_off",
    "data": "{\"entity_id\":\" light.bathroom_light\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1250,
    "y": 1780,
    "wires": [
      []
    ]
  },
  {
    "id": "19a57a1d.668396",
    "type": "trigger-state",
    "z": "acf12371.2c1ae",
    "name": "",
    "server": "5ee4d578.f7736c",
    "entityid": "light.hue_lightstrip_plus_1_2",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "yrj9xgqsli",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      },
      {
        "id": "awav1i06gke",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 380,
    "y": 260,
    "wires": [
      [
        "305f853b.a9109a",
        "69f941cc.67b3d"
      ],
      []
    ]
  },
  {
    "id": "305f853b.a9109a",
    "type": "api-call-service",
    "z": "acf12371.2c1ae",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.hue_lightstrip_plus_1_2",
    "data": "{\"rgb_color\":[255,40,254]}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 760,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "69f941cc.67b3d",
    "type": "api-call-service",
    "z": "acf12371.2c1ae",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.office_light_rgb",
    "data": "{\"rgb_color\":[255,40,254]}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 760,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "419be230.6e864c",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "When office plug active",
    "info": "",
    "x": 120,
    "y": 200,
    "wires": []
  },
  {
    "id": "ebbc8996.c43b58",
    "type": "catch",
    "z": "acf12371.2c1ae",
    "name": "",
    "scope": null,
    "x": 80,
    "y": 80,
    "wires": [
      [
        "1b1f5173.a7432f"
      ]
    ]
  },
  {
    "id": "1b1f5173.a7432f",
    "type": "subflow:f5eab19a.7cf17",
    "z": "acf12371.2c1ae",
    "name": "",
    "x": 310,
    "y": 80,
    "wires": []
  },
  {
    "id": "88992cf0.ec7f5",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "Error Handler",
    "info": "",
    "x": 90,
    "y": 40,
    "wires": []
  },
  {
    "id": "8cbf3f8d.84749",
    "type": "ha-wait-until",
    "z": "d73100a9.0d64d",
    "name": "Both In Bed",
    "server": "5ee4d578.f7736c",
    "outputs": 2,
    "entityId": "sensor.num_in_master_bed",
    "property": "state",
    "comparator": "is",
    "value": "2",
    "valueType": "str",
    "timeout": "4",
    "timeoutUnits": "hours",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 1870,
    "y": 300,
    "wires": [
      [
        "75529894.e77db8"
      ],
      [
        "27d2e607.3670ba"
      ]
    ]
  },
  {
    "id": "747f847d.8cf0ec",
    "type": "subflow:47bc2d66.1132e4",
    "z": "d73100a9.0d64d",
    "name": "",
    "env": [],
    "x": 3370,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "b4bcf0ef.3f114",
    "type": "subflow:c9b308f8.01ef68",
    "z": "d73100a9.0d64d",
    "name": "",
    "env": [],
    "x": 3010,
    "y": 420,
    "wires": []
  },
  {
    "id": "52988821.c30f68",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Disable holiday mode",
    "server": "eef5a84.da24f58",
    "service_domain": "input_boolean",
    "service": "turn_off",
    "data": "{\"entity_id\":\"input_boolean.holidaymode\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 480,
    "y": 1400,
    "wires": [
      []
    ]
  },
  {
    "id": "359bae70.db4ef2",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Disarm Alarm",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "alarm_control_panel",
    "service": "alarm_disarm",
    "entityId": "alarm_control_panel.home_alarm",
    "data": "{}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1140,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "ae2c061b.21ee48",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "Give Life life 360 time to update",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1110,
    "y": 400,
    "wires": [
      [
        "2040e4b1.d5c3fc",
        "da37bd86.e9a86"
      ]
    ]
  },
  {
    "id": "ed273171.7f05f",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "Give Life life 360 time to update",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "10",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 790,
    "y": 500,
    "wires": [
      [
        "2040e4b1.d5c3fc"
      ]
    ]
  },
  {
    "id": "a2cfceb9.6eebc",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Someone Home",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.isanyonehome",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 240,
    "y": 1000,
    "wires": [
      []
    ]
  },
  {
    "id": "dc2626b6.cb8a88",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Away",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.isanyonehome",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 770,
    "y": 1100,
    "wires": [
      []
    ]
  },
  {
    "id": "bea24dc.62f6cb",
    "type": "function",
    "z": "a3158433.9d1f78",
    "name": "SomeOne Left ",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 780,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "81818922.360f98",
    "type": "function",
    "z": "a3158433.9d1f78",
    "name": "Someone Home",
    "func": "msg = {};\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 780,
    "y": 220,
    "wires": [
      [
        "359bae70.db4ef2",
        "34d4aee9.cd2842",
        "ae2c061b.21ee48",
        "554a47c4.710788"
      ]
    ]
  },
  {
    "id": "fa841a56.1037e8",
    "type": "link out",
    "z": "a3158433.9d1f78",
    "name": "Matt Home",
    "links": [
      "2bed651f.90ee2a"
    ],
    "x": 995,
    "y": 131,
    "wires": []
  },
  {
    "id": "2bed651f.90ee2a",
    "type": "link in",
    "z": "dceb45d8.425368",
    "name": "Matt Lunch Time - Home vis bt",
    "links": [
      "6590eef7.36df6",
      "fa841a56.1037e8"
    ],
    "x": 75,
    "y": 140,
    "wires": [
      [
        "912e1c7f.de2ae"
      ]
    ]
  },
  {
    "id": "b217742e.3caa78",
    "type": "switch",
    "z": "a3158433.9d1f78",
    "name": "DisarmDelayOver",
    "property": "DisarmDelayOver",
    "propertyType": "global",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 2470,
    "y": 640,
    "wires": [
      [
        "21652d70.72b232",
        "234642c4.349f8e"
      ]
    ]
  },
  {
    "id": "da37bd86.e9a86",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "Deactive - DisarmDelayOver",
    "rules": [
      {
        "t": "set",
        "p": "DisarmDelayOver",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1420,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "554a47c4.710788",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "Active - DisarmDelayOver",
    "rules": [
      {
        "t": "set",
        "p": "DisarmDelayOver",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "a1c74ed7.4353b",
    "type": "change",
    "z": "b8a16318.b66a5",
    "name": "Deactive - DisarmDelayOver",
    "rules": [
      {
        "t": "set",
        "p": "DisarmDelayOver",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 320,
    "y": 600,
    "wires": [
      []
    ]
  },
  {
    "id": "ecc00f70.5015e",
    "type": "trigger-state",
    "z": "a0cdc0f9.a362b",
    "name": "Bathroom Door Closes",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.bathroom_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "d5vltnbuxze",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "off"
      },
      {
        "id": "9ynzlhs6z8",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 220,
    "y": 360,
    "wires": [
      [
        "11cc7991.aa98f6"
      ],
      []
    ]
  },
  {
    "id": "11cc7991.aa98f6",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "On",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "on",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 360,
    "wires": [
      [
        "9edcd817.aed998"
      ]
    ]
  },
  {
    "id": "6f09f51.c3f470c",
    "type": "delay",
    "z": "d73100a9.0d64d",
    "name": "",
    "pauseType": "delay",
    "timeout": "30",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 300,
    "y": 380,
    "wires": [
      [
        "76161c80.f91cb4"
      ]
    ]
  },
  {
    "id": "4dd1d9f0.0d6928",
    "type": "server-state-changed",
    "z": "21d6efde.d0943",
    "name": "Number Of People In Bed",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "sensor.num_in_master_bed",
    "entityidfiltertype": "substring",
    "outputinitially": true,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 150,
    "y": 280,
    "wires": [
      [
        "c77ec114.79458"
      ]
    ]
  },
  {
    "id": "17ce9344.2f1a6d",
    "type": "function",
    "z": "21d6efde.d0943",
    "name": "What changed?",
    "func": "if (msg.payload == \"0\" && msg.data.old_state.state >= \"1\") {\n    // Bed Empty\n    return [null, null, null, msg];\n}if ((msg.payload == \"1\" && msg.data.old_state.state == \"2\" )) {\n    // Someone got out of bed    \n    return [msg, null, null, null];\n} else if (msg.payload == \"2\" ) {\n    // All In bed\n    return [null, msg, null, null];\n} else if (msg.payload == \"1\" && msg.data.old_state.state == \"0\" ) {\n    return [null,null ,msg, null];\n}\n",
    "outputs": 4,
    "noerr": 0,
    "x": 443,
    "y": 380,
    "wires": [
      [
        "8742d21b.87bac",
        "f5f4dbc1.426328"
      ],
      [
        "37a4096e.f440b6",
        "f5f4dbc1.426328"
      ],
      [
        "e00c5e15.87c8",
        "f5f4dbc1.426328"
      ],
      [
        "8742d21b.87bac",
        "89782bb8.4daed8",
        "f5f4dbc1.426328"
      ]
    ],
    "outputLabels": [
      "Someone got out of bed ",
      "All In bed",
      "Some one got into bed",
      ""
    ]
  },
  {
    "id": "73c4653f.fa065c",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Turn Off Hallway",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.hallway_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 960,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "31e78bac.bf7a44",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Get Light Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.hue_lightstrip_underbed",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 960,
    "y": 220,
    "wires": [
      [
        "e6526ce7.a7f6d"
      ]
    ]
  },
  {
    "id": "e6526ce7.a7f6d",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Is on?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 220,
    "wires": [
      [
        "bd2991b6.e3bb8"
      ]
    ]
  },
  {
    "id": "bf1745aa.99ae38",
    "type": "trigger",
    "z": "21d6efde.d0943",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "40",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1570,
    "y": 220,
    "wires": [
      [
        "c7837085.fa407"
      ]
    ]
  },
  {
    "id": "d94b6303.4c9b4",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Get Light Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.hue_lightstrip_underbed",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 960,
    "y": 580,
    "wires": [
      [
        "3e8b67b.d67e898"
      ]
    ]
  },
  {
    "id": "3e8b67b.d67e898",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Is on?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1116,
    "y": 580,
    "wires": [
      [],
      [
        "cd3f3b72.852b78"
      ]
    ]
  },
  {
    "id": "ad898ac9.92eed8",
    "type": "trigger",
    "z": "21d6efde.d0943",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": true,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1330,
    "y": 480,
    "wires": [
      [
        "3b6b00df.83105"
      ]
    ]
  },
  {
    "id": "b72e15a1.166368",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Get Light Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.hue_lightstrip_underbed",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 954,
    "y": 440,
    "wires": [
      [
        "c33821b3.7c2f2"
      ]
    ]
  },
  {
    "id": "c33821b3.7c2f2",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Is on?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1144,
    "y": 440,
    "wires": [
      [
        "ad898ac9.92eed8"
      ]
    ]
  },
  {
    "id": "cd3f3b72.852b78",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Is Light?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "10",
    "halt_if_type": "num",
    "halt_if_compare": "gt",
    "override_topic": true,
    "entity_id": "sensor.bedroom_light_level",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1280,
    "y": 580,
    "wires": [
      [
        "77cd270e.473e68"
      ],
      [
        "4dc7d59d.1755fc"
      ]
    ]
  },
  {
    "id": "77cd270e.473e68",
    "type": "trigger",
    "z": "21d6efde.d0943",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "4",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1690,
    "y": 620,
    "wires": [
      [
        "54d568b1.55c118"
      ]
    ]
  },
  {
    "id": "b5f1a42e.badfd8",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 370,
    "y": 520,
    "wires": [
      [
        "ad898ac9.92eed8",
        "77cd270e.473e68",
        "bf1745aa.99ae38",
        "85de34f9.89a238"
      ]
    ]
  },
  {
    "id": "b97181b3.4fed7",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "TODO: Once Barthroom door open - increase lgiht level",
    "info": "",
    "x": 1737,
    "y": 320,
    "wires": []
  },
  {
    "id": "54d568b1.55c118",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Is sun up?",
    "property": "sunstate",
    "propertyType": "global",
    "rules": [
      {
        "t": "eq",
        "v": "above_horizon",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1870,
    "y": 620,
    "wires": [
      [
        "3ae27dd.11c2082"
      ],
      [
        "b945e297.cc631"
      ]
    ],
    "outputLabels": [
      "Yes",
      "No"
    ]
  },
  {
    "id": "3ae27dd.11c2082",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Turn Off Light Strip",
    "server": "eef5a84.da24f58",
    "version": "1",
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.hue_lightstrip_underbed",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 2076,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "d320a708.e46708",
    "type": "link out",
    "z": "21d6efde.d0943",
    "name": "Someone going to bathroom",
    "links": [
      "fc92a07c.b063"
    ],
    "x": 1155,
    "y": 180,
    "wires": []
  },
  {
    "id": "f095ae40.45f81",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "Bathroom light",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "on",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 960,
    "y": 180,
    "wires": [
      [
        "d320a708.e46708"
      ]
    ]
  },
  {
    "id": "7dad6fcb.83973",
    "type": "catch",
    "z": "21d6efde.d0943",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 60,
    "wires": [
      [
        "36ab283d.217f38"
      ]
    ]
  },
  {
    "id": "36ab283d.217f38",
    "type": "subflow:f5eab19a.7cf17",
    "z": "21d6efde.d0943",
    "name": "",
    "x": 350,
    "y": 60,
    "wires": []
  },
  {
    "id": "7ea1ee6b.d0763",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 20,
    "wires": []
  },
  {
    "id": "54664ccd.b262b4",
    "type": "api-call-service",
    "z": "7df159d5.618c58",
    "name": "Call Service",
    "server": "5ee4d578.f7736c",
    "service_domain": "",
    "service": "",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 730,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "eaa2ec0.5e97a18",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 1220,
    "wires": [
      [
        "e2585915.37a2e8"
      ]
    ]
  },
  {
    "id": "b976ad9c.9ff01",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 1260,
    "wires": [
      [
        "f5b0f47e.dda648"
      ]
    ]
  },
  {
    "id": "2e287d01.0a12d2",
    "type": "function",
    "z": "7df159d5.618c58",
    "name": "Build Command",
    "func": "var rgb_color;\nvar mattColor = [72,255,118] // greeb\nvar danniColor = [75,164,255] // blue\nvar fullBed = [201,40,255] // dark pink\nvar emtpyBed = [255,182,109] // oragne\nvar lightLevel = env.get(\"Light Level\")\n\nif (msg.payload.NumberInBed == \"0\") {\n    rgb_color = emtpyBed; \n} else if (msg.payload.NumberInBed == \"2\") {\n   rgb_color = fullBed;\n} else if (msg.payload.DanniInBed == \"True\") {\n    rgb_color = danniColor;\n} else if (msg.payload.MattInBed == \"True\") {\n    rgb_color = mattColor;\n} else {\n    rgb_color = [255,43,0]; // Error this should happen\n}\n\n\n\nif (lightLevel == \"DIMMED\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : \"turn_on\",\n     \"data\" : \n        { \n            \"entity_id\" : \"light.hue_lightstrip_underbed\",\n            \"brightness_pct\": \"50\",\n            \"transition\":\"5\",\n            \"rgb_color\": rgb_color\n        } \n    }\n} else if (lightLevel == \"SLOW_LOW\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : \"turn_on\",\n     \"data\" : \n        { \n            \"entity_id\" : \"light.hue_lightstrip_underbed\",\n            \"brightness_pct\": \"10\",\n            \"transition\":\"30\",\n            \"rgb_color\": rgb_color\n        } \n    }\n}else if (lightLevel == \"FAST_LOW\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : \"turn_on\",\n     \"data\" : \n        { \n            \"entity_id\" : \"light.hue_lightstrip_underbed\",\n            \"brightness_pct\": \"10\",\n            \"transition\":\"5\",\n            \"rgb_color\": rgb_color\n        } \n    }\n} else if (lightLevel == \"HIGH\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : \"turn_on\",\n     \"data\" : \n        { \n            \"entity_id\" : \"light.hue_lightstrip_underbed\",\n            \"brightness_pct\": \"100\",\n            \"transition\":\"2\",\n            \"rgb_color\": rgb_color\n        } \n    }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 480,
    "y": 80,
    "wires": [
      [
        "54664ccd.b262b4"
      ]
    ]
  },
  {
    "id": "55364589.7caf5c",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Someone Got Out of Bed",
    "info": "",
    "x": 987,
    "y": 140,
    "wires": []
  },
  {
    "id": "7163eb0e.a8e594",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Both in Bed",
    "info": "",
    "x": 944,
    "y": 280,
    "wires": []
  },
  {
    "id": "80b968a4.750978",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Someone got into to bed and bed was empty",
    "info": "",
    "x": 1050,
    "y": 540,
    "wires": []
  },
  {
    "id": "8742d21b.87bac",
    "type": "function",
    "z": "21d6efde.d0943",
    "name": "Someone Got Out of Bed",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 713,
    "y": 200,
    "wires": [
      [
        "31e78bac.bf7a44",
        "f095ae40.45f81"
      ]
    ]
  },
  {
    "id": "37a4096e.f440b6",
    "type": "function",
    "z": "21d6efde.d0943",
    "name": "Both In Bed",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 730,
    "y": 400,
    "wires": [
      [
        "73c4653f.fa065c",
        "b72e15a1.166368",
        "60ccf4c9.3b230c",
        "19968e17.daaa62"
      ]
    ]
  },
  {
    "id": "3a419f66.b12e2",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 1180,
    "wires": [
      [
        "9b6604aa.359578"
      ]
    ]
  },
  {
    "id": "a9d60da4.efb3b",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 1300,
    "wires": [
      [
        "5df54694.ddcb18"
      ]
    ]
  },
  {
    "id": "e890483e.ef37a8",
    "type": "api-render-template",
    "z": "7df159d5.618c58",
    "name": "GetState",
    "server": "5ee4d578.f7736c",
    "template": "{\n  \"MattInBed\": \"{{ states(\"sensor.matt_in_bed\") }}\",\n  \"DanniInBed\": \"{{ states(\"sensor.danni_in_bed\") }}\",\n  \"NumberInBed\": \"{{ states(\"sensor.num_in_master_bed\") }}\"\n}",
    "resultsLocation": "payload",
    "resultsLocationType": "msg",
    "templateLocation": "template",
    "templateLocationType": "msg",
    "x": 260,
    "y": 80,
    "wires": [
      [
        "2e287d01.0a12d2"
      ]
    ]
  },
  {
    "id": "ffbd43d0.7ad8c",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Automation based on bed sensor",
    "info": "",
    "x": 193,
    "y": 160,
    "wires": []
  },
  {
    "id": "cd442f93.a7434",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Testing",
    "info": "",
    "x": 110,
    "y": 1120,
    "wires": []
  },
  {
    "id": "6986a0d4.bf4d6",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Set LightLevel = FAST_LOW",
    "rules": [
      {
        "t": "set",
        "p": "LightLevel",
        "pt": "msg",
        "to": "FAST_LOW",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 3058,
    "y": 480,
    "wires": [
      [
        "f7a7ad4c.e1887"
      ]
    ]
  },
  {
    "id": "f7a7ad4c.e1887",
    "type": "subflow:7df159d5.618c58",
    "z": "d73100a9.0d64d",
    "name": "",
    "x": 3320,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "33d67a23.de0b26",
    "type": "function",
    "z": "d73100a9.0d64d",
    "name": "-",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "x": 2830,
    "y": 420,
    "wires": [
      [
        "b4bcf0ef.3f114",
        "6986a0d4.bf4d6",
        "766b8cf0.e8b514"
      ]
    ]
  },
  {
    "id": "ebab3cd6.89d6d",
    "type": "function",
    "z": "47bc2d66.1132e4",
    "name": "Build Data",
    "func": "msg.payload = {\n    \"data\":\n        { \"message\": \".\", \"entity_id\": msg.pri_alexa }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 970,
    "y": 100,
    "wires": [
      [
        "275d0587.9c0bba"
      ]
    ]
  },
  {
    "id": "a2f7cd26.7ec92",
    "type": "link in",
    "z": "21d6efde.d0943",
    "name": "Hallway Motion - Action",
    "links": [
      "e04902ac.5849e",
      "ddc05dd0.50814"
    ],
    "x": 75,
    "y": 1060,
    "wires": [
      [
        "4a31153c.c3f34c"
      ]
    ]
  },
  {
    "id": "85de34f9.89a238",
    "type": "ha-wait-until",
    "z": "21d6efde.d0943",
    "name": "",
    "server": "5ee4d578.f7736c",
    "outputs": 2,
    "entityId": "sensor.num_in_master_bed",
    "property": "state",
    "comparator": "gte",
    "value": "1",
    "valueType": "num",
    "timeout": "3",
    "timeoutUnits": "minutes",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 900,
    "y": 1100,
    "wires": [
      [],
      [
        "b37727b7.7328c8"
      ]
    ]
  },
  {
    "id": "54dcaa5e.c2e7e4",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Is Drak?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "10",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 614,
    "y": 1060,
    "wires": [
      [
        "85de34f9.89a238",
        "ac8b17ae.6c2cb8"
      ]
    ]
  },
  {
    "id": "65fba381.feb66c",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Get Light Level",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "sensor.bedroom_light_level",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 414,
    "y": 1060,
    "wires": [
      [
        "54dcaa5e.c2e7e4"
      ]
    ],
    "icon": "node-red/mongodb.png"
  },
  {
    "id": "7ed0494c.0f48f8",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Hallway motion",
    "info": "",
    "x": 140,
    "y": 1020,
    "wires": []
  },
  {
    "id": "b37727b7.7328c8",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Turn Off Light Strip",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.hue_lightstrip_underbed",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1170,
    "y": 1120,
    "wires": [
      []
    ]
  },
  {
    "id": "4a31153c.c3f34c",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 210,
    "y": 1060,
    "wires": [
      [
        "65fba381.feb66c"
      ]
    ]
  },
  {
    "id": "c3e890f4.9c742",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Hallway Motion - Action",
    "links": [
      "e04902ac.5849e",
      "ddc05dd0.50814"
    ],
    "x": 135,
    "y": 300,
    "wires": [
      [
        "6d9dc6b3.422258"
      ]
    ]
  },
  {
    "id": "6d9dc6b3.422258",
    "type": "switch",
    "z": "a0cdc0f9.a362b",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 250,
    "y": 300,
    "wires": [
      [
        "a930f15f.b431d",
        "f49bd1bf.ad501"
      ]
    ]
  },
  {
    "id": "be46a4b4.32eef8",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Hallway motion",
    "info": "",
    "x": 200,
    "y": 260,
    "wires": []
  },
  {
    "id": "c6403382.59d75",
    "type": "trigger",
    "z": "a0cdc0f9.a362b",
    "name": "Wait 2 Minute for some one to enter",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "2",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1120,
    "y": 180,
    "wires": [
      [
        "918f0fb5.9a267"
      ]
    ]
  },
  {
    "id": "dfbfea55.092c18",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "Someone Entered Bathroom",
    "rules": [
      {
        "t": "set",
        "p": "blah",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 860,
    "y": 400,
    "wires": [
      [
        "f49bd1bf.ad501",
        "95a4dd4.cece52",
        "bc7a046f.08cac8",
        "84ba3598.6c50e8"
      ]
    ]
  },
  {
    "id": "d6eda8a.8082c58",
    "type": "change",
    "z": "dceb45d8.425368",
    "name": "SET LunchTime Var",
    "rules": [
      {
        "t": "set",
        "p": "LunchTime.BeenTrigged",
        "pt": "global",
        "to": "on",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1540,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "60ccf4c9.3b230c",
    "type": "link out",
    "z": "21d6efde.d0943",
    "name": "Both In Bed",
    "links": [
      "5a8e5309.e00ddc"
    ],
    "x": 975,
    "y": 400,
    "wires": []
  },
  {
    "id": "5a8e5309.e00ddc",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Bathroom disable timer",
    "links": [
      "1ba3252.4c458db",
      "60ccf4c9.3b230c"
    ],
    "x": 555,
    "y": 620,
    "wires": [
      [
        "c6d28a61.3da988"
      ]
    ]
  },
  {
    "id": "367929a4.b81d46",
    "type": "change",
    "z": "c9b308f8.01ef68",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "hasGoodNightBeenTriggered",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 980,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "8f9c705.d69fb9",
    "type": "change",
    "z": "99d64a3d.f4e418",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "hasGoodNightBeenTriggered",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1200,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "6ea9b8b4.f2d438",
    "type": "switch",
    "z": "d73100a9.0d64d",
    "name": "Has triggered",
    "property": "hasGoodNightBeenTriggered",
    "propertyType": "global",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1160,
    "y": 300,
    "wires": [
      [],
      [
        "72c3ab65.ad95e4"
      ]
    ]
  },
  {
    "id": "eb0ba936.3f4e18",
    "type": "switch",
    "z": "d73100a9.0d64d",
    "name": "Has triggered",
    "property": "hasGoodNightBeenTriggered",
    "propertyType": "global",
    "rules": [
      {
        "t": "false"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 2220,
    "y": 300,
    "wires": [
      [
        "6e45a7ed.2c8728",
        "5d848996.a2fc68",
        "3eddd440.5a143c"
      ]
    ]
  },
  {
    "id": "1c6435f7.2b5b4a",
    "type": "function",
    "z": "a0a4859f.5a2a48",
    "name": "Data",
    "func": "msg.payload = \n{\n  \"data\": \n  {\n    \"message\": \"Alarm still going off disable light show\",\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 750,
    "y": 760,
    "wires": [
      [
        "7d81f06.7dd5b1"
      ]
    ]
  },
  {
    "id": "7bc3b53b.a5caec",
    "type": "server-state-changed",
    "z": "acf12371.2c1ae",
    "name": "",
    "server": "5ee4d578.f7736c",
    "entityidfilter": "sensor.octoprint_current_state",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "haltifstate": "",
    "outputs": 1,
    "x": 190,
    "y": 380,
    "wires": [
      [
        "8b157c0.56ad788"
      ]
    ]
  },
  {
    "id": "acdd264f.f21468",
    "type": "api-call-service",
    "z": "acf12371.2c1ae",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "version": "1",
    "service_domain": "notify",
    "service": "mattiphone_iphone_10smax",
    "entityId": "",
    "data": "{}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 840,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "8b157c0.56ad788",
    "type": "function",
    "z": "acf12371.2c1ae",
    "name": "Data",
    "func": "msg.payload = \n{\n  \"data\": \n  {\n    \"message\": \"Printer new Status: \" + msg.payload\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 530,
    "y": 380,
    "wires": [
      [
        "acdd264f.f21468"
      ]
    ]
  },
  {
    "id": "7076afa8.c4a22",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "Printer State Change",
    "info": "",
    "x": 120,
    "y": 340,
    "wires": []
  },
  {
    "id": "2b73f0a0.724a4",
    "type": "api-call-service",
    "z": "acf12371.2c1ae",
    "name": "Turn on office Light",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.office_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 950,
    "y": 620,
    "wires": [
      []
    ]
  },
  {
    "id": "aa78949c.41c9a8",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Office Door State Change",
    "links": [
      "79d508d7.4f2b68"
    ],
    "x": 395,
    "y": 1720,
    "wires": []
  },
  {
    "id": "79d508d7.4f2b68",
    "type": "link in",
    "z": "acf12371.2c1ae",
    "name": "",
    "links": [
      "8c42e0e.e62702",
      "aa78949c.41c9a8"
    ],
    "x": 161,
    "y": 680,
    "wires": [
      [
        "bb9565df.a2f8c8"
      ]
    ]
  },
  {
    "id": "bac0e249.335d6",
    "type": "api-current-state",
    "z": "56368b94.f11494",
    "name": "Hallway State",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "sensor.hallway_sensor_light_level",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 440,
    "y": 140,
    "wires": [
      [
        "76978b35.4c91e4"
      ]
    ]
  },
  {
    "id": "76978b35.4c91e4",
    "type": "switch",
    "z": "56368b94.f11494",
    "name": "Is Dark?",
    "property": "data.attributes.dark",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "false"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 680,
    "y": 140,
    "wires": [
      [],
      [],
      [
        "8c895b54.0a9588"
      ]
    ]
  },
  {
    "id": "3aaf4288.5a861e",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "On Door Open - Turn on light if dark",
    "info": "",
    "x": 180,
    "y": 580,
    "wires": []
  },
  {
    "id": "2554c135.8f322e",
    "type": "api-call-service",
    "z": "2aff94ce.fdbbdc",
    "name": "Office Plug",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{\"entity_id\":\"switch.plug_05\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 510,
    "y": 120,
    "wires": [
      [
        "ef5eac6b.9761a"
      ]
    ]
  },
  {
    "id": "97ee681f.882eb8",
    "type": "delay",
    "z": "2aff94ce.fdbbdc",
    "name": "",
    "pauseType": "delay",
    "timeout": "60",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 220,
    "y": 120,
    "wires": [
      [
        "2554c135.8f322e"
      ]
    ]
  },
  {
    "id": "63544d80.0c9704",
    "type": "subflow:2aff94ce.fdbbdc",
    "z": "c9b308f8.01ef68",
    "name": "",
    "env": [],
    "x": 510,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "3889bd46.c46682",
    "type": "switch",
    "z": "fec14295.8a46d",
    "name": "Is On?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "true"
      },
      {
        "t": "eq",
        "v": "On",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Yes",
        "vt": "str"
      },
      {
        "t": "false"
      },
      {
        "t": "eq",
        "v": "Off",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "no",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 9,
    "x": 270,
    "y": 140,
    "wires": [
      [],
      [],
      [],
      [],
      [],
      [],
      [],
      [],
      []
    ]
  },
  {
    "id": "4b081df5.3a2924",
    "type": "comment",
    "z": "fec14295.8a46d",
    "name": "True",
    "info": "",
    "x": 570,
    "y": 40,
    "wires": []
  },
  {
    "id": "46cf8510.1b9b6c",
    "type": "comment",
    "z": "fec14295.8a46d",
    "name": "False",
    "info": "",
    "x": 570,
    "y": 200,
    "wires": []
  },
  {
    "id": "bb415259.e6d81",
    "type": "function",
    "z": "a0a4859f.5a2a48",
    "name": "Data",
    "func": "var loc = \"Alarm not active - \" + msg.location;\nif (msg.trusted == false) {\n    loc = \"untrusted motion detected alarm will not trigger - \"  + msg.location\n}\n\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": loc,\n    \"data\": \n    {\n      \"push\": {\n            \"badge\": 5,\n            \"category\": \"alarm\"\n        },\"attachment\": \n      {\n        \"url\": msg.image,\n        \"content-type\": \"jpeg\",\n        \"hide-thumbnail\": false\n      }\n    }\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "x": 1430,
    "y": 100,
    "wires": [
      [
        "4766ddd2.ac3f44"
      ]
    ]
  },
  {
    "id": "49841f4d.0e0a6",
    "type": "api-current-state",
    "z": "cdbc6ec6.2e0ec",
    "name": "Matt",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.matt_living_room",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 210,
    "y": 40,
    "wires": [
      [
        "179e2120.6949bf"
      ]
    ]
  },
  {
    "id": "1f3dd269.5d463e",
    "type": "api-current-state",
    "z": "cdbc6ec6.2e0ec",
    "name": "Danni",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.danni_living_room",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 210,
    "y": 80,
    "wires": [
      [
        "179e2120.6949bf"
      ]
    ]
  },
  {
    "id": "179e2120.6949bf",
    "type": "join",
    "z": "cdbc6ec6.2e0ec",
    "name": "",
    "mode": "custom",
    "build": "array",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "accumulate": false,
    "timeout": "",
    "count": "2",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "",
    "reduceFixup": "",
    "x": 430,
    "y": 60,
    "wires": [
      [
        "78367767.3a14a8"
      ]
    ]
  },
  {
    "id": "78367767.3a14a8",
    "type": "function",
    "z": "cdbc6ec6.2e0ec",
    "name": "Any on home?",
    "func": "\nif (msg.payload[0] > 10 || msg.payload[1] > 10) {\n   return [msg, null];\n} else if (msg.payload[0] == 0 && msg.payload[1] == 0)  {\n    return [null, msg];\n} else {\n    return [null, null];\n}",
    "outputs": 2,
    "noerr": 0,
    "x": 680,
    "y": 60,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "e615d2e5.a6b6e",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "env": [],
    "x": 1240,
    "y": 100,
    "wires": [
      [],
      [
        "bb415259.e6d81",
        "a9868bfd.76d548"
      ]
    ]
  },
  {
    "id": "1ed9c8f5.1b8567",
    "type": "comment",
    "z": "a0a4859f.5a2a48",
    "name": "Notication Only",
    "info": "",
    "x": 980,
    "y": 60,
    "wires": []
  },
  {
    "id": "4631bb30.00af14",
    "type": "comment",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm & Notication",
    "info": "",
    "x": 990,
    "y": 140,
    "wires": []
  },
  {
    "id": "7825ad5c.712c84",
    "type": "trigger",
    "z": "a0a4859f.5a2a48",
    "name": "wait 20 seconds",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1380,
    "y": 360,
    "wires": [
      [
        "ef97081d.287ae8"
      ]
    ]
  },
  {
    "id": "6aaf5f6d.8996c",
    "type": "rbe",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "location",
    "x": 810,
    "y": 100,
    "wires": [
      [
        "51b15e05.4f64a"
      ]
    ]
  },
  {
    "id": "22b57d8c.92fe72",
    "type": "inject",
    "z": "dceb45d8.425368",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 120,
    "y": 180,
    "wires": [
      [
        "912e1c7f.de2ae"
      ]
    ]
  },
  {
    "id": "5cbf4f55.ced48",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "env": [],
    "x": 670,
    "y": 1200,
    "wires": [
      [
        "770fb6fb.c34b98",
        "30cf93b0.d2bb6c",
        "9bb7e742.fe6778",
        "2e706b9a.44a264"
      ],
      []
    ]
  },
  {
    "id": "5ade2405.4537cc",
    "type": "comment",
    "z": "a0a4859f.5a2a48",
    "name": "Block if someone home",
    "info": "",
    "x": 680,
    "y": 1160,
    "wires": []
  },
  {
    "id": "770fb6fb.c34b98",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "Disarm Alarm",
    "server": "5ee4d578.f7736c",
    "service_domain": "alarm_control_panel",
    "service": "alarm_disarm",
    "data": "{\"entity_id\":\"alarm_control_panel.home_alarm\"}",
    "mergecontext": "",
    "x": 940,
    "y": 1180,
    "wires": [
      []
    ]
  },
  {
    "id": "c9abaa1c.5ae078",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1260,
    "y": 1200,
    "wires": [
      []
    ]
  },
  {
    "id": "21658842.1f96a8",
    "type": "api-call-service",
    "z": "a0a4859f.5a2a48",
    "name": "Let Danni Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "danniiphone",
    "data": "{}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1260,
    "y": 1240,
    "wires": [
      []
    ]
  },
  {
    "id": "30cf93b0.d2bb6c",
    "type": "function",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm Activation Blocked",
    "func": "\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": \"Alarm Activation Blocked\"\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 970,
    "y": 1220,
    "wires": [
      [
        "c9abaa1c.5ae078",
        "21658842.1f96a8"
      ]
    ]
  },
  {
    "id": "a930f15f.b431d",
    "type": "api-current-state",
    "z": "a0cdc0f9.a362b",
    "name": "Light off?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bathroom",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 660,
    "y": 200,
    "wires": [
      [
        "c6403382.59d75"
      ],
      []
    ]
  },
  {
    "id": "5d848996.a2fc68",
    "type": "ha-wait-until",
    "z": "d73100a9.0d64d",
    "name": "Wait 2 Min",
    "server": "5ee4d578.f7736c",
    "outputs": 2,
    "entityId": "sensor.num_in_master_bed",
    "property": "state",
    "comparator": "is_not",
    "value": "2",
    "valueType": "str",
    "timeout": "2",
    "timeoutUnits": "minutes",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "x": 2610,
    "y": 340,
    "wires": [
      [],
      [
        "c9b7606.bb30ea"
      ]
    ]
  },
  {
    "id": "3eddd440.5a143c",
    "type": "ha-wait-until",
    "z": "d73100a9.0d64d",
    "name": "Wait 5 Min",
    "server": "5ee4d578.f7736c",
    "outputs": 2,
    "entityId": "sensor.num_in_master_bed",
    "property": "state",
    "comparator": "is_not",
    "value": "2",
    "valueType": "str",
    "timeout": "5",
    "timeoutUnits": "minutes",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "x": 2608,
    "y": 400,
    "wires": [
      [
        "86cbf076.c386f"
      ],
      [
        "33d67a23.de0b26"
      ]
    ]
  },
  {
    "id": "7356acc5.e71944",
    "type": "switch",
    "z": "d73100a9.0d64d",
    "name": "Has triggered",
    "property": "hasGoodNightBeenTriggered",
    "propertyType": "global",
    "rules": [
      {
        "t": "false"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 2300,
    "y": 600,
    "wires": [
      [
        "94c4fb0a.6129d8",
        "b399da43.7ff288"
      ]
    ]
  },
  {
    "id": "94c4fb0a.6129d8",
    "type": "trigger",
    "z": "d73100a9.0d64d",
    "name": "",
    "op1": "",
    "op2": "on",
    "op1type": "nul",
    "op2type": "str",
    "duration": "2",
    "extend": false,
    "units": "min",
    "reset": "off",
    "bytopic": "all",
    "outputs": 1,
    "x": 2590,
    "y": 460,
    "wires": [
      [
        "c9b7606.bb30ea"
      ]
    ]
  },
  {
    "id": "b399da43.7ff288",
    "type": "trigger",
    "z": "d73100a9.0d64d",
    "name": "",
    "op1": "",
    "op2": "on",
    "op1type": "nul",
    "op2type": "str",
    "duration": "5",
    "extend": false,
    "units": "min",
    "reset": "off",
    "bytopic": "all",
    "outputs": 1,
    "x": 2590,
    "y": 500,
    "wires": [
      [
        "33d67a23.de0b26"
      ]
    ]
  },
  {
    "id": "9763e2da.ca994",
    "type": "inject",
    "z": "acf12371.2c1ae",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 100,
    "y": 260,
    "wires": [
      [
        "19a57a1d.668396"
      ]
    ]
  },
  {
    "id": "8bb1ee4b.d0777",
    "type": "inject",
    "z": "d73100a9.0d64d",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 580,
    "y": 140,
    "wires": [
      [
        "dbfd4318.98ec5"
      ]
    ]
  },
  {
    "id": "dbfd4318.98ec5",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "hasGoodNightBeenTriggered",
        "tot": "global"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 760,
    "y": 140,
    "wires": [
      [
        "54fc6c62.79b6c4"
      ]
    ]
  },
  {
    "id": "54fc6c62.79b6c4",
    "type": "debug",
    "z": "d73100a9.0d64d",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 930,
    "y": 140,
    "wires": []
  },
  {
    "id": "cc4f8d1.d9d097",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Reset Goog Night State",
    "rules": [
      {
        "t": "set",
        "p": "hasGoodNightBeenTriggered",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 490,
    "y": 1453,
    "wires": [
      []
    ]
  },
  {
    "id": "3f4805be.d14eba",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Bed Time = True",
    "rules": [
      {
        "t": "set",
        "p": "bedTime",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 800,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "8f58fd59.491a9",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Bed Time = False",
    "rules": [
      {
        "t": "set",
        "p": "bedTime",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 810,
    "y": 320,
    "wires": [
      [
        "22991a5c.8bccb6"
      ]
    ]
  },
  {
    "id": "430cb417.cb4e7c",
    "type": "inject",
    "z": "acf12371.2c1ae",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 480,
    "y": 300,
    "wires": [
      [
        "305f853b.a9109a",
        "69f941cc.67b3d"
      ]
    ]
  },
  {
    "id": "6ee79555.3f313c",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "a3158433.9d1f78",
    "name": "",
    "env": [],
    "x": 3050,
    "y": 620,
    "wires": [
      [],
      [
        "f4d0131e.967c4"
      ]
    ]
  },
  {
    "id": "45eeaa29.0cf7c4",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "",
    "op1": "1",
    "op2": "0",
    "op1type": "str",
    "op2type": "str",
    "duration": "10",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 3330,
    "y": 600,
    "wires": [
      [
        "f4d0131e.967c4"
      ]
    ]
  },
  {
    "id": "883e0b57.4516a8",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 3040,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "9622b30d.8b1b6",
    "type": "comment",
    "z": "a3158433.9d1f78",
    "name": "Allow 10 minute delay",
    "info": "",
    "x": 3060,
    "y": 540,
    "wires": []
  },
  {
    "id": "9488063b.727978",
    "type": "time-range-switch",
    "z": "85970b46.61e358",
    "name": "",
    "lat": "",
    "lon": "",
    "startTime": "07:00",
    "endTime": "goldenHour",
    "startOffset": "20:00",
    "endOffset": 0,
    "x": 670,
    "y": 40,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "b4c7c6f4.4d91b8",
    "type": "change",
    "z": "85970b46.61e358",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "NoteType",
        "tot": "env"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 300,
    "y": 40,
    "wires": [
      [
        "9488063b.727978"
      ]
    ]
  },
  {
    "id": "a119708f.86aad",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 740,
    "y": 1580,
    "wires": [
      [
        "d6c5ee0b.dd471"
      ],
      []
    ]
  },
  {
    "id": "d8742850.a3fb68",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 1020,
    "y": 1280,
    "wires": [
      [
        "4b56562a.e13668"
      ],
      []
    ]
  },
  {
    "id": "38de4a13.9e07c6",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 1020,
    "y": 1100,
    "wires": [
      [
        "cbb5e819.633268"
      ],
      []
    ]
  },
  {
    "id": "21d9c69d.9f8e7a",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 740,
    "y": 920,
    "wires": [
      [
        "ac6c25a0.3f1b98"
      ],
      []
    ]
  },
  {
    "id": "a8227300.13432",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 740,
    "y": 780,
    "wires": [
      [
        "cad6c4a0.0570e8"
      ],
      []
    ]
  },
  {
    "id": "18bb5523.688fcb",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 740,
    "y": 620,
    "wires": [
      [
        "be55b0fe.1cdef"
      ],
      []
    ]
  },
  {
    "id": "f4e9b89.fd1c548",
    "type": "subflow:85970b46.61e358",
    "z": "a068bd5.28a8d4",
    "name": "",
    "env": [],
    "x": 1080,
    "y": 1100,
    "wires": [
      [
        "408d5f52.6ad53"
      ],
      []
    ]
  },
  {
    "id": "408d5f52.6ad53",
    "type": "function",
    "z": "a068bd5.28a8d4",
    "name": "Data",
    "func": "msg.payload = \n{\n  \"data\": \n  {\n    \"message\": msg.location,\n    \"data\": \n    {\n      \"push\": {\n            \"badge\": 5,\n            \"category\": \"alarm\"\n        },\"attachment\": \n      {\n        \"url\": msg.image,\n        \"content-type\": \"jpeg\",\n        \"hide-thumbnail\": false\n      }\n    }\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1270,
    "y": 1100,
    "wires": [
      [
        "922d39aa.a4bb88"
      ]
    ]
  },
  {
    "id": "ef5eac6b.9761a",
    "type": "debug",
    "z": "2aff94ce.fdbbdc",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 770,
    "y": 60,
    "wires": []
  },
  {
    "id": "24753368.d0e28c",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "10 Second After Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 170,
    "y": 1160,
    "wires": [
      [
        "124b807c.ce19b",
        "51c0fbb2.abfe34"
      ]
    ]
  },
  {
    "id": "84157fba.07d2",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "10 Second After Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 170,
    "y": 1340,
    "wires": [
      [
        "24f7770e.b891b8",
        "899c25f0.69a088"
      ]
    ]
  },
  {
    "id": "8d22476.bf1ffb8",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/rmMini",
    "topic": "availability/rmMini",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1030,
    "y": 1320,
    "wires": []
  },
  {
    "id": "f49bd1bf.ad501",
    "type": "subflow:56368b94.f11494",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "env": [],
    "x": 1220,
    "y": 320,
    "wires": [
      [
        "14070813.4ada38"
      ],
      [
        "c6d28a61.3da988"
      ],
      [
        "14070813.4ada38"
      ]
    ]
  },
  {
    "id": "918f0fb5.9a267",
    "type": "api-current-state",
    "z": "a0cdc0f9.a362b",
    "name": "Light On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bathroom_light",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1600,
    "y": 580,
    "wires": [
      [
        "770e1c17.c8aae4"
      ]
    ]
  },
  {
    "id": "770e1c17.c8aae4",
    "type": "subflow:fec14295.8a46d",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "env": [],
    "x": 1780,
    "y": 580,
    "wires": [
      [
        "63f156bc.aed608"
      ],
      [],
      [
        "63f156bc.aed608"
      ]
    ]
  },
  {
    "id": "564bca04.e08854",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 260,
    "wires": [
      [
        "e5220084.3f59c"
      ]
    ]
  },
  {
    "id": "e5220084.3f59c",
    "type": "function",
    "z": "c7191d19.c1e7b",
    "name": "Start",
    "func": "context.global.startTime = new Date().getTime();\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 420,
    "y": 260,
    "wires": [
      [
        "6aaa305f.aef59"
      ]
    ]
  },
  {
    "id": "4b43bcbe.e8e214",
    "type": "function",
    "z": "c7191d19.c1e7b",
    "name": "",
    "func": "var currentTime = new Date().getTime();\nvar timeElpased = (currentTime -context.global.startTime)\nmsg.payload = timeElpased / 1000\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 810,
    "y": 260,
    "wires": [
      [
        "6ad13589.f6ebec"
      ]
    ]
  },
  {
    "id": "6ad13589.f6ebec",
    "type": "debug",
    "z": "c7191d19.c1e7b",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1080,
    "y": 260,
    "wires": []
  },
  {
    "id": "6aaa305f.aef59",
    "type": "delay",
    "z": "c7191d19.c1e7b",
    "name": "",
    "pauseType": "random",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "10",
    "randomUnits": "seconds",
    "drop": false,
    "x": 620,
    "y": 260,
    "wires": [
      [
        "4b43bcbe.e8e214"
      ]
    ]
  },
  {
    "id": "6bca89c5.5e7c58",
    "type": "delay",
    "z": "c7191d19.c1e7b",
    "name": "",
    "pauseType": "rate",
    "timeout": "20",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 430,
    "y": 420,
    "wires": [
      [
        "13d2ee7a.5ebda2"
      ]
    ]
  },
  {
    "id": "eec5933a.c030f",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 420,
    "wires": [
      [
        "6bca89c5.5e7c58"
      ]
    ]
  },
  {
    "id": "13d2ee7a.5ebda2",
    "type": "debug",
    "z": "c7191d19.c1e7b",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 630,
    "y": 420,
    "wires": []
  },
  {
    "id": "cd549302.f2eef",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 580,
    "wires": [
      [
        "12006f03.25df01"
      ]
    ]
  },
  {
    "id": "12006f03.25df01",
    "type": "change",
    "z": "c7191d19.c1e7b",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "1",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 420,
    "y": 580,
    "wires": [
      [
        "81c29c10.c4769"
      ]
    ]
  },
  {
    "id": "8d7e64a8.7349e8",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 640,
    "wires": [
      [
        "81c29c10.c4769"
      ]
    ]
  },
  {
    "id": "81c29c10.c4769",
    "type": "delay",
    "z": "c7191d19.c1e7b",
    "name": "",
    "pauseType": "delay",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 680,
    "y": 640,
    "wires": [
      [
        "a91e297c.0447e8"
      ]
    ]
  },
  {
    "id": "a91e297c.0447e8",
    "type": "debug",
    "z": "c7191d19.c1e7b",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 970,
    "y": 620,
    "wires": []
  },
  {
    "id": "f81c6cf8.0f401",
    "type": "link in",
    "z": "dceb45d8.425368",
    "name": "Matt Left",
    "links": [
      "6590eef7.36df6"
    ],
    "x": 835,
    "y": 280,
    "wires": [
      [
        "c10515b6.577c78"
      ]
    ]
  },
  {
    "id": "6590eef7.36df6",
    "type": "link out",
    "z": "a3158433.9d1f78",
    "name": "Matt Left",
    "links": [
      "2bed651f.90ee2a",
      "f81c6cf8.0f401"
    ],
    "x": 995,
    "y": 91,
    "wires": []
  },
  {
    "id": "d1dbd941.ea1448",
    "type": "switch",
    "z": "cd950567.f864b8",
    "name": "Good Payload",
    "property": "goodpayload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1380,
    "y": 220,
    "wires": [
      [],
      [
        "dd361153.4c6fe"
      ]
    ]
  },
  {
    "id": "29f17be6.082704",
    "type": "counter",
    "z": "c7191d19.c1e7b",
    "name": "",
    "init": "0",
    "step": "1",
    "lower": "",
    "upper": "",
    "mode": "increment",
    "outputs": "1",
    "x": 580,
    "y": 760,
    "wires": [
      [
        "b6ab72ec.1809c"
      ]
    ]
  },
  {
    "id": "e3c27111.ded22",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "5",
    "payloadType": "num",
    "x": 210,
    "y": 760,
    "wires": [
      [
        "29f17be6.082704"
      ]
    ]
  },
  {
    "id": "1cbfba1.8d14546",
    "type": "debug",
    "z": "c7191d19.c1e7b",
    "name": "done",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1130,
    "y": 840,
    "wires": []
  },
  {
    "id": "b147d528.768918",
    "type": "switch",
    "z": "c7191d19.c1e7b",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "count",
        "vt": "msg"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 970,
    "y": 900,
    "wires": [
      [
        "1cbfba1.8d14546"
      ],
      [
        "29f17be6.082704",
        "3fb1cdcb.a65f32"
      ]
    ]
  },
  {
    "id": "e6966de2.d7197",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "0",
    "payloadType": "num",
    "x": 150,
    "y": 880,
    "wires": [
      [
        "7bca777a.757688"
      ]
    ]
  },
  {
    "id": "7bca777a.757688",
    "type": "change",
    "z": "c7191d19.c1e7b",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "1",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 380,
    "y": 880,
    "wires": [
      [
        "29f17be6.082704"
      ]
    ]
  },
  {
    "id": "3fb1cdcb.a65f32",
    "type": "debug",
    "z": "c7191d19.c1e7b",
    "name": "mess",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1130,
    "y": 900,
    "wires": []
  },
  {
    "id": "b6ab72ec.1809c",
    "type": "switch",
    "z": "c7191d19.c1e7b",
    "name": "",
    "property": "reset",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 750,
    "y": 760,
    "wires": [
      [
        "b147d528.768918"
      ]
    ]
  },
  {
    "id": "b823a8df.a826f8",
    "type": "counter",
    "z": "9a341993.fbc528",
    "name": "",
    "init": "0",
    "step": "1",
    "lower": "",
    "upper": "",
    "mode": "increment",
    "outputs": "1",
    "x": 760,
    "y": 160,
    "wires": [
      [
        "6c60f311.d0dcac"
      ]
    ]
  },
  {
    "id": "2fa1cf32.1c306",
    "type": "switch",
    "z": "9a341993.fbc528",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "count",
        "vt": "msg"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1150,
    "y": 300,
    "wires": [
      [
        "cb5fd0b9.f0996",
        "c7c38c9e.f6358"
      ],
      [
        "3e976e3b.b4d8a2",
        "5c47dd7f.176194"
      ]
    ]
  },
  {
    "id": "cb5fd0b9.f0996",
    "type": "change",
    "z": "9a341993.fbc528",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "1",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1160,
    "y": 100,
    "wires": [
      [
        "b823a8df.a826f8"
      ]
    ]
  },
  {
    "id": "6c60f311.d0dcac",
    "type": "switch",
    "z": "9a341993.fbc528",
    "name": "",
    "property": "reset",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 930,
    "y": 160,
    "wires": [
      [
        "2fa1cf32.1c306"
      ]
    ]
  },
  {
    "id": "841dbbf7.f8bb78",
    "type": "function",
    "z": "9a341993.fbc528",
    "name": "Adjust Conter",
    "func": "var val = msg.payload;\nif (val > 20) {\n   val = val -20;\n   msg.dir = \"up\";\n} else if (val < 20) {\n   val = 20 - val;\n   msg.dir = \"down\";\n} else {\n    val = 0;\n}\nmsg.payload = val;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 540,
    "y": 160,
    "wires": [
      [
        "b823a8df.a826f8"
      ]
    ]
  },
  {
    "id": "d518a0a9.2f721",
    "type": "server-state-changed",
    "z": "9a341993.fbc528",
    "name": "Tv Volume Change",
    "server": "5ee4d578.f7736c",
    "entityidfilter": "input_number.tv_volume_change",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 130,
    "y": 160,
    "wires": [
      [
        "706c4797.6edd68"
      ]
    ]
  },
  {
    "id": "87a80779.608118",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Volume Up",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_on",
    "data": "{   \"entity_id\": \"switch.tv_volume\" }",
    "mergecontext": "",
    "x": 1590,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "a446c097.612b1",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Volume Down",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{   \"entity_id\": \"switch.tv_volume\" }",
    "mergecontext": "",
    "x": 1600,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "3e976e3b.b4d8a2",
    "type": "switch",
    "z": "9a341993.fbc528",
    "name": "",
    "property": "dir",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "up",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "down",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1400,
    "y": 320,
    "wires": [
      [
        "87a80779.608118"
      ],
      [
        "a446c097.612b1"
      ]
    ]
  },
  {
    "id": "5c47dd7f.176194",
    "type": "delay",
    "z": "9a341993.fbc528",
    "name": "",
    "pauseType": "delay",
    "timeout": "100",
    "timeoutUnits": "milliseconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 810,
    "y": 260,
    "wires": [
      [
        "b823a8df.a826f8"
      ]
    ]
  },
  {
    "id": "c7c38c9e.f6358",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "input_number",
    "service": "set_value",
    "data": "{\"entity_id\":\"input_number.tv_volume_change\",\"value\":\"20\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "x": 1470,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "706c4797.6edd68",
    "type": "switch",
    "z": "9a341993.fbc528",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "neq",
        "v": "20",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 310,
    "y": 160,
    "wires": [
      [
        "841dbbf7.f8bb78"
      ]
    ]
  },
  {
    "id": "93417511.0ebcd8",
    "type": "function",
    "z": "7355692b.0038c8",
    "name": "",
    "func": "var seconds = msg.payload;\n//var numyears = Math.floor(seconds / 31536000);\nvar numdays = Math.floor((seconds % 31536000) / 86400); \nvar numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);\nvar numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);\nvar numseconds = (((seconds % 31536000) % 86400) % 3600) % 60;\n//msg.payload = numyears + \" years \" + \nmsg.payload = \"\";\nif (numdays > 0) {\n    msg.payload = numdays + \" days \" \n}\nif (numhours > 0) {\n    msg.payload = msg.payload + numhours + \" hours \" \n}\nmsg.payload = msg.payload + numminutes + \" minutes \" + Math.round(numseconds) + \" seconds\";\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 230,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "711ceb5.807fe14",
    "type": "subflow:7355692b.0038c8",
    "z": "c7191d19.c1e7b",
    "name": "",
    "env": [],
    "x": 480,
    "y": 180,
    "wires": [
      [
        "b3bacadd.eafab8"
      ]
    ]
  },
  {
    "id": "f0761190.01ad8",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "128",
    "payloadType": "num",
    "x": 190,
    "y": 180,
    "wires": [
      [
        "711ceb5.807fe14"
      ]
    ]
  },
  {
    "id": "b3bacadd.eafab8",
    "type": "debug",
    "z": "c7191d19.c1e7b",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 750,
    "y": 180,
    "wires": []
  },
  {
    "id": "5cc13c0f.32a2b4",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "86528",
    "payloadType": "num",
    "x": 190,
    "y": 140,
    "wires": [
      [
        "711ceb5.807fe14"
      ]
    ]
  },
  {
    "id": "5cb14a6d.6175a4",
    "type": "inject",
    "z": "c7191d19.c1e7b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "3728",
    "payloadType": "num",
    "x": 190,
    "y": 80,
    "wires": [
      [
        "711ceb5.807fe14"
      ]
    ]
  },
  {
    "id": "261e0b4c.0e67c4",
    "type": "function",
    "z": "a3158433.9d1f78",
    "name": "Matt Home",
    "func": "context.global.mattHomeStartTime = new Date().getTime();\n\nvar currentTime = new Date().getTime();\nvar timeElpased = (currentTime -context.global.mattLeaveStartTime)\nmsg.payload = timeElpased / 1000;\nmsg.homeAway = \"Home\";\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1050,
    "y": 51,
    "wires": [
      [
        "83d576bb.50f978"
      ]
    ]
  },
  {
    "id": "46f08a7c.f9b394",
    "type": "function",
    "z": "a3158433.9d1f78",
    "name": "Matt Leave",
    "func": "context.global.mattLeaveStartTime = new Date().getTime();\n\nvar currentTime = new Date().getTime();\nvar timeElpased = (currentTime -context.global.mattHomeStartTime)\nmsg.payload = timeElpased / 1000\nmsg.homeAway = \"Away\";\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1050,
    "y": 180,
    "wires": [
      [
        "208ca481.a39efc"
      ]
    ]
  },
  {
    "id": "208ca481.a39efc",
    "type": "subflow:7355692b.0038c8",
    "z": "a3158433.9d1f78",
    "name": "",
    "env": [],
    "x": 1250,
    "y": 180,
    "wires": [
      [
        "689b6f85.e3471"
      ]
    ]
  },
  {
    "id": "83d576bb.50f978",
    "type": "subflow:7355692b.0038c8",
    "z": "a3158433.9d1f78",
    "name": "",
    "env": [],
    "x": 1260,
    "y": 51,
    "wires": [
      [
        "689b6f85.e3471"
      ]
    ]
  },
  {
    "id": "689b6f85.e3471",
    "type": "function",
    "z": "a3158433.9d1f78",
    "name": "Data",
    "func": "var r = \"Matt is now \" + msg.homeAway + \". \" + msg.payload;\n\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": r\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1510,
    "y": 100,
    "wires": [
      [
        "3d6830a6.4a911",
        "130cffbd.29d66"
      ]
    ]
  },
  {
    "id": "a5ee1acb.0128a8",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1980,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "3d6830a6.4a911",
    "type": "debug",
    "z": "a3158433.9d1f78",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1650,
    "y": 60,
    "wires": []
  },
  {
    "id": "ff7bed56.cde45",
    "type": "inject",
    "z": "a3158433.9d1f78",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 820,
    "y": 40,
    "wires": [
      [
        "261e0b4c.0e67c4"
      ]
    ]
  },
  {
    "id": "130cffbd.29d66",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "",
    "rules": [
      {
        "t": "delete",
        "p": "homeAway",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1720,
    "y": 100,
    "wires": [
      [
        "a5ee1acb.0128a8"
      ]
    ]
  },
  {
    "id": "de600384.13d1",
    "type": "inject",
    "z": "a3158433.9d1f78",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 800,
    "y": 180,
    "wires": [
      [
        "46f08a7c.f9b394"
      ]
    ]
  },
  {
    "id": "7532ac43.f4bc54",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "media_player",
    "service": "volume_set",
    "data": "{\"entity_id\":\"media_player.office\",\"volume_level\":\"0.1\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 510,
    "y": 2480,
    "wires": [
      []
    ]
  },
  {
    "id": "85bbe655.9ced88",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 150,
    "y": 2480,
    "wires": [
      [
        "7532ac43.f4bc54"
      ]
    ]
  },
  {
    "id": "a16d7201.bd4a3",
    "type": "mqtt in",
    "z": "84ed1066.f22de",
    "name": "",
    "topic": "shellies/shellyht-E00E22/sensor/temperature",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 230,
    "y": 180,
    "wires": [
      [
        "e5beba83.142648",
        "e22c7f3e.a84ad",
        "5973e3f4.6edb9c"
      ]
    ]
  },
  {
    "id": "e5beba83.142648",
    "type": "switch",
    "z": "84ed1066.f22de",
    "name": "Warmer Then 6C",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "6",
        "vt": "num"
      },
      {
        "t": "lt",
        "v": "6",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 570,
    "y": 200,
    "wires": [
      [
        "af9fa763.602c18"
      ],
      [
        "6dae2581.18d8fc"
      ]
    ]
  },
  {
    "id": "818a6a7a.bf8988",
    "type": "mqtt out",
    "z": "84ed1066.f22de",
    "name": "",
    "topic": "Fridge/Status",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1030,
    "y": 100,
    "wires": []
  },
  {
    "id": "af9fa763.602c18",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "To Hot",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "To Hot",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 180,
    "wires": [
      [
        "818a6a7a.bf8988",
        "dffc412b.555e2"
      ]
    ]
  },
  {
    "id": "6dae2581.18d8fc",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "Good",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Good",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 220,
    "wires": [
      [
        "818a6a7a.bf8988",
        "5c381bb1.1c40b4",
        "81a9b11b.31e23"
      ]
    ]
  },
  {
    "id": "5c381bb1.1c40b4",
    "type": "rbe",
    "z": "84ed1066.f22de",
    "name": "",
    "func": "rbei",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 1290,
    "y": 220,
    "wires": [
      [
        "ca1972ac.01e52"
      ]
    ]
  },
  {
    "id": "ca1972ac.01e52",
    "type": "switch",
    "z": "84ed1066.f22de",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "To Hot",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Good",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1450,
    "y": 180,
    "wires": [
      [
        "6d31ab7b.eb7514",
        "ca273093.5cb1",
        "99388b0c.5d9408"
      ],
      [
        "4fc7334b.b81cac",
        "c60c5993.eeb3d8",
        "4872f683.b6b3a8"
      ]
    ]
  },
  {
    "id": "5973e3f4.6edb9c",
    "type": "trigger",
    "z": "84ed1066.f22de",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "4",
    "extend": true,
    "units": "hr",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 545,
    "y": 360,
    "wires": [
      [
        "241a99d9.e13a76",
        "fd4bf7a6.bc1f68",
        "47c93fd7.a79cb"
      ]
    ]
  },
  {
    "id": "241a99d9.e13a76",
    "type": "mqtt out",
    "z": "84ed1066.f22de",
    "name": "availability/fridgeshelly",
    "topic": "availability/fridgeshelly",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 875,
    "y": 420,
    "wires": []
  },
  {
    "id": "e22c7f3e.a84ad",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 525,
    "y": 400,
    "wires": [
      [
        "241a99d9.e13a76"
      ]
    ]
  },
  {
    "id": "cc3b2a14.4f2478",
    "type": "api-call-service",
    "z": "84ed1066.f22de",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "version": "1",
    "debugenabled": false,
    "service_domain": "notify",
    "service": "mattiphone",
    "entityId": "",
    "data": "{\"message\":\"Fridge Shelly - Offline\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1155,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "fd4bf7a6.bc1f68",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Fridge has not posted an update in the last 4 hours",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Frigde Shell HT",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 845,
    "y": 340,
    "wires": [
      [
        "51f52cc1.b9deb4"
      ]
    ]
  },
  {
    "id": "51f52cc1.b9deb4",
    "type": "link out",
    "z": "84ed1066.f22de",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 1050,
    "y": 340,
    "wires": []
  },
  {
    "id": "47c93fd7.a79cb",
    "type": "subflow:85970b46.61e358",
    "z": "84ed1066.f22de",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 855,
    "y": 380,
    "wires": [
      [
        "cc3b2a14.4f2478"
      ],
      []
    ]
  },
  {
    "id": "4199bfba.1277",
    "type": "comment",
    "z": "84ed1066.f22de",
    "name": "Check Temp",
    "info": "",
    "x": 550,
    "y": 120,
    "wires": []
  },
  {
    "id": "fc766fed.708d3",
    "type": "comment",
    "z": "84ed1066.f22de",
    "name": "Check for check in",
    "info": "",
    "x": 570,
    "y": 300,
    "wires": []
  },
  {
    "id": "38dec50a.659a9a",
    "type": "mqtt in",
    "z": "84ed1066.f22de",
    "name": "",
    "topic": "shellies/shellyht-E00E22/sensor/battery",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 210,
    "y": 560,
    "wires": [
      [
        "21a98a7.149a476"
      ]
    ]
  },
  {
    "id": "21a98a7.149a476",
    "type": "switch",
    "z": "84ed1066.f22de",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "20",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 480,
    "y": 560,
    "wires": [
      [
        "44bd4ee1.98529"
      ]
    ]
  },
  {
    "id": "44bd4ee1.98529",
    "type": "api-call-service",
    "z": "84ed1066.f22de",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Frigde shelly has less then 20% battery!\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 780,
    "y": 560,
    "wires": [
      []
    ]
  },
  {
    "id": "1f592428.b2c4ac",
    "type": "mqtt in",
    "z": "84ed1066.f22de",
    "name": "",
    "topic": "shellies/shellyht-E00E0F/sensor/temperature",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 230,
    "y": 920,
    "wires": [
      [
        "de75af60.1d9fc",
        "f6e6db82.702fe8",
        "ef5c0f7b.2f341"
      ]
    ]
  },
  {
    "id": "de75af60.1d9fc",
    "type": "switch",
    "z": "84ed1066.f22de",
    "name": "Warmer Then -20C",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "-20",
        "vt": "num"
      },
      {
        "t": "lt",
        "v": "-20",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 570,
    "y": 940,
    "wires": [
      [
        "16a78b98.5ad494"
      ],
      [
        "fc7c3b76.11baa8"
      ]
    ]
  },
  {
    "id": "51dc882d.3e4d38",
    "type": "mqtt out",
    "z": "84ed1066.f22de",
    "name": "",
    "topic": "Freezer/Status",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1040,
    "y": 860,
    "wires": []
  },
  {
    "id": "16a78b98.5ad494",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "To Hot",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "To Hot",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "temp",
        "pt": "msg",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 920,
    "wires": [
      [
        "51dc882d.3e4d38",
        "4725cb5c.b4f804"
      ]
    ]
  },
  {
    "id": "fc7c3b76.11baa8",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "Good",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Good",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 960,
    "wires": [
      [
        "51dc882d.3e4d38",
        "4725cb5c.b4f804"
      ]
    ]
  },
  {
    "id": "4725cb5c.b4f804",
    "type": "rbe",
    "z": "84ed1066.f22de",
    "name": "",
    "func": "rbei",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 1010,
    "y": 940,
    "wires": [
      [
        "15f6a55e.481aeb"
      ]
    ]
  },
  {
    "id": "15f6a55e.481aeb",
    "type": "switch",
    "z": "84ed1066.f22de",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "To Hot",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Good",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1170,
    "y": 940,
    "wires": [
      [
        "46a1164f.bc0e28",
        "3d5bb7f0.7d5888"
      ],
      [
        "f0b50cbf.af0ad"
      ]
    ]
  },
  {
    "id": "ef5c0f7b.2f341",
    "type": "trigger",
    "z": "84ed1066.f22de",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "4",
    "extend": true,
    "units": "hr",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 545,
    "y": 1100,
    "wires": [
      [
        "d8894444.6e9cc8",
        "8a1eb863.bf6f18",
        "3eb28781.04e518"
      ]
    ]
  },
  {
    "id": "d8894444.6e9cc8",
    "type": "mqtt out",
    "z": "84ed1066.f22de",
    "name": "availability/freezershelly",
    "topic": "availability/freezershelly",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 885,
    "y": 1160,
    "wires": []
  },
  {
    "id": "f6e6db82.702fe8",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 525,
    "y": 1140,
    "wires": [
      [
        "d8894444.6e9cc8"
      ]
    ]
  },
  {
    "id": "4d5cf8c7.198318",
    "type": "api-call-service",
    "z": "84ed1066.f22de",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Fridge Shelly - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1155,
    "y": 1120,
    "wires": [
      []
    ]
  },
  {
    "id": "8a1eb863.bf6f18",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Freezer has not posted an update in the last 4 hours",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Freezer Shell HT",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 845,
    "y": 1080,
    "wires": [
      [
        "748d8b68.2ac2f4"
      ]
    ]
  },
  {
    "id": "748d8b68.2ac2f4",
    "type": "link out",
    "z": "84ed1066.f22de",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 1050,
    "y": 1080,
    "wires": []
  },
  {
    "id": "3eb28781.04e518",
    "type": "subflow:85970b46.61e358",
    "z": "84ed1066.f22de",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 855,
    "y": 1120,
    "wires": [
      [
        "4d5cf8c7.198318"
      ],
      []
    ]
  },
  {
    "id": "fdc1e76f.ffdb48",
    "type": "comment",
    "z": "84ed1066.f22de",
    "name": "Check Temp",
    "info": "",
    "x": 550,
    "y": 860,
    "wires": []
  },
  {
    "id": "8cf7e29f.7cd",
    "type": "comment",
    "z": "84ed1066.f22de",
    "name": "Check for check in",
    "info": "",
    "x": 570,
    "y": 1040,
    "wires": []
  },
  {
    "id": "5162fe41.58231",
    "type": "mqtt in",
    "z": "84ed1066.f22de",
    "name": "",
    "topic": "shellies/shellyht-E00E0F/sensor/battery",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 210,
    "y": 1300,
    "wires": [
      [
        "6e1c0d67.a4e2b4"
      ]
    ]
  },
  {
    "id": "6e1c0d67.a4e2b4",
    "type": "switch",
    "z": "84ed1066.f22de",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "20",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 530,
    "y": 1300,
    "wires": [
      [
        "f6fb7193.143eb"
      ]
    ]
  },
  {
    "id": "f6fb7193.143eb",
    "type": "api-call-service",
    "z": "84ed1066.f22de",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Frigde shelly has less then 20% battery!\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 780,
    "y": 1300,
    "wires": [
      []
    ]
  },
  {
    "id": "dffc412b.555e2",
    "type": "trigger",
    "z": "84ed1066.f22de",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "40",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1130,
    "y": 160,
    "wires": [
      [
        "5c381bb1.1c40b4"
      ]
    ]
  },
  {
    "id": "81a9b11b.31e23",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 920,
    "y": 260,
    "wires": [
      [
        "dffc412b.555e2"
      ]
    ]
  },
  {
    "id": "2e01df80.788d4",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 150,
    "y": 2680,
    "wires": [
      [
        "482adf50.d5a9b"
      ]
    ]
  },
  {
    "id": "482adf50.d5a9b",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"media_player.office\",\"media_content_id\":\"spotify:playlist:Matt Awesomeness\",\"media_content_type\":\"SPOTIFY\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 480,
    "y": 2680,
    "wires": [
      []
    ]
  },
  {
    "id": "4e651081.a3f9d",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "alexa_tts",
    "data": "{\"entity_id\":\"media_player.office\",\"message\":\"test\",\"type\":\"announce\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 620,
    "y": 3380,
    "wires": [
      []
    ]
  },
  {
    "id": "c0d4f9e5.21d478",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 260,
    "y": 3380,
    "wires": [
      [
        "4e651081.a3f9d"
      ]
    ]
  },
  {
    "id": "d72255a3.a81358",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "alexa_media_office",
    "data": "{    \"message\": \"test\"    ,\"data\":{\"type\":\"announce\", \"method\":\"speak\"}}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 630,
    "y": 3500,
    "wires": [
      []
    ]
  },
  {
    "id": "15af48c.64eaeb7",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 260,
    "y": 3500,
    "wires": [
      [
        "d72255a3.a81358"
      ]
    ]
  },
  {
    "id": "227c52a.611f8ae",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "working announce",
    "info": "",
    "x": 270,
    "y": 3460,
    "wires": []
  },
  {
    "id": "ad0df8c3.8338f8",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "alexa_media_office",
    "data": "{    \"message\": \"<amazon:effect name='whispered'>hello</amazon:effect>\",    \"data\": {        \"type\": \"announce\",        \"method\": \"speak\"    }}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 630,
    "y": 3620,
    "wires": [
      []
    ]
  },
  {
    "id": "52d3d825.33e748",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 260,
    "y": 3620,
    "wires": [
      [
        "ad0df8c3.8338f8"
      ]
    ]
  },
  {
    "id": "e5ddff.761fe2",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "working announce wisper",
    "info": "",
    "x": 290,
    "y": 3580,
    "wires": []
  },
  {
    "id": "514977ec.00c9e8",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "alexa_media_danielle_s_echo_dot",
    "data": "{    \"message\": \"<amazon:effect name='whispered'>love you!!</amazon:effect>\",    \"data\": {        \"type\": \"tts\",        \"method\": \"speak\"    }}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 670,
    "y": 3760,
    "wires": [
      []
    ]
  },
  {
    "id": "5ef43786.725918",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 260,
    "y": 3760,
    "wires": [
      [
        "514977ec.00c9e8"
      ]
    ]
  },
  {
    "id": "db5147a9.fcaec8",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "working announce",
    "info": "",
    "x": 270,
    "y": 3720,
    "wires": []
  },
  {
    "id": "786ad735.4c75c8",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "alexa_media_office",
    "data": "{    \"message\": \"<amazon:effect name='whispered'>love you</amazon:effect>\",    \"data\": {        \"type\": \"announce\",        \"method\": \"speak\"    }}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 650,
    "y": 3900,
    "wires": [
      []
    ]
  },
  {
    "id": "5bb45e59.7d733",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 260,
    "y": 3900,
    "wires": [
      [
        "786ad735.4c75c8"
      ]
    ]
  },
  {
    "id": "92fc2547.287d18",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "alexa_media_danielle_s_echo_dot",
    "data": "{    \"message\": \"<amazon:effect name='whispered'>love you</amazon:effect>\",    \"data\": {        \"type\": \"announce\",        \"method\": \"speak\"    }}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 670,
    "y": 3840,
    "wires": [
      []
    ]
  },
  {
    "id": "6018e4ec.eb39bc",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 240,
    "y": 3840,
    "wires": [
      [
        "92fc2547.287d18"
      ]
    ]
  },
  {
    "id": "cb412e26.b7636",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "media_player",
    "service": "play_media",
    "data": "{\"entity_id\":\"media_player.office\",\"media_content_id\":\"test hass\",\"media_content_type\":\"routine\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 550,
    "y": 4180,
    "wires": [
      []
    ]
  },
  {
    "id": "1142b998.0c38a6",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 220,
    "y": 4180,
    "wires": [
      [
        "cb412e26.b7636"
      ]
    ]
  },
  {
    "id": "43eefc64.84b834",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "routine",
    "info": "routine",
    "x": 210,
    "y": 4100,
    "wires": []
  },
  {
    "id": "fc85022.e94dc",
    "type": "alexa-home",
    "z": "48ba348c.61270c",
    "conf": "3fa4c0fe.0f3ed",
    "device": "55337",
    "acknoledge": true,
    "name": "Test Alexa",
    "topic": "",
    "x": 140,
    "y": 2160,
    "wires": [
      [
        "133788d9.3c7a57",
        "7de9701c.ad9a5",
        "a2e16c2c.312fc"
      ]
    ]
  },
  {
    "id": "badd92c3.692f9",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Call Routine",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "media_player",
    "service": "play_media",
    "entityId": "media_player.office",
    "data": "{\"media_content_id\":\"test hass\",\"media_content_type\":\"routine\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 410,
    "y": 2100,
    "wires": [
      []
    ]
  },
  {
    "id": "41fcb984.0bf2d8",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Alexa Inbound",
    "info": "",
    "x": 150,
    "y": 2040,
    "wires": []
  },
  {
    "id": "b7739156.649f8",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "Every 30 Minutes",
    "repeat": "1800",
    "crontab": "",
    "once": true,
    "onceDelay": "60",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 170,
    "y": 2100,
    "wires": [
      [
        "badd92c3.692f9"
      ]
    ]
  },
  {
    "id": "133788d9.3c7a57",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "45",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 2160,
    "wires": [
      [
        "60cb00c7.59c35",
        "e59d24a3.cbfcd8",
        "e271efdf.ff522"
      ]
    ]
  },
  {
    "id": "60cb00c7.59c35",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/alexaInbound",
    "topic": "availability/alexaInbound",
    "qos": "0",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 770,
    "y": 2220,
    "wires": []
  },
  {
    "id": "7de9701c.ad9a5",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 490,
    "y": 2220,
    "wires": [
      [
        "60cb00c7.59c35"
      ]
    ]
  },
  {
    "id": "c9acc3a9.53cf3",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "version": "1",
    "debugenabled": false,
    "service_domain": "notify",
    "service": "mattiphone",
    "entityId": "",
    "data": "{\"message\":\"Alexa Inbound - Offline\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1040,
    "y": 2180,
    "wires": [
      []
    ]
  },
  {
    "id": "e59d24a3.cbfcd8",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Alexa Inbound Command Failure ",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Alex inbound polling failed",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 2140,
    "wires": [
      [
        "e81c2f88.73a11"
      ]
    ]
  },
  {
    "id": "e81c2f88.73a11",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 935,
    "y": 2140,
    "wires": []
  },
  {
    "id": "e271efdf.ff522",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "value": "FAULT_DETECTION",
        "type": "str"
      }
    ],
    "x": 740,
    "y": 2180,
    "wires": [
      [
        "c9acc3a9.53cf3"
      ],
      []
    ]
  },
  {
    "id": "da9d8fb4.7e958",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "10 Second After Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 190,
    "y": 2220,
    "wires": [
      [
        "133788d9.3c7a57",
        "7de9701c.ad9a5"
      ]
    ]
  },
  {
    "id": "1d8854f0.d579fb",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "media_player",
    "service": "play_media",
    "data": "{\"entity_id\":\"media_player.office\",\"media_content_id\":\"spotify:song\",\"media_content_type\":\"SPOTIFY\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 530,
    "y": 4480,
    "wires": [
      []
    ]
  },
  {
    "id": "4617748e.27d67c",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 190,
    "y": 4480,
    "wires": [
      [
        "1d8854f0.d579fb"
      ]
    ]
  },
  {
    "id": "b4eafbdf.3701c8",
    "type": "comment",
    "z": "1f9e3480.5be75c",
    "name": "play my musise",
    "info": "routine",
    "x": 220,
    "y": 4420,
    "wires": []
  },
  {
    "id": "ab73663a.33f708",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "media_player",
    "service": "play_media",
    "data": "{\"entity_id\":\"media_player.office\",\"media_content_id\":\"spotify:tracks\",\"media_content_type\":\"SPOTIFY\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 530,
    "y": 4540,
    "wires": [
      []
    ]
  },
  {
    "id": "fa722fb9.2311d",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "str",
    "x": 190,
    "y": 4540,
    "wires": [
      [
        "ab73663a.33f708"
      ]
    ]
  },
  {
    "id": "8ffe3f9.cb0b8c",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Alexa Shower Time - Routine",
    "server": "eef5a84.da24f58",
    "version": 1,
    "service_domain": "media_player",
    "service": "play_media",
    "entityId": "media_player.office",
    "data": "{\"media_content_id\":\"shower time\",\"media_content_type\":\"routine\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 360,
    "y": 1360,
    "wires": [
      []
    ]
  },
  {
    "id": "6c3320de.22c4",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Shower Time",
    "info": "",
    "x": 150,
    "y": 1320,
    "wires": []
  },
  {
    "id": "8fa41eed.e0746",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Shower Time",
    "links": [
      "baddf022.477dc",
      "39937e5c.81db92",
      "1ab28cd7.d2d263"
    ],
    "x": 100,
    "y": 1380,
    "wires": [
      [
        "8ffe3f9.cb0b8c",
        "315abedb.293842",
        "1ba3252.4c458db"
      ]
    ]
  },
  {
    "id": "402e1b88.8e6d14",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Bath Room Door",
    "server": "5ee4d578.f7736c",
    "entityidfilter": "binary_sensor.bathroom_door",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 160,
    "y": 840,
    "wires": [
      [
        "f6e880d3.d5189"
      ]
    ]
  },
  {
    "id": "f6e880d3.d5189",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Bathroom Door Open",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Bathroom Door Open",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 480,
    "y": 840,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "d96fd86e.a642e8",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Kitchen Cam",
    "server": "5ee4d578.f7736c",
    "entityidfilter": "binary_sensor.kitchencam_motion_sensor",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 150,
    "y": 1000,
    "wires": [
      [
        "decef216.64021",
        "f8efe1fe.a4a0e"
      ]
    ]
  },
  {
    "id": "decef216.64021",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Kitchen Cam Motion Detected",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Kitchen Cam Motion Detected",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "trusted",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 510,
    "y": 1000,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "f8efe1fe.a4a0e",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Kitchen cam Motion Detected",
    "links": [
      "8f80ab0d.e271b8",
      "bc5dc5ef.bc51a8",
      "a76f3a0f.d1fb38",
      "b46a8ce3.5b6ed",
      "c215726b.e66d5",
      "dfd9170e.807548"
    ],
    "x": 395,
    "y": 1040,
    "wires": []
  },
  {
    "id": "7a16963d.9235c8",
    "type": "server-state-changed",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "5ee4d578.f7736c",
    "entityidfilter": "sensor.last_alexa",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "haltifstate": "",
    "outputs": 1,
    "x": 250,
    "y": 4800,
    "wires": [
      [
        "c8f6ce16.1e173"
      ]
    ]
  },
  {
    "id": "c8f6ce16.1e173",
    "type": "debug",
    "z": "1f9e3480.5be75c",
    "name": "Last Alexa State Changed",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 610,
    "y": 4800,
    "wires": []
  },
  {
    "id": "b3fa2d76.559f8",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 4700,
    "wires": [
      [
        "9b6fe914.4d32e8"
      ]
    ]
  },
  {
    "id": "9b6fe914.4d32e8",
    "type": "api-call-service",
    "z": "1f9e3480.5be75c",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "alexa_media",
    "service": "update_last_called",
    "data": "",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "x": 560,
    "y": 4700,
    "wires": [
      []
    ]
  },
  {
    "id": "7186346f.4ab48c",
    "type": "delay",
    "z": "99d64a3d.f4e418",
    "name": "wait 25 min",
    "pauseType": "delay",
    "timeout": "3",
    "timeoutUnits": "hours",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 870,
    "y": 120,
    "wires": [
      [
        "a961f727.8da2a8",
        "8f9c705.d69fb9"
      ]
    ]
  },
  {
    "id": "46a1164f.bc0e28",
    "type": "trigger",
    "z": "84ed1066.f22de",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "pay",
    "duration": "-15",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 1650,
    "y": 900,
    "wires": [
      [
        "ceebadf8.c197"
      ]
    ]
  },
  {
    "id": "3d5bb7f0.7d5888",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1420,
    "y": 940,
    "wires": [
      [
        "46a1164f.bc0e28"
      ]
    ]
  },
  {
    "id": "6d31ab7b.eb7514",
    "type": "trigger",
    "z": "84ed1066.f22de",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "pay",
    "duration": "-15",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1930,
    "y": 120,
    "wires": [
      [
        "88936f8a.201dd"
      ]
    ]
  },
  {
    "id": "4fc7334b.b81cac",
    "type": "change",
    "z": "84ed1066.f22de",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1680,
    "y": 180,
    "wires": [
      [
        "6d31ab7b.eb7514",
        "88936f8a.201dd"
      ]
    ]
  },
  {
    "id": "31cbc1c6.2545be",
    "type": "mqtt in",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "topic": "kitchen/dishwasherLDR",
    "qos": "2",
    "datatype": "utf8",
    "broker": "1b6bc4ba.56ff4b",
    "x": 160,
    "y": 240,
    "wires": [
      [
        "87aeda18.66c048"
      ]
    ]
  },
  {
    "id": "90c2b8ec.3950d8",
    "type": "function",
    "z": "6e74caff.7ad1f4",
    "name": "Data",
    "func": "msg.payloadvalue = msg.payload\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": \"Diswasher Status \" + msg.payload\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 770,
    "y": 240,
    "wires": [
      [
        "3af1fdf9.c39842"
      ]
    ]
  },
  {
    "id": "87aeda18.66c048",
    "type": "rbe",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "func": "rbei",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 350,
    "y": 240,
    "wires": [
      [
        "5b45d804.3fbd78",
        "b2322e82.3fe0f"
      ]
    ]
  },
  {
    "id": "3af1fdf9.c39842",
    "type": "debug",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 970,
    "y": 200,
    "wires": []
  },
  {
    "id": "dd3eec86.c33db",
    "type": "change",
    "z": "5625076e.ee59e8",
    "name": "Have a good lunch",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Have a good lunch. Timer set",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "LunchTime.BeenTrigged",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 390,
    "y": 340,
    "wires": [
      [
        "bc429cf8.fed8b"
      ]
    ]
  },
  {
    "id": "bc429cf8.fed8b",
    "type": "subflow:47bc2d66.1132e4",
    "z": "5625076e.ee59e8",
    "name": "",
    "env": [],
    "x": 650,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "c180db42.37b678",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Dishwasher done",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "the dish washer has finished",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 990,
    "y": 300,
    "wires": [
      [
        "7db16e01.687d6"
      ]
    ]
  },
  {
    "id": "7db16e01.687d6",
    "type": "subflow:47bc2d66.1132e4",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "env": [],
    "x": 1450,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "40895bf9.d34864",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Running",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 790,
    "y": 320,
    "wires": [
      [
        "c180db42.37b678"
      ],
      [
        "96c28029.cbc45"
      ]
    ]
  },
  {
    "id": "96c28029.cbc45",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Dishwasher Started",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "the dish washer has started",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "Kitchen",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 990,
    "y": 340,
    "wires": [
      [
        "7db16e01.687d6"
      ]
    ]
  },
  {
    "id": "3d3fb4fe.b5ba7c",
    "type": "change",
    "z": "47bc2d66.1132e4",
    "name": "Kitchen",
    "rules": [
      {
        "t": "set",
        "p": "pri_alexa",
        "pt": "msg",
        "to": "[\"media_player.kitten\"]",
        "tot": "json"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 440,
    "y": 260,
    "wires": [
      [
        "c5f11237.56983"
      ]
    ]
  },
  {
    "id": "84f95833.944a98",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Office Availability",
    "info": "",
    "x": 160,
    "y": 2360,
    "wires": []
  },
  {
    "id": "c3c81fe2.07c17",
    "type": "mqtt in",
    "z": "48ba348c.61270c",
    "name": "",
    "topic": "checkIn/kitchenMCU",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 170,
    "y": 2400,
    "wires": [
      [
        "4cd31c18.781db4",
        "4eccd077.9722e"
      ]
    ]
  },
  {
    "id": "4cd31c18.781db4",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "8",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 450,
    "y": 2380,
    "wires": [
      [
        "396d016d.b31cfe",
        "1eee9814.8d00c8",
        "edc2a997.3d0a08"
      ]
    ]
  },
  {
    "id": "396d016d.b31cfe",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "availability/kitchenMCU",
    "topic": "availability/kitchenMCU",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 790,
    "y": 2440,
    "wires": []
  },
  {
    "id": "4eccd077.9722e",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.office",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 2420,
    "wires": [
      [
        "396d016d.b31cfe"
      ]
    ]
  },
  {
    "id": "59f7b45d.52c54c",
    "type": "api-call-service",
    "z": "48ba348c.61270c",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "version": "1",
    "debugenabled": false,
    "service_domain": "notify",
    "service": "mattiphone",
    "entityId": "",
    "data": "{\"message\":\"Kitchen Node MCU - Offline\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 980,
    "y": 2400,
    "wires": [
      []
    ]
  },
  {
    "id": "1eee9814.8d00c8",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Kitchen Node MCU has not checked in",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Kitchen Node MCU",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart office node mcu.",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 750,
    "y": 2360,
    "wires": [
      [
        "38b94500.07dd2c"
      ]
    ]
  },
  {
    "id": "38b94500.07dd2c",
    "type": "link out",
    "z": "48ba348c.61270c",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 955,
    "y": 2360,
    "wires": []
  },
  {
    "id": "edc2a997.3d0a08",
    "type": "subflow:85970b46.61e358",
    "z": "48ba348c.61270c",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "value": "FAULT_DETECTION",
        "type": "str"
      }
    ],
    "x": 760,
    "y": 2400,
    "wires": [
      [
        "59f7b45d.52c54c"
      ],
      []
    ]
  },
  {
    "id": "28fa280.0f108d8",
    "type": "function",
    "z": "a83e69e1.4b2ab8",
    "name": "Data",
    "func": "var mess = env.get(\"message\")\nvar title = env.get(\"title\")\nvar notification_id = env.get(\"notification_id\")\nvar category = env.get(\"category\")\n\nvar who = env.get(\"who\")\nvar target;\nif (who == \"Matt\") {\n   target = \"mobile_app_matt\"\n} else if (who == \"Danni\") {\n   target = \"mobile_app_iphone\" \n} else if (who == \"\") {\n    target = \"\"\n} else {\n   target = \"all_ios_devices\"\n}\n\n\nif (mess == \"PAYLOAD\") {\n    msg.payload = \n    {\n      \"service\": target,\n      \"data\": msg.payload.data \n    }\n} else if (mess == \"PAYLOAD_MSG\") {\n    msg.payload = \n    {\n      \"service\": target,\n      \"data\": \n      {\n        \"message\": msg.payload\n      }\n    }\n} else {\n    if( category !== \"\" ) {\n        msg.payload = \n        {\n          \"service\": target,\n          \"data\": \n          {\n            \"message\": mess,\n            \"data\": {\"push\": {\"category\": category }}\n          }\n        }\n    } else {\n        msg.payload = \n        {\n          \"service\": target,\n          \"data\": \n          {\n            \"message\": mess\n          }\n        }\n    }\n    \n}\n\nvar createNot = null\nvar clearNot = null\nif( notification_id !== \"\" ) {\n    if (title == \"CLEARED\") {\n        clearNot = {\n         \"payload\": {\n             \"data\": {\n                    \"notification_id\":notification_id\n                }\n            }\n        }\n    } else {\n        createNot = {\n         \"payload\": {\n             \"data\": {\n                    \"message\": mess,\n                    \"title\": title,\n                    \"notification_id\":notification_id\n                }\n            }\n        }\n    }\n    \n}\n\n\nif (target == \"\") {\n    msg = null\n}\n\n\nreturn [msg,createNot,clearNot];",
    "outputs": 3,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "x": 450,
    "y": 180,
    "wires": [
      [
        "839c216a.4a97d",
        "865e9283.e79ab"
      ],
      [
        "107302af.bf410d"
      ],
      [
        "21ae6270.68b64e"
      ]
    ]
  },
  {
    "id": "c33a81d7.395f2",
    "type": "catch",
    "z": "5625076e.ee59e8",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "a58559a5.eca708"
      ]
    ]
  },
  {
    "id": "a58559a5.eca708",
    "type": "subflow:f5eab19a.7cf17",
    "z": "5625076e.ee59e8",
    "name": "",
    "env": [],
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "b3b81baa.5c2938",
    "type": "comment",
    "z": "5625076e.ee59e8",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "89db94b2.2cd5c8",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "10 Second After Start up",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": "0",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 490,
    "y": 1020,
    "wires": [
      [
        "644d8797.711c28"
      ]
    ]
  },
  {
    "id": "644d8797.711c28",
    "type": "mqtt out",
    "z": "48ba348c.61270c",
    "name": "btmonitor/scan/restart",
    "topic": "btmonitor/scan/restart",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1060,
    "y": 1020,
    "wires": []
  },
  {
    "id": "2266c996.db78e6",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 1020,
    "y": 240,
    "wires": []
  },
  {
    "id": "8620b0eb.c8e42",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "cd950567.f864b8",
    "name": "",
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": "PAYLOAD"
      },
      {
        "name": "who",
        "type": "str",
        "value": "Matt"
      }
    ],
    "x": 1820,
    "y": 220,
    "wires": []
  },
  {
    "id": "93fd391a.057098",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "b8a16318.b66a5",
    "name": "Let Matt Know",
    "env": [
      {
        "name": "message",
        "value": "Node red started",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      }
    ],
    "x": 660,
    "y": 840,
    "wires": []
  },
  {
    "id": "ae019a30.ff6f78",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "d1172b8b.3d3298",
    "name": "Let Both Know",
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": "Door ball been pressed"
      },
      {
        "name": "who",
        "type": "str",
        "value": "Both"
      }
    ],
    "x": 980,
    "y": 180,
    "wires": []
  },
  {
    "id": "740c59e5.4fccd8",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a3158433.9d1f78",
    "name": "Let Both Know",
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": "Arming Alarm"
      },
      {
        "name": "who",
        "type": "str",
        "value": "Both"
      }
    ],
    "x": 800,
    "y": 1180,
    "wires": []
  },
  {
    "id": "23bafa9c.c59eb6",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a3158433.9d1f78",
    "name": "Let Both Know",
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": "Some one home"
      },
      {
        "name": "who",
        "type": "str",
        "value": "Both"
      }
    ],
    "x": 240,
    "y": 960,
    "wires": []
  },
  {
    "id": "ae6cd96b.088a18",
    "type": "delay",
    "z": "a068bd5.28a8d4",
    "name": "",
    "pauseType": "timed",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "5",
    "nbRateUnits": "60",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 480,
    "y": 1413,
    "wires": [
      [
        "9c585f5f.3d0d4"
      ]
    ]
  },
  {
    "id": "d6906ef5.59f6d",
    "type": "mqtt out",
    "z": "cd950567.f864b8",
    "name": "Restart Tracker",
    "topic": "btmonitor/scan/restart",
    "qos": "0",
    "retain": "false",
    "broker": "1b6bc4ba.56ff4b",
    "x": 400,
    "y": 940,
    "wires": []
  },
  {
    "id": "bdd13f50.74924",
    "type": "inject",
    "z": "cd950567.f864b8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 160,
    "y": 940,
    "wires": [
      [
        "d6906ef5.59f6d"
      ]
    ]
  },
  {
    "id": "8b4076b0.a87368",
    "type": "inject",
    "z": "b8a16318.b66a5",
    "name": "",
    "repeat": "14400",
    "crontab": "",
    "once": true,
    "onceDelay": "800",
    "topic": "",
    "payload": "RestartRequest",
    "payloadType": "str",
    "x": 130,
    "y": 940,
    "wires": [
      [
        "a990f614.02de78",
        "6efcf683.ea5c88"
      ]
    ]
  },
  {
    "id": "879b2b35.d68d68",
    "type": "comment",
    "z": "b8a16318.b66a5",
    "name": "Restart Bluetooth",
    "info": "",
    "x": 120,
    "y": 880,
    "wires": []
  },
  {
    "id": "93002185.91156",
    "type": "api-call-service",
    "z": "b8a16318.b66a5",
    "name": "Snapshot_Partial",
    "server": "5ee4d578.f7736c",
    "service_domain": "hassio",
    "service": "snapshot_partial",
    "data": "{\"addons\":[\"a0d7b954_appdaemon3\",\"a0d7b954_influxdb\",\"a0d7b954_sonweb\",\"core_mosquitto\",\"15ef4d2f_esphome\",\"a0d7b954_motioneye\",\"a0d7b954_vscode\",\"a0d7b954_unifi\",\"a0d7b954_nodered\",\"a0d7b954_logviewer\",\"a0d7b954_portainer\",\"core_samba\",\"a0d7b954_appdaemon3\",\"a0d7b954_grafana\",\"core_ssh\",\"core_duckdns\",\"03d23610_dasshio\",\"core_mosquitto\",\"a0d7b954_sonweb\",\"core_samba\",\"a0d7b954_nodered\",\"a0d7b954_logviewer\",\"a0d7b954_motioneye\",\"03d23610_dasshio\",\"core_ssh\",\"a0d7b954_portainer\",\"a0d7b954_grafana\",\"core_duckdns\",\"a0d7b954_plex\"],\"folders\":[\"homeassistant\",\"ssl\",\"addons_local.tar\"]}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1370,
    "y": 380,
    "wires": [
      [
        "ef6362ca.c8d73"
      ]
    ]
  },
  {
    "id": "ef930840.9f5ef8",
    "type": "inject",
    "z": "b8a16318.b66a5",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1080,
    "y": 380,
    "wires": [
      [
        "93002185.91156"
      ]
    ]
  },
  {
    "id": "ef6362ca.c8d73",
    "type": "debug",
    "z": "b8a16318.b66a5",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1650,
    "y": 380,
    "wires": []
  },
  {
    "id": "f1015be1.129118",
    "type": "mqtt out",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "topic": "kitchen/dishwasher",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1230,
    "y": 460,
    "wires": []
  },
  {
    "id": "5b45d804.3fbd78",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "Running",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "paused",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off ",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 650,
    "y": 500,
    "wires": [
      [
        "f1015be1.129118"
      ],
      [
        "f1015be1.129118"
      ],
      [
        "f04c12f1.7bfe9",
        "f7ab9190.bfd47"
      ]
    ]
  },
  {
    "id": "f04c12f1.7bfe9",
    "type": "ha-wait-until",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "entityId": "door",
    "property": "",
    "comparator": "is",
    "value": "",
    "valueType": "str",
    "timeout": 0,
    "timeoutUnits": "seconds",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 860,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "f7ab9190.bfd47",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Washed",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Washed",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1000,
    "y": 520,
    "wires": [
      [
        "f1015be1.129118"
      ]
    ]
  },
  {
    "id": "32e8e836.bbb578",
    "type": "catch",
    "z": "84ed1066.f22de",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 60,
    "wires": [
      [
        "77633fff.a34ae"
      ]
    ]
  },
  {
    "id": "77633fff.a34ae",
    "type": "subflow:f5eab19a.7cf17",
    "z": "84ed1066.f22de",
    "name": "",
    "x": 350,
    "y": 60,
    "wires": []
  },
  {
    "id": "792b4e79.c84b8",
    "type": "comment",
    "z": "84ed1066.f22de",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 20,
    "wires": []
  },
  {
    "id": "c89dd3e1.b78cb",
    "type": "catch",
    "z": "e361c01.ee9f54",
    "name": "",
    "scope": null,
    "x": 160,
    "y": 100,
    "wires": [
      [
        "8173a0ff.8a22"
      ]
    ]
  },
  {
    "id": "8173a0ff.8a22",
    "type": "subflow:f5eab19a.7cf17",
    "z": "e361c01.ee9f54",
    "name": "",
    "x": 390,
    "y": 100,
    "wires": []
  },
  {
    "id": "57b88e3d.55fb5",
    "type": "comment",
    "z": "e361c01.ee9f54",
    "name": "Error Handler",
    "info": "",
    "x": 170,
    "y": 60,
    "wires": []
  },
  {
    "id": "459d6827.eb2ff8",
    "type": "server-state-changed",
    "z": "e361c01.ee9f54",
    "name": "Power Change",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "sensor.plug_02_energy_power",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 180,
    "y": 180,
    "wires": [
      [
        "dd1b2ddf.ab4aa"
      ]
    ]
  },
  {
    "id": "ee2fe00c.dfd2d",
    "type": "switch",
    "z": "e361c01.ee9f54",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 770,
    "y": 180,
    "wires": [
      [
        "3d849770.8ae318"
      ],
      [
        "3db19334.8fee3c",
        "ba2df1bf.c4dd7"
      ]
    ]
  },
  {
    "id": "dd1b2ddf.ab4aa",
    "type": "rbe",
    "z": "e361c01.ee9f54",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 630,
    "y": 180,
    "wires": [
      [
        "ee2fe00c.dfd2d"
      ]
    ]
  },
  {
    "id": "3d849770.8ae318",
    "type": "trigger",
    "z": "e361c01.ee9f54",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "5",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1170,
    "y": 180,
    "wires": [
      [
        "ba2df1bf.c4dd7"
      ]
    ]
  },
  {
    "id": "3db19334.8fee3c",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 980,
    "y": 200,
    "wires": [
      [
        "3d849770.8ae318"
      ]
    ]
  },
  {
    "id": "8512839f.c786a",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Tempure Control - Get Target",
    "info": "",
    "x": 140,
    "y": 1420,
    "wires": []
  },
  {
    "id": "22891806.64f638",
    "type": "mqtt in",
    "z": "21d6efde.d0943",
    "name": "bedroom/ac/temperature/set",
    "topic": "bedroom/ac/temperature/set",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 140,
    "y": 1620,
    "wires": [
      [
        "9c51fdcd.c41e7"
      ]
    ]
  },
  {
    "id": "d70fa3b8.bbf3c",
    "type": "server-state-changed",
    "z": "21d6efde.d0943",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "climate.bedroom",
    "entityidfiltertype": "exact",
    "outputinitially": true,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 150,
    "y": 1820,
    "wires": [
      [
        "63f3fbc4.44b3a4",
        "1d40f751.e5c5e9"
      ]
    ]
  },
  {
    "id": "a232e09b.a287c",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Current Target",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "climate.bedroom",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 360,
    "y": 1480,
    "wires": [
      [
        "7ce04831.3ae818"
      ]
    ]
  },
  {
    "id": "e277f8fc.dd9e88",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "Start Up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 120,
    "y": 1480,
    "wires": [
      [
        "a232e09b.a287c"
      ]
    ]
  },
  {
    "id": "63f3fbc4.44b3a4",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Off?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "auto",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 410,
    "y": 1820,
    "wires": [
      [
        "7cb468dc.60a3a8"
      ],
      [
        "9d2fae06.e4429"
      ]
    ]
  },
  {
    "id": "7cb468dc.60a3a8",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Fan Off",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{\"entity_id\":\"switch.plug_04\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1040,
    "y": 1980,
    "wires": [
      []
    ]
  },
  {
    "id": "7738872a.c8fec8",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Fan On",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_on",
    "data": "{\"entity_id\":\"switch.plug_04\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1040,
    "y": 2020,
    "wires": [
      []
    ]
  },
  {
    "id": "b3d23dae.d82fc",
    "type": "server-state-changed",
    "z": "21d6efde.d0943",
    "name": "Temperature Change",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "sensor.bedroom_temperature",
    "entityidfiltertype": "exact",
    "outputinitially": true,
    "state_type": "num",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 120,
    "y": 2000,
    "wires": [
      [
        "bc8c848c.de4218"
      ]
    ]
  },
  {
    "id": "bc8c848c.de4218",
    "type": "rbe",
    "z": "21d6efde.d0943",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 390,
    "y": 2000,
    "wires": [
      [
        "b21ead51.2e274"
      ]
    ]
  },
  {
    "id": "9c51fdcd.c41e7",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "bedroom.targettemp",
        "pt": "global",
        "to": "$number(payload)",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 1620,
    "wires": [
      [
        "9d2fae06.e4429"
      ]
    ]
  },
  {
    "id": "1a74e282.88c43d",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "bedroom.targettemp",
        "vt": "global"
      },
      {
        "t": "gt",
        "v": "bedroom.targettemp",
        "vt": "global"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 870,
    "y": 2000,
    "wires": [
      [
        "7cb468dc.60a3a8"
      ],
      [
        "7738872a.c8fec8"
      ]
    ]
  },
  {
    "id": "7ce04831.3ae818",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "bedroom.targettemp",
        "pt": "global",
        "to": "$number(data.attributes.temperature)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "bedroom.ac.status",
        "pt": "global",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 580,
    "y": 1480,
    "wires": [
      []
    ]
  },
  {
    "id": "b0d7b9ab.a54a28",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "bedroom.targettemp",
        "tot": "global"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 320,
    "y": 1560,
    "wires": [
      []
    ]
  },
  {
    "id": "422333fe.48c93c",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "Start Up",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 120,
    "y": 1560,
    "wires": [
      [
        "b0d7b9ab.a54a28"
      ]
    ]
  },
  {
    "id": "9d2fae06.e4429",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Current Target",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "climate.bedroom",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 300,
    "y": 1900,
    "wires": [
      [
        "357964cc.1d2acc"
      ]
    ]
  },
  {
    "id": "cdffb08d.c0d2b",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "Testing",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": "20",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 90,
    "y": 1900,
    "wires": [
      [
        "9d2fae06.e4429"
      ]
    ]
  },
  {
    "id": "357964cc.1d2acc",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(data.attributes.current_temperature)",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 500,
    "y": 1900,
    "wires": [
      [
        "b21ead51.2e274"
      ]
    ]
  },
  {
    "id": "1d40f751.e5c5e9",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "bedroom.ac.status",
        "pt": "global",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 480,
    "y": 1780,
    "wires": [
      []
    ]
  },
  {
    "id": "a55ccceb.c6863",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Tempure Control - Fan Status",
    "info": "",
    "x": 140,
    "y": 1700,
    "wires": []
  },
  {
    "id": "b21ead51.2e274",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Ac On?",
    "property": "bedroom.ac.status",
    "propertyType": "global",
    "rules": [
      {
        "t": "eq",
        "v": "auto",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 720,
    "y": 2000,
    "wires": [
      [
        "1a74e282.88c43d"
      ]
    ]
  },
  {
    "id": "9aa1f984.f7e9b8",
    "type": "comment",
    "z": "a83e69e1.4b2ab8",
    "name": "message == \"PAYLOAD\" - msg.payload.data.message",
    "info": "",
    "x": 600,
    "y": 20,
    "wires": []
  },
  {
    "id": "13aee063.b908",
    "type": "catch",
    "z": "8a69107f.14257",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "749a5f9f.b6165"
      ]
    ]
  },
  {
    "id": "749a5f9f.b6165",
    "type": "subflow:f5eab19a.7cf17",
    "z": "8a69107f.14257",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "65041a04.fc28d4",
    "type": "comment",
    "z": "8a69107f.14257",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "a2b59366.b506c",
    "type": "inject",
    "z": "8a69107f.14257",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 120,
    "y": 220,
    "wires": [
      [
        "3188d052.ade6a"
      ]
    ]
  },
  {
    "id": "dffa7430.b742c8",
    "type": "server-state-changed",
    "z": "8a69107f.14257",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "input_boolean.danni_button",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 210,
    "y": 260,
    "wires": [
      [
        "3188d052.ade6a"
      ]
    ]
  },
  {
    "id": "3188d052.ade6a",
    "type": "delay",
    "z": "8a69107f.14257",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "5",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 520,
    "y": 260,
    "wires": [
      [
        "18ef958.0291f6b",
        "b72ca218.0888c",
        "9230b5c2.51a1b8"
      ]
    ]
  },
  {
    "id": "18ef958.0291f6b",
    "type": "api-call-service",
    "z": "8a69107f.14257",
    "name": "Toggle library_lights",
    "server": "5ee4d578.f7736c",
    "service_domain": "light",
    "service": "toggle",
    "data": "{\"entity_id\":\"light.library_lights\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 820,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "b72ca218.0888c",
    "type": "api-call-service",
    "z": "8a69107f.14257",
    "name": "Reset Button Status",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.danni_button",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 820,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "23f1ca9a.46ac56",
    "type": "inject",
    "z": "8a69107f.14257",
    "name": "Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 540,
    "y": 320,
    "wires": [
      [
        "b72ca218.0888c"
      ]
    ]
  },
  {
    "id": "f6c97631.876a78",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Turn BedRoom Themo Stat Off",
    "server": "5ee4d578.f7736c",
    "service_domain": "climate",
    "service": "turn_off",
    "data": "{\"entity_id\":\"climate.bedroom\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1130,
    "y": 1140,
    "wires": [
      []
    ]
  },
  {
    "id": "aeaa8ad9.155118",
    "type": "catch",
    "z": "80866e71.966c6",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 140,
    "y": 80,
    "wires": [
      [
        "e7f80448.57d3b8"
      ]
    ]
  },
  {
    "id": "e7f80448.57d3b8",
    "type": "subflow:f5eab19a.7cf17",
    "z": "80866e71.966c6",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "1ddf72a9.fdd1dd",
    "type": "comment",
    "z": "80866e71.966c6",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "3519bbc8.f58554",
    "type": "change",
    "z": "5625076e.ee59e8",
    "name": "The door bell has been pressed The door bell has been pressed",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "The door bell has been pressed The door bell has been pressed",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 510,
    "y": 480,
    "wires": [
      [
        "bed4d962.498428"
      ]
    ]
  },
  {
    "id": "bed4d962.498428",
    "type": "subflow:47bc2d66.1132e4",
    "z": "5625076e.ee59e8",
    "name": "",
    "x": 930,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "4905c786.48bbf8",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 340,
    "wires": [
      [
        "dd3eec86.c33db"
      ]
    ]
  },
  {
    "id": "192ac354.6dc3fd",
    "type": "comment",
    "z": "a0a4859f.5a2a48",
    "name": "Presence Detected",
    "info": "",
    "x": 170,
    "y": 180,
    "wires": []
  },
  {
    "id": "27296b10.af2594",
    "type": "switch",
    "z": "f5eab19a.7cf17",
    "name": "",
    "property": "error.message",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "Call-service API error. Error Message: 'rateLimits'",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 410,
    "y": 60,
    "wires": [
      [],
      [
        "8ee737f2.2dc868"
      ]
    ]
  },
  {
    "id": "40a46c6f.c7ba64",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Bed side plug",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_08",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 960,
    "y": 620,
    "wires": [
      []
    ]
  },
  {
    "id": "e00c5e15.87c8",
    "type": "function",
    "z": "21d6efde.d0943",
    "name": "Someone got into to bed and bed was empty",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 670,
    "y": 600,
    "wires": [
      [
        "d94b6303.4c9b4",
        "40a46c6f.c7ba64",
        "19968e17.daaa62"
      ]
    ]
  },
  {
    "id": "89782bb8.4daed8",
    "type": "function",
    "z": "21d6efde.d0943",
    "name": "Emtpy Bed",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 770,
    "y": 800,
    "wires": [
      [
        "4775ee16.55733",
        "b785bc45.9ba0a"
      ]
    ]
  },
  {
    "id": "4775ee16.55733",
    "type": "trigger",
    "z": "21d6efde.d0943",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "15",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 950,
    "y": 760,
    "wires": [
      [
        "e7c2066f.c4ddf8",
        "b191db40.a5b7f8"
      ]
    ]
  },
  {
    "id": "e7c2066f.c4ddf8",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Bed side plug",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_08",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1140,
    "y": 760,
    "wires": [
      []
    ]
  },
  {
    "id": "b191db40.a5b7f8",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Bedroom climate",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "debugenabled": false,
    "service_domain": "climate",
    "service": "turn_off",
    "entityId": "climate.bedroom",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1150,
    "y": 800,
    "wires": [
      []
    ]
  },
  {
    "id": "19968e17.daaa62",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 720,
    "wires": [
      [
        "4775ee16.55733",
        "b785bc45.9ba0a"
      ]
    ]
  },
  {
    "id": "72c8674b.8e3c38",
    "type": "api-call-service",
    "z": "a3158433.9d1f78",
    "name": "Bed side plug",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{\"entity_id\":\"switch.plug_08\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1080,
    "y": 1100,
    "wires": [
      []
    ]
  },
  {
    "id": "4a6ffa82.453554",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Kitchen Motion",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "entityidfilter": "binary_sensor.kitchen_motion",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 160,
    "y": 1080,
    "wires": [
      [
        "726c2fb2.8c822",
        "3495a219.f840be"
      ]
    ]
  },
  {
    "id": "726c2fb2.8c822",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Kitchen Motion",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Kitchen Motion",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "trusted",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 460,
    "y": 1080,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "3495a219.f840be",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Kitchen Motion Detected",
    "links": [
      "688dc601.8b0c68",
      "8f80ab0d.e271b8",
      "c215726b.e66d5",
      "dfd9170e.807548",
      "fd781bb5.bad858",
      "23f2e7cd.7ad698",
      "b6655c35.3097a"
    ],
    "x": 395,
    "y": 1120,
    "wires": []
  },
  {
    "id": "9230b5c2.51a1b8",
    "type": "api-call-service",
    "z": "8a69107f.14257",
    "name": "Toggle plug",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "toggle",
    "data": "{\"entity_id\":\"switch.plug_06\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 790,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "86cbf076.c386f",
    "type": "counter",
    "z": "d73100a9.0d64d",
    "name": "",
    "init": "0",
    "step": "1",
    "lower": "",
    "upper": "100",
    "mode": "increment",
    "outputs": 1,
    "x": 2860,
    "y": 80,
    "wires": [
      [
        "9d46d128.5c116",
        "22b85b0d.95e5b4"
      ]
    ]
  },
  {
    "id": "9d46d128.5c116",
    "type": "debug",
    "z": "d73100a9.0d64d",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 3170,
    "y": 40,
    "wires": []
  },
  {
    "id": "633fd784.87d398",
    "type": "inject",
    "z": "d73100a9.0d64d",
    "name": "Startup",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "Start",
    "payloadType": "str",
    "x": 140,
    "y": 220,
    "wires": [
      [
        "1f2cf988.2620b6",
        "10927101.c3aa0f",
        "ce507b.cc701f88"
      ]
    ]
  },
  {
    "id": "1f2cf988.2620b6",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Has triggered = no",
    "rules": [
      {
        "t": "set",
        "p": "hasGoodNightBeenTriggered",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 490,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "54338a4f.a1c854",
    "type": "delay",
    "z": "d73100a9.0d64d",
    "name": "",
    "pauseType": "delay",
    "timeout": "10",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 3220,
    "y": 200,
    "wires": [
      [
        "72c3ab65.ad95e4"
      ]
    ]
  },
  {
    "id": "22b85b0d.95e5b4",
    "type": "switch",
    "z": "d73100a9.0d64d",
    "name": "up to 5 time",
    "property": "count",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "5",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 3030,
    "y": 160,
    "wires": [
      [
        "832545e1.4bf1f8",
        "c56b6a5c.2f5578"
      ],
      [
        "54338a4f.a1c854"
      ]
    ]
  },
  {
    "id": "99afc7fd.02cdd8",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 3480,
    "y": 80,
    "wires": [
      [
        "86cbf076.c386f"
      ]
    ]
  },
  {
    "id": "c73f668c.f7ef28",
    "type": "function",
    "z": "d73100a9.0d64d",
    "name": "-",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1150,
    "y": 120,
    "wires": [
      [
        "86cbf076.c386f"
      ]
    ]
  },
  {
    "id": "832545e1.4bf1f8",
    "type": "trigger",
    "z": "d73100a9.0d64d",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "payl",
    "duration": "15",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 3230,
    "y": 140,
    "wires": [
      [
        "99afc7fd.02cdd8",
        "72c3ab65.ad95e4"
      ]
    ]
  },
  {
    "id": "d967e96f.341888",
    "type": "server-state-changed",
    "z": "9a341993.fbc528",
    "name": "Power Change",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "sensor.plug_07_energy_power",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 180,
    "y": 960,
    "wires": [
      [
        "bbcfcdc6.3d796"
      ]
    ]
  },
  {
    "id": "b0c782fe.509f1",
    "type": "switch",
    "z": "9a341993.fbc528",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 490,
    "y": 960,
    "wires": [
      [
        "c9a21b37.68cf68"
      ],
      [
        "dc700d5c.5f554",
        "c562a33.fc16d6"
      ]
    ]
  },
  {
    "id": "bbcfcdc6.3d796",
    "type": "rbe",
    "z": "9a341993.fbc528",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 350,
    "y": 960,
    "wires": [
      [
        "b0c782fe.509f1"
      ]
    ]
  },
  {
    "id": "c9a21b37.68cf68",
    "type": "trigger",
    "z": "9a341993.fbc528",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "25",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 890,
    "y": 960,
    "wires": [
      [
        "c562a33.fc16d6"
      ]
    ]
  },
  {
    "id": "dc700d5c.5f554",
    "type": "change",
    "z": "9a341993.fbc528",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 700,
    "y": 980,
    "wires": [
      [
        "c9a21b37.68cf68"
      ]
    ]
  },
  {
    "id": "c562a33.fc16d6",
    "type": "switch",
    "z": "9a341993.fbc528",
    "name": "Status",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "btwn",
        "v": "",
        "vt": "num",
        "v2": "10",
        "v2t": "num"
      },
      {
        "t": "lt",
        "v": "270",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 3,
    "x": 150,
    "y": 1160,
    "wires": [
      [
        "8c3e0d70.aec22"
      ],
      [
        "5c0d216f.67deb",
        "8e4230b9.58f06"
      ],
      [
        "d72e9909.52f548"
      ]
    ]
  },
  {
    "id": "ba2df1bf.c4dd7",
    "type": "switch",
    "z": "e361c01.ee9f54",
    "name": "Status",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "lt",
        "v": "10",
        "vt": "num"
      },
      {
        "t": "lt",
        "v": "200",
        "vt": "num"
      },
      {
        "t": "lt",
        "v": "1000",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 5,
    "x": 210,
    "y": 420,
    "wires": [
      [
        "afe8d4d6.b3fa78"
      ],
      [
        "afe8d4d6.b3fa78"
      ],
      [
        "e2de91a7.55223"
      ],
      [
        "450d4cab.ced584"
      ],
      [
        "482d8d0a.6d6084"
      ]
    ]
  },
  {
    "id": "afe8d4d6.b3fa78",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "Idle",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Idle",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 390,
    "y": 380,
    "wires": [
      [
        "4265f93c.c31368",
        "35d0937d.32b63c"
      ]
    ]
  },
  {
    "id": "e2de91a7.55223",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "Pumping",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Pumping",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 400,
    "y": 420,
    "wires": [
      [
        "4265f93c.c31368",
        "4974bc55.4878e4"
      ]
    ]
  },
  {
    "id": "450d4cab.ced584",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "In Use",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "In Use",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 390,
    "y": 460,
    "wires": [
      [
        "4265f93c.c31368",
        "4974bc55.4878e4"
      ]
    ]
  },
  {
    "id": "482d8d0a.6d6084",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "Heating",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Heating",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 400,
    "y": 500,
    "wires": [
      [
        "4265f93c.c31368",
        "4974bc55.4878e4"
      ]
    ]
  },
  {
    "id": "4265f93c.c31368",
    "type": "mqtt out",
    "z": "e361c01.ee9f54",
    "name": "hottub/status",
    "topic": "hottub/status",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 710,
    "y": 440,
    "wires": []
  },
  {
    "id": "5c0d216f.67deb",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_select",
    "service": "select_option",
    "entityId": "input_select.tv_state",
    "data": "{\"option\":\"True\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 630,
    "y": 1220,
    "wires": [
      []
    ]
  },
  {
    "id": "8c3e0d70.aec22",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_select",
    "service": "select_option",
    "entityId": "input_select.tv_state",
    "data": "{\"option\":\"False\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 630,
    "y": 1140,
    "wires": [
      []
    ]
  },
  {
    "id": "d72e9909.52f548",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Unknown",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "input_select",
    "service": "select_option",
    "entityId": "input_select.tv_state",
    "data": "{\"option\":\"Unknown\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 640,
    "y": 1280,
    "wires": [
      []
    ]
  },
  {
    "id": "18ec81d3.1ead2e",
    "type": "inject",
    "z": "9a341993.fbc528",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 1280,
    "wires": [
      [
        "8c3e0d70.aec22"
      ]
    ]
  },
  {
    "id": "ba7c674e.596bb8",
    "type": "inject",
    "z": "9a341993.fbc528",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 1320,
    "wires": [
      [
        "5c0d216f.67deb"
      ]
    ]
  },
  {
    "id": "13a3bd63.527173",
    "type": "inject",
    "z": "9a341993.fbc528",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 1360,
    "wires": [
      [
        "d72e9909.52f548"
      ]
    ]
  },
  {
    "id": "1e85a050.8412e",
    "type": "api-call-service",
    "z": "5625076e.ee59e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "persistent_notification",
    "service": "create",
    "data": "{\"message\":\"Test mesas\",\"title\":\"Test\",\"notification_id\":\"TEST_STATUS\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 660,
    "y": 660,
    "wires": [
      [
        "777dcdd0.a0f054"
      ]
    ]
  },
  {
    "id": "8f560a67.f57328",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 660,
    "wires": [
      [
        "1e85a050.8412e"
      ]
    ]
  },
  {
    "id": "4316a52c.7d3e4c",
    "type": "api-call-service",
    "z": "5625076e.ee59e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "persistent_notification",
    "service": "mark_read",
    "data": "{\"notification_id\":\"TEST_STATUS\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 670,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "cf940c07.d9f6e",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 700,
    "wires": [
      [
        "4316a52c.7d3e4c"
      ]
    ]
  },
  {
    "id": "d253c5f.8474838",
    "type": "api-call-service",
    "z": "5625076e.ee59e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "persistent_notification",
    "service": "dismiss",
    "data": "{\"notification_id\":\"TEST_STATUS\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 660,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "737971fa.45f07",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 740,
    "wires": [
      [
        "d253c5f.8474838"
      ]
    ]
  },
  {
    "id": "caf78461.797e28",
    "type": "api-call-service",
    "z": "5625076e.ee59e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "persistent_notification",
    "service": "create",
    "data": "{\"message\":\"Test mesas 2\",\"title\":\"Test\",\"notification_id\":\"TEST_STATUS\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 660,
    "y": 620,
    "wires": [
      []
    ]
  },
  {
    "id": "505a1442.9d24ac",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 620,
    "wires": [
      [
        "caf78461.797e28"
      ]
    ]
  },
  {
    "id": "11e9587a.801138",
    "type": "api-call-service",
    "z": "5625076e.ee59e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "persistent_notification",
    "service": "create",
    "data": "{\"message\":\"Test mesas 2\",\"title\":\"Test 3\",\"notification_id\":\"TEST_STATUS\"}",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 640,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "797ea2c9.e54f2c",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 580,
    "wires": [
      [
        "11e9587a.801138"
      ]
    ]
  },
  {
    "id": "2ecc5432.0e657c",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 860,
    "wires": [
      [
        "17b880fd.520f4f"
      ]
    ]
  },
  {
    "id": "17b880fd.520f4f",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "5625076e.ee59e8",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "Hello",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      }
    ],
    "x": 500,
    "y": 860,
    "wires": []
  },
  {
    "id": "79fc60a0.6824a",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 920,
    "wires": [
      [
        "6ebdb102.efdff"
      ]
    ]
  },
  {
    "id": "6ebdb102.efdff",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "5625076e.ee59e8",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "Hello",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      },
      {
        "name": "notification_id",
        "value": "fdgf",
        "type": "str"
      }
    ],
    "x": 500,
    "y": 920,
    "wires": []
  },
  {
    "id": "107302af.bf410d",
    "type": "api-call-service",
    "z": "a83e69e1.4b2ab8",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "persistent_notification",
    "service": "create",
    "data": "{}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 780,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "777dcdd0.a0f054",
    "type": "debug",
    "z": "5625076e.ee59e8",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 970,
    "y": 660,
    "wires": []
  },
  {
    "id": "bdb64371.3e3f2",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 1000,
    "wires": [
      [
        "67b09a7e.6e4434"
      ]
    ]
  },
  {
    "id": "67b09a7e.6e4434",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "5625076e.ee59e8",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "somethign else",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      },
      {
        "name": "notification_id",
        "value": "fdgf",
        "type": "str"
      },
      {
        "name": "title",
        "value": "New toitle",
        "type": "str"
      }
    ],
    "x": 500,
    "y": 1000,
    "wires": []
  },
  {
    "id": "21ae6270.68b64e",
    "type": "api-call-service",
    "z": "a83e69e1.4b2ab8",
    "name": "",
    "server": "eef5a84.da24f58",
    "service_domain": "persistent_notification",
    "service": "dismiss",
    "data": "{}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 780,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "2f94a2c3.b155ae",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 1220,
    "wires": [
      [
        "34a4d39.8bcdb2c"
      ]
    ]
  },
  {
    "id": "34a4d39.8bcdb2c",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "5625076e.ee59e8",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "somethign else",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      },
      {
        "name": "notification_id",
        "value": "fdgf",
        "type": "str"
      },
      {
        "name": "title",
        "value": "CLEARED",
        "type": "str"
      }
    ],
    "x": 500,
    "y": 1220,
    "wires": []
  },
  {
    "id": "35d0937d.32b63c",
    "type": "trigger",
    "z": "e361c01.ee9f54",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "2",
    "extend": false,
    "units": "hr",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 930,
    "y": 360,
    "wires": [
      [
        "9f63165a.d89408",
        "a11fdde.730532"
      ]
    ]
  },
  {
    "id": "4974bc55.4878e4",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 720,
    "y": 400,
    "wires": [
      [
        "35d0937d.32b63c",
        "8ad6dfaa.2113f"
      ]
    ]
  },
  {
    "id": "9f63165a.d89408",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "e361c01.ee9f54",
    "name": "Hot Idle",
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": "hot tub has been idle for more then "
      },
      {
        "name": "who",
        "type": "str",
        "value": "Matt"
      },
      {
        "name": "notification_id",
        "type": "str",
        "value": "HOT_TUB_STATUS"
      },
      {
        "name": "title",
        "type": "str",
        "value": "Hot Tub Offline"
      }
    ],
    "x": 1160,
    "y": 320,
    "wires": []
  },
  {
    "id": "6cc4111d.451eb",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "e361c01.ee9f54",
    "name": "Hot Restored",
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": "Hot tube back on line"
      },
      {
        "name": "who",
        "type": "str",
        "value": "both"
      },
      {
        "name": "notification_id",
        "type": "str",
        "value": "HOT_TUB_STATUS"
      },
      {
        "name": "title",
        "type": "str",
        "value": "CLEARED"
      }
    ],
    "x": 1170,
    "y": 400,
    "wires": []
  },
  {
    "id": "a11fdde.730532",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "Idle Status = True",
    "rules": [
      {
        "t": "set",
        "p": "hottub.idlestatus",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1190,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "419b14f2.a8fb9c",
    "type": "change",
    "z": "e361c01.ee9f54",
    "name": "Idle Status = False",
    "rules": [
      {
        "t": "set",
        "p": "hottub.idlestatus",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1190,
    "y": 440,
    "wires": [
      []
    ]
  },
  {
    "id": "8ad6dfaa.2113f",
    "type": "switch",
    "z": "e361c01.ee9f54",
    "name": "Idle Status",
    "property": "hottub.idlestatus",
    "propertyType": "global",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 930,
    "y": 420,
    "wires": [
      [
        "6cc4111d.451eb",
        "419b14f2.a8fb9c"
      ],
      [
        "419b14f2.a8fb9c",
        "5a385c61.1d7704"
      ]
    ]
  },
  {
    "id": "5a385c61.1d7704",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "e361c01.ee9f54",
    "name": "Hot Restored - Dont send notication",
    "env": [
      {
        "name": "notification_id",
        "type": "str",
        "value": "HOT_TUB_STATUS"
      },
      {
        "name": "title",
        "type": "str",
        "value": "CLEARED"
      }
    ],
    "x": 1240,
    "y": 480,
    "wires": []
  },
  {
    "id": "5fee203c.653f4",
    "type": "server-state-changed",
    "z": "f92add19.c43b9",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "input_text.alexa_tts",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 160,
    "y": 720,
    "wires": [
      [
        "62af2699.5a7be8"
      ]
    ]
  },
  {
    "id": "dc4f4973.c90148",
    "type": "subflow:47bc2d66.1132e4",
    "z": "f92add19.c43b9",
    "name": "",
    "env": [],
    "x": 1210,
    "y": 720,
    "wires": [
      []
    ]
  },
  {
    "id": "62af2699.5a7be8",
    "type": "change",
    "z": "f92add19.c43b9",
    "name": "Move to Msg.Say",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 720,
    "wires": [
      [
        "905d0b84.742ea8"
      ]
    ]
  },
  {
    "id": "905d0b84.742ea8",
    "type": "api-current-state",
    "z": "f92add19.c43b9",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_select.alexa_tts_echo",
    "state_type": "str",
    "state_location": "alexa",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 800,
    "y": 720,
    "wires": [
      [
        "dc4f4973.c90148"
      ]
    ]
  },
  {
    "id": "ddc8f250.0fbf6",
    "type": "switch",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "property": "trusted",
    "propertyType": "msg",
    "rules": [
      {
        "t": "false"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 570,
    "y": 180,
    "wires": [
      [
        "6aaf5f6d.8996c"
      ],
      [
        "96f1c335.74979"
      ]
    ]
  },
  {
    "id": "4766ddd2.ac3f44",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      }
    ],
    "x": 1800,
    "y": 180,
    "wires": []
  },
  {
    "id": "a990f614.02de78",
    "type": "mqtt out",
    "z": "b8a16318.b66a5",
    "name": "Restart Tracker",
    "topic": "btmonitor/scan/restart",
    "qos": "0",
    "retain": "false",
    "broker": "1b6bc4ba.56ff4b",
    "x": 340,
    "y": 940,
    "wires": []
  },
  {
    "id": "86c0bbde.977958",
    "type": "mqtt out",
    "z": "b8a16318.b66a5",
    "name": "Restart Tracker",
    "topic": "btmonitor/scan/restart",
    "qos": "0",
    "retain": "false",
    "broker": "1b6bc4ba.56ff4b",
    "x": 520,
    "y": 980,
    "wires": []
  },
  {
    "id": "6efcf683.ea5c88",
    "type": "delay",
    "z": "b8a16318.b66a5",
    "name": "",
    "pauseType": "delay",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 320,
    "y": 980,
    "wires": [
      [
        "86c0bbde.977958"
      ]
    ]
  },
  {
    "id": "d8362427.c17708",
    "type": "trigger-state",
    "z": "1e454935.091dd7",
    "name": "Good night triggered",
    "server": "5ee4d578.f7736c",
    "entityid": "input_boolean.goodnight",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "ce96o0ps5uh",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      },
      {
        "id": "g04bldiufeh",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "off"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 150,
    "y": 280,
    "wires": [
      [
        "9567c19f.3fa0b"
      ],
      []
    ]
  },
  {
    "id": "1340727d.22962e",
    "type": "inject",
    "z": "1e454935.091dd7",
    "name": "Startup",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 120,
    "y": 340,
    "wires": [
      [
        "c11dfeb5.382b4"
      ]
    ]
  },
  {
    "id": "c11dfeb5.382b4",
    "type": "api-current-state",
    "z": "1e454935.091dd7",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.goodnight",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 390,
    "y": 340,
    "wires": [
      [
        "b5871c4d.5646b"
      ],
      []
    ]
  },
  {
    "id": "b5871c4d.5646b",
    "type": "api-call-service",
    "z": "1e454935.091dd7",
    "name": "Reset Request",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 660,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "7918afaa.44de1",
    "type": "comment",
    "z": "1e454935.091dd7",
    "name": "Good Night",
    "info": "",
    "x": 130,
    "y": 220,
    "wires": []
  },
  {
    "id": "ff0503fb.8cdfb",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51101",
    "acknoledge": true,
    "name": "TV",
    "topic": "",
    "x": 110,
    "y": 800,
    "wires": [
      [
        "f68efe92.f2def"
      ]
    ]
  },
  {
    "id": "7513ff8e.927e4",
    "type": "server-state-changed",
    "z": "6e74caff.7ad1f4",
    "name": "Dishwasher Door",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "binary_sensor.dishwasher_door",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "habool",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 180,
    "y": 860,
    "wires": [
      [
        "f75923e1.22159",
        "2934fdb0.6598f2"
      ]
    ]
  },
  {
    "id": "f75923e1.22159",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 370,
    "y": 860,
    "wires": [
      [
        "fd8731ca.f5bab"
      ],
      [
        "b25c4dff.04735",
        "763e012a.d6211"
      ]
    ]
  },
  {
    "id": "bd520a5c.aa4848",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn Off Power",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_01",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 900,
    "y": 820,
    "wires": [
      []
    ]
  },
  {
    "id": "fd8731ca.f5bab",
    "type": "trigger",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "20",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 670,
    "y": 820,
    "wires": [
      [
        "bd520a5c.aa4848"
      ]
    ]
  },
  {
    "id": "2934fdb0.6598f2",
    "type": "debug",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 410,
    "y": 800,
    "wires": []
  },
  {
    "id": "763e012a.d6211",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn On Power",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_01",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 560,
    "y": 920,
    "wires": [
      []
    ]
  },
  {
    "id": "b25c4dff.04735",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 530,
    "y": 880,
    "wires": [
      [
        "fd8731ca.f5bab"
      ]
    ]
  },
  {
    "id": "6dc15410.c5f52c",
    "type": "mqtt out",
    "z": "f92add19.c43b9",
    "name": "Restart Tracker",
    "topic": "btmonitor/scan/restart",
    "qos": "0",
    "retain": "false",
    "broker": "1b6bc4ba.56ff4b",
    "x": 400,
    "y": 920,
    "wires": []
  },
  {
    "id": "3364c90.63b1f38",
    "type": "comment",
    "z": "f92add19.c43b9",
    "name": "Alexa TTS",
    "info": "",
    "x": 80,
    "y": 660,
    "wires": []
  },
  {
    "id": "6087dbe0.a43c44",
    "type": "comment",
    "z": "f92add19.c43b9",
    "name": "Restart BL Tracker",
    "info": "",
    "x": 115.01420593261719,
    "y": 858.6420288085938,
    "wires": []
  },
  {
    "id": "862d00f9.a28b2",
    "type": "trigger-state",
    "z": "f92add19.c43b9",
    "name": "Restart Selected",
    "server": "5ee4d578.f7736c",
    "entityid": "input_boolean.restart_bluetoothtracker",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "ra4a769ue6",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      },
      {
        "id": "ipoc8pc35tr",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "off"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 110,
    "y": 920,
    "wires": [
      [
        "6dc15410.c5f52c",
        "252c7f74.c4fc5"
      ],
      []
    ]
  },
  {
    "id": "5bc216ba.000d68",
    "type": "api-call-service",
    "z": "f92add19.c43b9",
    "name": "Turn Off Input",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.restart_bluetoothtracker",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 580,
    "y": 960,
    "wires": [
      []
    ]
  },
  {
    "id": "252c7f74.c4fc5",
    "type": "delay",
    "z": "f92add19.c43b9",
    "name": "",
    "pauseType": "delay",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 380,
    "y": 960,
    "wires": [
      [
        "5bc216ba.000d68"
      ]
    ]
  },
  {
    "id": "30c083fd.58f19c",
    "type": "inject",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 3360,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "86ae9181.20afa",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Turn Off Light",
    "info": "",
    "x": 1610,
    "y": 520,
    "wires": []
  },
  {
    "id": "f16be72b.544398",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Bathroom Motion",
    "info": "",
    "x": 200,
    "y": 440,
    "wires": []
  },
  {
    "id": "7bce13eb.9c946c",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Turn On Light",
    "links": [],
    "x": 135,
    "y": 600,
    "wires": [
      [
        "9edcd817.aed998"
      ]
    ]
  },
  {
    "id": "adce322c.205aa",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Someone Got Out Of Bed",
    "info": "",
    "x": 230,
    "y": 560,
    "wires": []
  },
  {
    "id": "c6d28a61.3da988",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "Clear Timer",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 580,
    "wires": [
      [
        "bc7a046f.08cac8",
        "95a4dd4.cece52",
        "4a2e8ced.86f9d4"
      ]
    ]
  },
  {
    "id": "84e5515.48f10b",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "Dishwasher Status",
    "info": "",
    "x": 150,
    "y": 180,
    "wires": []
  },
  {
    "id": "d48e101a.1319a",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "Dishwasher Power",
    "info": "",
    "x": 190,
    "y": 720,
    "wires": []
  },
  {
    "id": "2f5c852f.2b057a",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "Kitchen Light",
    "info": "",
    "x": 150,
    "y": 1160,
    "wires": []
  },
  {
    "id": "69b08bd.1c91d74",
    "type": "mqtt out",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "topic": "kitchen/light/status",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1410,
    "y": 1260,
    "wires": []
  },
  {
    "id": "5bc43779.94a538",
    "type": "mqtt in",
    "z": "6e74caff.7ad1f4",
    "name": "Kitchen Light Command",
    "topic": "bt-mqtt-gateway/switchbot/kitchen/light/set",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 180,
    "y": 1240,
    "wires": [
      [
        "21812940.ed8956",
        "ea1e1972.bef478"
      ]
    ]
  },
  {
    "id": "766b8cf0.e8b514",
    "type": "link out",
    "z": "d73100a9.0d64d",
    "name": "Good Night Activated",
    "links": [
      "3b5bbfbe.77c1d",
      "346b65c8.a46e1a"
    ],
    "x": 2955,
    "y": 520,
    "wires": []
  },
  {
    "id": "19b3b600.e6e52a",
    "type": "catch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "3d026028.d0656"
      ]
    ]
  },
  {
    "id": "3d026028.d0656",
    "type": "subflow:f5eab19a.7cf17",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "24c3e801.bf9508",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "688dc601.8b0c68",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "Rearm good night",
    "links": [
      "224d137d.2e20dc",
      "3495a219.f840be",
      "82e7bf66.f63d3",
      "8c42e0e.e62702",
      "64fb3f92.803b6"
    ],
    "x": 855,
    "y": 1060,
    "wires": [
      [
        "4d91f3d6.b9c79c"
      ]
    ]
  },
  {
    "id": "4d91f3d6.b9c79c",
    "type": "switch",
    "z": "d73100a9.0d64d",
    "name": "Is it bed time",
    "property": "bedTime",
    "propertyType": "global",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1090,
    "y": 1060,
    "wires": [
      [
        "7064b85a.243398",
        "3ed3ba30.d71e26"
      ]
    ]
  },
  {
    "id": "27692a05.c2b166",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Rearm good night",
    "info": "",
    "x": 150,
    "y": 1020,
    "wires": []
  },
  {
    "id": "53134777.f235d8",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "Wait For Both To Be In Bed",
    "links": [
      "7064b85a.243398",
      "5d68af75.25cde"
    ],
    "x": 1275,
    "y": 260,
    "wires": [
      [
        "72c3ab65.ad95e4"
      ]
    ]
  },
  {
    "id": "22991a5c.8bccb6",
    "type": "link out",
    "z": "d73100a9.0d64d",
    "name": "Morning",
    "links": [
      "ae6a1e16.6014c"
    ],
    "x": 995,
    "y": 300,
    "wires": []
  },
  {
    "id": "7064b85a.243398",
    "type": "link out",
    "z": "d73100a9.0d64d",
    "name": "",
    "links": [
      "53134777.f235d8"
    ],
    "x": 1255,
    "y": 1060,
    "wires": []
  },
  {
    "id": "346b65c8.a46e1a",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "",
    "links": [
      "766b8cf0.e8b514"
    ],
    "x": 75,
    "y": 1180,
    "wires": [
      [
        "7ceeb910.891a48",
        "57d5cb21.69d794",
        "b211bebc.0b52b"
      ]
    ]
  },
  {
    "id": "7ceeb910.891a48",
    "type": "ha-wait-until",
    "z": "d73100a9.0d64d",
    "name": "Computer On",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "entityId": "switch.plug_05",
    "property": "state",
    "comparator": "is",
    "value": "true",
    "valueType": "bool",
    "timeout": 0,
    "timeoutUnits": "seconds",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 440,
    "y": 1180,
    "wires": [
      [
        "4d91f3d6.b9c79c"
      ]
    ]
  },
  {
    "id": "ae6a1e16.6014c",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "",
    "links": [
      "22991a5c.8bccb6"
    ],
    "x": 75,
    "y": 1120,
    "wires": [
      [
        "274fa071.0948a"
      ]
    ]
  },
  {
    "id": "274fa071.0948a",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Its Morning - Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 210,
    "y": 1120,
    "wires": [
      [
        "7ceeb910.891a48",
        "57d5cb21.69d794",
        "b211bebc.0b52b"
      ]
    ]
  },
  {
    "id": "57d5cb21.69d794",
    "type": "ha-wait-until",
    "z": "d73100a9.0d64d",
    "name": "Lamp On",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "entityId": "light.bed_room_lamp",
    "property": "state",
    "comparator": "is",
    "value": "true",
    "valueType": "bool",
    "timeout": 0,
    "timeoutUnits": "seconds",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 420,
    "y": 1280,
    "wires": [
      [
        "1a1a7b1d.3db2c5"
      ]
    ]
  },
  {
    "id": "1a1a7b1d.3db2c5",
    "type": "delay",
    "z": "d73100a9.0d64d",
    "name": "",
    "pauseType": "delay",
    "timeout": "2",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 580,
    "y": 1280,
    "wires": [
      [
        "371e0584.05c96a"
      ]
    ]
  },
  {
    "id": "371e0584.05c96a",
    "type": "api-current-state",
    "z": "d73100a9.0d64d",
    "name": "Is on still?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bed_room_lamp",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 760,
    "y": 1220,
    "wires": [
      [
        "4d91f3d6.b9c79c"
      ],
      [
        "57d5cb21.69d794"
      ]
    ]
  },
  {
    "id": "566ab2f7.b30cdc",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Assume Nothing happen if it turn off in 2 minutes",
    "info": "",
    "x": 860,
    "y": 1280,
    "wires": []
  },
  {
    "id": "b211bebc.0b52b",
    "type": "ha-wait-until",
    "z": "d73100a9.0d64d",
    "name": "Living Room Light",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "entityId": "light.living_room_lights",
    "property": "state",
    "comparator": "is",
    "value": "true",
    "valueType": "bool",
    "timeout": 0,
    "timeoutUnits": "seconds",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 450,
    "y": 1220,
    "wires": [
      [
        "4d91f3d6.b9c79c"
      ]
    ]
  },
  {
    "id": "3ee08ac0.ea8096",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "\tPresence Detection",
    "info": "",
    "x": 930,
    "y": 1020,
    "wires": []
  },
  {
    "id": "8717b4a7.3015b8",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "70892",
    "acknoledge": true,
    "name": "Kitchen Light",
    "topic": "",
    "x": 130,
    "y": 900,
    "wires": [
      [
        "510b7436.eb1f8c",
        "55cf041.5355dfc"
      ]
    ]
  },
  {
    "id": "510b7436.eb1f8c",
    "type": "switch",
    "z": "80866e71.966c6",
    "name": "",
    "property": "command",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "TurnOffRequest",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 330,
    "y": 900,
    "wires": [
      [
        "69f84640.578028"
      ],
      [
        "362136b6.f80cfa"
      ]
    ]
  },
  {
    "id": "7644ed33.1b5854",
    "type": "mqtt out",
    "z": "80866e71.966c6",
    "name": "",
    "topic": "bt-mqtt-gateway/switchbot/kitchen/light/set",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 880,
    "y": 900,
    "wires": []
  },
  {
    "id": "69f84640.578028",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "Off",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "OFF",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 550,
    "y": 880,
    "wires": [
      [
        "7644ed33.1b5854",
        "30b7bd6b.102312"
      ]
    ]
  },
  {
    "id": "362136b6.f80cfa",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "On",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "ON",
        "tot": "str"
      },
      {
        "t": "delete",
        "p": "name",
        "pt": "msg"
      },
      {
        "t": "delete",
        "p": "_applianceId",
        "pt": "msg"
      },
      {
        "t": "delete",
        "p": "_confId",
        "pt": "msg"
      },
      {
        "t": "delete",
        "p": "command",
        "pt": "msg"
      },
      {
        "t": "delete",
        "p": "extraInfo",
        "pt": "msg"
      },
      {
        "t": "delete",
        "p": "_msgid",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 550,
    "y": 920,
    "wires": [
      [
        "7644ed33.1b5854",
        "82a65a20.4be418"
      ]
    ]
  },
  {
    "id": "55cf041.5355dfc",
    "type": "debug",
    "z": "80866e71.966c6",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 300,
    "y": 1000,
    "wires": []
  },
  {
    "id": "82a65a20.4be418",
    "type": "debug",
    "z": "80866e71.966c6",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 790,
    "y": 960,
    "wires": []
  },
  {
    "id": "30b7bd6b.102312",
    "type": "debug",
    "z": "80866e71.966c6",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 790,
    "y": 860,
    "wires": []
  },
  {
    "id": "4f9fc045.5ecaf",
    "type": "server-events",
    "z": "6a3dc053.8b5b6",
    "name": "All",
    "server": "eef5a84.da24f58",
    "event_type": "ios.action_fired",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "x": 130,
    "y": 160,
    "wires": [
      [
        "70de4671.f86528",
        "cb0127e8.b67b98"
      ]
    ]
  },
  {
    "id": "70de4671.f86528",
    "type": "debug",
    "z": "6a3dc053.8b5b6",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "cb0127e8.b67b98",
    "type": "switch",
    "z": "6a3dc053.8b5b6",
    "name": "",
    "property": "payload.event.actionName",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "LIV_LAMP",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "TV",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "TV_UP",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "TV_DOWN",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "PC",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "SHOWER",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "BED_LIGHT",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "GOODNIGHT",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "BED_FAN",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "PING",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "BEDSIDE",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 11,
    "x": 330,
    "y": 300,
    "wires": [
      [
        "ceaf8459.571ba8"
      ],
      [
        "409bf3af.1fa2fc"
      ],
      [
        "77e9028c.f7645c"
      ],
      [
        "1d8c3b92.ea88a4"
      ],
      [
        "5faedba1.83d324"
      ],
      [
        "baddf022.477dc"
      ],
      [
        "8b528cfa.1f7ec"
      ],
      [
        "69e3038b.68b6fc",
        "f743da.27023c28"
      ],
      [
        "4688f534.30ec5c"
      ],
      [
        "1f5285a2.a5e99a"
      ],
      [
        "e876947a.ecf3b8"
      ]
    ]
  },
  {
    "id": "ceaf8459.571ba8",
    "type": "api-call-service",
    "z": "6a3dc053.8b5b6",
    "name": "Living Room Lamp",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "toggle",
    "entityId": "light.bed_room_lamp",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 610,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "77e9028c.f7645c",
    "type": "api-call-service",
    "z": "6a3dc053.8b5b6",
    "name": "Volume Up",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.tv_volume",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 590,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "1d8c3b92.ea88a4",
    "type": "api-call-service",
    "z": "6a3dc053.8b5b6",
    "name": "Volume Down",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "{   \"entity_id\": \"switch.tv_volume\" }",
    "mergecontext": "",
    "x": 600,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "dd361153.4c6fe",
    "type": "rbe",
    "z": "cd950567.f864b8",
    "name": "",
    "func": "rbei",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 1570,
    "y": 220,
    "wires": [
      [
        "8620b0eb.c8e42",
        "49f84595.d4ec4c"
      ]
    ]
  },
  {
    "id": "377ccb85.03bec4",
    "type": "delay",
    "z": "cd950567.f864b8",
    "name": "",
    "pauseType": "delay",
    "timeout": "2",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 680,
    "y": 60,
    "wires": [
      [
        "b3c666ee.88c4a8"
      ]
    ]
  },
  {
    "id": "45afa583.e70c9c",
    "type": "change",
    "z": "cd950567.f864b8",
    "name": "Clear Waiting delay",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1270,
    "y": 100,
    "wires": [
      [
        "377ccb85.03bec4"
      ]
    ]
  },
  {
    "id": "e918e231.bd4c1",
    "type": "switch",
    "z": "cd950567.f864b8",
    "name": "Good Payload",
    "property": "goodpayload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1340,
    "y": 400,
    "wires": [
      [],
      [
        "883ea3db.d14ca"
      ]
    ]
  },
  {
    "id": "8c8ab6a2.b87428",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "cd950567.f864b8",
    "name": "",
    "env": [
      {
        "name": "message",
        "type": "str",
        "value": "PAYLOAD"
      },
      {
        "name": "who",
        "type": "str",
        "value": "Matt"
      }
    ],
    "x": 1760,
    "y": 400,
    "wires": []
  },
  {
    "id": "883ea3db.d14ca",
    "type": "rbe",
    "z": "cd950567.f864b8",
    "name": "",
    "func": "rbei",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 1570,
    "y": 400,
    "wires": [
      [
        "8c8ab6a2.b87428",
        "7113d4bc.ff622c"
      ]
    ]
  },
  {
    "id": "f1a3f9ea.3e39d8",
    "type": "delay",
    "z": "cd950567.f864b8",
    "name": "",
    "pauseType": "delay",
    "timeout": "2",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 680,
    "y": 540,
    "wires": [
      [
        "406545cd.70f59c"
      ]
    ]
  },
  {
    "id": "579e425c.aeaaec",
    "type": "change",
    "z": "cd950567.f864b8",
    "name": "Clear Waiting delay",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1230,
    "y": 280,
    "wires": [
      [
        "f1a3f9ea.3e39d8"
      ]
    ]
  },
  {
    "id": "406545cd.70f59c",
    "type": "function",
    "z": "cd950567.f864b8",
    "name": "Data",
    "func": "msg.payloadvalue = msg.payload\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": \"is Danni here: \" + msg.payload\n  }\n}\n\nif (0 < msg.payloadvalue && msg.payloadvalue < 100) {\n    msg.goodpayload = true \n} else {\n    msg.goodpayload = false\n}\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1150,
    "y": 400,
    "wires": [
      [
        "e918e231.bd4c1",
        "579e425c.aeaaec"
      ]
    ]
  },
  {
    "id": "f48b357d.debff8",
    "type": "link out",
    "z": "cd950567.f864b8",
    "name": "MATT - BT - HOME",
    "links": [
      "7149bfa1.ce884",
      "1d9c70a.c14368f",
      "f7740640.c80dd8",
      "7b16b22f.9b719c",
      "75a9b44f.1ad8bc",
      "62e65b11.82cb44"
    ],
    "x": 1775,
    "y": 260,
    "wires": []
  },
  {
    "id": "77fc4304.46571c",
    "type": "link out",
    "z": "cd950567.f864b8",
    "name": "MATT - BT - AWAY",
    "links": [
      "a09d4a4f.fbb188",
      "5057d631.c48018"
    ],
    "x": 1775,
    "y": 300,
    "wires": []
  },
  {
    "id": "49f84595.d4ec4c",
    "type": "switch",
    "z": "cd950567.f864b8",
    "name": "",
    "property": "payloadvalue",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "100",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1690,
    "y": 280,
    "wires": [
      [
        "f48b357d.debff8"
      ],
      [
        "77fc4304.46571c"
      ]
    ]
  },
  {
    "id": "528c1fad.a8b2",
    "type": "link out",
    "z": "cd950567.f864b8",
    "name": "DANNI - BT - HOME",
    "links": [
      "7149bfa1.ce884",
      "f7740640.c80dd8",
      "7b16b22f.9b719c",
      "75a9b44f.1ad8bc",
      "62e65b11.82cb44"
    ],
    "x": 1775,
    "y": 440,
    "wires": []
  },
  {
    "id": "7da7e798.85c708",
    "type": "link out",
    "z": "cd950567.f864b8",
    "name": "DANNI - BT - AWAY",
    "links": [
      "a09d4a4f.fbb188"
    ],
    "x": 1775,
    "y": 480,
    "wires": []
  },
  {
    "id": "7113d4bc.ff622c",
    "type": "switch",
    "z": "cd950567.f864b8",
    "name": "",
    "property": "payloadvalue",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "100",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1690,
    "y": 460,
    "wires": [
      [
        "528c1fad.a8b2"
      ],
      [
        "7da7e798.85c708"
      ]
    ]
  },
  {
    "id": "7149bfa1.ce884",
    "type": "link in",
    "z": "a3158433.9d1f78",
    "name": "",
    "links": [
      "528c1fad.a8b2",
      "f48b357d.debff8"
    ],
    "x": 615,
    "y": 220,
    "wires": [
      [
        "81818922.360f98"
      ]
    ]
  },
  {
    "id": "a09d4a4f.fbb188",
    "type": "link in",
    "z": "a3158433.9d1f78",
    "name": "",
    "links": [
      "77fc4304.46571c",
      "7da7e798.85c708"
    ],
    "x": 615,
    "y": 260,
    "wires": [
      [
        "bea24dc.62f6cb"
      ]
    ]
  },
  {
    "id": "1d9c70a.c14368f",
    "type": "link in",
    "z": "a3158433.9d1f78",
    "name": "",
    "links": [
      "f48b357d.debff8"
    ],
    "x": 855,
    "y": 80,
    "wires": [
      [
        "261e0b4c.0e67c4",
        "6590eef7.36df6"
      ]
    ]
  },
  {
    "id": "5057d631.c48018",
    "type": "link in",
    "z": "a3158433.9d1f78",
    "name": "",
    "links": [
      "77fc4304.46571c"
    ],
    "x": 855,
    "y": 120,
    "wires": [
      [
        "fa841a56.1037e8",
        "46f08a7c.f9b394"
      ]
    ]
  },
  {
    "id": "fa0f64c8.764628",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "c5288811.25f9e8",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "type": "str",
        "value": "underbedlight_temp"
      }
    ],
    "x": 380,
    "y": 420,
    "wires": [
      [
        "2daf4701.535bf8"
      ],
      [
        "fe2b1708.cb1038"
      ]
    ]
  },
  {
    "id": "57e0f08e.ebcff",
    "type": "inject",
    "z": "c5288811.25f9e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 420,
    "wires": [
      [
        "fa0f64c8.764628"
      ]
    ]
  },
  {
    "id": "2daf4701.535bf8",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "True",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 570,
    "y": 400,
    "wires": []
  },
  {
    "id": "fe2b1708.cb1038",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "False",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 570,
    "y": 440,
    "wires": []
  },
  {
    "id": "a9d8687b.4f3b88",
    "type": "catch",
    "z": "e2e6b53d.b747f8",
    "name": "",
    "scope": [
      "efe8d09a.45ca9"
    ],
    "uncaught": false,
    "x": 530,
    "y": 140,
    "wires": [
      [
        "5cb3fbe4.215834",
        "e99bac22.8c48f"
      ]
    ]
  },
  {
    "id": "893e72ad.8293c",
    "type": "function",
    "z": "e2e6b53d.b747f8",
    "name": "Data",
    "func": "var BreakerName = env.get(\"InputPrefix\") + env.get(\"BreakerName\").toLowerCase()\nflow.set('breakerOldmsg',msg);\n\n\n\nmsg = {\"payload\" : {\"entity_id\": BreakerName}}\n    \nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 250,
    "y": 100,
    "wires": [
      [
        "efe8d09a.45ca9"
      ]
    ]
  },
  {
    "id": "efe8d09a.45ca9",
    "type": "api-current-state",
    "z": "e2e6b53d.b747f8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 560,
    "y": 100,
    "wires": [
      [
        "a101232f.6bc5e"
      ],
      [
        "a0f16bbd.44df68"
      ]
    ]
  },
  {
    "id": "891ced8c.5189a",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "c5288811.25f9e8",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "type": "str",
        "value": "underbedlight_temp2"
      }
    ],
    "x": 380,
    "y": 600,
    "wires": [
      [
        "1f07f5fa.7db94a"
      ],
      [
        "53c7924c.d6e14c"
      ]
    ]
  },
  {
    "id": "6ad50929.5b3618",
    "type": "inject",
    "z": "c5288811.25f9e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 600,
    "wires": [
      [
        "891ced8c.5189a"
      ]
    ]
  },
  {
    "id": "1f07f5fa.7db94a",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "True",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 570,
    "y": 580,
    "wires": []
  },
  {
    "id": "53c7924c.d6e14c",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "False",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 570,
    "y": 620,
    "wires": []
  },
  {
    "id": "c77ec114.79458",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "21d6efde.d0943",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "value": "underbedlight_temp",
        "type": "str"
      }
    ],
    "x": 210,
    "y": 380,
    "wires": [
      [
        "17ce9344.2f1a6d"
      ],
      []
    ]
  },
  {
    "id": "62af218d.b9ebc",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Trigger Light Breaker",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.breaker_underbedlight_temp",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 260,
    "y": 2300,
    "wires": [
      []
    ]
  },
  {
    "id": "220ad73e.6558c8",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "",
    "env": [],
    "x": 480,
    "y": 2340,
    "wires": [
      []
    ]
  },
  {
    "id": "4bdeca17.aa5b24",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "Set LightLevel = HIGH",
    "rules": [
      {
        "t": "set",
        "p": "LightLevel",
        "pt": "msg",
        "to": "HIGH",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 260,
    "y": 2340,
    "wires": [
      [
        "220ad73e.6558c8"
      ]
    ]
  },
  {
    "id": "c7e3295c.a61de8",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Force under bed light to stop",
    "info": "",
    "x": 160,
    "y": 2240,
    "wires": []
  },
  {
    "id": "32cd8fcd.35633",
    "type": "link in",
    "z": "21d6efde.d0943",
    "name": "Force under bed light none",
    "links": [
      "8b528cfa.1f7ec",
      "c56b6a5c.2f5578"
    ],
    "x": 55,
    "y": 2320,
    "wires": [
      [
        "62af218d.b9ebc",
        "4bdeca17.aa5b24"
      ]
    ]
  },
  {
    "id": "c56b6a5c.2f5578",
    "type": "link out",
    "z": "d73100a9.0d64d",
    "name": "",
    "links": [
      "32cd8fcd.35633"
    ],
    "x": 3400,
    "y": 180,
    "wires": []
  },
  {
    "id": "4e2298de.6119c8",
    "type": "trigger-state",
    "z": "21d6efde.d0943",
    "name": "Breaker Triggered",
    "server": "5ee4d578.f7736c",
    "entityid": "input_boolean.breaker_underbedlight_temp",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 130,
    "y": 2480,
    "wires": [
      [
        "9812a9cf.ebf7f8"
      ],
      [
        "fe69196b.a170d8"
      ]
    ]
  },
  {
    "id": "9812a9cf.ebf7f8",
    "type": "delay",
    "z": "21d6efde.d0943",
    "name": "",
    "pauseType": "delay",
    "timeout": "15",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 470,
    "y": 2460,
    "wires": [
      [
        "ca3f4889.3a5b78"
      ]
    ]
  },
  {
    "id": "fe69196b.a170d8",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "Clear",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 310,
    "y": 2520,
    "wires": [
      [
        "9812a9cf.ebf7f8"
      ]
    ]
  },
  {
    "id": "ca3f4889.3a5b78",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Trigger Light Breaker",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.breaker_underbedlight_temp",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 680,
    "y": 2520,
    "wires": [
      [
        "c5112815.cfcc58"
      ]
    ]
  },
  {
    "id": "5cb3fbe4.215834",
    "type": "debug",
    "z": "e2e6b53d.b747f8",
    "name": "Breaker Nonfound",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 710,
    "y": 280,
    "wires": []
  },
  {
    "id": "a101232f.6bc5e",
    "type": "function",
    "z": "e2e6b53d.b747f8",
    "name": "",
    "func": "msg = flow.get('breakerOldmsg');\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 990,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "a0f16bbd.44df68",
    "type": "function",
    "z": "e2e6b53d.b747f8",
    "name": "",
    "func": "msg = flow.get('breakerOldmsg');\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 990,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "b54022e0.4ea7",
    "type": "api-current-state",
    "z": "c5288811.25f9e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.dummy1",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 510,
    "y": 40,
    "wires": [
      [
        "41f47e69.67f7c"
      ],
      [
        "554baf48.71196"
      ]
    ]
  },
  {
    "id": "41f47e69.67f7c",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "True",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 930,
    "y": 20,
    "wires": []
  },
  {
    "id": "554baf48.71196",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "False",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 930,
    "y": 60,
    "wires": []
  },
  {
    "id": "bf023357.bcce3",
    "type": "inject",
    "z": "c5288811.25f9e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 160,
    "y": 40,
    "wires": [
      [
        "b54022e0.4ea7"
      ]
    ]
  },
  {
    "id": "c38d3653.bfa5c8",
    "type": "api-current-state",
    "z": "c5288811.25f9e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.breaker_underbedlight_temp",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 570,
    "y": 140,
    "wires": [
      [
        "4fcf2a0b.263974"
      ],
      [
        "968c3836.063878"
      ]
    ]
  },
  {
    "id": "4fcf2a0b.263974",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "True",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 930,
    "y": 120,
    "wires": []
  },
  {
    "id": "968c3836.063878",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "False",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 930,
    "y": 160,
    "wires": []
  },
  {
    "id": "7e56314e.ac49b",
    "type": "inject",
    "z": "c5288811.25f9e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 160,
    "y": 140,
    "wires": [
      [
        "c38d3653.bfa5c8"
      ]
    ]
  },
  {
    "id": "8d3df04d.d3e9f",
    "type": "api-current-state",
    "z": "c5288811.25f9e8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 740,
    "y": 260,
    "wires": [
      [
        "a2473f0f.f27e5"
      ],
      [
        "cbc73bc9.affef8"
      ]
    ]
  },
  {
    "id": "a2473f0f.f27e5",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "True",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 950,
    "y": 240,
    "wires": []
  },
  {
    "id": "cbc73bc9.affef8",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "False",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 950,
    "y": 280,
    "wires": []
  },
  {
    "id": "a7d75b9d.06fff8",
    "type": "inject",
    "z": "c5288811.25f9e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 260,
    "wires": [
      [
        "8838d24a.cca18"
      ]
    ]
  },
  {
    "id": "8838d24a.cca18",
    "type": "function",
    "z": "c5288811.25f9e8",
    "name": "Data",
    "func": "var BreakerName = env.get(\"InputPrefix\") + env.get(\"BreakerName\")\nflow.set('breakerOldmsg',msg);\nBreakName = \"input_boolean.breaker_\" + \"underbedlight_temp\"\n\nmsg.payload  = {\"entity_id\": BreakName}\n    \nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 430,
    "y": 260,
    "wires": [
      [
        "8d3df04d.d3e9f",
        "b6512fe7.95702"
      ]
    ]
  },
  {
    "id": "b6512fe7.95702",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 610,
    "y": 320,
    "wires": []
  },
  {
    "id": "e99bac22.8c48f",
    "type": "switch",
    "z": "e2e6b53d.b747f8",
    "name": "",
    "property": "$boolean($env('DefaultState'))",
    "propertyType": "jsonata",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "false"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 2,
    "x": 690,
    "y": 160,
    "wires": [
      [
        "a101232f.6bc5e"
      ],
      [
        "a0f16bbd.44df68"
      ]
    ]
  },
  {
    "id": "766b4253.0ef6cc",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "c5288811.25f9e8",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "type": "str",
        "value": "underbedlight_temp2"
      },
      {
        "name": "DefaultState",
        "type": "bool",
        "value": "false"
      }
    ],
    "x": 380,
    "y": 720,
    "wires": [
      [
        "44cc473f.5022c8"
      ],
      [
        "d4a37c9.c8ecb8"
      ]
    ]
  },
  {
    "id": "aded1f0a.56259",
    "type": "inject",
    "z": "c5288811.25f9e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 720,
    "wires": [
      [
        "766b4253.0ef6cc"
      ]
    ]
  },
  {
    "id": "44cc473f.5022c8",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "True",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 570,
    "y": 700,
    "wires": []
  },
  {
    "id": "d4a37c9.c8ecb8",
    "type": "debug",
    "z": "c5288811.25f9e8",
    "name": "False",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 570,
    "y": 740,
    "wires": []
  },
  {
    "id": "2df258c.55fdca8",
    "type": "comment",
    "z": "c5288811.25f9e8",
    "name": "None Existsing",
    "info": "",
    "x": 200,
    "y": 520,
    "wires": []
  },
  {
    "id": "409bf3af.1fa2fc",
    "type": "api-call-service",
    "z": "6a3dc053.8b5b6",
    "name": "TV On/Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "toggle",
    "entityId": "switch.tv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 580,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "8ee5a185.8fd4e",
    "type": "api-call-service",
    "z": "50a84f0.9f6dbb",
    "name": "TV On/Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "switch",
    "service": "toggle",
    "entityId": "switch.tv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 680,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "a9849a45.2e7158",
    "type": "api-current-state",
    "z": "50a84f0.9f6dbb",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "True",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_select.tv_state",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 360,
    "y": 100,
    "wires": [
      [
        "8ee5a185.8fd4e"
      ],
      []
    ]
  },
  {
    "id": "a7573e0d.7e4eb",
    "type": "subflow:50a84f0.9f6dbb",
    "z": "c9b308f8.01ef68",
    "name": "",
    "x": 490,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "24eb6a57.aef116",
    "type": "delay",
    "z": "c9b308f8.01ef68",
    "name": "",
    "pauseType": "delay",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 880,
    "y": 100,
    "wires": [
      [
        "2971d7cd.f71318"
      ]
    ]
  },
  {
    "id": "f9270c85.9b616",
    "type": "api-call-service",
    "z": "99d64a3d.f4e418",
    "name": "Turn on living room lights",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bed_room_lamp",
    "data": "{\"brightness_pct\":100,\"transition\":600}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 650,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "324dab80.d8dad4",
    "type": "api-current-state",
    "z": "99d64a3d.f4e418",
    "name": "Is Off?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bed_room_lamp",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 150,
    "y": 700,
    "wires": [
      [
        "23185437.e6f9cc"
      ],
      []
    ]
  },
  {
    "id": "7c42a7c9.0e0088",
    "type": "comment",
    "z": "99d64a3d.f4e418",
    "name": "On Dark",
    "info": "",
    "x": 140,
    "y": 400,
    "wires": []
  },
  {
    "id": "23185437.e6f9cc",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "99d64a3d.f4e418",
    "name": "",
    "x": 350,
    "y": 700,
    "wires": [
      [
        "f9270c85.9b616"
      ],
      []
    ]
  },
  {
    "id": "cc1b4e8a.9c3f3",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "1036247",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "1036247",
    "payloadType": "num",
    "x": 1320,
    "y": 1220,
    "wires": [
      [
        "b7f644c.01308b8"
      ]
    ]
  },
  {
    "id": "b7f644c.01308b8",
    "type": "mqtt out",
    "z": "21d6efde.d0943",
    "name": "",
    "topic": "bedroom/bedweight",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1650,
    "y": 1220,
    "wires": []
  },
  {
    "id": "8ff2c577.811818",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "1636247",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "1636247",
    "payloadType": "num",
    "x": 1320,
    "y": 1260,
    "wires": [
      [
        "b7f644c.01308b8"
      ]
    ]
  },
  {
    "id": "d812603.ba259a",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "3036247",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "3036247",
    "payloadType": "num",
    "x": 1320,
    "y": 1300,
    "wires": [
      [
        "b7f644c.01308b8"
      ]
    ]
  },
  {
    "id": "bb814067.827f8",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "On Start Up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 110,
    "y": 2600,
    "wires": [
      [
        "c9d31ea2.cceee"
      ]
    ]
  },
  {
    "id": "c9d31ea2.cceee",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "21d6efde.d0943",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "value": "underbedlight_temp",
        "type": "str"
      }
    ],
    "x": 320,
    "y": 2600,
    "wires": [
      [],
      [
        "ca3f4889.3a5b78"
      ]
    ]
  },
  {
    "id": "793fa7a7.3b3ed8",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Re-end in 15 minutes",
    "info": "",
    "x": 140,
    "y": 2420,
    "wires": []
  },
  {
    "id": "c5112815.cfcc58",
    "type": "mqtt out",
    "z": "21d6efde.d0943",
    "name": "Set 0",
    "topic": "bedroom/bedweight",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 890,
    "y": 2520,
    "wires": []
  },
  {
    "id": "f8a2b0f4.5b3a9",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Turn Off Light Strip",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.hue_lightstrip_underbed",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1150,
    "y": 880,
    "wires": [
      []
    ]
  },
  {
    "id": "b785bc45.9ba0a",
    "type": "trigger",
    "z": "21d6efde.d0943",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "8",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 950,
    "y": 880,
    "wires": [
      [
        "f8a2b0f4.5b3a9",
        "2d64a30b.7c287c"
      ]
    ]
  },
  {
    "id": "fb9e78ff.52cdd8",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "21d6efde.d0943",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "value": "BedStripOnMainLightOn",
        "type": "str"
      }
    ],
    "x": 320,
    "y": 2780,
    "wires": [
      [
        "db981fc1.4a633"
      ],
      []
    ]
  },
  {
    "id": "db981fc1.4a633",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "Set LightLevel = HIGH",
    "rules": [
      {
        "t": "set",
        "p": "LightLevel",
        "pt": "msg",
        "to": "HIGH",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 560,
    "y": 2780,
    "wires": [
      [
        "ed433d9a.9d51e"
      ]
    ]
  },
  {
    "id": "ed433d9a.9d51e",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "",
    "env": [],
    "x": 820,
    "y": 2780,
    "wires": [
      []
    ]
  },
  {
    "id": "5b64eadc.2442b4",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Main light on",
    "info": "",
    "x": 110,
    "y": 2720,
    "wires": []
  },
  {
    "id": "8c5602df.7677c",
    "type": "trigger-state",
    "z": "21d6efde.d0943",
    "name": "Main Light On",
    "server": "5ee4d578.f7736c",
    "entityid": "light.bed_room_light",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "59x71zy3eie",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "rc9invljc3",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 120,
    "y": 2780,
    "wires": [
      [
        "fb9e78ff.52cdd8"
      ],
      []
    ]
  },
  {
    "id": "3485d02a.50b6e",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Night Time Alarm",
    "info": "",
    "x": 120,
    "y": 2920,
    "wires": []
  },
  {
    "id": "58e8e0e0.d64e4",
    "type": "link in",
    "z": "21d6efde.d0943",
    "name": "",
    "links": [
      "cc2fcdb8.ee0ea"
    ],
    "x": 55,
    "y": 2980,
    "wires": [
      [
        "e4c33ada.780c38"
      ]
    ]
  },
  {
    "id": "3d4c632.ff3659c",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Both In Bed",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "2",
    "halt_if_type": "num",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.num_in_master_bed",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 470,
    "y": 2980,
    "wires": [
      [
        "5b1eb236.8a70bc",
        "f41cd85c.eb4728"
      ],
      []
    ]
  },
  {
    "id": "5b1eb236.8a70bc",
    "type": "change",
    "z": "21d6efde.d0943",
    "name": "Set LightLevel = HIGH",
    "rules": [
      {
        "t": "set",
        "p": "LightLevel",
        "pt": "msg",
        "to": "HIGH",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 760,
    "y": 3020,
    "wires": [
      [
        "a633485a.9a70f8"
      ]
    ]
  },
  {
    "id": "a633485a.9a70f8",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "",
    "env": [],
    "x": 1020,
    "y": 3020,
    "wires": [
      []
    ]
  },
  {
    "id": "e4c33ada.780c38",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "21d6efde.d0943",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "type": "str",
        "value": "NightAlarm"
      }
    ],
    "x": 260,
    "y": 2980,
    "wires": [
      [
        "3d4c632.ff3659c"
      ],
      []
    ]
  },
  {
    "id": "f41cd85c.eb4728",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Lights On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.office, light.hallway_light, light.living_room_lights",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 720,
    "y": 2980,
    "wires": [
      []
    ]
  },
  {
    "id": "315abedb.293842",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Full Lights",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bathroom_light",
    "data": "{\"brightness_pct\":100}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 300,
    "y": 1420,
    "wires": [
      []
    ]
  },
  {
    "id": "baddf022.477dc",
    "type": "link out",
    "z": "6a3dc053.8b5b6",
    "name": "Trigger Shower Time",
    "links": [
      "8fa41eed.e0746"
    ],
    "x": 535,
    "y": 360,
    "wires": []
  },
  {
    "id": "67bbf13.be2361",
    "type": "inject",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1020,
    "y": 280,
    "wires": [
      [
        "f49bd1bf.ad501"
      ]
    ]
  },
  {
    "id": "15d16de5.93e372",
    "type": "inject",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1340,
    "y": 400,
    "wires": [
      [
        "14070813.4ada38"
      ]
    ]
  },
  {
    "id": "efbf779e.103b48",
    "type": "inject",
    "z": "d3802138.c1529",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 120,
    "wires": [
      [
        "ee977de7.e2e7c"
      ]
    ]
  },
  {
    "id": "ee977de7.e2e7c",
    "type": "subflow:56368b94.f11494",
    "z": "d3802138.c1529",
    "name": "",
    "env": [],
    "x": 460,
    "y": 120,
    "wires": [
      [
        "678b12cd.dea51c"
      ],
      [
        "582e382e.e5cfa8"
      ],
      [
        "60c2372e.eec7d8"
      ]
    ]
  },
  {
    "id": "678b12cd.dea51c",
    "type": "debug",
    "z": "d3802138.c1529",
    "name": "1",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 670,
    "y": 60,
    "wires": []
  },
  {
    "id": "582e382e.e5cfa8",
    "type": "debug",
    "z": "d3802138.c1529",
    "name": "2",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 670,
    "y": 100,
    "wires": []
  },
  {
    "id": "60c2372e.eec7d8",
    "type": "debug",
    "z": "d3802138.c1529",
    "name": "3",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 670,
    "y": 140,
    "wires": []
  },
  {
    "id": "6cd552a9.465a5c",
    "type": "api-current-state",
    "z": "d3802138.c1529",
    "name": "Check Sun",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "below_horizon",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sun.sun",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 370,
    "y": 260,
    "wires": [
      [
        "66c9b8e5.605078"
      ],
      [
        "ee12854.bfa3978"
      ]
    ]
  },
  {
    "id": "17e8b051.fde9c",
    "type": "inject",
    "z": "d3802138.c1529",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 160,
    "y": 220,
    "wires": [
      [
        "6cd552a9.465a5c"
      ]
    ]
  },
  {
    "id": "66c9b8e5.605078",
    "type": "debug",
    "z": "d3802138.c1529",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 630,
    "y": 220,
    "wires": []
  },
  {
    "id": "ee12854.bfa3978",
    "type": "debug",
    "z": "d3802138.c1529",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 630,
    "y": 260,
    "wires": []
  },
  {
    "id": "228d3470.7e90ac",
    "type": "api-current-state",
    "z": "56368b94.f11494",
    "name": "Check Sun is down",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "below_horizon",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sun.sun",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 210,
    "y": 80,
    "wires": [
      [],
      [
        "bac0e249.335d6"
      ]
    ]
  },
  {
    "id": "8963696a.ae3798",
    "type": "catch",
    "z": "56368b94.f11494",
    "name": "",
    "scope": null,
    "uncaught": false,
    "x": 360,
    "y": 220,
    "wires": [
      [
        "8c895b54.0a9588"
      ]
    ]
  },
  {
    "id": "21812940.ed8956",
    "type": "debug",
    "z": "6e74caff.7ad1f4",
    "name": "SET",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 470,
    "y": 1180,
    "wires": []
  },
  {
    "id": "ded5415e.cafe7",
    "type": "mqtt out",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "topic": "bt-mqtt-gateway/switchbot/kitchen/light/set",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 520,
    "y": 1500,
    "wires": []
  },
  {
    "id": "6d1312b.51613ec",
    "type": "ha-wait-until",
    "z": "6e74caff.7ad1f4",
    "name": "Wait For Light To Change",
    "server": "5ee4d578.f7736c",
    "outputs": 2,
    "entityId": "sensor.kitchen_light_level",
    "property": "state",
    "comparator": "gt",
    "value": "5",
    "valueType": "num",
    "timeout": "10",
    "timeoutUnits": "seconds",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 790,
    "y": 1140,
    "wires": [
      [
        "4e6625a5.6dfc4c",
        "c788646a.1604c8"
      ],
      [
        "8b065b95.a42678"
      ]
    ]
  },
  {
    "id": "c9b8aa1.2a8ff58",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "ON",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "OFF",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 590,
    "y": 1240,
    "wires": [
      [
        "6d1312b.51613ec",
        "8f81c10d.c6cca"
      ],
      [
        "4e1295f9.9761dc",
        "f6b82905.862df8"
      ]
    ]
  },
  {
    "id": "db8c4e2b.0f2db",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "ON",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "ON",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1170,
    "y": 1180,
    "wires": [
      [
        "a6fb8dc2.dd1cc",
        "bf94fafa.c77df8"
      ]
    ]
  },
  {
    "id": "a6fb8dc2.dd1cc",
    "type": "mqtt out",
    "z": "6e74caff.7ad1f4",
    "name": "Kitchen",
    "topic": "bt-mqtt-gateway/switchbot/kitchen/light/set",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1340,
    "y": 1180,
    "wires": []
  },
  {
    "id": "6e74af93.24315",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "up to 5 time",
    "property": "count",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "5",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1570,
    "y": 1120,
    "wires": [
      [
        "6d1312b.51613ec"
      ],
      [
        "4e6625a5.6dfc4c",
        "b8839b70.cfc8b8",
        "484bc8a6.5c32e8"
      ]
    ]
  },
  {
    "id": "bf94fafa.c77df8",
    "type": "counter",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "init": "0",
    "step": "1",
    "lower": "",
    "upper": "100",
    "mode": "increment",
    "outputs": 1,
    "x": 1240,
    "y": 1060,
    "wires": [
      [
        "414ff1f8.ee6fc"
      ]
    ]
  },
  {
    "id": "4e6625a5.6dfc4c",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1070,
    "y": 1060,
    "wires": [
      [
        "bf94fafa.c77df8"
      ]
    ]
  },
  {
    "id": "517b4891.003028",
    "type": "ha-wait-until",
    "z": "6e74caff.7ad1f4",
    "name": "Wait For Light To Change",
    "server": "5ee4d578.f7736c",
    "outputs": 2,
    "entityId": "sensor.kitchen_light_level",
    "property": "state",
    "comparator": "lt",
    "value": "1",
    "valueType": "num",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 930,
    "y": 1460,
    "wires": [
      [
        "c68d9693.c4d778",
        "a2a3d0a6.01ccd"
      ],
      [
        "700aa453.53bb5c"
      ]
    ]
  },
  {
    "id": "fcafd450.507ce8",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "OFF",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "OFF",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1310,
    "y": 1480,
    "wires": [
      [
        "a773b615.a78448",
        "b522630d.375bb"
      ]
    ]
  },
  {
    "id": "a773b615.a78448",
    "type": "mqtt out",
    "z": "6e74caff.7ad1f4",
    "name": "Kitchen",
    "topic": "bt-mqtt-gateway/switchbot/kitchen/light/set",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1480,
    "y": 1480,
    "wires": []
  },
  {
    "id": "9427f3a0.63504",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "up to 5 time",
    "property": "count",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "5",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1670,
    "y": 1400,
    "wires": [
      [
        "517b4891.003028"
      ],
      [
        "a2a3d0a6.01ccd",
        "e900fbf6.ff13b8",
        "aaaf8f8d.f6852"
      ]
    ]
  },
  {
    "id": "b522630d.375bb",
    "type": "counter",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "init": "0",
    "step": "1",
    "lower": "",
    "upper": "100",
    "mode": "increment",
    "outputs": 1,
    "x": 1340,
    "y": 1340,
    "wires": [
      [
        "ac60a6ca.3d2068"
      ]
    ]
  },
  {
    "id": "4e1295f9.9761dc",
    "type": "subflow:56368b94.f11494",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "x": 700,
    "y": 1340,
    "wires": [
      [
        "517b4891.003028"
      ],
      [],
      []
    ]
  },
  {
    "id": "c788646a.1604c8",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "ON",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "ON",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1190,
    "y": 1240,
    "wires": [
      [
        "69b08bd.1c91d74",
        "22efffff.7e8b6"
      ]
    ]
  },
  {
    "id": "c68d9693.c4d778",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "OFF",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "OFF",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1190,
    "y": 1280,
    "wires": [
      [
        "69b08bd.1c91d74",
        "22efffff.7e8b6"
      ]
    ]
  },
  {
    "id": "913bb43f.5b8938",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "Status confirmed",
    "info": "",
    "x": 1400,
    "y": 1220,
    "wires": []
  },
  {
    "id": "ea1e1972.bef478",
    "type": "rbe",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 410,
    "y": 1240,
    "wires": [
      [
        "c9b8aa1.2a8ff58"
      ]
    ]
  },
  {
    "id": "22efffff.7e8b6",
    "type": "link out",
    "z": "6e74caff.7ad1f4",
    "name": "Light Status Comfirmed",
    "links": [
      "f0867ad9.611038"
    ],
    "x": 1360,
    "y": 1300,
    "wires": []
  },
  {
    "id": "a2a3d0a6.01ccd",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1190,
    "y": 1340,
    "wires": [
      [
        "b522630d.375bb"
      ]
    ]
  },
  {
    "id": "ac60a6ca.3d2068",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "Reset?",
    "property": "reset",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1500,
    "y": 1340,
    "wires": [
      [
        "9427f3a0.63504"
      ]
    ]
  },
  {
    "id": "414ff1f8.ee6fc",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "Reset?",
    "property": "reset",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1400,
    "y": 1060,
    "wires": [
      [
        "6e74af93.24315"
      ]
    ]
  },
  {
    "id": "752d4f21.4d4f2",
    "type": "mqtt out",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "topic": "kitchen/light/status",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 450,
    "y": 1620,
    "wires": []
  },
  {
    "id": "b8839b70.cfc8b8",
    "type": "debug",
    "z": "6e74caff.7ad1f4",
    "name": "Give Up - On",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1800,
    "y": 1120,
    "wires": []
  },
  {
    "id": "e900fbf6.ff13b8",
    "type": "debug",
    "z": "6e74caff.7ad1f4",
    "name": "Give Up - Off",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1890,
    "y": 1400,
    "wires": []
  },
  {
    "id": "484bc8a6.5c32e8",
    "type": "link out",
    "z": "6e74caff.7ad1f4",
    "name": "Given Up - ON",
    "links": [
      "f0867ad9.611038"
    ],
    "x": 1735,
    "y": 1160,
    "wires": []
  },
  {
    "id": "aaaf8f8d.f6852",
    "type": "link out",
    "z": "6e74caff.7ad1f4",
    "name": "Given Up - OFF",
    "links": [
      "f0867ad9.611038"
    ],
    "x": 1835,
    "y": 1440,
    "wires": []
  },
  {
    "id": "8f81c10d.c6cca",
    "type": "debug",
    "z": "6e74caff.7ad1f4",
    "name": "On",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 790,
    "y": 1240,
    "wires": []
  },
  {
    "id": "f6b82905.862df8",
    "type": "debug",
    "z": "6e74caff.7ad1f4",
    "name": "Off",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 790,
    "y": 1280,
    "wires": []
  },
  {
    "id": "9a25938d.bacef",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 270,
    "y": 1300,
    "wires": [
      [
        "ea1e1972.bef478"
      ]
    ]
  },
  {
    "id": "f0867ad9.611038",
    "type": "link in",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "links": [
      "22efffff.7e8b6",
      "484bc8a6.5c32e8",
      "aaaf8f8d.f6852"
    ],
    "x": 175,
    "y": 1300,
    "wires": [
      [
        "9a25938d.bacef"
      ]
    ]
  },
  {
    "id": "e80e856b.f125c8",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "ON",
    "payloadType": "str",
    "x": 160,
    "y": 1480,
    "wires": [
      [
        "ded5415e.cafe7"
      ]
    ]
  },
  {
    "id": "7bf3e49a.d4840c",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "OFF",
    "payloadType": "str",
    "x": 160,
    "y": 1520,
    "wires": [
      [
        "ded5415e.cafe7"
      ]
    ]
  },
  {
    "id": "effd382.20aa4c8",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "ON",
    "payloadType": "str",
    "x": 190,
    "y": 1600,
    "wires": [
      [
        "752d4f21.4d4f2"
      ]
    ]
  },
  {
    "id": "829b7560.cf0628",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "OFF",
    "payloadType": "str",
    "x": 190,
    "y": 1640,
    "wires": [
      [
        "752d4f21.4d4f2"
      ]
    ]
  },
  {
    "id": "700aa453.53bb5c",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "Reset?",
    "property": "reset",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1140,
    "y": 1480,
    "wires": [
      [
        "fcafd450.507ce8"
      ]
    ]
  },
  {
    "id": "8b065b95.a42678",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "Reset?",
    "property": "reset",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1020,
    "y": 1200,
    "wires": [
      [
        "db8c4e2b.0f2db"
      ]
    ]
  },
  {
    "id": "84b24fc8.a8976",
    "type": "api-current-state",
    "z": "6e74caff.7ad1f4",
    "name": "Light Level",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.kitchen_light_level",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 390,
    "y": 1900,
    "wires": [
      [
        "fc1e8b29.610278"
      ]
    ]
  },
  {
    "id": "fc1e8b29.610278",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "5",
        "vt": "num"
      },
      {
        "t": "lt",
        "v": "1",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 570,
    "y": 1820,
    "wires": [
      [
        "549ed09b.966bf"
      ],
      [
        "914d80b1.76342"
      ]
    ]
  },
  {
    "id": "914d80b1.76342",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "OFF",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "OFF",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 1840,
    "wires": [
      [
        "9490d8a2.f34408"
      ]
    ]
  },
  {
    "id": "549ed09b.966bf",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "ON",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "ON",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 1800,
    "wires": [
      [
        "9490d8a2.f34408"
      ]
    ]
  },
  {
    "id": "9490d8a2.f34408",
    "type": "mqtt out",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "topic": "kitchen/light/status",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 910,
    "y": 1820,
    "wires": []
  },
  {
    "id": "defb8da6.a4976",
    "type": "server-state-changed",
    "z": "6e74caff.7ad1f4",
    "name": "On Light Level Change",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "sensor.kitchen_light_level",
    "entityidfiltertype": "exact",
    "outputinitially": true,
    "state_type": "num",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 360,
    "y": 1820,
    "wires": [
      [
        "fc1e8b29.610278"
      ]
    ]
  },
  {
    "id": "1dfdcb09.698d65",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "20",
    "topic": "Start Up",
    "payload": "",
    "payloadType": "date",
    "x": 170,
    "y": 1900,
    "wires": [
      [
        "84b24fc8.a8976"
      ]
    ]
  },
  {
    "id": "235d9d93.c879f2",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "status",
    "info": "",
    "x": 130,
    "y": 1760,
    "wires": []
  },
  {
    "id": "14070813.4ada38",
    "type": "api-current-state",
    "z": "a0cdc0f9.a362b",
    "name": "Light off?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bathroom",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1560,
    "y": 320,
    "wires": [
      [
        "78facd5e.ed58b4"
      ],
      []
    ]
  },
  {
    "id": "c8ee6fb1.6ad25",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": true,
    "complete": "payload",
    "x": 950,
    "y": 880,
    "wires": []
  },
  {
    "id": "99d097a7.0f3398",
    "type": "trigger",
    "z": "826a5f7f.19967",
    "name": "Once in 45",
    "op1": "",
    "op2": "",
    "op1type": "date",
    "op2type": "nul",
    "duration": "45",
    "extend": true,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1090,
    "y": 240,
    "wires": [
      [
        "cbb0b316.f7f89"
      ]
    ]
  },
  {
    "id": "905f0b83.335748",
    "type": "switch",
    "z": "826a5f7f.19967",
    "name": "True",
    "property": "payload.MotionDetected",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 330,
    "y": 300,
    "wires": [
      [
        "c8ee6fb1.6ad25",
        "99d097a7.0f3398"
      ]
    ]
  },
  {
    "id": "bee0116f.20334",
    "type": "exec",
    "z": "826a5f7f.19967",
    "command": "DEBUG= npm/bin/upload-gphotos",
    "addpay": true,
    "append": "-q -c ~/t.json -a \"Front Porch\"",
    "useSpawn": "false",
    "timer": "",
    "oldrc": false,
    "name": "upload-gphotos",
    "x": 980,
    "y": 660,
    "wires": [
      [],
      [
        "309bba3d.18d386"
      ],
      [
        "38bb9e97.a18b22"
      ]
    ]
  },
  {
    "id": "309bba3d.18d386",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": true,
    "complete": "payload",
    "x": 1190,
    "y": 820,
    "wires": []
  },
  {
    "id": "704afdfc.f1d834",
    "type": "exec",
    "z": "826a5f7f.19967",
    "command": "pkill ffmpeg; timeout -k 2 35 ffmpeg -i rtsp://192.168.30.217:8554/unicast -map 0:0 -vcodec copy -t 5 -f mp4",
    "addpay": true,
    "append": "",
    "useSpawn": "false",
    "timer": "",
    "oldrc": false,
    "name": "ffmpeg",
    "x": 980,
    "y": 400,
    "wires": [
      [],
      [
        "309bba3d.18d386"
      ],
      [
        "cc43bc54.22a5b"
      ]
    ]
  },
  {
    "id": "cbb0b316.f7f89",
    "type": "moment",
    "z": "826a5f7f.19967",
    "name": "",
    "topic": "",
    "input": "",
    "inputType": "msg",
    "inTz": "America/Toronto",
    "adjAmount": "0",
    "adjType": "hours",
    "adjDir": "subtract",
    "format": "[/var/tmp/Front_Porch_]YYYY_MM_DD_HH_mm_ss[.mp4]",
    "locale": "en_CA",
    "output": "payload",
    "outputType": "msg",
    "outTz": "America/Toronto",
    "x": 700,
    "y": 320,
    "wires": [
      [
        "c8ee6fb1.6ad25",
        "704afdfc.f1d834",
        "2e04092c.ce3006",
        "24194380.06d1dc"
      ]
    ]
  },
  {
    "id": "2e04092c.ce3006",
    "type": "join",
    "z": "826a5f7f.19967",
    "name": "",
    "mode": "custom",
    "build": "string",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "accumulate": false,
    "timeout": "",
    "count": "",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "",
    "reduceFixup": "",
    "x": 750,
    "y": 660,
    "wires": [
      [
        "c8ee6fb1.6ad25"
      ]
    ]
  },
  {
    "id": "cc43bc54.22a5b",
    "type": "change",
    "z": "826a5f7f.19967",
    "name": "msg.complete",
    "rules": [
      {
        "t": "move",
        "p": "payload",
        "pt": "msg",
        "to": "complete",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1180,
    "y": 420,
    "wires": [
      [
        "2e04092c.ce3006"
      ]
    ]
  },
  {
    "id": "57cfc76b.b83638",
    "type": "exec",
    "z": "826a5f7f.19967",
    "command": "rm -rf /var/tmp/*",
    "addpay": false,
    "append": "",
    "useSpawn": "false",
    "timer": "",
    "oldrc": false,
    "name": "Cleanup",
    "x": 1020,
    "y": 740,
    "wires": [
      [],
      [
        "309bba3d.18d386"
      ],
      []
    ]
  },
  {
    "id": "24194380.06d1dc",
    "type": "join",
    "z": "826a5f7f.19967",
    "name": "",
    "mode": "custom",
    "build": "string",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "accumulate": false,
    "timeout": "",
    "count": "",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "",
    "reduceFixup": "",
    "x": 750,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "38bb9e97.a18b22",
    "type": "change",
    "z": "826a5f7f.19967",
    "name": "msg.complete",
    "rules": [
      {
        "t": "move",
        "p": "payload",
        "pt": "msg",
        "to": "complete",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1200,
    "y": 680,
    "wires": [
      [
        "24194380.06d1dc"
      ]
    ]
  },
  {
    "id": "8224db3d.89ec38",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "Test Button",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 890,
    "y": 180,
    "wires": [
      [
        "99d097a7.0f3398"
      ]
    ]
  },
  {
    "id": "78b61b80.73fa24",
    "type": "exec",
    "z": "826a5f7f.19967",
    "command": "pkill ffmpeg; timeout -k 2 35 ffmpeg -i rtsp://192.168.30.217:8554/unicast -map 0:0 -vcodec copy -t 5 -f mp4",
    "addpay": true,
    "append": "",
    "useSpawn": "false",
    "timer": "",
    "oldrc": false,
    "name": "ffmpeg",
    "x": 1570,
    "y": 320,
    "wires": [
      [],
      [],
      []
    ]
  },
  {
    "id": "496ce4a3.240efc",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "Test Button",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1352.017333984375,
    "y": 158.0104217529297,
    "wires": [
      [
        "78b61b80.73fa24"
      ]
    ]
  },
  {
    "id": "5917b8f.9192c48",
    "type": "exec",
    "z": "826a5f7f.19967",
    "command": "",
    "addpay": true,
    "append": "ffmpeg -i rtsp://192.168.30.217:8554/unicast -acodec copy -vcodec copy c:/abc.mp4",
    "useSpawn": "false",
    "timer": "",
    "oldrc": false,
    "name": "",
    "x": 1240,
    "y": 1300,
    "wires": [
      [
        "e9a098fc.fa1998"
      ],
      [
        "e9a098fc.fa1998"
      ],
      [
        "e9a098fc.fa1998"
      ]
    ]
  },
  {
    "id": "e9a098fc.fa1998",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1450,
    "y": 1300,
    "wires": []
  },
  {
    "id": "ff15db44.827538",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1080,
    "y": 1360,
    "wires": [
      [
        "5917b8f.9192c48"
      ]
    ]
  },
  {
    "id": "c414332e.598be",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 620,
    "y": 1160,
    "wires": [
      [
        "6c3592d0.e49b4c"
      ]
    ]
  },
  {
    "id": "6c3592d0.e49b4c",
    "type": "api-call-service",
    "z": "826a5f7f.19967",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "camera",
    "service": "record",
    "entityId": "camera.officecam",
    "data": "{\"filename\":\"tmp/{{ entity_id }}_{{ now().strftime(;%Y%m%d-%H%M%S') }}.mp4\",\"duration\":\"8\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 990,
    "y": 1160,
    "wires": [
      []
    ]
  },
  {
    "id": "dd7d73.5ce3429",
    "type": "moment",
    "z": "826a5f7f.19967",
    "name": "",
    "topic": "",
    "input": "",
    "inputType": "date",
    "inTz": "Europe/London",
    "adjAmount": "0",
    "adjType": "hours",
    "adjDir": "subtract",
    "format": "YYYY_MM_DD_HH_mm_ss",
    "locale": "en_gb",
    "output": "payload",
    "outputType": "msg",
    "outTz": "Europe/London",
    "x": 840,
    "y": 1040,
    "wires": [
      [
        "9b739dcd.4da9d"
      ]
    ]
  },
  {
    "id": "e5102103.cc014",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 1270,
    "y": 1040,
    "wires": []
  },
  {
    "id": "75fce9.57beb318",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 600,
    "y": 1040,
    "wires": [
      [
        "dd7d73.5ce3429"
      ]
    ]
  },
  {
    "id": "9b739dcd.4da9d",
    "type": "function",
    "z": "826a5f7f.19967",
    "name": "Build File",
    "func": "msg.payload = \"/tmp/Front_Porch_\" + msg.payload + \".mp4\"\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1060,
    "y": 1040,
    "wires": [
      [
        "e5102103.cc014"
      ]
    ]
  },
  {
    "id": "85cc4ab.9a2d9b8",
    "type": "moment",
    "z": "3b25c31e.848f5c",
    "name": "",
    "topic": "",
    "input": "",
    "inputType": "date",
    "inTz": "Europe/London",
    "adjAmount": "0",
    "adjType": "hours",
    "adjDir": "subtract",
    "format": "YYYY_MM_DD_HH_mm_ss",
    "locale": "en_gb",
    "output": "payload",
    "outputType": "msg",
    "outTz": "Europe/London",
    "x": 280,
    "y": 40,
    "wires": [
      [
        "ac858831.b48e58"
      ]
    ]
  },
  {
    "id": "ac858831.b48e58",
    "type": "function",
    "z": "3b25c31e.848f5c",
    "name": "Build File",
    "func": "var CameraName = env.get(\"CameraName\")\nvar RecordType = env.get(\"RecordType\")\n\nvar Duration = env.get(\"Duration\")\n\nmsg = { \"payload\" :{\n    \"data\" : {\n            \"entity_id\" : \"camera.\" + CameraName,\n            \"filename\": \"tmp/\" + CameraName + \"_\" + msg.payload + \".\" + RecordType,\n            \"duration\": Duration\n        }\n    }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 500,
    "y": 40,
    "wires": [
      [
        "852e9bd0.f74218",
        "72567fc8.5b251"
      ]
    ]
  },
  {
    "id": "370f4564.05b71a",
    "type": "subflow:3b25c31e.848f5c",
    "z": "826a5f7f.19967",
    "name": "",
    "env": [
      {
        "name": "CameraName",
        "type": "str",
        "value": "officecam"
      },
      {
        "name": "Duration",
        "type": "num",
        "value": "3"
      }
    ],
    "x": 810,
    "y": 1440,
    "wires": [
      [
        "65065529.d8dc6c"
      ]
    ]
  },
  {
    "id": "c69799d4.a44fe8",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 600,
    "y": 1440,
    "wires": [
      [
        "370f4564.05b71a"
      ]
    ]
  },
  {
    "id": "65065529.d8dc6c",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 1030,
    "y": 1440,
    "wires": []
  },
  {
    "id": "ac9f03cf.662f2",
    "type": "function",
    "z": "826a5f7f.19967",
    "name": "Build",
    "func": "msg = { \"payload\" :{\n    \"data\" : {\n            \"entity_id\" : \"camera.officecam\",\n            \"filename\": \"tmp/pic.mp4\",\n            \"duration\": \"8\"\n        }\n    }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 820,
    "y": 1260,
    "wires": [
      [
        "831aba86.36edd8"
      ]
    ]
  },
  {
    "id": "831aba86.36edd8",
    "type": "api-call-service",
    "z": "826a5f7f.19967",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "camera",
    "service": "record",
    "entityId": "",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1010,
    "y": 1260,
    "wires": [
      []
    ]
  },
  {
    "id": "24b725e9.30c51a",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 620,
    "y": 1260,
    "wires": [
      [
        "ac9f03cf.662f2"
      ]
    ]
  },
  {
    "id": "852e9bd0.f74218",
    "type": "api-call-service",
    "z": "3b25c31e.848f5c",
    "name": "Record",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "camera",
    "service": "record",
    "entityId": "",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 700,
    "y": 40,
    "wires": [
      [
        "99bd274d.f1fcf8",
        "b866ead0.013798"
      ]
    ]
  },
  {
    "id": "d42a790a.44ad08",
    "type": "subflow:3b25c31e.848f5c",
    "z": "826a5f7f.19967",
    "name": "",
    "env": [
      {
        "name": "CameraName",
        "type": "str",
        "value": "kitchencam"
      },
      {
        "name": "Duration",
        "type": "num",
        "value": "3"
      }
    ],
    "x": 830,
    "y": 1540,
    "wires": [
      [
        "344f9bb3.9d3204"
      ]
    ]
  },
  {
    "id": "390d54f6.3624fc",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 620,
    "y": 1540,
    "wires": [
      [
        "d42a790a.44ad08"
      ]
    ]
  },
  {
    "id": "344f9bb3.9d3204",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 1050,
    "y": 1540,
    "wires": []
  },
  {
    "id": "fd08dc40.51c1d",
    "type": "subflow:3b25c31e.848f5c",
    "z": "826a5f7f.19967",
    "name": "",
    "env": [
      {
        "name": "CameraName",
        "type": "str",
        "value": "back_garden"
      }
    ],
    "x": 830,
    "y": 1620,
    "wires": [
      [
        "25d25b83.f4b124"
      ]
    ]
  },
  {
    "id": "1957b42c.a1ad6c",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 620,
    "y": 1620,
    "wires": [
      [
        "fd08dc40.51c1d"
      ]
    ]
  },
  {
    "id": "25d25b83.f4b124",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 1050,
    "y": 1620,
    "wires": []
  },
  {
    "id": "1841f2ca.6e1e0d",
    "type": "telegrambot-payload",
    "z": "826a5f7f.19967",
    "name": "",
    "bot": "6cdab321.f08dec",
    "chatId": "",
    "sendMethod": "sendMessage",
    "payload": "",
    "x": 600,
    "y": 1940,
    "wires": [
      []
    ]
  },
  {
    "id": "23eb609d.ca3c1",
    "type": "telegrambot-switch",
    "z": "826a5f7f.19967",
    "name": "",
    "bot": "6cdab321.f08dec",
    "chatId": "945067103",
    "question": "Hi",
    "answers": [
      "a",
      "b"
    ],
    "outputs": 2,
    "autoAnswerCallback": false,
    "timeoutValue": "",
    "timeoutUnits": "",
    "x": 1160,
    "y": 2000,
    "wires": [
      [
        "7b99e741.6bdc58"
      ],
      [
        "23cf6830.a01ff8"
      ]
    ]
  },
  {
    "id": "c008c7b4.fa2a98",
    "type": "inject",
    "z": "826a5f7f.19967",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 900,
    "y": 2000,
    "wires": [
      [
        "23eb609d.ca3c1"
      ]
    ]
  },
  {
    "id": "7b99e741.6bdc58",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 1410,
    "y": 1980,
    "wires": []
  },
  {
    "id": "23cf6830.a01ff8",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 1410,
    "y": 2040,
    "wires": []
  },
  {
    "id": "7b5efadb.a45c84",
    "type": "debug",
    "z": "826a5f7f.19967",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 850,
    "y": 1940,
    "wires": []
  },
  {
    "id": "6840cc4.f044734",
    "type": "subflow:3b25c31e.848f5c",
    "z": "594d2dae.a157a4",
    "name": "",
    "env": [
      {
        "name": "CameraName",
        "value": "livingroom",
        "type": "str"
      },
      {
        "name": "MQTT Topic",
        "value": "camera/livingroom/record",
        "type": "str"
      }
    ],
    "x": 430,
    "y": 660,
    "wires": [
      []
    ]
  },
  {
    "id": "cb948b5.9fae378",
    "type": "inject",
    "z": "594d2dae.a157a4",
    "name": "Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "5",
    "topic": "",
    "payload": "online",
    "payloadType": "str",
    "x": 200,
    "y": 200,
    "wires": [
      [
        "5021a72c.44e0b8",
        "80e71ce.457e7e",
        "b277ad88.3fb8a",
        "bb153c03.1e657",
        "83d8e4d9.c82218"
      ]
    ]
  },
  {
    "id": "5021a72c.44e0b8",
    "type": "mqtt out",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "camera/livingroom/available",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 500,
    "y": 200,
    "wires": []
  },
  {
    "id": "376aaf2e.ae8a",
    "type": "mqtt in",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "camera/livingroom/record/set",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 190,
    "y": 660,
    "wires": [
      [
        "6840cc4.f044734"
      ]
    ]
  },
  {
    "id": "27a8fd1b.c635f2",
    "type": "mqtt out",
    "z": "3b25c31e.848f5c",
    "name": "",
    "topic": "camera/livingroom/record",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 870,
    "y": 200,
    "wires": []
  },
  {
    "id": "72567fc8.5b251",
    "type": "function",
    "z": "3b25c31e.848f5c",
    "name": "Recording",
    "func": "var topic = env.get(\"MQTT Topic\")\n\nif (topic ==\"camera/???/record\") {\n   return null; \n} else {\n    msg.topic = topic;\n    msg.payload = \"ON\";\n    return msg;\n}\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 640,
    "y": 200,
    "wires": [
      [
        "27a8fd1b.c635f2"
      ]
    ]
  },
  {
    "id": "3aea71b8.ac593e",
    "type": "delay",
    "z": "b8a16318.b66a5",
    "name": "",
    "pauseType": "delay",
    "timeout": "15",
    "timeoutUnits": "minutes",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 490,
    "y": 840,
    "wires": [
      [
        "93fd391a.057098"
      ]
    ]
  },
  {
    "id": "a690aa6b.fb4b88",
    "type": "mqtt out",
    "z": "3b25c31e.848f5c",
    "name": "",
    "topic": "",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1410,
    "y": 200,
    "wires": []
  },
  {
    "id": "70f3f692.647568",
    "type": "function",
    "z": "3b25c31e.848f5c",
    "name": "Done",
    "func": "var topic = env.get(\"MQTT Topic\")\n\nif (topic ==\"camera/???/record\") {\n   return null; \n} else {\n    msg.topic = topic;\n    msg.payload = \"OFF\";\n    return msg;\n}\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1230,
    "y": 200,
    "wires": [
      [
        "a690aa6b.fb4b88"
      ]
    ]
  },
  {
    "id": "99bd274d.f1fcf8",
    "type": "delay",
    "z": "3b25c31e.848f5c",
    "name": "",
    "pauseType": "delay",
    "timeout": "30",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 940,
    "y": 40,
    "wires": [
      [
        "70f3f692.647568"
      ]
    ]
  },
  {
    "id": "2e0fa036.935cf",
    "type": "catch",
    "z": "3b25c31e.848f5c",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 900,
    "y": 340,
    "wires": [
      [
        "70f3f692.647568",
        "24bc081.e4525f8"
      ]
    ]
  },
  {
    "id": "24bc081.e4525f8",
    "type": "subflow:f5eab19a.7cf17",
    "z": "3b25c31e.848f5c",
    "name": "",
    "x": 1160,
    "y": 340,
    "wires": []
  },
  {
    "id": "3128d23b.a8207e",
    "type": "subflow:f5eab19a.7cf17",
    "z": "3b25c31e.848f5c",
    "name": "",
    "x": 1160,
    "y": 420,
    "wires": []
  },
  {
    "id": "b19bbb06.3fc448",
    "type": "catch",
    "z": "3b25c31e.848f5c",
    "name": "",
    "scope": [
      "a690aa6b.fb4b88",
      "70f3f692.647568",
      "24bc081.e4525f8",
      "3128d23b.a8207e"
    ],
    "uncaught": false,
    "x": 870,
    "y": 420,
    "wires": [
      [
        "3128d23b.a8207e"
      ]
    ]
  },
  {
    "id": "cc0988a5.76d998",
    "type": "catch",
    "z": "594d2dae.a157a4",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 180,
    "y": 60,
    "wires": [
      [
        "fc5cae0e.d0d98"
      ]
    ]
  },
  {
    "id": "fc5cae0e.d0d98",
    "type": "subflow:f5eab19a.7cf17",
    "z": "594d2dae.a157a4",
    "name": "",
    "x": 390,
    "y": 60,
    "wires": []
  },
  {
    "id": "813ee71.858da18",
    "type": "comment",
    "z": "594d2dae.a157a4",
    "name": "Error Handler",
    "info": "",
    "x": 170,
    "y": 20,
    "wires": []
  },
  {
    "id": "80e71ce.457e7e",
    "type": "mqtt out",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "camera/kitchen/available",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 490,
    "y": 240,
    "wires": []
  },
  {
    "id": "b277ad88.3fb8a",
    "type": "mqtt out",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "camera/hallway/available",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 490,
    "y": 280,
    "wires": []
  },
  {
    "id": "bb153c03.1e657",
    "type": "mqtt out",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "camera/backgraden/available",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 500,
    "y": 320,
    "wires": []
  },
  {
    "id": "83d8e4d9.c82218",
    "type": "mqtt out",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "camera/office/available",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 480,
    "y": 360,
    "wires": []
  },
  {
    "id": "8b528cfa.1f7ec",
    "type": "link out",
    "z": "6a3dc053.8b5b6",
    "name": "Bed Light",
    "links": [
      "32cd8fcd.35633"
    ],
    "x": 535,
    "y": 400,
    "wires": []
  },
  {
    "id": "3551ac34.dca644",
    "type": "inject",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1380,
    "y": 680,
    "wires": [
      [
        "918f0fb5.9a267"
      ]
    ]
  },
  {
    "id": "98087ce9.c3e1c",
    "type": "delay",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "3",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 1820,
    "y": 620,
    "wires": [
      [
        "a67bf8a7.d26de8"
      ]
    ]
  },
  {
    "id": "a67bf8a7.d26de8",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "Alarm going off",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      },
      {
        "name": "notification_id",
        "value": "alarmrringing",
        "type": "str"
      },
      {
        "name": "title",
        "value": "Alarm going off",
        "type": "str"
      }
    ],
    "x": 2160,
    "y": 620,
    "wires": []
  },
  {
    "id": "a86681ea.92425",
    "type": "inject",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1880,
    "y": 680,
    "wires": [
      [
        "a67bf8a7.d26de8"
      ]
    ]
  },
  {
    "id": "831923d6.979ec",
    "type": "http request",
    "z": "2aff94ce.fdbbdc",
    "name": "",
    "method": "GET",
    "ret": "txt",
    "paytoqs": false,
    "url": "http://192.168.1.250:5001/271191/hibernate",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "x": 230,
    "y": 80,
    "wires": [
      [
        "ef5eac6b.9761a"
      ]
    ]
  },
  {
    "id": "fd248a7b.214428",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51177",
    "acknoledge": true,
    "name": "Living Room Plug",
    "topic": "",
    "x": 140,
    "y": 620,
    "wires": [
      [
        "a2d9bb24.3687b8"
      ]
    ]
  },
  {
    "id": "5f060153.1d4c1",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51127",
    "acknoledge": true,
    "name": "Office Light",
    "topic": "",
    "x": 130,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "95b81294.8df06",
    "type": "function",
    "z": "80866e71.966c6",
    "name": "",
    "func": "light = msg.light\ncommad = \"turn_on\"\nif (msg.command == \"TurnOffRequest\") {\n    commad = \"turn_off\"\n}\n\nif (msg.command == \"SetPercentageRequest\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : commad,\n     \"data\" : \n        { \n            \"entity_id\" : light,\n            \"brightness_pct\": msg.payload\n        } \n    }\n} else  if (msg.command == \"SetColorRequest\") {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : commad,\n     \"data\" : \n        { \n            \"entity_id\" : light,\n            \"hs_color\": [msg.payload.hue,80 ]\n        } \n    }\n\n\n} else {\n    msg.payload = { \"domain\" : \"light\",\n    \"service\" : commad,\n     \"data\" : \n        { \n            \"entity_id\" : light\n        } \n    }\n}\n\n    \n\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1310,
    "y": 380,
    "wires": [
      [
        "a47966dd.e9a758"
      ]
    ],
    "outputLabels": [
      "On"
    ]
  },
  {
    "id": "a47966dd.e9a758",
    "type": "api-call-service",
    "z": "80866e71.966c6",
    "name": "",
    "server": "5ee4d578.f7736c",
    "service_domain": "",
    "service": "",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1490,
    "y": 380,
    "wires": [
      [
        "8694ad37.47b7b"
      ]
    ]
  },
  {
    "id": "3094a403.7afc5c",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "light",
        "pt": "msg",
        "to": "light.office_light",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 380,
    "wires": [
      [
        "95b81294.8df06"
      ]
    ]
  },
  {
    "id": "4f296db8.3aa0b4",
    "type": "api-current-state",
    "z": "80866e71.966c6",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "{\"entity_id\":msg.payload}",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 2000,
    "y": 380,
    "wires": [
      [
        "52dae85b.7b6158"
      ]
    ]
  },
  {
    "id": "52dae85b.7b6158",
    "type": "debug",
    "z": "80866e71.966c6",
    "name": "Get State",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 2300,
    "y": 380,
    "wires": []
  },
  {
    "id": "8694ad37.47b7b",
    "type": "function",
    "z": "80866e71.966c6",
    "name": "",
    "func": "\n\n    msg.payload = \"light.office_light\"\n\n\n    \n\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1690,
    "y": 380,
    "wires": [
      [
        "4f296db8.3aa0b4"
      ]
    ],
    "outputLabels": [
      "On"
    ]
  },
  {
    "id": "ee359875.093898",
    "type": "api-current-state",
    "z": "80866e71.966c6",
    "name": "Office Plug State",
    "server": "eef5a84.da24f58",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.plug_05",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 550,
    "y": 460,
    "wires": [
      [
        "c9b1a942.579f28"
      ]
    ]
  },
  {
    "id": "c9b1a942.579f28",
    "type": "switch",
    "z": "80866e71.966c6",
    "name": "No?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 730,
    "y": 460,
    "wires": [
      [
        "251600ca.8c805"
      ],
      []
    ]
  },
  {
    "id": "bf3d7931.b37a68",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51102",
    "acknoledge": true,
    "name": "Computer",
    "topic": "",
    "x": 120,
    "y": 480,
    "wires": [
      [
        "162312c3.23181d"
      ]
    ]
  },
  {
    "id": "fbaff11a.4a841",
    "type": "subflow:2aff94ce.fdbbdc",
    "z": "80866e71.966c6",
    "name": "",
    "env": [],
    "x": 550,
    "y": 500,
    "wires": [
      []
    ]
  },
  {
    "id": "162312c3.23181d",
    "type": "subflow:fec14295.8a46d",
    "z": "80866e71.966c6",
    "name": "",
    "x": 320,
    "y": 480,
    "wires": [
      [
        "ee359875.093898"
      ],
      [
        "fbaff11a.4a841"
      ],
      []
    ]
  },
  {
    "id": "251600ca.8c805",
    "type": "api-call-service",
    "z": "80866e71.966c6",
    "name": "Office Plug",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_on",
    "data": "{\"entity_id\":\"switch.plug_05\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 930,
    "y": 460,
    "wires": [
      []
    ]
  },
  {
    "id": "a2d9bb24.3687b8",
    "type": "subflow:fec14295.8a46d",
    "z": "80866e71.966c6",
    "name": "",
    "x": 360,
    "y": 620,
    "wires": [
      [
        "4733a478.ded64c"
      ],
      [
        "48d0c1e8.92da"
      ],
      []
    ]
  },
  {
    "id": "4733a478.ded64c",
    "type": "api-call-service",
    "z": "80866e71.966c6",
    "name": "Living Room Plug",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_03",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 670,
    "y": 600,
    "wires": [
      []
    ]
  },
  {
    "id": "48d0c1e8.92da",
    "type": "api-call-service",
    "z": "80866e71.966c6",
    "name": "Living Room Plug",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_03",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 670,
    "y": 640,
    "wires": [
      []
    ]
  },
  {
    "id": "5f964389.e6170c",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "light",
        "pt": "msg",
        "to": "light.bathroom",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 370,
    "y": 400,
    "wires": [
      [
        "72cc887d.a40e08"
      ]
    ]
  },
  {
    "id": "72cc887d.a40e08",
    "type": "subflow:20dffe5a.37e8a2",
    "z": "80866e71.966c6",
    "name": "",
    "env": [],
    "x": 600,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "4a92e6d0.45e428",
    "type": "alexa-home",
    "z": "80866e71.966c6",
    "conf": "3fa4c0fe.0f3ed",
    "device": "51127",
    "acknoledge": true,
    "name": "Office Light",
    "topic": "",
    "x": 130,
    "y": 340,
    "wires": [
      [
        "900ddb51.1745d8"
      ]
    ]
  },
  {
    "id": "900ddb51.1745d8",
    "type": "change",
    "z": "80866e71.966c6",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "light",
        "pt": "msg",
        "to": "light.office_light",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 370,
    "y": 340,
    "wires": [
      [
        "ac8f44ec.7398e8"
      ]
    ]
  },
  {
    "id": "ac8f44ec.7398e8",
    "type": "subflow:20dffe5a.37e8a2",
    "z": "80866e71.966c6",
    "name": "",
    "env": [],
    "x": 600,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "a9868bfd.76d548",
    "type": "mqtt out",
    "z": "a0a4859f.5a2a48",
    "name": "Scan For Who Arrive",
    "topic": "btmonitor/scan/ARRIVE",
    "qos": "0",
    "retain": "false",
    "broker": "1b6bc4ba.56ff4b",
    "x": 1440,
    "y": 140,
    "wires": []
  },
  {
    "id": "32097680.334d7a",
    "type": "inject",
    "z": "a3158433.9d1f78",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 780,
    "y": 340,
    "wires": [
      [
        "359bae70.db4ef2"
      ]
    ]
  },
  {
    "id": "7b59cea7.002ea",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1400,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "3b2fd0b9.9c301",
    "type": "mqtt out",
    "z": "cd950567.f864b8",
    "name": "Scan For Who Arrive",
    "topic": "btmonitor/scan/arrive",
    "qos": "2",
    "retain": "false",
    "broker": "1b6bc4ba.56ff4b",
    "x": 340,
    "y": 1060,
    "wires": []
  },
  {
    "id": "2102539f.96c77c",
    "type": "link in",
    "z": "cd950567.f864b8",
    "name": "Scan For Who Home",
    "links": [
      "cc2fcdb8.ee0ea"
    ],
    "x": 95,
    "y": 1060,
    "wires": [
      [
        "3b2fd0b9.9c301"
      ]
    ]
  },
  {
    "id": "b50a3ecc.fed35",
    "type": "comment",
    "z": "cd950567.f864b8",
    "name": "Font Door Open",
    "info": "",
    "x": 160,
    "y": 1000,
    "wires": []
  },
  {
    "id": "33963909.2f9fa6",
    "type": "inject",
    "z": "cd950567.f864b8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 1120,
    "wires": [
      [
        "3b2fd0b9.9c301"
      ]
    ]
  },
  {
    "id": "db85f591.e4bac8",
    "type": "mqtt out",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "dafang/cam3/play police.wav 100",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 460,
    "y": 520,
    "wires": []
  },
  {
    "id": "aa6958fe.5fd678",
    "type": "mqtt out",
    "z": "594d2dae.a157a4",
    "name": "",
    "topic": "",
    "qos": "",
    "retain": "",
    "broker": "1b6bc4ba.56ff4b",
    "x": 470,
    "y": 840,
    "wires": []
  },
  {
    "id": "c71d4ee7.723a9",
    "type": "inject",
    "z": "594d2dae.a157a4",
    "name": "motion  detection Off",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "dafang/cam3/motion/detection/set",
    "payload": "OFF",
    "payloadType": "str",
    "x": 210,
    "y": 800,
    "wires": [
      [
        "aa6958fe.5fd678"
      ]
    ]
  },
  {
    "id": "2f13031b.3d6b2c",
    "type": "inject",
    "z": "594d2dae.a157a4",
    "name": "motion  detection On",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "dafang/cam3/motion/detection/set",
    "payload": "ON",
    "payloadType": "str",
    "x": 210,
    "y": 860,
    "wires": [
      [
        "aa6958fe.5fd678"
      ]
    ]
  },
  {
    "id": "c1452f39.40dd",
    "type": "inject",
    "z": "594d2dae.a157a4",
    "name": "IR Cut detection Off",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "dafang/cam3/ir_cut/set",
    "payload": "OFF",
    "payloadType": "str",
    "x": 210,
    "y": 920,
    "wires": [
      [
        "aa6958fe.5fd678"
      ]
    ]
  },
  {
    "id": "da6b595d.ccc1d8",
    "type": "inject",
    "z": "594d2dae.a157a4",
    "name": "IR Cut ON",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "dafang/cam3/ir_cut/set",
    "payload": "ON",
    "payloadType": "str",
    "x": 180,
    "y": 980,
    "wires": [
      [
        "aa6958fe.5fd678"
      ]
    ]
  },
  {
    "id": "7731c355.37caec",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Back Door Open / Close",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "binary_sensor.back_door_sensor",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 190,
    "y": 1240,
    "wires": [
      [
        "92c23e69.85056"
      ]
    ]
  },
  {
    "id": "92c23e69.85056",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Back Door",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Back Door",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "trusted",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 1240,
    "wires": [
      [
        "64a723bb.a421cc",
        "f4e9b89.fd1c548"
      ]
    ]
  },
  {
    "id": "dcdab32e.51851",
    "type": "api-call-service",
    "z": "d1172b8b.3d3298",
    "name": "Hallway Light On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.hallway_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 990,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "9f0fb26a.fe3a3",
    "type": "trigger",
    "z": "d1172b8b.3d3298",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "2",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 970,
    "y": 320,
    "wires": [
      [
        "43cd373b.972e08"
      ]
    ]
  },
  {
    "id": "43cd373b.972e08",
    "type": "api-call-service",
    "z": "d1172b8b.3d3298",
    "name": "Hallway Light OFF",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.hallway_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1210,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "e947642c.3c9798",
    "type": "link in",
    "z": "d1172b8b.3d3298",
    "name": "Keep Light on",
    "links": [
      "cc2fcdb8.ee0ea",
      "e04902ac.5849e"
    ],
    "x": 295,
    "y": 300,
    "wires": [
      [
        "c0bc4544.925ba8"
      ]
    ]
  },
  {
    "id": "c0bc4544.925ba8",
    "type": "change",
    "z": "d1172b8b.3d3298",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 740,
    "y": 300,
    "wires": [
      [
        "9f0fb26a.fe3a3"
      ]
    ]
  },
  {
    "id": "cc4f4512.fa9de8",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Office Motion",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "binary_sensor.office_motion",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 150,
    "y": 1280,
    "wires": [
      [
        "c27c19ab.52cbf8",
        "8c42e0e.e62702"
      ]
    ]
  },
  {
    "id": "c27c19ab.52cbf8",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Office Motion",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Office Motion",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "trusted",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 1280,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "8c42e0e.e62702",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Office Motion Detected",
    "links": [
      "688dc601.8b0c68",
      "8f80ab0d.e271b8",
      "b46a8ce3.5b6ed",
      "c215726b.e66d5",
      "79d508d7.4f2b68",
      "dfd9170e.807548",
      "23f2e7cd.7ad698",
      "b6655c35.3097a"
    ],
    "x": 395,
    "y": 1320,
    "wires": []
  },
  {
    "id": "89d441eb.91883",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Barthroom Window Changed",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "binary_sensor.bathroom_window",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 200,
    "y": 540,
    "wires": [
      [
        "67a90e6f.5920c",
        "7ccd5774.a912e8"
      ]
    ]
  },
  {
    "id": "67a90e6f.5920c",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Barthroom Window",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Barthroom Window",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 470,
    "y": 540,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "6ff4d6e.b277128",
    "type": "api-render-template",
    "z": "a3158433.9d1f78",
    "name": "Windows / Door Status",
    "server": "5ee4d578.f7736c",
    "template": "Font Door: {% if is_state('binary_sensor.font_door', 'off') %}Closed{% elif  is_state('binary_sensor.font_door', 'on') %}Open{% else %}Unknown{% endif %}\nBack Boor: {% if is_state('binary_sensor.back_door_sensor', 'off') %}Closed{% elif  is_state('binary_sensor.back_door_sensor', 'on') %}Open{% else %}Unknown{% endif %}\n\nBedroom Window: {% if is_state('binary_sensor.bedroom_window', 'off') %}Closed{% elif  is_state('binary_sensor.bedroom_window', 'on') %}Open{% else %}Unknown{% endif %}\nBathroom Window: {% if is_state('binary_sensor.bathroom_window', 'off') %}Closed{% elif  is_state('binary_sensor.bathroom_window', 'on') %}Open{% else %}Unknown{% endif %}",
    "resultsLocation": "payload",
    "resultsLocationType": "msg",
    "templateLocation": "",
    "templateLocationType": "none",
    "x": 1160,
    "y": 1300,
    "wires": [
      [
        "4f164db.e136eb4",
        "42db4fb.3baa2b"
      ]
    ]
  },
  {
    "id": "8cf03270.db05c",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a3158433.9d1f78",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      }
    ],
    "x": 1580,
    "y": 1300,
    "wires": []
  },
  {
    "id": "42db4fb.3baa2b",
    "type": "debug",
    "z": "a3158433.9d1f78",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1510,
    "y": 1400,
    "wires": []
  },
  {
    "id": "4f164db.e136eb4",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "Data",
    "rules": [
      {
        "t": "move",
        "p": "payload",
        "pt": "msg",
        "to": "payload.data.message",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1350,
    "y": 1300,
    "wires": [
      [
        "42db4fb.3baa2b",
        "8cf03270.db05c"
      ]
    ]
  },
  {
    "id": "865e9283.e79ab",
    "type": "debug",
    "z": "a83e69e1.4b2ab8",
    "name": "Send Message",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 670,
    "y": 120,
    "wires": []
  },
  {
    "id": "27136334.733a9c",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "5625076e.ee59e8",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      }
    ],
    "x": 520,
    "y": 1120,
    "wires": []
  },
  {
    "id": "1af05f2c.119c11",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 1100,
    "wires": [
      [
        "d6f373d6.49af"
      ]
    ]
  },
  {
    "id": "d6f373d6.49af",
    "type": "change",
    "z": "5625076e.ee59e8",
    "name": "Data",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.message",
        "pt": "msg",
        "to": "Hello",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 350,
    "y": 1100,
    "wires": [
      [
        "27136334.733a9c"
      ]
    ]
  },
  {
    "id": "2df22b9c.bebe64",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1480,
    "y": 4220,
    "wires": [
      []
    ]
  },
  {
    "id": "ef41719.8fded9",
    "type": "inject",
    "z": "1f9e3480.5be75c",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1360,
    "y": 80,
    "wires": [
      [
        "1867d849.6636c8"
      ]
    ]
  },
  {
    "id": "1867d849.6636c8",
    "type": "api-render-template",
    "z": "1f9e3480.5be75c",
    "name": "Bath room weather",
    "server": "5ee4d578.f7736c",
    "template": "Right now its {% if not is_state('sensor.bath_room_temperature', 'unknown') %}{{ states('sensor.bath_room_temperature') | round(2)}} degrees {% elif not is_state('sensor.bath_room_temperature', 'unknown') %}{{ states('sensor.bathroom_sensor_temperature') | round(2)}} degrees{% else %}{% endif %}{% if not is_state('sensor.bath_room_humidity', 'unknown') %}with humidity of {{ states('sensor.bath_room_humidity' | round(0) ) }} percent {% endif %} inside.\nOutside its {{ state_attr('weather.dark_sky','temperature')  | round(2)}} degrees with humidity of {{ state_attr('weather.dark_sky','humidity') }} percent",
    "resultsLocation": "say",
    "resultsLocationType": "msg",
    "templateLocation": "",
    "templateLocationType": "msg",
    "x": 1570,
    "y": 80,
    "wires": [
      [
        "6174bbc0.9b3a04"
      ]
    ]
  },
  {
    "id": "b2abfa88.4a6958",
    "type": "subflow:47bc2d66.1132e4",
    "z": "1f9e3480.5be75c",
    "name": "",
    "env": [],
    "x": 1910,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "6174bbc0.9b3a04",
    "type": "change",
    "z": "1f9e3480.5be75c",
    "name": "Bath Room Alexa",
    "rules": [
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "bath",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1810,
    "y": 80,
    "wires": [
      [
        "b2abfa88.4a6958"
      ]
    ]
  },
  {
    "id": "7447c294.cedd9c",
    "type": "change",
    "z": "47bc2d66.1132e4",
    "name": "Bath",
    "rules": [
      {
        "t": "set",
        "p": "pri_alexa",
        "pt": "msg",
        "to": "[\"media_player.barthroom_2\"]",
        "tot": "json"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 340,
    "wires": [
      [
        "c5f11237.56983"
      ]
    ]
  },
  {
    "id": "7d892064.7f7aa",
    "type": "api-render-template",
    "z": "a0cdc0f9.a362b",
    "name": "Bath room weather",
    "server": "5ee4d578.f7736c",
    "template": "Right now its {% if not is_state('sensor.bath_room_temperature', 'unknown') %}{{ states('sensor.bath_room_temperature') | round(2)}} degrees {% elif not is_state('sensor.bath_room_temperature', 'unknown') %}{{ states('sensor.bathroom_sensor_temperature') | round(2)}} degrees{% else %}{% endif %}{% if not is_state('sensor.bath_room_humidity', 'unknown') %}with humidity of {{ states('sensor.bath_room_humidity' | round(0) ) }} percent {% endif %} inside.\nOutside its {{ state_attr('weather.dark_sky','temperature')  | round(2)}} degrees with humidity of {{ state_attr('weather.dark_sky','humidity') }} percent",
    "resultsLocation": "say",
    "resultsLocationType": "msg",
    "templateLocation": "",
    "templateLocationType": "msg",
    "x": 250,
    "y": 1700,
    "wires": [
      [
        "34f42aaf.90d7b6"
      ]
    ]
  },
  {
    "id": "1e1fdef1.99f061",
    "type": "subflow:47bc2d66.1132e4",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "env": [],
    "x": 750,
    "y": 1700,
    "wires": [
      []
    ]
  },
  {
    "id": "34f42aaf.90d7b6",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Room Alexa",
    "rules": [
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "bath",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 490,
    "y": 1700,
    "wires": [
      [
        "1e1fdef1.99f061"
      ]
    ]
  },
  {
    "id": "a4a986e.5cee778",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Room - Action Open",
    "links": [
      "b4657f46.153e"
    ],
    "x": 115,
    "y": 1700,
    "wires": [
      [
        "7d892064.7f7aa"
      ]
    ]
  },
  {
    "id": "7ccd5774.a912e8",
    "type": "switch",
    "z": "a068bd5.28a8d4",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 450,
    "y": 500,
    "wires": [
      [
        "b4657f46.153e"
      ]
    ]
  },
  {
    "id": "b4657f46.153e",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "",
    "links": [
      "a4a986e.5cee778"
    ],
    "x": 580,
    "y": 500,
    "wires": []
  },
  {
    "id": "90aab28.477495",
    "type": "catch",
    "z": "6d7fc63f.5adbe8",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "8022b999.df8938"
      ]
    ]
  },
  {
    "id": "8022b999.df8938",
    "type": "subflow:f5eab19a.7cf17",
    "z": "6d7fc63f.5adbe8",
    "name": "",
    "x": 330,
    "y": 80,
    "wires": []
  },
  {
    "id": "7ff829ee.210798",
    "type": "comment",
    "z": "6d7fc63f.5adbe8",
    "name": "Error Handler",
    "info": "",
    "x": 110,
    "y": 40,
    "wires": []
  },
  {
    "id": "63b26139.6d6b1",
    "type": "comment",
    "z": "6d7fc63f.5adbe8",
    "name": "Disable this tab when tree is down",
    "info": "",
    "x": 180,
    "y": 140,
    "wires": []
  },
  {
    "id": "26e6b9d.261cc46",
    "type": "api-call-service",
    "z": "6d7fc63f.5adbe8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_02",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 430,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "9b45968c.c07618",
    "type": "api-call-service",
    "z": "6d7fc63f.5adbe8",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_02",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 430,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "7ffb929a.4515ec",
    "type": "trigger-state",
    "z": "6d7fc63f.5adbe8",
    "name": "Lamp On",
    "server": "5ee4d578.f7736c",
    "entityid": "light.bed_room_lamp",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "7jadbz2mrxn",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "z2kb7nj23b",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 180,
    "y": 220,
    "wires": [
      [
        "26e6b9d.261cc46"
      ],
      []
    ]
  },
  {
    "id": "941433cb.845cc",
    "type": "trigger-state",
    "z": "6d7fc63f.5adbe8",
    "name": "Lamp Off",
    "server": "5ee4d578.f7736c",
    "entityid": "light.bed_room_lamp",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "cz2wjoyqmtp",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      },
      {
        "id": "d36c1rfkas",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 180,
    "y": 280,
    "wires": [
      [
        "9b45968c.c07618"
      ],
      []
    ]
  },
  {
    "id": "3c8bb36d.6841fc",
    "type": "trigger",
    "z": "acf12371.2c1ae",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "payl",
    "duration": "5",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 930,
    "y": 660,
    "wires": [
      [
        "bc54c26f.5a203"
      ]
    ]
  },
  {
    "id": "bc54c26f.5a203",
    "type": "api-call-service",
    "z": "acf12371.2c1ae",
    "name": "Turn off office Light",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.office_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1370,
    "y": 800,
    "wires": [
      []
    ]
  },
  {
    "id": "bca5faad.bb2738",
    "type": "trigger-state",
    "z": "acf12371.2c1ae",
    "name": "Light Strips On",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "light.hue_lightstrip_plus_1_2",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "qhecvyt3517",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 320,
    "y": 800,
    "wires": [
      [
        "e8a55e90.6643a"
      ],
      []
    ]
  },
  {
    "id": "e8a55e90.6643a",
    "type": "change",
    "z": "acf12371.2c1ae",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 650,
    "y": 800,
    "wires": [
      [
        "3c8bb36d.6841fc",
        "bc54c26f.5a203",
        "8ba694b1.ff3688"
      ]
    ]
  },
  {
    "id": "25dc764e.1ed99a",
    "type": "api-call-service",
    "z": "cd950567.f864b8",
    "name": "Hallway Light On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.hallway_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 670,
    "y": 1300,
    "wires": [
      []
    ]
  },
  {
    "id": "78bb52c2.40ffac",
    "type": "api-call-service",
    "z": "cd950567.f864b8",
    "name": "Living Room Lamp",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bed_room_lamp",
    "data": "{\"brightness_pct\":\"100\",\"transition\":\"2\",\"color_temp\":\"413\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 870,
    "y": 1360,
    "wires": [
      [
        "c22eea3.7fa6118"
      ]
    ]
  },
  {
    "id": "c22eea3.7fa6118",
    "type": "trigger",
    "z": "cd950567.f864b8",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "8",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1090,
    "y": 1440,
    "wires": [
      [
        "2d0e3d99.12fbd2"
      ]
    ]
  },
  {
    "id": "94c969c1.0d1668",
    "type": "switch",
    "z": "cd950567.f864b8",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 190,
    "y": 1480,
    "wires": [
      [
        "75e721da.a3eeb"
      ]
    ]
  },
  {
    "id": "75e721da.a3eeb",
    "type": "change",
    "z": "cd950567.f864b8",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 400,
    "y": 1480,
    "wires": [
      [
        "c22eea3.7fa6118"
      ]
    ]
  },
  {
    "id": "2d0e3d99.12fbd2",
    "type": "api-call-service",
    "z": "cd950567.f864b8",
    "name": "Turn Off Light",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.bed_room_lamp, light.hallway_light",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1300,
    "y": 1440,
    "wires": [
      []
    ]
  },
  {
    "id": "dfd9170e.807548",
    "type": "link in",
    "z": "cd950567.f864b8",
    "name": "",
    "links": [
      "224d137d.2e20dc",
      "3495a219.f840be",
      "f8efe1fe.a4a0e",
      "8c42e0e.e62702",
      "64fb3f92.803b6"
    ],
    "x": 75,
    "y": 1480,
    "wires": [
      [
        "94c969c1.0d1668"
      ]
    ]
  },
  {
    "id": "354de190.00169e",
    "type": "subflow:56368b94.f11494",
    "z": "cd950567.f864b8",
    "name": "",
    "x": 420,
    "y": 1340,
    "wires": [
      [
        "25dc764e.1ed99a",
        "3e4eb988.7e47c6"
      ],
      [],
      [
        "25dc764e.1ed99a",
        "3e4eb988.7e47c6"
      ]
    ]
  },
  {
    "id": "62e65b11.82cb44",
    "type": "link in",
    "z": "cd950567.f864b8",
    "name": "Welcome Light",
    "links": [
      "528c1fad.a8b2",
      "634ad6f8.7dd188",
      "cc2fcdb8.ee0ea",
      "f48b357d.debff8"
    ],
    "x": 75,
    "y": 1320,
    "wires": [
      [
        "354de190.00169e"
      ]
    ]
  },
  {
    "id": "523c240b.dd2e8c",
    "type": "comment",
    "z": "cd950567.f864b8",
    "name": "MOtion Detected",
    "info": "",
    "x": 140,
    "y": 1440,
    "wires": []
  },
  {
    "id": "480996f2.5fd988",
    "type": "comment",
    "z": "cd950567.f864b8",
    "name": "Someone Just Got Home",
    "info": "",
    "x": 170,
    "y": 1280,
    "wires": []
  },
  {
    "id": "a3887573.d80c88",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "cd950567.f864b8",
    "name": "",
    "env": [],
    "x": 220,
    "y": 1380,
    "wires": [
      [],
      [
        "354de190.00169e"
      ]
    ]
  },
  {
    "id": "5e18f96b.d4c508",
    "type": "link in",
    "z": "cd950567.f864b8",
    "name": "",
    "links": [],
    "x": 75,
    "y": 1380,
    "wires": [
      [
        "a3887573.d80c88"
      ]
    ]
  },
  {
    "id": "3e4eb988.7e47c6",
    "type": "api-current-state",
    "z": "cd950567.f864b8",
    "name": "Lamp On?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bed_room_lamp",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 650,
    "y": 1360,
    "wires": [
      [
        "78bb52c2.40ffac"
      ],
      []
    ]
  },
  {
    "id": "b5b2df58.a53ce",
    "type": "inject",
    "z": "594d2dae.a157a4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 160,
    "y": 720,
    "wires": [
      [
        "6840cc4.f044734"
      ]
    ]
  },
  {
    "id": "b866ead0.013798",
    "type": "debug",
    "z": "3b25c31e.848f5c",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 910,
    "y": 100,
    "wires": []
  },
  {
    "id": "452803e9.c2df6c",
    "type": "debug",
    "z": "a3158433.9d1f78",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 2190,
    "y": 500,
    "wires": []
  },
  {
    "id": "eed11822.6bddf8",
    "type": "debug",
    "z": "a3158433.9d1f78",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 2850,
    "y": 420,
    "wires": []
  },
  {
    "id": "da51fb26.c7d168",
    "type": "debug",
    "z": "a3158433.9d1f78",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 2850,
    "y": 660,
    "wires": []
  },
  {
    "id": "379963b.1349f9c",
    "type": "debug",
    "z": "a3158433.9d1f78",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 2430,
    "y": 500,
    "wires": []
  },
  {
    "id": "234642c4.349f8e",
    "type": "debug",
    "z": "a3158433.9d1f78",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 2670,
    "y": 480,
    "wires": []
  },
  {
    "id": "4d9f4167.b65e1",
    "type": "trigger",
    "z": "a3158433.9d1f78",
    "name": "Give Life life 360 time to update",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "8",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 850,
    "y": 1040,
    "wires": [
      [
        "88477cf4.2a868"
      ]
    ]
  },
  {
    "id": "88477cf4.2a868",
    "type": "change",
    "z": "a3158433.9d1f78",
    "name": "Deactive - DisarmDelayOver",
    "rules": [
      {
        "t": "set",
        "p": "DisarmDelayOver",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1160,
    "y": 1040,
    "wires": [
      []
    ]
  },
  {
    "id": "5c544d33.3a39a4",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "On bathroom window open",
    "info": "",
    "x": 210,
    "y": 1640,
    "wires": []
  },
  {
    "id": "e3c4a1b8.376ce",
    "type": "server-events",
    "z": "c9dd75c4.1c8078",
    "name": "",
    "server": "5ee4d578.f7736c",
    "event_type": "deconz_event",
    "x": 160,
    "y": 240,
    "wires": [
      [
        "db08627.613d5a",
        "3ab04050.a044e"
      ]
    ]
  },
  {
    "id": "db08627.613d5a",
    "type": "debug",
    "z": "c9dd75c4.1c8078",
    "name": "deconz_event",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 540,
    "y": 180,
    "wires": []
  },
  {
    "id": "3ab04050.a044e",
    "type": "switch",
    "z": "c9dd75c4.1c8078",
    "name": "Device",
    "property": "payload.event.unique_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "00:15:8d:00:03:56:00:10",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "68:0a:e2:ff:fe:15:0b:85",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "08:6b:d7:ff:fe:21:b8:01",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "68:0a:e2:ff:fe:40:f9:39",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "68:0a:e2:ff:fe:31:6e:f7",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 6,
    "x": 450,
    "y": 400,
    "wires": [
      [
        "d1d7d64a.b61628"
      ],
      [
        "14cd568d.4da619"
      ],
      [
        "c1702ccd.2b40e"
      ],
      [
        "4ef5ed7b.a9b064"
      ],
      [
        "3941e7f5.bb97d8"
      ],
      [
        "999a04a0.47c7f8"
      ]
    ]
  },
  {
    "id": "c8500ed0.7f702",
    "type": "switch",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "property": "payload.event.event",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1002",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "2002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "1004",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2004",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "1001",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2001",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 6,
    "x": 250,
    "y": 2300,
    "wires": [
      [
        "310aca31.ef9286"
      ],
      [
        "fbae79cc.1d1698"
      ],
      [
        "5b63f119.6f159"
      ],
      [
        "58d011f0.e2c29"
      ],
      [
        "a2b61f42.6946a"
      ],
      [
        "76e2ed19.925a74"
      ]
    ]
  },
  {
    "id": "310aca31.ef9286",
    "type": "function",
    "z": "a0cdc0f9.a362b",
    "name": "Left Single Press",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 490,
    "y": 2100,
    "wires": [
      [
        "8840b403.486f28"
      ]
    ]
  },
  {
    "id": "fbae79cc.1d1698",
    "type": "function",
    "z": "a0cdc0f9.a362b",
    "name": "Right Single Press",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 490,
    "y": 2260,
    "wires": [
      [
        "17d570c1.49dd9f"
      ]
    ]
  },
  {
    "id": "5b63f119.6f159",
    "type": "function",
    "z": "a0cdc0f9.a362b",
    "name": "Left Double Press",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 490,
    "y": 2340,
    "wires": [
      [
        "39937e5c.81db92"
      ]
    ]
  },
  {
    "id": "58d011f0.e2c29",
    "type": "function",
    "z": "a0cdc0f9.a362b",
    "name": "Right Double Press",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 470,
    "y": 2460,
    "wires": [
      []
    ]
  },
  {
    "id": "a2b61f42.6946a",
    "type": "function",
    "z": "a0cdc0f9.a362b",
    "name": "Left Long Press",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 460,
    "y": 2500,
    "wires": [
      []
    ]
  },
  {
    "id": "76e2ed19.925a74",
    "type": "function",
    "z": "a0cdc0f9.a362b",
    "name": "Right Long Press",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 470,
    "y": 2540,
    "wires": [
      []
    ]
  },
  {
    "id": "20f09be3.f8d294",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Button press ",
    "info": "",
    "x": 170,
    "y": 2140,
    "wires": []
  },
  {
    "id": "257bd400.1aeb5c",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Button Press Handler",
    "links": [
      "26dce11c.ceccee",
      "2d674a1d.f70ff6"
    ],
    "x": 135,
    "y": 2300,
    "wires": [
      [
        "c8500ed0.7f702"
      ]
    ]
  },
  {
    "id": "25e1519d.7029be",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Toogle Bath Room Light",
    "links": [],
    "x": 655,
    "y": 2120,
    "wires": [
      [
        "8840b403.486f28"
      ]
    ]
  },
  {
    "id": "8840b403.486f28",
    "type": "api-current-state",
    "z": "a0cdc0f9.a362b",
    "name": "Light off?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bathroom",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 800,
    "y": 2100,
    "wires": [
      [
        "5d1f606c.02ec9"
      ],
      [
        "5a9f8802.36d3e8"
      ]
    ]
  },
  {
    "id": "a0a6cacc.e13778",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Light On",
    "links": [
      "5d1f606c.02ec9",
      "4675f80a.f6fb08"
    ],
    "x": 1595,
    "y": 280,
    "wires": [
      [
        "78facd5e.ed58b4"
      ]
    ]
  },
  {
    "id": "ddf64a1a.855ea8",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Light Off",
    "links": [
      "5a9f8802.36d3e8",
      "69e3038b.68b6fc"
    ],
    "x": 1835,
    "y": 520,
    "wires": [
      [
        "63f156bc.aed608"
      ]
    ]
  },
  {
    "id": "5d1f606c.02ec9",
    "type": "link out",
    "z": "a0cdc0f9.a362b",
    "name": "Toggle - Light On Request",
    "links": [
      "a0a6cacc.e13778",
      "ef383b90.090248",
      "3d590ec8.987a72"
    ],
    "x": 935,
    "y": 2080,
    "wires": []
  },
  {
    "id": "5a9f8802.36d3e8",
    "type": "link out",
    "z": "a0cdc0f9.a362b",
    "name": "Toggle Light Off Request",
    "links": [
      "b007b2cb.40bac",
      "ddf64a1a.855ea8"
    ],
    "x": 935,
    "y": 2120,
    "wires": []
  },
  {
    "id": "b007b2cb.40bac",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Clear Timier",
    "links": [
      "4675f80a.f6fb08",
      "5a9f8802.36d3e8"
    ],
    "x": 555,
    "y": 580,
    "wires": [
      [
        "c6d28a61.3da988"
      ]
    ]
  },
  {
    "id": "700de82a.ec9898",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Toggle Light",
    "info": "",
    "x": 710,
    "y": 2040,
    "wires": []
  },
  {
    "id": "c07466f9.0747e8",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Time",
    "info": "",
    "x": 700,
    "y": 2220,
    "wires": []
  },
  {
    "id": "ef383b90.090248",
    "type": "link in",
    "z": "a0cdc0f9.a362b",
    "name": "Trigger Count Down",
    "links": [
      "5d1f606c.02ec9",
      "6122d212.c9789c"
    ],
    "x": 935,
    "y": 500,
    "wires": [
      [
        "bc7a046f.08cac8",
        "95a4dd4.cece52"
      ]
    ]
  },
  {
    "id": "17d570c1.49dd9f",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Turn On Bath time",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "toggle",
    "entityId": "input_boolean.bathtime",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 730,
    "y": 2260,
    "wires": [
      []
    ]
  },
  {
    "id": "4675f80a.f6fb08",
    "type": "link out",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Time",
    "links": [
      "a0a6cacc.e13778",
      "b007b2cb.40bac"
    ],
    "x": 555,
    "y": 1020,
    "wires": []
  },
  {
    "id": "bc9f775b.fbe888",
    "type": "subflow:47bc2d66.1132e4",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "env": [],
    "x": 1010,
    "y": 1180,
    "wires": [
      []
    ]
  },
  {
    "id": "66750501.150e8c",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Room Alexa",
    "rules": [
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "bath",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Bath time activated, light will stay on for 40 minutes. enjoy your bath",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 1160,
    "wires": [
      [
        "bc9f775b.fbe888"
      ]
    ]
  },
  {
    "id": "35cf05cc.088eaa",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Room Alexa",
    "rules": [
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "bath",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "Bath time deactivated",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 1200,
    "wires": [
      [
        "bc9f775b.fbe888"
      ]
    ]
  },
  {
    "id": "39937e5c.81db92",
    "type": "link out",
    "z": "a0cdc0f9.a362b",
    "name": "Shower Time Request",
    "links": [
      "8fa41eed.e0746"
    ],
    "x": 795,
    "y": 2340,
    "wires": []
  },
  {
    "id": "4e453e2c.79f42",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Shower Time",
    "info": "",
    "x": 710,
    "y": 2309,
    "wires": []
  },
  {
    "id": "1ba3252.4c458db",
    "type": "link out",
    "z": "a0cdc0f9.a362b",
    "name": "Shower Time Triggered",
    "links": [
      "5a8e5309.e00ddc"
    ],
    "x": 255,
    "y": 1480,
    "wires": []
  },
  {
    "id": "53f58fe.617107",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "bathTime.AutoOff",
    "rules": [
      {
        "t": "set",
        "p": "bathTime.AutoOff",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 820,
    "wires": [
      [
        "52c7bf3f.bee33"
      ]
    ]
  },
  {
    "id": "762ebe4.e14ea4",
    "type": "switch",
    "z": "a0cdc0f9.a362b",
    "name": "AutoOff",
    "property": "bathTime.AutoOff",
    "propertyType": "global",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 580,
    "y": 1080,
    "wires": [
      [
        "515b672b.f284f8"
      ],
      [
        "9d078a72.d4b5a8",
        "35cf05cc.088eaa",
        "8b85e6e3.f5e478"
      ]
    ]
  },
  {
    "id": "515b672b.f284f8",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "bathTime.AutoOff",
    "rules": [
      {
        "t": "set",
        "p": "bathTime.AutoOff",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 1040,
    "wires": [
      []
    ]
  },
  {
    "id": "35eae1b3.ccafbe",
    "type": "comment",
    "z": "9a341993.fbc528",
    "name": "Drive Status from Power",
    "info": "",
    "x": 210,
    "y": 860,
    "wires": []
  },
  {
    "id": "bf1e8f5e.13d05",
    "type": "server-state-changed",
    "z": "6e74caff.7ad1f4",
    "name": "Power Change",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "entityidfilter": "sensor.plug_09_energy_power",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "x": 140,
    "y": 2220,
    "wires": [
      [
        "b91ec71b.de1508"
      ]
    ]
  },
  {
    "id": "2b752590.0edd6a",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 450,
    "y": 2220,
    "wires": [
      [
        "c4292ac5.6b9648"
      ],
      [
        "cb10ed6c.836b4",
        "e2e37ddb.d2983"
      ]
    ]
  },
  {
    "id": "b91ec71b.de1508",
    "type": "rbe",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 310,
    "y": 2220,
    "wires": [
      [
        "2b752590.0edd6a"
      ]
    ]
  },
  {
    "id": "c4292ac5.6b9648",
    "type": "trigger",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "25",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 830,
    "y": 2160,
    "wires": [
      [
        "e2e37ddb.d2983"
      ]
    ]
  },
  {
    "id": "cb10ed6c.836b4",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 620,
    "y": 2140,
    "wires": [
      [
        "c4292ac5.6b9648"
      ]
    ]
  },
  {
    "id": "e2e37ddb.d2983",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "Status",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1",
        "vt": "num"
      },
      {
        "t": "gt",
        "v": "1",
        "vt": "num"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 2,
    "x": 870,
    "y": 2240,
    "wires": [
      [
        "e5ac570e.22d648"
      ],
      [
        "bf75942f.91c238"
      ]
    ]
  },
  {
    "id": "16d8d201.0473ce",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "Washer Drive Status from Power",
    "info": "",
    "x": 190,
    "y": 2120,
    "wires": []
  },
  {
    "id": "118fa0d5.385e1f",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Washer done",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "the washing machine has finished",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "down",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1550,
    "y": 2220,
    "wires": [
      [
        "312b9bb5.feabc4"
      ]
    ]
  },
  {
    "id": "312b9bb5.feabc4",
    "type": "subflow:47bc2d66.1132e4",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "env": [],
    "x": 1890,
    "y": 2200,
    "wires": [
      []
    ]
  },
  {
    "id": "4a770ad6.5bccc4",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Washer Started",
    "rules": [
      {
        "t": "set",
        "p": "say",
        "pt": "msg",
        "to": "washer machine has started",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "alexa",
        "pt": "msg",
        "to": "Kitchen",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1560,
    "y": 2260,
    "wires": [
      [
        "312b9bb5.feabc4"
      ]
    ]
  },
  {
    "id": "1fc7be16.10f152",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "Washer Started",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 1560,
    "y": 2300,
    "wires": []
  },
  {
    "id": "c2955882.59bb98",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "Washer Finished",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 1560,
    "y": 2180,
    "wires": []
  },
  {
    "id": "e5ac570e.22d648",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Done",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Done",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1010,
    "y": 2220,
    "wires": [
      [
        "efe1be6f.d6185"
      ]
    ]
  },
  {
    "id": "bf75942f.91c238",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Running",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "Running",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1020,
    "y": 2260,
    "wires": [
      [
        "efe1be6f.d6185"
      ]
    ]
  },
  {
    "id": "efe1be6f.d6185",
    "type": "rbe",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "func": "rbei",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 1170,
    "y": 2240,
    "wires": [
      [
        "3d3030f0.75c41"
      ]
    ]
  },
  {
    "id": "3d3030f0.75c41",
    "type": "switch",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "Done",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "Running",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1310,
    "y": 2240,
    "wires": [
      [
        "118fa0d5.385e1f",
        "c2955882.59bb98"
      ],
      [
        "4a770ad6.5bccc4",
        "1fc7be16.10f152"
      ]
    ]
  },
  {
    "id": "eb6dc825.428168",
    "type": "catch",
    "z": "c9dd75c4.1c8078",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 140,
    "y": 80,
    "wires": [
      [
        "4524867b.b67518"
      ]
    ]
  },
  {
    "id": "4524867b.b67518",
    "type": "subflow:f5eab19a.7cf17",
    "z": "c9dd75c4.1c8078",
    "name": "",
    "x": 350,
    "y": 80,
    "wires": []
  },
  {
    "id": "9a4ee868.759318",
    "type": "comment",
    "z": "c9dd75c4.1c8078",
    "name": "Error Handler",
    "info": "",
    "x": 130,
    "y": 40,
    "wires": []
  },
  {
    "id": "573a9269.82f1bc",
    "type": "catch",
    "z": "ea5aca0.33b1a38",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 120,
    "y": 80,
    "wires": [
      [
        "4d2d40f4.43d7c"
      ]
    ]
  },
  {
    "id": "4d2d40f4.43d7c",
    "type": "subflow:f5eab19a.7cf17",
    "z": "ea5aca0.33b1a38",
    "name": "",
    "x": 330,
    "y": 80,
    "wires": []
  },
  {
    "id": "fc3343cc.4d055",
    "type": "comment",
    "z": "ea5aca0.33b1a38",
    "name": "Error Handler",
    "info": "",
    "x": 110,
    "y": 40,
    "wires": []
  },
  {
    "id": "d3ab0ec5.96ff8",
    "type": "trigger-state",
    "z": "ea5aca0.33b1a38",
    "name": "",
    "server": "5ee4d578.f7736c",
    "entityid": "sensor.bincollectionistomorrow",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "pvivnzb1anq",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 210,
    "y": 280,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "2f8a6246.a3fb7e",
    "type": "inject",
    "z": "ea5aca0.33b1a38",
    "name": "11:30",
    "repeat": "",
    "crontab": "30 11 * * *",
    "once": false,
    "onceDelay": "15",
    "topic": "",
    "payload": "true",
    "payloadType": "bool",
    "x": 130,
    "y": 420,
    "wires": [
      [
        "55f61cc.83cf8e4"
      ]
    ]
  },
  {
    "id": "55f61cc.83cf8e4",
    "type": "api-current-state",
    "z": "ea5aca0.33b1a38",
    "name": "Bin Day Tomorrow",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.bincollectionistomorrow",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 330,
    "y": 420,
    "wires": [
      [
        "373da54a.7d9baa"
      ],
      []
    ]
  },
  {
    "id": "373da54a.7d9baa",
    "type": "api-current-state",
    "z": "ea5aca0.33b1a38",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.nextbincollection",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "",
    "override_data": "none",
    "blockInputOverrides": true,
    "x": 650,
    "y": 420,
    "wires": [
      [
        "bdcd9b69.25d2b8"
      ]
    ]
  },
  {
    "id": "bdcd9b69.25d2b8",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "ea5aca0.33b1a38",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD_MSG",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 960,
    "y": 420,
    "wires": []
  },
  {
    "id": "e41dca06.50b638",
    "type": "comment",
    "z": "a83e69e1.4b2ab8",
    "name": "message == \"PAYLOAD_MSG\" - msg.payload",
    "info": "",
    "x": 570,
    "y": 60,
    "wires": []
  },
  {
    "id": "80805cef.7019f",
    "type": "comment",
    "z": "ea5aca0.33b1a38",
    "name": "Reminder about bin day",
    "info": "",
    "x": 160,
    "y": 380,
    "wires": []
  },
  {
    "id": "afeb14c0.5fa1d8",
    "type": "inject",
    "z": "ea5aca0.33b1a38",
    "name": "18:30",
    "repeat": "",
    "crontab": "30 18 * * *",
    "once": false,
    "onceDelay": "15",
    "topic": "",
    "payload": "true",
    "payloadType": "bool",
    "x": 130,
    "y": 560,
    "wires": [
      [
        "38a6cc97.0bcdc4"
      ]
    ]
  },
  {
    "id": "38a6cc97.0bcdc4",
    "type": "api-current-state",
    "z": "ea5aca0.33b1a38",
    "name": "Bin Day Tomorrow",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.bincollectionistomorrow",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 330,
    "y": 560,
    "wires": [
      [
        "6ef489f4.033f88"
      ],
      []
    ]
  },
  {
    "id": "6ef489f4.033f88",
    "type": "api-current-state",
    "z": "ea5aca0.33b1a38",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.nextbincollection",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "",
    "override_data": "none",
    "blockInputOverrides": true,
    "x": 650,
    "y": 560,
    "wires": [
      [
        "3774cac3.15d456"
      ]
    ]
  },
  {
    "id": "3774cac3.15d456",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "ea5aca0.33b1a38",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD_MSG",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 960,
    "y": 560,
    "wires": []
  },
  {
    "id": "dd6c3709.fb45a8",
    "type": "comment",
    "z": "ea5aca0.33b1a38",
    "name": "Reminder about bin day",
    "info": "",
    "x": 160,
    "y": 520,
    "wires": []
  },
  {
    "id": "130e15b.29debea",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Libary Motion",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.motion_library",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 150,
    "y": 360,
    "wires": [
      [
        "5d0a1c2a.272a64",
        "d8919309.7def5"
      ]
    ]
  },
  {
    "id": "5d0a1c2a.272a64",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Libary Motion",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Libary Motion",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "trusted",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 460,
    "y": 320,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "d8919309.7def5",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Libary Motion",
    "links": [
      "4288444c.f3f9bc"
    ],
    "x": 395,
    "y": 360,
    "wires": []
  },
  {
    "id": "fd53b0e0.c9b61",
    "type": "comment",
    "z": "8a69107f.14257",
    "name": "Motion Detected",
    "info": "",
    "x": 160,
    "y": 600,
    "wires": []
  },
  {
    "id": "4288444c.f3f9bc",
    "type": "link in",
    "z": "8a69107f.14257",
    "name": "Action Libary motion",
    "links": [
      "d8919309.7def5"
    ],
    "x": 95,
    "y": 680,
    "wires": [
      [
        "655a695c.ef8778"
      ]
    ]
  },
  {
    "id": "f4916e43.db42f",
    "type": "api-call-service",
    "z": "8a69107f.14257",
    "name": "Toggle library_lights",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.library_lights",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 460,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "f7fcedc6.be69",
    "type": "api-call-service",
    "z": "8a69107f.14257",
    "name": "Toggle plug",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_06",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 438,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "655a695c.ef8778",
    "type": "switch",
    "z": "8a69107f.14257",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 230,
    "y": 680,
    "wires": [
      [
        "f7fcedc6.be69",
        "f4916e43.db42f",
        "777fe56e.7859dc"
      ]
    ]
  },
  {
    "id": "e332e132.17225",
    "type": "trigger-state",
    "z": "a0cdc0f9.a362b",
    "name": "Shower Door",
    "server": "5ee4d578.f7736c",
    "entityid": "binary_sensor.shower_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "zarheyu0bjf",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "ausbqpdz31p",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 170,
    "y": 1980,
    "wires": [
      [
        "2b286b3b.0a1bb4"
      ],
      []
    ]
  },
  {
    "id": "2b286b3b.0a1bb4",
    "type": "trigger",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "10",
    "extend": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 380,
    "y": 1980,
    "wires": [
      [
        "1ab28cd7.d2d263"
      ]
    ]
  },
  {
    "id": "1ab28cd7.d2d263",
    "type": "link out",
    "z": "a0cdc0f9.a362b",
    "name": "Shower Time Request",
    "links": [
      "8fa41eed.e0746"
    ],
    "x": 545,
    "y": 1980,
    "wires": []
  },
  {
    "id": "fcc59b6b.f2bad8",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Shower time",
    "info": "",
    "x": 170,
    "y": 1920,
    "wires": []
  },
  {
    "id": "93dbb7a4.b9e748",
    "type": "comment",
    "z": "21d6efde.d0943",
    "name": "Light Auto Off",
    "info": "",
    "x": 110,
    "y": 3240,
    "wires": []
  },
  {
    "id": "b45dab02.6d7738",
    "type": "trigger-state",
    "z": "21d6efde.d0943",
    "name": "Light On",
    "server": "5ee4d578.f7736c",
    "entityid": "light.bedroom",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "3hivjx1hsq1",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "5d986k2xa2q",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 100,
    "y": 3300,
    "wires": [
      [
        "9fa767a9.90dc18"
      ],
      []
    ]
  },
  {
    "id": "ba09070a.220758",
    "type": "link in",
    "z": "21d6efde.d0943",
    "name": "Action - BedRoom Light Auto Off (Trigged safe)",
    "links": [
      "90fde8f7.a26cb8",
      "e04902ac.5849e",
      "ddc05dd0.50814"
    ],
    "x": 55,
    "y": 3360,
    "wires": [
      [
        "57604a2f.19b454"
      ]
    ]
  },
  {
    "id": "e1c5ffbe.bd264",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "LighOn?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "group.light_bedroom",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 380,
    "y": 3360,
    "wires": [
      [
        "9fa767a9.90dc18"
      ],
      []
    ]
  },
  {
    "id": "9fa767a9.90dc18",
    "type": "trigger",
    "z": "21d6efde.d0943",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "20",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 550,
    "y": 3295,
    "wires": [
      [
        "9086d0ab.761df"
      ]
    ]
  },
  {
    "id": "57604a2f.19b454",
    "type": "switch",
    "z": "21d6efde.d0943",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 170,
    "y": 3360,
    "wires": [
      [
        "e1c5ffbe.bd264"
      ]
    ]
  },
  {
    "id": "a6e879f5.cba028",
    "type": "api-call-service",
    "z": "21d6efde.d0943",
    "name": "Turn Off Light",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "group.light_bedroom",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1000,
    "y": 3300,
    "wires": [
      []
    ]
  },
  {
    "id": "f5f4dbc1.426328",
    "type": "function",
    "z": "21d6efde.d0943",
    "name": "Bed State Changed",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 170,
    "y": 520,
    "wires": [
      [
        "b5f1a42e.badfd8",
        "4f518fae.94cda"
      ]
    ]
  },
  {
    "id": "4f518fae.94cda",
    "type": "link out",
    "z": "21d6efde.d0943",
    "name": "Bed State Changed",
    "links": [
      "baf3c4a6.a7e0d8"
    ],
    "x": 340,
    "y": 560,
    "wires": []
  },
  {
    "id": "baf3c4a6.a7e0d8",
    "type": "link in",
    "z": "21d6efde.d0943",
    "name": "Action - BedRoom Light Auto Off",
    "links": [
      "4f518fae.94cda"
    ],
    "x": 215,
    "y": 3400,
    "wires": [
      [
        "e1c5ffbe.bd264"
      ]
    ]
  },
  {
    "id": "c9b7606.bb30ea",
    "type": "api-current-state",
    "z": "d73100a9.0d64d",
    "name": "Is office light strip",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.hue_lightstrip_plus_1_2",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 2950,
    "y": 320,
    "wires": [
      [
        "ff31cac4.b7b148"
      ],
      []
    ]
  },
  {
    "id": "84d435fb.32f558",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Trigger Anyway",
    "info": "",
    "x": 2300,
    "y": 560,
    "wires": []
  },
  {
    "id": "8e4230b9.58f06",
    "type": "link out",
    "z": "9a341993.fbc528",
    "name": "TV Is now On",
    "links": [
      "35934b6b.88af44",
      "f3f9e3f0.7dc0a"
    ],
    "x": 595,
    "y": 1180,
    "wires": []
  },
  {
    "id": "4bd60bc.b131ef4",
    "type": "comment",
    "z": "9a341993.fbc528",
    "name": "TV On",
    "info": "",
    "x": 150,
    "y": 1620,
    "wires": []
  },
  {
    "id": "35934b6b.88af44",
    "type": "link in",
    "z": "9a341993.fbc528",
    "name": "Action - Tv On",
    "links": [
      "8e4230b9.58f06"
    ],
    "x": 115,
    "y": 1680,
    "wires": [
      [
        "a2966779.e5fa98",
        "eb20ee4f.aa464",
        "3a687ee8.833de2",
        "31a917c2.923668"
      ]
    ]
  },
  {
    "id": "a2966779.e5fa98",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Sofa Led",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.sofa_1_light_rgb",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 380,
    "y": 1680,
    "wires": [
      []
    ]
  },
  {
    "id": "eb20ee4f.aa464",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Sofa 2 Led",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.wled_sofa2",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 390,
    "y": 1720,
    "wires": [
      []
    ]
  },
  {
    "id": "3a687ee8.833de2",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Under Stairs Led",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.wled_understairs",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 410,
    "y": 1760,
    "wires": [
      []
    ]
  },
  {
    "id": "31a917c2.923668",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Under TV Led",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.wled_undertv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 400,
    "y": 1800,
    "wires": [
      []
    ]
  },
  {
    "id": "837ff9b4.f5dc98",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Turn off Mircowave",
    "server": "eef5a84.da24f58",
    "version": "1",
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_010",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 510,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "6a2c7663.3da788",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Turn off Kic - 11",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_011",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 500,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "ba1c0362.a5462",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Turn off Kic - 12",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_012",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 500,
    "y": 420,
    "wires": [
      []
    ]
  },
  {
    "id": "1c752f54.5dc961",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Turn off Kic - 13",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_013",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 500,
    "y": 460,
    "wires": [
      []
    ]
  },
  {
    "id": "a2a8b688.0a7b58",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn On Mircowave",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_010",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 750,
    "y": 2740,
    "wires": [
      []
    ]
  },
  {
    "id": "155f91a5.24f70e",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn On Kic - 11",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_011",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 480,
    "y": 2620,
    "wires": [
      []
    ]
  },
  {
    "id": "c1ec00ec.750c6",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn On Kic - 12",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_012",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 480,
    "y": 2660,
    "wires": [
      []
    ]
  },
  {
    "id": "c915e43b.832848",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn On Kic - 13",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_on",
    "entityId": "switch.plug_013",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 480,
    "y": 2700,
    "wires": [
      []
    ]
  },
  {
    "id": "ab939947.296018",
    "type": "comment",
    "z": "6e74caff.7ad1f4",
    "name": "Turn On plugs",
    "info": "",
    "x": 130,
    "y": 2520,
    "wires": []
  },
  {
    "id": "fd781bb5.bad858",
    "type": "link in",
    "z": "6e74caff.7ad1f4",
    "name": "On Kic Mov",
    "links": [
      "3495a219.f840be"
    ],
    "x": 100,
    "y": 2640,
    "wires": [
      [
        "7ffa086a.2667e8",
        "6c7e6965.ffe1c8"
      ]
    ]
  },
  {
    "id": "b0280511.628478",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "env": [],
    "x": 190,
    "y": 2440,
    "wires": [
      [
        "155f91a5.24f70e",
        "c1ec00ec.750c6",
        "c915e43b.832848",
        "e73a2bf6.84b5d8"
      ],
      []
    ]
  },
  {
    "id": "777fe56e.7859dc",
    "type": "trigger",
    "z": "8a69107f.14257",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "45",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 438,
    "y": 660,
    "wires": [
      [
        "c11adf83.11426",
        "55e2e240.b5e0fc"
      ]
    ]
  },
  {
    "id": "55e2e240.b5e0fc",
    "type": "api-call-service",
    "z": "8a69107f.14257",
    "name": "Toggle library_lights",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.library_lights",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 810,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "c11adf83.11426",
    "type": "api-call-service",
    "z": "8a69107f.14257",
    "name": "Toggle plug",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_06",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 788,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "173f37a6.d07cc8",
    "type": "inject",
    "z": "8a69107f.14257",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 230,
    "y": 640,
    "wires": [
      [
        "777fe56e.7859dc"
      ]
    ]
  },
  {
    "id": "75e4254.f57b6dc",
    "type": "trigger",
    "z": "babe2ac9.4e2738",
    "name": "Wait 5 minutes",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1080,
    "y": 500,
    "wires": [
      [
        "474d2042.802c6"
      ]
    ]
  },
  {
    "id": "23f2e7cd.7ad698",
    "type": "link in",
    "z": "babe2ac9.4e2738",
    "name": "Living Room Motion (PIR) - Action",
    "links": [
      "224d137d.2e20dc",
      "3495a219.f840be",
      "8c42e0e.e62702"
    ],
    "x": 95,
    "y": 420,
    "wires": [
      [
        "134ba71e.8780d9",
        "ef103c1e.b4421"
      ]
    ]
  },
  {
    "id": "8fe49357.00649",
    "type": "time-range-switch",
    "z": "babe2ac9.4e2738",
    "name": "",
    "lat": "",
    "lon": "",
    "startTime": "03:00",
    "endTime": "10:00",
    "startOffset": 0,
    "endOffset": 0,
    "x": 1190,
    "y": 260,
    "wires": [
      [
        "d52281d9.71822",
        "48a40e58.7f204"
      ],
      []
    ]
  },
  {
    "id": "b6655c35.3097a",
    "type": "link in",
    "z": "babe2ac9.4e2738",
    "name": "Hallway Motion - Action",
    "links": [
      "3495a219.f840be",
      "8c42e0e.e62702",
      "e04902ac.5849e",
      "ddc05dd0.50814"
    ],
    "x": 55,
    "y": 340,
    "wires": [
      [
        "31417347.d3180c"
      ]
    ]
  },
  {
    "id": "d52281d9.71822",
    "type": "api-call-service",
    "z": "babe2ac9.4e2738",
    "name": "Turn on living room lights",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bed_room_lamp",
    "data": "{\"brightness_pct\":100}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1508,
    "y": 314,
    "wires": [
      []
    ]
  },
  {
    "id": "48a40e58.7f204",
    "type": "trigger",
    "z": "babe2ac9.4e2738",
    "name": "Time to come down",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "30",
    "extend": true,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 1490,
    "y": 380,
    "wires": [
      [
        "6862da67.b25ad4"
      ]
    ]
  },
  {
    "id": "134ba71e.8780d9",
    "type": "change",
    "z": "babe2ac9.4e2738",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 440,
    "y": 400,
    "wires": [
      [
        "48a40e58.7f204"
      ]
    ]
  },
  {
    "id": "6862da67.b25ad4",
    "type": "api-call-service",
    "z": "babe2ac9.4e2738",
    "name": "Turn off living room lights - No movent",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.bed_room_lamp",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1770,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "6e519e2b.836c1",
    "type": "switch",
    "z": "babe2ac9.4e2738",
    "name": "Triggered?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 410,
    "y": 340,
    "wires": [
      [
        "d2acce6f.512ca"
      ]
    ]
  },
  {
    "id": "b8a5277d.741b38",
    "type": "api-current-state",
    "z": "babe2ac9.4e2738",
    "name": "Light State",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bed_room_lamp",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "",
    "override_data": "none",
    "blockInputOverrides": false,
    "x": 830,
    "y": 320,
    "wires": [
      [
        "a55288e7.a76338"
      ]
    ]
  },
  {
    "id": "a55288e7.a76338",
    "type": "switch",
    "z": "babe2ac9.4e2738",
    "name": "Is off?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1010,
    "y": 320,
    "wires": [
      [
        "48a40e58.7f204",
        "d52281d9.71822"
      ]
    ]
  },
  {
    "id": "406fd8bb.f08408",
    "type": "comment",
    "z": "babe2ac9.4e2738",
    "name": "Auto Down Stairs Lights",
    "info": "",
    "x": 150,
    "y": 260,
    "wires": []
  },
  {
    "id": "d2acce6f.512ca",
    "type": "subflow:56368b94.f11494",
    "z": "babe2ac9.4e2738",
    "name": "",
    "env": [],
    "x": 600,
    "y": 340,
    "wires": [
      [
        "b8a5277d.741b38"
      ],
      [],
      [
        "b8a5277d.741b38"
      ]
    ]
  },
  {
    "id": "31417347.d3180c",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "babe2ac9.4e2738",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "value": "LampOnDownStairs",
        "type": "str"
      }
    ],
    "x": 200,
    "y": 340,
    "wires": [
      [
        "6e519e2b.836c1"
      ],
      []
    ]
  },
  {
    "id": "d1009666.09b4c8",
    "type": "api-current-state",
    "z": "babe2ac9.4e2738",
    "name": "Light State",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bed_room_lamp",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "",
    "override_data": "none",
    "blockInputOverrides": false,
    "x": 650,
    "y": 440,
    "wires": [
      [
        "88be936d.d38db",
        "75e4254.f57b6dc",
        "4c8c1b07.b31364"
      ]
    ]
  },
  {
    "id": "ef103c1e.b4421",
    "type": "subflow:56368b94.f11494",
    "z": "babe2ac9.4e2738",
    "name": "",
    "env": [],
    "x": 420,
    "y": 460,
    "wires": [
      [
        "d1009666.09b4c8"
      ],
      [],
      [
        "d1009666.09b4c8"
      ]
    ]
  },
  {
    "id": "88be936d.d38db",
    "type": "api-call-service",
    "z": "babe2ac9.4e2738",
    "name": "Turn on living room lights",
    "server": "5ee4d578.f7736c",
    "version": "1",
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.bed_room_lamp",
    "data": "{\"brightness_pct\":100}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1050,
    "y": 440,
    "wires": [
      []
    ]
  },
  {
    "id": "474d2042.802c6",
    "type": "api-call-service",
    "z": "babe2ac9.4e2738",
    "name": "Turn off living room lights - No movent",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.bed_room_lamp",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1550,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "4c8c1b07.b31364",
    "type": "ha-wait-until",
    "z": "babe2ac9.4e2738",
    "name": "If Motion again restart timer",
    "server": "5ee4d578.f7736c",
    "outputs": 2,
    "entityId": "binary_sensor.living_room_motion",
    "property": "state",
    "comparator": "is",
    "value": "true",
    "valueType": "bool",
    "timeout": "5",
    "timeoutUnits": "minutes",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 840,
    "y": 560,
    "wires": [
      [
        "75e4254.f57b6dc"
      ],
      []
    ]
  },
  {
    "id": "f3f9e3f0.7dc0a",
    "type": "link in",
    "z": "babe2ac9.4e2738",
    "name": "Action - Tv On",
    "links": [
      "8e4230b9.58f06"
    ],
    "x": 375,
    "y": 540,
    "wires": [
      [
        "5fe56986.cebdf8"
      ]
    ]
  },
  {
    "id": "5fe56986.cebdf8",
    "type": "change",
    "z": "babe2ac9.4e2738",
    "name": "Tv On",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "unauthorised access detected. notifying police, uploading real-time camera footage to remote server",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 510,
    "y": 540,
    "wires": [
      [
        "75e4254.f57b6dc",
        "4c8c1b07.b31364"
      ]
    ]
  },
  {
    "id": "5faedba1.83d324",
    "type": "api-current-state",
    "z": "6a3dc053.8b5b6",
    "name": "Office Plug State",
    "server": "eef5a84.da24f58",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.plug_05",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 610,
    "y": 320,
    "wires": [
      [
        "1049620.a291f9e"
      ],
      [
        "b15a63c2.995e7"
      ]
    ]
  },
  {
    "id": "1049620.a291f9e",
    "type": "subflow:2aff94ce.fdbbdc",
    "z": "6a3dc053.8b5b6",
    "name": "",
    "env": [],
    "x": 1030,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "b15a63c2.995e7",
    "type": "api-call-service",
    "z": "6a3dc053.8b5b6",
    "name": "Office Plug",
    "server": "5ee4d578.f7736c",
    "service_domain": "switch",
    "service": "turn_on",
    "data": "{\"entity_id\":\"switch.plug_05\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1010,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "4eaa78de.18a268",
    "type": "link in",
    "z": "d73100a9.0d64d",
    "name": "Trigger Good Night",
    "links": [
      "69e3038b.68b6fc"
    ],
    "x": 2415,
    "y": 420,
    "wires": [
      [
        "33d67a23.de0b26"
      ]
    ]
  },
  {
    "id": "69e3038b.68b6fc",
    "type": "link out",
    "z": "6a3dc053.8b5b6",
    "name": "Night",
    "links": [
      "4eaa78de.18a268",
      "ddf64a1a.855ea8"
    ],
    "x": 535,
    "y": 440,
    "wires": []
  },
  {
    "id": "fc37c575.c0ae08",
    "type": "api-call-service",
    "z": "5625076e.ee59e8",
    "name": "Is it Bed time - Matt",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "notify",
    "service": "mattiphone",
    "entityId": "",
    "data": "{\"message\":\"Bed time? I'm turning everything off in 5 minutes\",\"data\":{\"push\":{\"badge\":5,\"category\":\"goodnight\"}}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 710,
    "y": 1380,
    "wires": [
      []
    ]
  },
  {
    "id": "d321bc2b.7c056",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 360,
    "y": 1380,
    "wires": [
      [
        "fc37c575.c0ae08"
      ]
    ]
  },
  {
    "id": "608bac35.92a5a4",
    "type": "inject",
    "z": "d73100a9.0d64d",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 2380,
    "y": 200,
    "wires": [
      [
        "6e45a7ed.2c8728"
      ]
    ]
  },
  {
    "id": "7ffa086a.2667e8",
    "type": "trigger",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "payl",
    "duration": "40",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 270,
    "y": 2940,
    "wires": [
      [
        "8a6a1096.31559",
        "ed99d640.d55998",
        "43a82c49.740a84",
        "9015c87c.b8b528",
        "ee63abb8.30fef8"
      ]
    ]
  },
  {
    "id": "8a6a1096.31559",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn Off Mircowave",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_010",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 490,
    "y": 2900,
    "wires": [
      []
    ]
  },
  {
    "id": "ed99d640.d55998",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn off Kic - 11",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_011",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 480,
    "y": 2940,
    "wires": [
      []
    ]
  },
  {
    "id": "43a82c49.740a84",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn Off Kic - 12",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_012",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 480,
    "y": 2980,
    "wires": [
      []
    ]
  },
  {
    "id": "9015c87c.b8b528",
    "type": "api-call-service",
    "z": "6e74caff.7ad1f4",
    "name": "Turn off Kic - 13",
    "server": "eef5a84.da24f58",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "switch.plug_013",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 480,
    "y": 3020,
    "wires": [
      []
    ]
  },
  {
    "id": "10927101.c3aa0f",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Reset Inputs",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight_beentriggered, input_boolean.goodnight, input_boolean.goodnight_delay_60, input_boolean.goodnight_delay_180, input_boolean.goodnight_delay_30, input_boolean.goodnight_armed, input_boolean.goodnight_cancel",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 470,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "72c3ab65.ad95e4",
    "type": "function",
    "z": "d73100a9.0d64d",
    "name": "Arm -Bed",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 1680,
    "y": 280,
    "wires": [
      [
        "8cbf3f8d.84749"
      ]
    ]
  },
  {
    "id": "d569524f.092a7",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Disarm",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1680,
    "y": 340,
    "wires": [
      [
        "8cbf3f8d.84749",
        "9cc7615c.cb47d"
      ]
    ]
  },
  {
    "id": "23e81ddc.189fd2",
    "type": "status",
    "z": "d73100a9.0d64d",
    "name": "",
    "scope": [
      "8cbf3f8d.84749"
    ],
    "x": 120,
    "y": 1560,
    "wires": [
      [
        "84fe1e1b.17e5d"
      ]
    ]
  },
  {
    "id": "84fe1e1b.17e5d",
    "type": "function",
    "z": "d73100a9.0d64d",
    "name": "Convert Message to time",
    "func": "var s = msg.status.text;\nif (s.match(/waiting until.*/) && s.length > 8){\n    s = s.substr(s.length -8)\n    s = s.substr(0,5)\n    msg = {\"payload\":{\"data\":{\"value\":s}}}\n} else {\n    msg = null;\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "x": 350,
    "y": 1560,
    "wires": [
      [
        "6d53b44.800114c",
        "633f2350.96e4dc"
      ]
    ]
  },
  {
    "id": "6d53b44.800114c",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Set wait till time",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_text",
    "service": "set_value",
    "entityId": " input_text.goodnight_waittill",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 600,
    "y": 1500,
    "wires": [
      []
    ]
  },
  {
    "id": "da9b8ab1.874268",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Output wait till time",
    "info": "",
    "x": 150,
    "y": 1500,
    "wires": []
  },
  {
    "id": "ce507b.cc701f88",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Set wait till time",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_text",
    "service": "set_value",
    "entityId": " input_text.goodnight_waittill",
    "data": "{\"value\":\"\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 480,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "9451899f.67b3e8",
    "type": "change",
    "z": "b8a16318.b66a5",
    "name": "Set Param",
    "rules": [
      {
        "t": "set",
        "p": "me.user_id",
        "pt": "global",
        "to": "dfa60723e3ee4e0191c1def891de2021",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 270,
    "y": 640,
    "wires": [
      []
    ]
  },
  {
    "id": "c0a3b8d5.d6ec88",
    "type": "trigger-state",
    "z": "d73100a9.0d64d",
    "name": "Armed Status Changed - On",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.goodnight_armed",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "fkpvnb99ttn",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      },
      {
        "id": "tdd9mk8uaxp",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 1380,
    "y": 220,
    "wires": [
      [
        "72c3ab65.ad95e4",
        "9ce3ee59.467b6"
      ],
      []
    ]
  },
  {
    "id": "e8cc9bf1.7eb9e8",
    "type": "trigger-state",
    "z": "d73100a9.0d64d",
    "name": "Armed Status Changed - Off",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.goodnight_armed",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "fkpvnb99ttn",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      },
      {
        "id": "w2qrsalti3p",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 1380,
    "y": 400,
    "wires": [
      [
        "d569524f.092a7"
      ],
      []
    ]
  },
  {
    "id": "9cc7615c.cb47d",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Armed Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight_armed",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1880,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "9ce3ee59.467b6",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Reset Been Triggered Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight_beentriggered",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1740,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "3ed3ba30.d71e26",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Reset Been Triggered Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight_beentriggered",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 1320,
    "y": 1100,
    "wires": [
      []
    ]
  },
  {
    "id": "13089769.bc8c29",
    "type": "comment",
    "z": "d73100a9.0d64d",
    "name": "Inputs",
    "info": "",
    "x": 100.01734924316406,
    "y": 1640.12158203125,
    "wires": []
  },
  {
    "id": "260f161b.31fb1a",
    "type": "trigger-state",
    "z": "d73100a9.0d64d",
    "name": "Delay 30",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.goodnight_delay_30",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "fkpvnb99ttn",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      },
      {
        "id": "tdd9mk8uaxp",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 120,
    "y": 720,
    "wires": [
      [
        "bebe9295.26d41",
        "8a9e4a8c.294d28"
      ],
      []
    ]
  },
  {
    "id": "d514a6dd.c6ec88",
    "type": "trigger-state",
    "z": "d73100a9.0d64d",
    "name": "Delay 60",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.goodnight_delay_60",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "fkpvnb99ttn",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      },
      {
        "id": "tdd9mk8uaxp",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 120,
    "y": 760,
    "wires": [
      [
        "bebe9295.26d41",
        "be9e3159.3ea59"
      ],
      []
    ]
  },
  {
    "id": "6e15fcea.d46e04",
    "type": "trigger-state",
    "z": "d73100a9.0d64d",
    "name": "Delay 180",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.goodnight_delay_180",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "fkpvnb99ttn",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      },
      {
        "id": "tdd9mk8uaxp",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 120,
    "y": 800,
    "wires": [
      [
        "bebe9295.26d41",
        "69a40cbb.df3674"
      ],
      []
    ]
  },
  {
    "id": "7635119a.f1f75",
    "type": "trigger-state",
    "z": "d73100a9.0d64d",
    "name": "Cancel",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.goodnight_cancel",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "fkpvnb99ttn",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      },
      {
        "id": "tdd9mk8uaxp",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 110,
    "y": 640,
    "wires": [
      [
        "bebe9295.26d41"
      ],
      []
    ]
  },
  {
    "id": "bebe9295.26d41",
    "type": "function",
    "z": "d73100a9.0d64d",
    "name": ">",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 290,
    "y": 640,
    "wires": [
      [
        "99df83ab.46e3b"
      ]
    ]
  },
  {
    "id": "b6fd0d53.bb28e",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Reset Been Triggered Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight_beentriggered",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 180,
    "y": 1700,
    "wires": [
      []
    ]
  },
  {
    "id": "af695324.942b",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Armed Status",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": true,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.goodnight_armed",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 800,
    "y": 1560,
    "wires": [
      []
    ]
  },
  {
    "id": "e57623.5458c9e",
    "type": "api-call-service",
    "z": "d73100a9.0d64d",
    "name": "Reset Inputs",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.goodnight_beentriggered, input_boolean.goodnight, input_boolean.goodnight_delay_60, input_boolean.goodnight_delay_180, input_boolean.goodnight_delay_30, input_boolean.goodnight_armed, input_boolean.goodnight_cancel",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1570,
    "y": 460,
    "wires": [
      []
    ]
  },
  {
    "id": "8efbd9c3.525698",
    "type": "delay",
    "z": "d73100a9.0d64d",
    "name": "",
    "pauseType": "delay",
    "timeout": "3",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 1400,
    "y": 460,
    "wires": [
      [
        "e57623.5458c9e"
      ]
    ]
  },
  {
    "id": "fc10e2c0.0607",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "Remove Reset",
    "rules": [
      {
        "t": "delete",
        "p": "reset",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1220,
    "y": 460,
    "wires": [
      [
        "8efbd9c3.525698"
      ]
    ]
  },
  {
    "id": "633f2350.96e4dc",
    "type": "change",
    "z": "d73100a9.0d64d",
    "name": "",
    "rules": [
      {
        "t": "delete",
        "p": "payload",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 590,
    "y": 1560,
    "wires": [
      [
        "af695324.942b"
      ]
    ]
  },
  {
    "id": "fcf075af.6884d8",
    "type": "ha-wait-until",
    "z": "e361c01.ee9f54",
    "name": "Wait for heater off",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "entityId": "sensor.hot_tub_status",
    "property": "state",
    "comparator": "is_not",
    "value": "Heating",
    "valueType": "str",
    "timeout": 0,
    "timeoutUnits": "seconds",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 350,
    "y": 740,
    "wires": [
      [
        "e86b21dd.5f291",
        "97f9ece3.55bcb"
      ]
    ]
  },
  {
    "id": "e86b21dd.5f291",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "e361c01.ee9f54",
    "name": "Hot tub reached temp - heater off",
    "env": [
      {
        "name": "message",
        "value": "Hot tub reached temp - heater off",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      }
    ],
    "x": 740,
    "y": 740,
    "wires": []
  },
  {
    "id": "789e5afc.0e24b4",
    "type": "trigger-state",
    "z": "e361c01.ee9f54",
    "name": "Alert On",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.alert_hottub_heateroff",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "ul9aqqbtx2d",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": true,
    "state_type": "habool",
    "x": 120,
    "y": 740,
    "wires": [
      [
        "fcf075af.6884d8"
      ],
      []
    ]
  },
  {
    "id": "42b3effb.fbfaf",
    "type": "comment",
    "z": "e361c01.ee9f54",
    "name": "Wait for heater to go off",
    "info": "",
    "x": 160,
    "y": 700,
    "wires": []
  },
  {
    "id": "97f9ece3.55bcb",
    "type": "api-call-service",
    "z": "e361c01.ee9f54",
    "name": "Cancel alert",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.alert_hottub_heateroff",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 670,
    "y": 780,
    "wires": [
      []
    ]
  },
  {
    "id": "75529894.e77db8",
    "type": "function",
    "z": "d73100a9.0d64d",
    "name": ">",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 2200,
    "y": 340,
    "wires": [
      [
        "6e45a7ed.2c8728",
        "5d848996.a2fc68",
        "3eddd440.5a143c"
      ]
    ]
  },
  {
    "id": "27d2e607.3670ba",
    "type": "function",
    "z": "d73100a9.0d64d",
    "name": ">",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 2270,
    "y": 640,
    "wires": [
      [
        "94c4fb0a.6129d8",
        "b399da43.7ff288"
      ]
    ]
  },
  {
    "id": "cd00845c.ea1588",
    "type": "trigger-state",
    "z": "8a69107f.14257",
    "name": "Vib Detected",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.danni_lockbox_vibration",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 150,
    "y": 1100,
    "wires": [
      [
        "da1a813e.2484c"
      ],
      []
    ]
  },
  {
    "id": "f3b9a0bd.b62b7",
    "type": "comment",
    "z": "8a69107f.14257",
    "name": "Vib Detected",
    "info": "",
    "x": 150,
    "y": 1060,
    "wires": []
  },
  {
    "id": "d2ecf097.f4769",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "8a69107f.14257",
    "name": "Sweet box open!!",
    "env": [
      {
        "name": "message",
        "value": "Sweet box open!!",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 670,
    "y": 1100,
    "wires": []
  },
  {
    "id": "da1a813e.2484c",
    "type": "delay",
    "z": "8a69107f.14257",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "2",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 400,
    "y": 1100,
    "wires": [
      []
    ]
  },
  {
    "id": "878320aa.0b185",
    "type": "trigger-state",
    "z": "9a341993.fbc528",
    "name": "On Idle",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "media_player.living_room_fire_tv",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "22yt78kdgb3",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "idle"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": true,
    "state_type": "str",
    "x": 120,
    "y": 2320,
    "wires": [
      [
        "321647b6.3f2028"
      ],
      []
    ]
  },
  {
    "id": "520dab52.888584",
    "type": "comment",
    "z": "9a341993.fbc528",
    "name": "Turn off tv when idle",
    "info": "",
    "x": 150,
    "y": 2280,
    "wires": []
  },
  {
    "id": "321647b6.3f2028",
    "type": "subflow:50a84f0.9f6dbb",
    "z": "9a341993.fbc528",
    "name": "",
    "env": [],
    "x": 330,
    "y": 2320,
    "wires": [
      []
    ]
  },
  {
    "id": "3c440883.49d378",
    "type": "trigger-state",
    "z": "9a341993.fbc528",
    "name": "From Idle",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "media_player.living_room_fire_tv",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "q6kmyuh4xf",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "idle"
      },
      {
        "id": "len2bij403",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "off"
      },
      {
        "id": "su36mf4imrj",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "unavailable"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": true,
    "state_type": "str",
    "x": 120,
    "y": 2520,
    "wires": [
      [
        "56f53c09.858104"
      ],
      []
    ]
  },
  {
    "id": "d77bd763.d91168",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "TV On/Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "service_domain": "switch",
    "service": "toggle",
    "entityId": "switch.tv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 680,
    "y": 2540,
    "wires": [
      []
    ]
  },
  {
    "id": "66be0e9d.86475",
    "type": "api-current-state",
    "z": "9a341993.fbc528",
    "name": "Is Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "False",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_select.tv_state",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 510,
    "y": 2540,
    "wires": [
      [
        "d77bd763.d91168"
      ],
      []
    ]
  },
  {
    "id": "56f53c09.858104",
    "type": "delay",
    "z": "9a341993.fbc528",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 350,
    "y": 2540,
    "wires": [
      [
        "66be0e9d.86475"
      ]
    ]
  },
  {
    "id": "51b15e05.4f64a",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "a0a4859f.5a2a48",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "value": "alarm_notication_only",
        "type": "str"
      }
    ],
    "x": 1000,
    "y": 100,
    "wires": [
      [
        "e615d2e5.a6b6e"
      ],
      []
    ]
  },
  {
    "id": "9e7450fb.4d726",
    "type": "api-current-state",
    "z": "a3158433.9d1f78",
    "name": "_alarm_notication_only ",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_alarm_notication_only",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 830,
    "y": 980,
    "wires": [
      [
        "b8b9d59f.cb51d8"
      ],
      []
    ]
  },
  {
    "id": "b8b9d59f.cb51d8",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a3158433.9d1f78",
    "name": "Notication Only Mode",
    "env": [
      {
        "name": "message",
        "value": "Notication only mode - is disabled",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 1140,
    "y": 980,
    "wires": []
  },
  {
    "id": "9e5b6fe3.3e762",
    "type": "trigger-state",
    "z": "9a341993.fbc528",
    "name": "From Off",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "media_player.living_room_fire_tv",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "gxkweky4j4v",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "idle"
      },
      {
        "id": "sk2bzr6ks6d",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "off"
      },
      {
        "id": "kjvkix8duk",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "unavailable"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": true,
    "state_type": "str",
    "x": 120,
    "y": 2560,
    "wires": [
      [
        "56f53c09.858104"
      ],
      []
    ]
  },
  {
    "id": "d367e975.44df38",
    "type": "comment",
    "z": "9a341993.fbc528",
    "name": "Turn on tv",
    "info": "",
    "x": 120,
    "y": 2480,
    "wires": []
  },
  {
    "id": "2b25f7b.081a808",
    "type": "trigger-state",
    "z": "9a341993.fbc528",
    "name": "On Off",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "media_player.living_room_fire_tv",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "us59baz4j2",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "off"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": true,
    "state_type": "str",
    "x": 110,
    "y": 2360,
    "wires": [
      [
        "321647b6.3f2028"
      ],
      []
    ]
  },
  {
    "id": "51a50a7d.f76064",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Turn Off Fire Stick",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "media_player",
    "service": "turn_off",
    "entityId": "media_player.living_room_fire_tv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1250,
    "y": 1100,
    "wires": [
      []
    ]
  },
  {
    "id": "7a770c6e.ef1804",
    "type": "api-current-state",
    "z": "9a341993.fbc528",
    "name": "Is off?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "override_topic": false,
    "entity_id": "media_player.living_room_fire_tv",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 890,
    "y": 1100,
    "wires": [
      [
        "51a50a7d.f76064"
      ],
      []
    ]
  },
  {
    "id": "d07ab53b.8d42b8",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "Start Up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 320,
    "y": 800,
    "wires": [
      [
        "2c441a8d.3f1c86"
      ]
    ]
  },
  {
    "id": "2c441a8d.3f1c86",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Bed Empty",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "0",
    "halt_if_type": "num",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.num_in_master_bed",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 490,
    "y": 800,
    "wires": [
      [
        "89782bb8.4daed8"
      ],
      []
    ]
  },
  {
    "id": "6c7e6965.ffe1c8",
    "type": "function",
    "z": "6e74caff.7ad1f4",
    "name": ">",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 230,
    "y": 2640,
    "wires": [
      [
        "155f91a5.24f70e",
        "c1ec00ec.750c6",
        "c915e43b.832848",
        "e73a2bf6.84b5d8"
      ]
    ]
  },
  {
    "id": "9bc67dac.7e623",
    "type": "link out",
    "z": "80866e71.966c6",
    "name": "Alex Inbound - Tv ON",
    "links": [
      "ee32c760.c5da28"
    ],
    "x": 515,
    "y": 780,
    "wires": []
  },
  {
    "id": "f68efe92.f2def",
    "type": "subflow:fec14295.8a46d",
    "z": "80866e71.966c6",
    "name": "",
    "x": 320,
    "y": 800,
    "wires": [
      [
        "9bc67dac.7e623"
      ],
      [
        "795286f2.ecd0c8"
      ],
      []
    ]
  },
  {
    "id": "795286f2.ecd0c8",
    "type": "link out",
    "z": "80866e71.966c6",
    "name": "Alex Inbound - Tv Off",
    "links": [
      "a671d8a0.8b37f8"
    ],
    "x": 515,
    "y": 820,
    "wires": []
  },
  {
    "id": "ae6cbcd9.0f76b",
    "type": "comment",
    "z": "9a341993.fbc528",
    "name": "Alexa",
    "info": "",
    "x": 130,
    "y": 2060,
    "wires": []
  },
  {
    "id": "a671d8a0.8b37f8",
    "type": "link in",
    "z": "9a341993.fbc528",
    "name": "Turn Off Tv",
    "links": [
      "795286f2.ecd0c8"
    ],
    "x": 95,
    "y": 2120,
    "wires": [
      [
        "7314ddef.dc1a84",
        "49e915b3.b8b47c"
      ]
    ]
  },
  {
    "id": "7314ddef.dc1a84",
    "type": "subflow:50a84f0.9f6dbb",
    "z": "9a341993.fbc528",
    "name": "",
    "env": [],
    "x": 510,
    "y": 2120,
    "wires": [
      []
    ]
  },
  {
    "id": "433179bb.7f7688",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "TV On/Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "toggle",
    "entityId": "switch.tv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 500,
    "y": 2200,
    "wires": [
      []
    ]
  },
  {
    "id": "ee32c760.c5da28",
    "type": "link in",
    "z": "9a341993.fbc528",
    "name": "",
    "links": [
      "9bc67dac.7e623"
    ],
    "x": 95,
    "y": 2200,
    "wires": [
      [
        "4731a02c.b46cf"
      ]
    ]
  },
  {
    "id": "4731a02c.b46cf",
    "type": "api-current-state",
    "z": "9a341993.fbc528",
    "name": "Is Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "False",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_select.tv_state",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 310,
    "y": 2200,
    "wires": [
      [
        "433179bb.7f7688",
        "3cd3065a.24292a"
      ],
      []
    ]
  },
  {
    "id": "49e915b3.b8b47c",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Turn On Fire Stick",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "media_player",
    "service": "turn_on",
    "entityId": "media_player.living_room_fire_tv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 530,
    "y": 2160,
    "wires": [
      []
    ]
  },
  {
    "id": "3cd3065a.24292a",
    "type": "api-call-service",
    "z": "9a341993.fbc528",
    "name": "Turn Off Fire Stick",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "media_player",
    "service": "turn_off",
    "entityId": "media_player.living_room_fire_tv",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 530,
    "y": 2240,
    "wires": [
      []
    ]
  },
  {
    "id": "e73a2bf6.84b5d8",
    "type": "ha-wait-until",
    "z": "6e74caff.7ad1f4",
    "name": "Wait for door to open",
    "server": "5ee4d578.f7736c",
    "outputs": 1,
    "entityId": "binary_sensor.mircowave_door",
    "entityIdFilterType": "exact",
    "property": "state",
    "comparator": "is",
    "value": "on",
    "valueType": "str",
    "timeout": 0,
    "timeoutType": "num",
    "timeoutUnits": "hours",
    "entityLocation": "",
    "entityLocationType": "none",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "x": 500,
    "y": 2740,
    "wires": [
      [
        "a2a8b688.0a7b58"
      ]
    ]
  },
  {
    "id": "ee63abb8.30fef8",
    "type": "change",
    "z": "6e74caff.7ad1f4",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 370,
    "y": 2840,
    "wires": [
      [
        "e73a2bf6.84b5d8"
      ]
    ]
  },
  {
    "id": "c5c6a7d6.c84f48",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 120,
    "y": 2800,
    "wires": [
      [
        "7ffa086a.2667e8"
      ]
    ]
  },
  {
    "id": "cf3bde13.c70a4",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 2560,
    "wires": [
      [
        "6c7e6965.ffe1c8"
      ]
    ]
  },
  {
    "id": "5689ccb9.92d694",
    "type": "inject",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 160,
    "y": 2740,
    "wires": [
      [
        "ee63abb8.30fef8",
        "8a6a1096.31559"
      ]
    ]
  },
  {
    "id": "7ba291d9.e0a41",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "Computer truns on",
    "info": "",
    "x": 130,
    "y": 800,
    "wires": []
  },
  {
    "id": "74c44243.13ca9c",
    "type": "server-state-changed",
    "z": "a068bd5.28a8d4",
    "name": "Lower Hallway Motion",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.lower_hallway_motion",
    "entityidfiltertype": "substring",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 180,
    "y": 660,
    "wires": [
      [
        "411325bd.14718c",
        "ddc05dd0.50814"
      ]
    ]
  },
  {
    "id": "411325bd.14718c",
    "type": "change",
    "z": "a068bd5.28a8d4",
    "name": "Lower Hallway Motion Detected",
    "rules": [
      {
        "t": "set",
        "p": "location",
        "pt": "msg",
        "to": "Lower Hallway Motion Detected",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "image",
        "pt": "msg",
        "to": "https://msb396.duckdns.org/api/camera_proxy/camera.living_room?token=6bf07bbf33a0a37622a7fd25c019ed1fb1169449b4a0b808fafdb5800b2e5c3f",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 510,
    "y": 660,
    "wires": [
      [
        "64a723bb.a421cc"
      ]
    ]
  },
  {
    "id": "ddc05dd0.50814",
    "type": "link out",
    "z": "a068bd5.28a8d4",
    "name": "Lower Hallway Motion",
    "links": [
      "a2f7cd26.7ec92",
      "b6655c35.3097a",
      "ba09070a.220758",
      "c3e890f4.9c742",
      "5972a834.14fe58",
      "1430c409.2b12ec"
    ],
    "x": 395,
    "y": 700,
    "wires": []
  },
  {
    "id": "7cac62c4.7981bc",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "Office",
    "info": "",
    "x": 92,
    "y": 680,
    "wires": []
  },
  {
    "id": "9be597a1.716c08",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "Hallway",
    "info": "",
    "x": 92,
    "y": 720,
    "wires": []
  },
  {
    "id": "5972a834.14fe58",
    "type": "link in",
    "z": "acf12371.2c1ae",
    "name": "Light on - On hallway motion",
    "links": [
      "ddc05dd0.50814"
    ],
    "x": 161,
    "y": 720,
    "wires": [
      [
        "c13d514c.e2c37"
      ]
    ]
  },
  {
    "id": "f11b6517.78b028",
    "type": "api-current-state",
    "z": "42cea594.a055ac",
    "name": "Is office light strip",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.hue_lightstrip_plus_1_2",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1150,
    "y": 220,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "f9ec5694.79b328",
    "type": "api-current-state",
    "z": "42cea594.a055ac",
    "name": "Is it light",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "1.6",
    "halt_if_type": "num",
    "halt_if_compare": "lt",
    "override_topic": false,
    "entity_id": "sensor.office_doorbell_light_level",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": true,
    "x": 669,
    "y": 220,
    "wires": [
      [
        "f11b6517.78b028"
      ],
      [
        "9f714878.a46298"
      ]
    ]
  },
  {
    "id": "5abca6a5.3c6618",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "42cea594.a055ac",
    "name": "",
    "env": [
      {
        "name": "BreakerName",
        "value": "officelightonmotion",
        "type": "str"
      }
    ],
    "x": 429,
    "y": 220,
    "wires": [
      [
        "f9ec5694.79b328"
      ],
      []
    ]
  },
  {
    "id": "9f714878.a46298",
    "type": "api-current-state",
    "z": "42cea594.a055ac",
    "name": "office light  on?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.office_light",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 889,
    "y": 180,
    "wires": [
      [
        "f11b6517.78b028"
      ],
      []
    ]
  },
  {
    "id": "bf61daf5.994bf8",
    "type": "switch",
    "z": "42cea594.a055ac",
    "name": "Is Open?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 240,
    "y": 220,
    "wires": [
      [
        "5abca6a5.3c6618"
      ],
      []
    ]
  },
  {
    "id": "c13d514c.e2c37",
    "type": "subflow:42cea594.a055ac",
    "z": "acf12371.2c1ae",
    "name": "",
    "env": [],
    "x": 328,
    "y": 720,
    "wires": [
      [
        "2b73f0a0.724a4",
        "20b05573.a1ea0a"
      ]
    ]
  },
  {
    "id": "bb9565df.a2f8c8",
    "type": "subflow:42cea594.a055ac",
    "z": "acf12371.2c1ae",
    "name": "",
    "x": 328,
    "y": 680,
    "wires": [
      [
        "3c8bb36d.6841fc",
        "2b73f0a0.724a4",
        "4cb8a330.dc112c"
      ]
    ]
  },
  {
    "id": "8ba694b1.ff3688",
    "type": "trigger",
    "z": "acf12371.2c1ae",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "payl",
    "duration": "30",
    "extend": true,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 930,
    "y": 760,
    "wires": [
      [
        "bc54c26f.5a203"
      ]
    ]
  },
  {
    "id": "4cb8a330.dc112c",
    "type": "change",
    "z": "acf12371.2c1ae",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 750,
    "y": 700,
    "wires": [
      [
        "8ba694b1.ff3688"
      ]
    ]
  },
  {
    "id": "208083c8.0849cc",
    "type": "comment",
    "z": "acf12371.2c1ae",
    "name": "Hallway turn the light on for short time untill office motion",
    "info": "",
    "x": 1070,
    "y": 720,
    "wires": []
  },
  {
    "id": "20b05573.a1ea0a",
    "type": "api-current-state",
    "z": "acf12371.2c1ae",
    "name": "Office light must be off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.office_light",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 580,
    "y": 760,
    "wires": [
      [
        "8ba694b1.ff3688"
      ],
      []
    ]
  },
  {
    "id": "1430c409.2b12ec",
    "type": "link in",
    "z": "d1172b8b.3d3298",
    "name": "Keep Light on",
    "links": [
      "ddc05dd0.50814",
      "e04902ac.5849e"
    ],
    "x": 295,
    "y": 260,
    "wires": [
      [
        "94fbbe31.aebc9"
      ]
    ]
  },
  {
    "id": "7184d2e0.642dcc",
    "type": "comment",
    "z": "d1172b8b.3d3298",
    "name": "Lower Hallway",
    "info": "",
    "x": 180,
    "y": 260,
    "wires": []
  },
  {
    "id": "56bd6b2d.0ff904",
    "type": "comment",
    "z": "d1172b8b.3d3298",
    "name": "Door",
    "info": "",
    "x": 150,
    "y": 300,
    "wires": []
  },
  {
    "id": "ed779155.11ae4",
    "type": "subflow:56368b94.f11494",
    "z": "d1172b8b.3d3298",
    "name": "",
    "env": [],
    "x": 740,
    "y": 240,
    "wires": [
      [
        "dcdab32e.51851"
      ],
      [],
      [
        "dcdab32e.51851"
      ]
    ]
  },
  {
    "id": "94fbbe31.aebc9",
    "type": "subflow:fec14295.8a46d",
    "z": "d1172b8b.3d3298",
    "name": "",
    "x": 540,
    "y": 240,
    "wires": [
      [
        "ed779155.11ae4"
      ],
      [],
      []
    ]
  },
  {
    "id": "8c895b54.0a9588",
    "type": "time-range-switch",
    "z": "56368b94.f11494",
    "name": "",
    "lat": "",
    "lon": "",
    "startTime": "sunriseEnd",
    "endTime": "sunsetStart",
    "startOffset": 0,
    "endOffset": 0,
    "x": 890,
    "y": 220,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "3218ec69.4bca34",
    "type": "trigger-state",
    "z": "d1172b8b.3d3298",
    "name": "Current Pos",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "sensor.blind_hallway_current_position",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": true,
    "state_type": "num",
    "x": 150,
    "y": 720,
    "wires": [
      [
        "dd1dc8cc.067d38",
        "563c9f2c.dc7c4"
      ],
      []
    ]
  },
  {
    "id": "dd1dc8cc.067d38",
    "type": "debug",
    "z": "d1172b8b.3d3298",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "x": 630,
    "y": 680,
    "wires": []
  },
  {
    "id": "84773bd2.99bed8",
    "type": "comment",
    "z": "d1172b8b.3d3298",
    "name": "Blind Logic",
    "info": "",
    "x": 160,
    "y": 560,
    "wires": []
  },
  {
    "id": "d118f7af.474a58",
    "type": "trigger-state",
    "z": "d1172b8b.3d3298",
    "name": "Number Changed",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_number.hallwayblind",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 640,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "699ef634.60e708",
    "type": "api-call-service",
    "z": "d1172b8b.3d3298",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "set_cover_position",
    "entityId": "cover.blind",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 500,
    "y": 640,
    "wires": [
      []
    ]
  },
  {
    "id": "83a33475.9201e8",
    "type": "api-call-service",
    "z": "d1172b8b.3d3298",
    "name": "Open",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "set_cover_position",
    "entityId": "cover.hallway_blind",
    "data": "{\"position\":95}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 710,
    "y": 820,
    "wires": [
      []
    ]
  },
  {
    "id": "8c0baf59.7ecfe",
    "type": "inject",
    "z": "d1172b8b.3d3298",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 320,
    "y": 780,
    "wires": [
      [
        "ebc396b5.597c88"
      ]
    ]
  },
  {
    "id": "9e2ef6d6.0b5fb8",
    "type": "api-call-service",
    "z": "d1172b8b.3d3298",
    "name": "",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_number",
    "service": "set_value",
    "entityId": "input_number.hallwayblind",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 800,
    "y": 760,
    "wires": [
      []
    ]
  },
  {
    "id": "8cba57fa.1fa358",
    "type": "api-call-service",
    "z": "d1172b8b.3d3298",
    "name": "Close Blind",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "set_cover_position",
    "entityId": "cover.hallway_blind",
    "data": "{\"position\":0}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 690,
    "y": 880,
    "wires": [
      []
    ]
  },
  {
    "id": "11278cd8.a471c3",
    "type": "inject",
    "z": "d1172b8b.3d3298",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 260,
    "y": 980,
    "wires": [
      [
        "70f4c965.2edba8"
      ]
    ]
  },
  {
    "id": "a1d080e4.29f15",
    "type": "debug",
    "z": "d1172b8b.3d3298",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 730,
    "y": 720,
    "wires": []
  },
  {
    "id": "563c9f2c.dc7c4",
    "type": "function",
    "z": "d1172b8b.3d3298",
    "name": "",
    "func": "\nvar r\nvar p = msg.payload;\nr = {\"data\":{\"value\":p}}\n\nreturn r",
    "outputs": 1,
    "noerr": 0,
    "x": 490,
    "y": 720,
    "wires": [
      [
        "9e2ef6d6.0b5fb8",
        "a1d080e4.29f15"
      ]
    ]
  },
  {
    "id": "70f4c965.2edba8",
    "type": "api-current-state",
    "z": "d1172b8b.3d3298",
    "name": "Is Closed",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "0",
    "halt_if_type": "num",
    "halt_if_compare": "gt",
    "override_topic": false,
    "entity_id": "sensor.blind_hallway_current_position",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 520,
    "y": 880,
    "wires": [
      [
        "8cba57fa.1fa358"
      ],
      []
    ]
  },
  {
    "id": "ebc396b5.597c88",
    "type": "api-current-state",
    "z": "d1172b8b.3d3298",
    "name": "Is Open",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "92",
    "halt_if_type": "num",
    "halt_if_compare": "lt",
    "override_topic": false,
    "entity_id": "sensor.blind_hallway_current_position",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 520,
    "y": 820,
    "wires": [
      [
        "83a33475.9201e8"
      ],
      []
    ]
  },
  {
    "id": "15424de5.911922",
    "type": "link in",
    "z": "d1172b8b.3d3298",
    "name": "Open Hallway Blind",
    "links": [
      "2d64a30b.7c287c"
    ],
    "x": 255,
    "y": 820,
    "wires": [
      [
        "ebc396b5.597c88"
      ]
    ]
  },
  {
    "id": "579218ea.5178a8",
    "type": "link in",
    "z": "d1172b8b.3d3298",
    "name": "Close Hallway Blind",
    "links": [],
    "x": 255,
    "y": 880,
    "wires": [
      [
        "70f4c965.2edba8"
      ]
    ]
  },
  {
    "id": "2d64a30b.7c287c",
    "type": "link out",
    "z": "21d6efde.d0943",
    "name": "Bed Empty for 8 Min",
    "links": [
      "15424de5.911922"
    ],
    "x": 1075,
    "y": 920,
    "wires": []
  },
  {
    "id": "c4f42088.33c4a",
    "type": "trigger-state",
    "z": "a0cdc0f9.a362b",
    "name": "Bath Is wet",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.water_bath",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "2b53jy80ay5",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "2pi79jbuhas",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 140,
    "y": 2760,
    "wires": [
      [
        "98784fb2.de356"
      ],
      []
    ]
  },
  {
    "id": "98784fb2.de356",
    "type": "delay",
    "z": "a0cdc0f9.a362b",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "15",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 360,
    "y": 2760,
    "wires": [
      [
        "257fec5a.d920d4",
        "13dfe582.3112fa"
      ]
    ]
  },
  {
    "id": "257fec5a.d920d4",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a0cdc0f9.a362b",
    "name": "Bath is ready",
    "env": [
      {
        "name": "message",
        "value": "Bath is ready",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      }
    ],
    "x": 590,
    "y": 2760,
    "wires": []
  },
  {
    "id": "3f227561.20ac5a",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Bath is read",
    "info": "",
    "x": 130,
    "y": 2700,
    "wires": []
  },
  {
    "id": "bcc04b7b.85b428",
    "type": "inject",
    "z": "9a341993.fbc528",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 2720,
    "wires": [
      []
    ]
  },
  {
    "id": "7173ef33.c11c",
    "type": "inject",
    "z": "9a341993.fbc528",
    "name": "",
    "repeat": "60",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "Every Minute",
    "payload": "",
    "payloadType": "date",
    "x": 190,
    "y": 2720,
    "wires": [
      [
        "10f1d1dc.850a5e"
      ]
    ]
  },
  {
    "id": "10f1d1dc.850a5e",
    "type": "api-current-state",
    "z": "9a341993.fbc528",
    "name": "Is Fire Stick Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "media_player.living_room_fire_tv",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 440,
    "y": 2720,
    "wires": [
      [
        "15aa591b.3118d7"
      ],
      []
    ]
  },
  {
    "id": "15aa591b.3118d7",
    "type": "subflow:50a84f0.9f6dbb",
    "z": "9a341993.fbc528",
    "name": "",
    "env": [],
    "x": 650,
    "y": 2720,
    "wires": [
      []
    ]
  },
  {
    "id": "6be188e5.f97488",
    "type": "comment",
    "z": "9a341993.fbc528",
    "name": "Once Minute Check",
    "info": "",
    "x": 150,
    "y": 2680,
    "wires": []
  },
  {
    "id": "84ba3598.6c50e8",
    "type": "change",
    "z": "a0cdc0f9.a362b",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "me",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 870,
    "y": 220,
    "wires": [
      [
        "c6403382.59d75"
      ]
    ]
  },
  {
    "id": "6122d212.c9789c",
    "type": "link out",
    "z": "a0cdc0f9.a362b",
    "name": "Start up Light On",
    "links": [
      "ef383b90.090248"
    ],
    "x": 1035,
    "y": 100,
    "wires": []
  },
  {
    "id": "bbdf8cac.2e19",
    "type": "inject",
    "z": "a0cdc0f9.a362b",
    "name": "10Sec Start Upd",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10s",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 730,
    "y": 100,
    "wires": [
      [
        "4d717f68.041d7"
      ]
    ]
  },
  {
    "id": "4d717f68.041d7",
    "type": "api-current-state",
    "z": "a0cdc0f9.a362b",
    "name": "Light On?",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.bathroom",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 920,
    "y": 100,
    "wires": [
      [
        "6122d212.c9789c"
      ],
      []
    ]
  },
  {
    "id": "3b8a834.9f67e7c",
    "type": "comment",
    "z": "a0cdc0f9.a362b",
    "name": "Start up trigger count down ",
    "info": "",
    "x": 750,
    "y": 60,
    "wires": []
  },
  {
    "id": "18282b56.a4d3b5",
    "type": "api-call-service",
    "z": "a0cdc0f9.a362b",
    "name": "Turn On Bathtime",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.bathtime",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 790,
    "y": 2800,
    "wires": [
      []
    ]
  },
  {
    "id": "13dfe582.3112fa",
    "type": "api-current-state",
    "z": "a0cdc0f9.a362b",
    "name": "Bathtime Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.bathtime",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 590,
    "y": 2800,
    "wires": [
      [
        "18282b56.a4d3b5"
      ],
      []
    ]
  },
  {
    "id": "9086d0ab.761df",
    "type": "api-current-state",
    "z": "21d6efde.d0943",
    "name": "Bed Empty",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "0",
    "halt_if_type": "num",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "sensor.num_in_master_bed",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 770,
    "y": 3300,
    "wires": [
      [
        "a6e879f5.cba028"
      ],
      []
    ]
  },
  {
    "id": "ca273093.5cb1",
    "type": "api-call-service",
    "z": "84ed1066.f22de",
    "name": "fridge_temp_warning - ON",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.fridge_temp_warning",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1720,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "c60c5993.eeb3d8",
    "type": "api-call-service",
    "z": "84ed1066.f22de",
    "name": "fridge_temp_warning - Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.fridge_temp_warning",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1710,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "4872f683.b6b3a8",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "84ed1066.f22de",
    "name": "Frigde temperature restored",
    "env": [
      {
        "name": "message",
        "value": "Frigde temperature restored",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      }
    ],
    "x": 1720,
    "y": 220,
    "wires": []
  },
  {
    "id": "99388b0c.5d9408",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "84ed1066.f22de",
    "name": "Warning! Fridge is greater then 6C",
    "env": [
      {
        "name": "message",
        "value": "Warning! Fridge is greater then 6C",
        "type": "str"
      }
    ],
    "x": 1740,
    "y": 80,
    "wires": []
  },
  {
    "id": "4dbddc9e.21a464",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "84ed1066.f22de",
    "name": "Warning! Fridge is greater then 6C",
    "env": [
      {
        "name": "message",
        "value": "Warning! Fridge is greater then 6C",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      }
    ],
    "x": 2400,
    "y": 120,
    "wires": []
  },
  {
    "id": "a2e16c2c.312fc",
    "type": "debug",
    "z": "48ba348c.61270c",
    "name": "Test Alex",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 720,
    "y": 2100,
    "wires": []
  },
  {
    "id": "d88cca8e.35c738",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Bedroom MCU - Not Posted Temp",
    "info": "",
    "x": 200,
    "y": 2620,
    "wires": []
  },
  {
    "id": "d44dc410.0eee78",
    "type": "mqtt in",
    "z": "48ba348c.61270c",
    "name": "",
    "topic": "bedroom/senorarray",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 150,
    "y": 2660,
    "wires": [
      [
        "b8afb169.24c3c"
      ]
    ]
  },
  {
    "id": "b8afb169.24c3c",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "2",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 2660,
    "wires": [
      [
        "12911573.5a6f9b"
      ]
    ]
  },
  {
    "id": "a8cc8445.bff498",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "10 Second After Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 170,
    "y": 2700,
    "wires": [
      [
        "b8afb169.24c3c",
        "1f2a56db.97de59"
      ]
    ]
  },
  {
    "id": "85977658.662578",
    "type": "link in",
    "z": "48ba348c.61270c",
    "name": "",
    "links": [
      "82cfabc3.c2c478",
      "20b5a1d8.a650fe",
      "a1cec523.a181e8",
      "f7cb7ddf.cc703",
      "48a7f807.8583d8",
      "a6165491.aa9ba8",
      "b32e27f7.8449f8",
      "f6daaed4.01e24",
      "ab9413e4.3c106",
      "3a06d91d.c9d8a6",
      "51f52cc1.b9deb4",
      "748d8b68.2ac2f4",
      "856f0f59.ec59e",
      "e81c2f88.73a11",
      "6d9e86a4.e66318",
      "38b94500.07dd2c",
      "e52d023e.a2257",
      "5bf6b67f.8898b8"
    ],
    "x": 75,
    "y": 240,
    "wires": [
      [
        "354d9c54.764304"
      ]
    ]
  },
  {
    "id": "354d9c54.764304",
    "type": "function",
    "z": "48ba348c.61270c",
    "name": "Bulid Message",
    "func": "msg = {\n   \n   to:\"matbrewer396@gmail.com\",\n   topic: \"Fault Detected - \" + msg.fault.name,\n   payload: \"Item: \"  + msg.fault.item + \"\\nAction To Fix: \" + msg.fault.actiontofix \n};\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 280,
    "y": 240,
    "wires": [
      [
        "d964ced3.a3949"
      ]
    ]
  },
  {
    "id": "d964ced3.a3949",
    "type": "subflow:a0cc6149.1f76e",
    "z": "48ba348c.61270c",
    "name": "",
    "x": 510,
    "y": 240,
    "wires": []
  },
  {
    "id": "1f2a56db.97de59",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 2700,
    "wires": [
      [
        "12911573.5a6f9b"
      ]
    ]
  },
  {
    "id": "5e19c6f3.90c3e8",
    "type": "mqtt out",
    "z": "484cfc13.181de4",
    "name": "Post to MQTT",
    "topic": "",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 860,
    "y": 200,
    "wires": []
  },
  {
    "id": "beb4662d.2583b8",
    "type": "function",
    "z": "484cfc13.181de4",
    "name": "Bulid Message",
    "func": "msg = {\n   \n   to:\"matbrewer396@gmail.com\",\n   topic: \"Fault Detected - \" + msg.fault.name,\n   payload: \"Item: \"  + msg.fault.item + \"\\nAction To Fix: \" + msg.fault.actiontofix \n};\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 860,
    "y": 120,
    "wires": [
      [
        "5d61477c.3bce68"
      ]
    ]
  },
  {
    "id": "5d61477c.3bce68",
    "type": "subflow:a0cc6149.1f76e",
    "z": "484cfc13.181de4",
    "name": "",
    "x": 1050,
    "y": 120,
    "wires": []
  },
  {
    "id": "7566d92d.f1ac28",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "484cfc13.181de4",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD_MSG",
        "type": "str"
      },
      {
        "name": "who",
        "value": "matt",
        "type": "str"
      }
    ],
    "x": 1060,
    "y": 160,
    "wires": []
  },
  {
    "id": "bf2b1d2e.9a03a",
    "type": "change",
    "z": "484cfc13.181de4",
    "name": "Set Message",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "fault.name",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 850,
    "y": 160,
    "wires": [
      [
        "7566d92d.f1ac28"
      ]
    ]
  },
  {
    "id": "a9dd1ec7.77a27",
    "type": "switch",
    "z": "484cfc13.181de4",
    "name": "offline",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "neq",
        "v": "online",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 690,
    "y": 140,
    "wires": [
      [
        "beb4662d.2583b8",
        "bf2b1d2e.9a03a"
      ]
    ]
  },
  {
    "id": "12911573.5a6f9b",
    "type": "subflow:484cfc13.181de4",
    "z": "48ba348c.61270c",
    "name": "Bedroom MCU - Not Posted Temp",
    "env": [
      {
        "name": "fault.name",
        "value": "Bedroom MCU - Not Posted Temp",
        "type": "str"
      },
      {
        "name": "fault.item",
        "value": "Bedroom Node MCU",
        "type": "str"
      },
      {
        "name": "fault.actiontofix",
        "value": "Restart it",
        "type": "str"
      },
      {
        "name": "availbility.topic",
        "value": "availability/bedroomMCU/senorarray",
        "type": "str"
      }
    ],
    "x": 740,
    "y": 2680,
    "wires": []
  },
  {
    "id": "d183e95.6471018",
    "type": "function",
    "z": "484cfc13.181de4",
    "name": "Build msg",
    "func": "var fname = env.get(\"fault.name\")\nvar item = env.get(\"fault.item\")\nvar actiontofix = env.get(\"fault.actiontofix\")\nvar topic = env.get(\"availbility.topic\")\n\nmsg = {\"fault\":{ \n            \"name\":fname,\n            \"item\":item,\n            \"actiontofix\":actiontofix\n            },\n        \"topic\":topic,\n        \"payload\":msg.payload\n}\n        \n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 500,
    "y": 140,
    "wires": [
      [
        "a9dd1ec7.77a27",
        "5e19c6f3.90c3e8",
        "43d401fb.00c89"
      ]
    ]
  },
  {
    "id": "43d401fb.00c89",
    "type": "debug",
    "z": "484cfc13.181de4",
    "name": "fault detcted",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 680,
    "y": 280,
    "wires": []
  },
  {
    "id": "639e2403.5058fc",
    "type": "watch",
    "z": "b8a16318.b66a5",
    "name": "Group Change",
    "files": "/config/user_content/device_counters.yaml",
    "recursive": "",
    "x": 180,
    "y": 1180,
    "wires": [
      [
        "3bb1c0e5.2cf8b"
      ]
    ]
  },
  {
    "id": "8581dca0.95c08",
    "type": "api-call-service",
    "z": "b8a16318.b66a5",
    "name": "Reload Groups",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "group",
    "service": "reload",
    "entityId": "",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 640,
    "y": 1180,
    "wires": [
      []
    ]
  },
  {
    "id": "3bb1c0e5.2cf8b",
    "type": "delay",
    "z": "b8a16318.b66a5",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "3",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 420,
    "y": 1180,
    "wires": [
      [
        "8581dca0.95c08"
      ]
    ]
  },
  {
    "id": "9ed9cb7c.5fa038",
    "type": "inject",
    "z": "21d6efde.d0943",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 960,
    "y": 700,
    "wires": [
      [
        "e7c2066f.c4ddf8"
      ]
    ]
  },
  {
    "id": "d74630e8.b4909",
    "type": "comment",
    "z": "48ba348c.61270c",
    "name": "Bathroom MCU - Not Posted Temp",
    "info": "",
    "x": 200,
    "y": 2760,
    "wires": []
  },
  {
    "id": "b4c6c87d.23ca68",
    "type": "mqtt in",
    "z": "48ba348c.61270c",
    "name": "",
    "topic": "bathroom/senorarray",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 150,
    "y": 2800,
    "wires": [
      [
        "8661edcc.3be77"
      ]
    ]
  },
  {
    "id": "8661edcc.3be77",
    "type": "trigger",
    "z": "48ba348c.61270c",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "2",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 2800,
    "wires": [
      [
        "cb282ca8.cd75f"
      ]
    ]
  },
  {
    "id": "3bc8dc13.a3f8c4",
    "type": "inject",
    "z": "48ba348c.61270c",
    "name": "10 Second After Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 170,
    "y": 2840,
    "wires": [
      [
        "8661edcc.3be77",
        "a4acf032.66917"
      ]
    ]
  },
  {
    "id": "a4acf032.66917",
    "type": "change",
    "z": "48ba348c.61270c",
    "name": "Online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 2840,
    "wires": [
      [
        "cb282ca8.cd75f"
      ]
    ]
  },
  {
    "id": "cb282ca8.cd75f",
    "type": "subflow:484cfc13.181de4",
    "z": "48ba348c.61270c",
    "name": "Bathroom MCU - Not Posted Temp",
    "env": [
      {
        "name": "fault.name",
        "value": "Bathroom MCU - Not Posted Temp",
        "type": "str"
      },
      {
        "name": "fault.item",
        "value": "Bath Node MCU",
        "type": "str"
      },
      {
        "name": "fault.actiontofix",
        "value": "Restart it",
        "type": "str"
      },
      {
        "name": "availbility.topic",
        "value": "availability/bathroomMCU/senorarray",
        "type": "str"
      }
    ],
    "x": 740,
    "y": 2820,
    "wires": []
  },
  {
    "id": "7d6dc10a.845af",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Close Blind",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "set_cover_position",
    "entityId": "cover.hallway_blind",
    "data": "{\"position\":0}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1050,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "d55df0b8.b9985",
    "type": "api-current-state",
    "z": "c9b308f8.01ef68",
    "name": "Is Closed",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "0",
    "halt_if_type": "num",
    "halt_if_compare": "gt",
    "override_topic": false,
    "entity_id": "sensor.blind_hallway_current_position",
    "state_type": "num",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 880,
    "y": 260,
    "wires": [
      [
        "7d6dc10a.845af"
      ],
      []
    ]
  },
  {
    "id": "c87086a7.b7e0f8",
    "type": "inject",
    "z": "d1172b8b.3d3298",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 480,
    "y": 980,
    "wires": [
      [
        "8cba57fa.1fa358"
      ]
    ]
  },
  {
    "id": "4dca5a14.453ec4",
    "type": "subflow:e2e6b53d.b747f8",
    "z": "dceb45d8.425368",
    "name": "",
    "env": [
      {
        "name": "InputPrefix",
        "value": "input_boolean.automation_mattlunchtime",
        "type": "str"
      }
    ],
    "x": 920,
    "y": 100,
    "wires": [
      [
        "bb795d4b.f8fac"
      ],
      []
    ]
  },
  {
    "id": "744b9657.394938",
    "type": "api-call-service",
    "z": "dceb45d8.425368",
    "name": "Update Status - On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.lunchtimetimer",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1530,
    "y": 420,
    "wires": [
      []
    ]
  },
  {
    "id": "b46723fe.38fbf",
    "type": "api-call-service",
    "z": "dceb45d8.425368",
    "name": "Update Status - Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_off",
    "entityId": "input_boolean.lunchtimetimer",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 2090,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "663b8d8b.fab114",
    "type": "trigger-state",
    "z": "dceb45d8.425368",
    "name": "Timer State Changes to Off",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "input_boolean.lunchtimetimer",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "uhzdgpawuc",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "xwjrwep83v",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 820,
    "y": 320,
    "wires": [
      [
        "c10515b6.577c78"
      ],
      []
    ]
  },
  {
    "id": "c4bb67ee.814568",
    "type": "switch",
    "z": "cd950567.f864b8",
    "name": "If = 0",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 530,
    "y": 220,
    "wires": [
      [
        "bb6ce56f.291538"
      ],
      [
        "fcd4d38c.3a3f8",
        "b3c666ee.88c4a8"
      ]
    ]
  },
  {
    "id": "bb6ce56f.291538",
    "type": "delay",
    "z": "cd950567.f864b8",
    "name": "",
    "pauseType": "delay",
    "timeout": "15",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 840,
    "y": 180,
    "wires": [
      [
        "b3c666ee.88c4a8"
      ]
    ]
  },
  {
    "id": "fcd4d38c.3a3f8",
    "type": "change",
    "z": "cd950567.f864b8",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "reset",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 610,
    "y": 160,
    "wires": [
      [
        "bb6ce56f.291538"
      ]
    ]
  },
  {
    "id": "f95eff10.16fd5",
    "type": "switch",
    "z": "cd950567.f864b8",
    "name": "If = 0",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 510,
    "y": 400,
    "wires": [
      [
        "ccff034e.e9724"
      ],
      [
        "b6467f08.18ecf",
        "406545cd.70f59c"
      ]
    ]
  },
  {
    "id": "ccff034e.e9724",
    "type": "delay",
    "z": "cd950567.f864b8",
    "name": "",
    "pauseType": "delay",
    "timeout": "15",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 820,
    "y": 360,
    "wires": [
      [
        "406545cd.70f59c"
      ]
    ]
  },
  {
    "id": "b6467f08.18ecf",
    "type": "change",
    "z": "cd950567.f864b8",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "reset",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 590,
    "y": 340,
    "wires": [
      [
        "ccff034e.e9724"
      ]
    ]
  },
  {
    "id": "910e61d7.dd337",
    "type": "comment",
    "z": "cd950567.f864b8",
    "name": "Some silly pwoer cycle - it drop 5 seconds",
    "info": "",
    "x": 840,
    "y": 120,
    "wires": []
  },
  {
    "id": "88936f8a.201dd",
    "type": "delay",
    "z": "84ed1066.f22de",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "5",
    "nbRateUnits": "1",
    "rateUnits": "day",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 2130,
    "y": 180,
    "wires": [
      [
        "4dbddc9e.21a464"
      ]
    ]
  },
  {
    "id": "4688f534.30ec5c",
    "type": "api-call-service",
    "z": "6a3dc053.8b5b6",
    "name": "Bed Room Fan",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "toggle",
    "entityId": "switch.plug_04",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 600,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "1f5285a2.a5e99a",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "6a3dc053.8b5b6",
    "name": "Pong",
    "env": [
      {
        "name": "message",
        "value": "Pong",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      },
      {
        "name": "category",
        "value": "PONG",
        "type": "str"
      },
      {
        "name": "action",
        "value": "[{\"action\":\"PING\",\"title\":\"Ping 1\"},{\"action\":\"PING2\",\"title\":\"Ping 2\"}]",
        "type": "json"
      }
    ],
    "x": 570,
    "y": 520,
    "wires": []
  },
  {
    "id": "e876947a.ecf3b8",
    "type": "api-call-service",
    "z": "6a3dc053.8b5b6",
    "name": "Bed Room Side Pug",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "toggle",
    "entityId": "switch.plug_08",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 620,
    "y": 560,
    "wires": [
      []
    ]
  },
  {
    "id": "53ad57b4.ed1798",
    "type": "server-events",
    "z": "6a3dc053.8b5b6",
    "name": "ISO Event",
    "server": "5ee4d578.f7736c",
    "event_type": "ios.notification_action_fired",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "x": 180,
    "y": 720,
    "wires": [
      [
        "e586f3a6.5920d",
        "94a94fda.ca9a8"
      ]
    ]
  },
  {
    "id": "e586f3a6.5920d",
    "type": "switch",
    "z": "6a3dc053.8b5b6",
    "name": "PING",
    "property": "payload.event.actionName",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "PING",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 400,
    "y": 720,
    "wires": [
      [
        "ef99cf27.c6481"
      ]
    ]
  },
  {
    "id": "ef99cf27.c6481",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "6a3dc053.8b5b6",
    "name": "Pong",
    "env": [
      {
        "name": "message",
        "value": "Pong from notication actiom",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      },
      {
        "name": "action",
        "value": "[{\"action\":\"PING\",\"title\":\"Ping 1\"},{\"action\":\"PING2\",\"title\":\"Ping 2\"}]",
        "type": "json"
      }
    ],
    "x": 590,
    "y": 720,
    "wires": []
  },
  {
    "id": "94a94fda.ca9a8",
    "type": "debug",
    "z": "6a3dc053.8b5b6",
    "name": "ISO Notication Event",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 440,
    "y": 760,
    "wires": []
  },
  {
    "id": "725fe1b6.2938e",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 1320,
    "wires": [
      [
        "3532dffe.1ad68"
      ]
    ]
  },
  {
    "id": "3532dffe.1ad68",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "5625076e.ee59e8",
    "name": "Test To Both",
    "env": [
      {
        "name": "message",
        "value": "Test To Both from node red - did you get this?",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 490,
    "y": 1320,
    "wires": []
  },
  {
    "id": "b2322e82.3fe0f",
    "type": "delay",
    "z": "6e74caff.7ad1f4",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "3",
    "nbRateUnits": "2",
    "rateUnits": "hour",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 560,
    "y": 240,
    "wires": [
      [
        "40895bf9.d34864",
        "90c2b8ec.3950d8"
      ]
    ]
  },
  {
    "id": "922d39aa.a4bb88",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a068bd5.28a8d4",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 1480,
    "y": 1100,
    "wires": []
  },
  {
    "id": "5207bd7b.39f254",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm Disarmed",
    "env": [
      {
        "name": "message",
        "value": "Alarm Disarmed",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 1360,
    "y": 860,
    "wires": []
  },
  {
    "id": "7d81f06.7dd5b1",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "a0a4859f.5a2a48",
    "name": "Alarm Disarmed",
    "env": [
      {
        "name": "message",
        "value": "Alarm still going off disable light show",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      }
    ],
    "x": 1000,
    "y": 760,
    "wires": []
  },
  {
    "id": "ed279203.c0c33",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Ground Floor Toliet - Open",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.ground_floor_toilet_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "b9h2ggymwte",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "bw2sensbajw",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 260,
    "y": 360,
    "wires": [
      [
        "5272f256.371e9c"
      ],
      []
    ]
  },
  {
    "id": "574a14cf.c54d6c",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Ground Floor Toliet - Closed",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.ground_floor_toilet_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "awsqo57aegu",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      },
      {
        "id": "gso37lm0u5j",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 260,
    "y": 400,
    "wires": [
      [
        "e64e98bc.18e568"
      ],
      []
    ]
  },
  {
    "id": "5272f256.371e9c",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - Ground Floor Toliet - Open",
    "links": [
      "7945bafd.c5cb64",
      "e365e486.2ba248"
    ],
    "x": 475,
    "y": 360,
    "wires": []
  },
  {
    "id": "e64e98bc.18e568",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - Ground Floor Toliet - Closed",
    "links": [
      "7f72104.431c4f",
      "82965396.14b57"
    ],
    "x": 475,
    "y": 400,
    "wires": []
  },
  {
    "id": "b94a65a8.9c4b98",
    "type": "comment",
    "z": "e6716385.6d8c2",
    "name": "Door Open",
    "info": "",
    "x": 160,
    "y": 200,
    "wires": []
  },
  {
    "id": "7945bafd.c5cb64",
    "type": "link in",
    "z": "e6716385.6d8c2",
    "name": "ACT - Door Open",
    "links": [
      "5272f256.371e9c"
    ],
    "x": 115,
    "y": 240,
    "wires": [
      [
        "99a743c2.e6471",
        "d1efacff.ab5f9",
        "adba4581.8465c8"
      ]
    ]
  },
  {
    "id": "7befce21.e23cb",
    "type": "comment",
    "z": "e6716385.6d8c2",
    "name": "Door Closed",
    "info": "",
    "x": 170,
    "y": 332,
    "wires": []
  },
  {
    "id": "7f72104.431c4f",
    "type": "link in",
    "z": "e6716385.6d8c2",
    "name": "ACT - Door Closed",
    "links": [
      "e64e98bc.18e568"
    ],
    "x": 115,
    "y": 372,
    "wires": [
      [
        "99a743c2.e6471",
        "c0b98db5.0c20b",
        "de7abf67.fd15d"
      ]
    ]
  },
  {
    "id": "d1efacff.ab5f9",
    "type": "trigger",
    "z": "e6716385.6d8c2",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "1",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 670,
    "y": 240,
    "wires": [
      [
        "ddafdac6.f17458"
      ]
    ]
  },
  {
    "id": "99a743c2.e6471",
    "type": "api-call-service",
    "z": "e6716385.6d8c2",
    "name": "Turn On - Max",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.ground_floor_toilet",
    "data": "{\"brightness_pct\":\"100\",\"transition\":\"2\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 380,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "ead8620d.c7a9e",
    "type": "api-call-service",
    "z": "e6716385.6d8c2",
    "name": "Slow off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.ground_floor_toilet",
    "data": "{\"transition\":\"20\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1220,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "ddafdac6.f17458",
    "type": "api-call-service",
    "z": "e6716385.6d8c2",
    "name": "Instance Dim",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.ground_floor_toilet",
    "data": "{\"brightness_pct\":\"70\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 970,
    "y": 300,
    "wires": [
      [
        "ead8620d.c7a9e"
      ]
    ]
  },
  {
    "id": "de7abf67.fd15d",
    "type": "trigger",
    "z": "e6716385.6d8c2",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "10",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 670,
    "y": 360,
    "wires": [
      [
        "ddafdac6.f17458"
      ]
    ]
  },
  {
    "id": "adba4581.8465c8",
    "type": "change",
    "z": "e6716385.6d8c2",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 350,
    "y": 260,
    "wires": [
      [
        "de7abf67.fd15d"
      ]
    ]
  },
  {
    "id": "c0b98db5.0c20b",
    "type": "change",
    "z": "e6716385.6d8c2",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 350,
    "y": 340,
    "wires": [
      [
        "d1efacff.ab5f9"
      ]
    ]
  },
  {
    "id": "9b6604aa.359578",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - FAST_LOW",
    "env": [
      {
        "name": "Light Level",
        "value": "FAST_LOW",
        "type": "str"
      }
    ],
    "x": 400,
    "y": 1180,
    "wires": [
      []
    ]
  },
  {
    "id": "e2585915.37a2e8",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - SLOW_LOW",
    "env": [
      {
        "name": "Light Level",
        "value": "SLOW_LOW",
        "type": "str"
      }
    ],
    "x": 400,
    "y": 1220,
    "wires": [
      []
    ]
  },
  {
    "id": "f5b0f47e.dda648",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - HIGH",
    "env": [
      {
        "name": "Light Level",
        "value": "HIGH",
        "type": "str"
      }
    ],
    "x": 380,
    "y": 1260,
    "wires": [
      []
    ]
  },
  {
    "id": "5df54694.ddcb18",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - DIMMED",
    "env": [
      {
        "name": "Light Level",
        "value": "DIMMED",
        "type": "str"
      }
    ],
    "x": 390,
    "y": 1300,
    "wires": [
      []
    ]
  },
  {
    "id": "4dc7d59d.1755fc",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - HIGH",
    "env": [
      {
        "name": "Light Level",
        "value": "HIGH",
        "type": "str"
      }
    ],
    "x": 1720,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "3b6b00df.83105",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - SLOW_LOW",
    "env": [
      {
        "name": "Light Level",
        "value": "SLOW_LOW",
        "type": "str"
      }
    ],
    "x": 1600,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "b945e297.cc631",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - FAST_LOW",
    "env": [
      {
        "name": "Light Level",
        "value": "FAST_LOW",
        "type": "str"
      }
    ],
    "x": 2100,
    "y": 620,
    "wires": [
      []
    ]
  },
  {
    "id": "ac8b17ae.6c2cb8",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - HIGH",
    "env": [
      {
        "name": "Light Level",
        "value": "HIGH",
        "type": "str"
      }
    ],
    "x": 940,
    "y": 1060,
    "wires": [
      []
    ]
  },
  {
    "id": "bd2991b6.e3bb8",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - DIMMED",
    "env": [
      {
        "name": "Light Level",
        "value": "DIMMED",
        "type": "str"
      }
    ],
    "x": 1330,
    "y": 220,
    "wires": [
      [
        "bf1745aa.99ae38"
      ]
    ]
  },
  {
    "id": "c7837085.fa407",
    "type": "subflow:7df159d5.618c58",
    "z": "21d6efde.d0943",
    "name": "Set Bed Light - FAST_LOW",
    "env": [
      {
        "name": "Light Level",
        "value": "FAST_LOW",
        "type": "str"
      }
    ],
    "x": 1800,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "32262f6b.fe44f",
    "type": "comment",
    "z": "9cb589d.fe06478",
    "name": "BedRoom Availability",
    "info": "",
    "x": 160,
    "y": 220,
    "wires": []
  },
  {
    "id": "7ee2e96c.cd98e8",
    "type": "mqtt in",
    "z": "9cb589d.fe06478",
    "name": "",
    "topic": "checkIn/bedroomMCU",
    "qos": "2",
    "broker": "1b6bc4ba.56ff4b",
    "x": 160,
    "y": 260,
    "wires": [
      [
        "8d532b83.a244c8",
        "9e29d28b.9d494"
      ]
    ]
  },
  {
    "id": "8d532b83.a244c8",
    "type": "trigger",
    "z": "9cb589d.fe06478",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "4",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 240,
    "wires": [
      [
        "56e72d4b.564584"
      ]
    ]
  },
  {
    "id": "56e72d4b.564584",
    "type": "mqtt out",
    "z": "9cb589d.fe06478",
    "name": "availability/bedroomMCU",
    "topic": "availability/bedroomMCU",
    "qos": "2",
    "retain": "true",
    "broker": "1b6bc4ba.56ff4b",
    "x": 770,
    "y": 300,
    "wires": []
  },
  {
    "id": "9e29d28b.9d494",
    "type": "change",
    "z": "9cb589d.fe06478",
    "name": "online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 280,
    "wires": [
      [
        "56e72d4b.564584"
      ]
    ]
  },
  {
    "id": "e351ae57.5b19f",
    "type": "api-call-service",
    "z": "9cb589d.fe06478",
    "name": "Lett Matt Know",
    "server": "eef5a84.da24f58",
    "service_domain": "notify",
    "service": "mattiphone",
    "data": "{\"message\":\"Bedroom Node MCU - Offline\"}",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 1180,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "87d56df5.d289e",
    "type": "change",
    "z": "9cb589d.fe06478",
    "name": "Fault Details",
    "rules": [
      {
        "t": "set",
        "p": "fault.name",
        "pt": "msg",
        "to": "Bedroom Node MCU has not checked in",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.item",
        "pt": "msg",
        "to": "Bedroom Node MCU",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fault.actiontofix",
        "pt": "msg",
        "to": "Restart bedroom node mcu",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "devicecheckin.bedroom",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 930,
    "y": 220,
    "wires": [
      [
        "5bf6b67f.8898b8"
      ]
    ]
  },
  {
    "id": "5bf6b67f.8898b8",
    "type": "link out",
    "z": "9cb589d.fe06478",
    "name": "Fault Detected",
    "links": [
      "c6717092.75d4b",
      "85977658.662578"
    ],
    "x": 1135,
    "y": 220,
    "wires": []
  },
  {
    "id": "e7e5e877.a4d608",
    "type": "subflow:85970b46.61e358",
    "z": "9cb589d.fe06478",
    "name": "",
    "env": [
      {
        "name": "NoteType",
        "type": "str",
        "value": "FAULT_DETECTION"
      }
    ],
    "x": 940,
    "y": 260,
    "wires": [
      [
        "e351ae57.5b19f"
      ],
      []
    ]
  },
  {
    "id": "6d3a5639.9ad6f8",
    "type": "comment",
    "z": "9cb589d.fe06478",
    "name": "Bedroom MCU - Not Posted Temp",
    "info": "",
    "x": 200,
    "y": 380,
    "wires": []
  },
  {
    "id": "e39e6098.05b8d",
    "type": "mqtt in",
    "z": "9cb589d.fe06478",
    "name": "",
    "topic": "bedroom/senorarray",
    "qos": "2",
    "datatype": "auto",
    "broker": "1b6bc4ba.56ff4b",
    "x": 150,
    "y": 420,
    "wires": [
      [
        "7a7aafea.4341a"
      ]
    ]
  },
  {
    "id": "7a7aafea.4341a",
    "type": "trigger",
    "z": "9cb589d.fe06478",
    "name": "",
    "op1": "",
    "op2": "offline",
    "op1type": "nul",
    "op2type": "str",
    "duration": "2",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 430,
    "y": 420,
    "wires": [
      [
        "af307b00.e63658"
      ]
    ]
  },
  {
    "id": "2425477c.5f6488",
    "type": "inject",
    "z": "9cb589d.fe06478",
    "name": "10 Second After Start up",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 170,
    "y": 460,
    "wires": [
      [
        "7a7aafea.4341a",
        "b5f98aa.f55e978"
      ]
    ]
  },
  {
    "id": "b5f98aa.f55e978",
    "type": "change",
    "z": "9cb589d.fe06478",
    "name": "Online",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "online",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 460,
    "wires": [
      [
        "af307b00.e63658"
      ]
    ]
  },
  {
    "id": "af307b00.e63658",
    "type": "subflow:484cfc13.181de4",
    "z": "9cb589d.fe06478",
    "name": "Bedroom MCU - Not Posted Temp",
    "env": [
      {
        "name": "fault.name",
        "value": "Bedroom MCU - Not Posted Temp",
        "type": "str"
      },
      {
        "name": "fault.item",
        "value": "Bedroom Node MCU",
        "type": "str"
      },
      {
        "name": "fault.actiontofix",
        "value": "Restart it",
        "type": "str"
      },
      {
        "name": "availbility.topic",
        "value": "availability/bedroomMCU/senorarray",
        "type": "str"
      }
    ],
    "x": 740,
    "y": 440,
    "wires": []
  },
  {
    "id": "77d14996.4e69c8",
    "type": "counter",
    "z": "3c093842.944ef8",
    "name": "button counter",
    "init": "0",
    "step": "1",
    "lower": "",
    "upper": "",
    "mode": "increment",
    "outputs": 1,
    "x": 520,
    "y": 160,
    "wires": [
      [
        "ce431e8a.f2af1"
      ]
    ]
  },
  {
    "id": "b26905f3.b03a98",
    "type": "change",
    "z": "3c093842.944ef8",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 490,
    "y": 240,
    "wires": [
      [
        "77d14996.4e69c8"
      ]
    ]
  },
  {
    "id": "394a27fa.aac8a8",
    "type": "trigger",
    "z": "3c093842.944ef8",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "payl",
    "duration": "500",
    "extend": true,
    "units": "ms",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 940,
    "y": 160,
    "wires": [
      [
        "b26905f3.b03a98"
      ]
    ]
  },
  {
    "id": "ce431e8a.f2af1",
    "type": "switch",
    "z": "3c093842.944ef8",
    "name": "Reset Blcoker",
    "property": "reset",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 720,
    "y": 160,
    "wires": [
      [],
      [
        "394a27fa.aac8a8"
      ]
    ]
  },
  {
    "id": "d8e04257.04393",
    "type": "switch",
    "z": "c47facfc.ae997",
    "name": "EventCode",
    "property": "msg.payload.event.event",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "1001",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2001",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "1003",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2003",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 6,
    "x": 570,
    "y": 260,
    "wires": [
      [
        "d2c9d4ac.2bbea8"
      ],
      [
        "bf24423f.df689"
      ],
      [
        "4e3c5d6e.176a04"
      ],
      [
        "4082089f.91a948"
      ],
      [],
      []
    ]
  },
  {
    "id": "f77eb657.3b7508",
    "type": "api-call-service",
    "z": "c47facfc.ae997",
    "name": "Decrease Brightness",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "deconz",
    "service": "configure",
    "entityId": "",
    "data": "{\"field\":\"/state\",\"data\":{\"bri_inc\":-254,\"transitiontime\":35}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1500,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "77827cb0.c1bc04",
    "type": "api-call-service",
    "z": "c47facfc.ae997",
    "name": "Increase Brightness",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "deconz",
    "service": "configure",
    "entityId": "",
    "data": "{\"field\":\"/state\",\"data\":{\"bri_inc\":254,\"transitiontime\":35}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1860,
    "y": 287,
    "wires": [
      []
    ]
  },
  {
    "id": "cdfdc29a.34927",
    "type": "api-call-service",
    "z": "c47facfc.ae997",
    "name": "Turn On (current state)",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1540,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "b42e742c.1cf258",
    "type": "api-call-service",
    "z": "c47facfc.ae997",
    "name": "Turn Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1100,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "e56bb3ae.46e79",
    "type": "api-call-service",
    "z": "c47facfc.ae997",
    "name": "Turn On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "",
    "data": "{\"brightness_pct\":1}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1420,
    "y": 340,
    "wires": [
      [
        "1c83c098.34866f"
      ]
    ]
  },
  {
    "id": "7f3e6238.8cefac",
    "type": "api-current-state",
    "z": "c47facfc.ae997",
    "name": "Is Light On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1050,
    "y": 300,
    "wires": [
      [
        "1c83c098.34866f"
      ],
      [
        "cbc5309d.03a11"
      ]
    ]
  },
  {
    "id": "d8814685.d132f8",
    "type": "api-current-state",
    "z": "c47facfc.ae997",
    "name": "Is Light On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1050,
    "y": 400,
    "wires": [
      [
        "97763b83.19e938"
      ],
      []
    ]
  },
  {
    "id": "724ef711.c313c8",
    "type": "subflow:c47facfc.ae997",
    "z": "e0877ac4.f74e78",
    "name": "",
    "env": [
      {
        "name": "entity_id",
        "value": "light.middle_floor_bathroom",
        "type": "str"
      }
    ],
    "x": 340,
    "y": 320,
    "wires": [
      [
        "5084a8f3.38da38"
      ],
      [
        "1940c38e.e8fa6c"
      ]
    ]
  },
  {
    "id": "cbc5309d.03a11",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity_id",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity_id\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1230,
    "y": 340,
    "wires": [
      [
        "e56bb3ae.46e79"
      ]
    ]
  },
  {
    "id": "6fcf8569.56debc",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity_id & Event",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg = {\n    \"payload\":{ \n                \"data\" : \n                        { \n                            \"entity_id\" : entity_id,\n                            \"entity\" : entity_id\n                        } \n                }\n    ,\"event\":msg.payload.event.event\n\n}\n\n\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 360,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "5a022d2b.4d4164",
    "type": "catch",
    "z": "e6716385.6d8c2",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 180,
    "y": 100,
    "wires": [
      [
        "ae306c19.93f99"
      ]
    ]
  },
  {
    "id": "ae306c19.93f99",
    "type": "subflow:f5eab19a.7cf17",
    "z": "e6716385.6d8c2",
    "name": "",
    "x": 390,
    "y": 100,
    "wires": []
  },
  {
    "id": "fccec211.fd236",
    "type": "comment",
    "z": "e6716385.6d8c2",
    "name": "Error Handler",
    "info": "",
    "x": 170,
    "y": 60,
    "wires": []
  },
  {
    "id": "c4cd612c.a2ff6",
    "type": "catch",
    "z": "c47facfc.ae997",
    "name": "",
    "scope": null,
    "uncaught": true,
    "x": 180,
    "y": 100,
    "wires": [
      [
        "b8300f00.af3"
      ]
    ]
  },
  {
    "id": "b8300f00.af3",
    "type": "subflow:f5eab19a.7cf17",
    "z": "c47facfc.ae997",
    "name": "",
    "x": 390,
    "y": 100,
    "wires": []
  },
  {
    "id": "12e798dd.22a9a7",
    "type": "comment",
    "z": "c47facfc.ae997",
    "name": "Error Handler",
    "info": "",
    "x": 170,
    "y": 60,
    "wires": []
  },
  {
    "id": "1c83c098.34866f",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1620,
    "y": 287,
    "wires": [
      [
        "77827cb0.c1bc04"
      ]
    ]
  },
  {
    "id": "97763b83.19e938",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity_id",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1270,
    "y": 400,
    "wires": [
      [
        "f77eb657.3b7508"
      ]
    ]
  },
  {
    "id": "678783f6.32a50c",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity_id",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity_id\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1290,
    "y": 180,
    "wires": [
      [
        "cdfdc29a.34927"
      ]
    ]
  },
  {
    "id": "bf24423f.df689",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity_id",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity_id\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 890,
    "y": 240,
    "wires": [
      [
        "b42e742c.1cf258"
      ]
    ]
  },
  {
    "id": "4082089f.91a948",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity wo data",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n        \"entity_id\" : entity_id\n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 870,
    "y": 400,
    "wires": [
      [
        "d8814685.d132f8"
      ]
    ]
  },
  {
    "id": "4e3c5d6e.176a04",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity wo data",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n        \"entity_id\" : entity_id\n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 870,
    "y": 300,
    "wires": [
      [
        "7f3e6238.8cefac"
      ]
    ]
  },
  {
    "id": "b79cd5b5.5f1048",
    "type": "api-current-state",
    "z": "c47facfc.ae997",
    "name": "Is Light On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 1070,
    "y": 140,
    "wires": [
      [
        "411b52ff.2e3dec"
      ],
      [
        "678783f6.32a50c"
      ]
    ]
  },
  {
    "id": "d2c9d4ac.2bbea8",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity wo data",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n        \"entity_id\" : entity_id\n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 890,
    "y": 140,
    "wires": [
      [
        "b79cd5b5.5f1048"
      ]
    ]
  },
  {
    "id": "f8ad17dc.a40718",
    "type": "api-call-service",
    "z": "c47facfc.ae997",
    "name": "Turn On (Max)",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "",
    "data": "{\"brightness_pct\":100}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1520,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "411b52ff.2e3dec",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity_id",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity_id\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1290,
    "y": 140,
    "wires": [
      [
        "f8ad17dc.a40718"
      ]
    ]
  },
  {
    "id": "14cd568d.4da619",
    "type": "function",
    "z": "c9dd75c4.1c8078",
    "name": "Ikea Dimmer - Bathroom",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 710,
    "y": 320,
    "wires": [
      [
        "2d674a1d.f70ff6"
      ]
    ]
  },
  {
    "id": "2d674a1d.f70ff6",
    "type": "link out",
    "z": "c9dd75c4.1c8078",
    "name": "SW-Bathroom Dimmer",
    "links": [
      "257bd400.1aeb5c",
      "40cb3457.2c5edc"
    ],
    "x": 915,
    "y": 320,
    "wires": []
  },
  {
    "id": "d1d7d64a.b61628",
    "type": "function",
    "z": "c9dd75c4.1c8078",
    "name": "Dual Switch",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 670,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "40cb3457.2c5edc",
    "type": "link in",
    "z": "e0877ac4.f74e78",
    "name": "",
    "links": [
      "2d674a1d.f70ff6"
    ],
    "x": 135,
    "y": 320,
    "wires": [
      [
        "724ef711.c313c8"
      ]
    ]
  },
  {
    "id": "6bc8c3f6.bee6fc",
    "type": "comment",
    "z": "e0877ac4.f74e78",
    "name": "Bathoom Dimmer",
    "info": "",
    "x": 200,
    "y": 280,
    "wires": []
  },
  {
    "id": "b4ed43c5.2d993",
    "type": "catch",
    "z": "e0877ac4.f74e78",
    "name": "",
    "scope": null,
    "x": 160,
    "y": 100,
    "wires": [
      [
        "cd56dd1e.4f5b7"
      ]
    ]
  },
  {
    "id": "cd56dd1e.4f5b7",
    "type": "subflow:f5eab19a.7cf17",
    "z": "e0877ac4.f74e78",
    "name": "",
    "x": 390,
    "y": 100,
    "wires": []
  },
  {
    "id": "37f1ee9d.5ca762",
    "type": "comment",
    "z": "e0877ac4.f74e78",
    "name": "Error Handler",
    "info": "",
    "x": 170,
    "y": 60,
    "wires": []
  },
  {
    "id": "5084a8f3.38da38",
    "type": "trigger",
    "z": "e0877ac4.f74e78",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "payl",
    "duration": "4",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 730,
    "y": 460,
    "wires": [
      [
        "1c2136db.f255e9"
      ]
    ]
  },
  {
    "id": "1940c38e.e8fa6c",
    "type": "change",
    "z": "e0877ac4.f74e78",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "Reset",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 530,
    "y": 380,
    "wires": [
      [
        "5084a8f3.38da38"
      ]
    ]
  },
  {
    "id": "8302e2e0.f9ea5",
    "type": "api-call-service",
    "z": "e0877ac4.f74e78",
    "name": "Light Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.middle_floor_bathroom",
    "data": "{\"transition\":20}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1220,
    "y": 460,
    "wires": [
      []
    ]
  },
  {
    "id": "1c2136db.f255e9",
    "type": "api-call-service",
    "z": "e0877ac4.f74e78",
    "name": "Lower Brightness",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.middle_floor_bathroom",
    "data": "{\"brightness_pct\":50}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 970,
    "y": 460,
    "wires": [
      [
        "8302e2e0.f9ea5"
      ]
    ]
  },
  {
    "id": "8653f73f.2a3748",
    "type": "api-call-service",
    "z": "c47facfc.ae997",
    "name": "Stop Listening",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "deconz",
    "service": "configure",
    "entityId": "",
    "data": "{\"field\":\"/state\",\"data\":{\"bri_inc\":0,\"transitiontime\":50}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 500,
    "y": 420,
    "wires": [
      []
    ]
  },
  {
    "id": "26881f2d.3efa3",
    "type": "function",
    "z": "c47facfc.ae997",
    "name": "Set entity",
    "func": "var entity_id = env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 320,
    "y": 420,
    "wires": [
      [
        "8653f73f.2a3748"
      ]
    ]
  },
  {
    "id": "87aa87a4.dfe358",
    "type": "comment",
    "z": "73f354e0.89c88c",
    "name": "Door",
    "info": "",
    "x": 190,
    "y": 300,
    "wires": []
  },
  {
    "id": "24e7a254.b6c00e",
    "type": "comment",
    "z": "73f354e0.89c88c",
    "name": "Motion",
    "info": "",
    "x": 170,
    "y": 940,
    "wires": []
  },
  {
    "id": "baf837a.7f915c8",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Bathroom - Montion Detected",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.bathroom_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "29m36aldk3e",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "gjbzxf602q5",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 240,
    "y": 980,
    "wires": [
      [
        "eb387329.c79f7"
      ],
      []
    ]
  },
  {
    "id": "15af76e1.3b5839",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Bathroom - Montion Cleared",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.bathroom_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "u7y3ovsm8",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      },
      {
        "id": "avq16iyyput",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 240,
    "y": 1020,
    "wires": [
      [
        "5799f4d.ab3db0c"
      ],
      []
    ]
  },
  {
    "id": "eb387329.c79f7",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - Bathroom - Motion Detected",
    "links": [
      "73ada763.f18338"
    ],
    "x": 435,
    "y": 980,
    "wires": []
  },
  {
    "id": "5799f4d.ab3db0c",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - Bathroom - Motion Cleared",
    "links": [],
    "x": 435,
    "y": 1020,
    "wires": []
  },
  {
    "id": "73ada763.f18338",
    "type": "link in",
    "z": "e0877ac4.f74e78",
    "name": "",
    "links": [
      "eb387329.c79f7"
    ],
    "x": 135,
    "y": 460,
    "wires": [
      [
        "30fd7322.de6adc"
      ]
    ]
  },
  {
    "id": "30fd7322.de6adc",
    "type": "api-call-service",
    "z": "e0877ac4.f74e78",
    "name": "Turn On Light",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.middle_floor_bathroom",
    "data": "{\"brightness_pct\":100}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 380,
    "y": 460,
    "wires": [
      [
        "5084a8f3.38da38"
      ]
    ]
  },
  {
    "id": "3f04befb.8ee1d2",
    "type": "trigger-state",
    "z": "e0877ac4.f74e78",
    "name": "Light Turn Off (Not Node Red)",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "light.middle_floor_bathroom",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "5ys26rxnd99",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      },
      {
        "id": "hv8o4y7hx9e",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "at2rstwb01b",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 250,
    "y": 380,
    "wires": [
      [
        "1940c38e.e8fa6c"
      ],
      []
    ]
  },
  {
    "id": "35a2ce44.d60af2",
    "type": "inject",
    "z": "e0877ac4.f74e78",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1080,
    "y": 520,
    "wires": [
      [
        "8302e2e0.f9ea5"
      ]
    ]
  },
  {
    "id": "451815e2.b6b6fc",
    "type": "comment",
    "z": "e0877ac4.f74e78",
    "name": "Bathroom motion",
    "info": "",
    "x": 200,
    "y": 420,
    "wires": []
  },
  {
    "id": "a406f221.d7381",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Lower Stair Case - Montion Detected",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.lower_stair_montion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "29m36aldk3e",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "gjbzxf602q5",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 270,
    "y": 1080,
    "wires": [
      [
        "71da816c.7fdd7"
      ],
      []
    ]
  },
  {
    "id": "6024cabb.744e44",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Lower Stair Case - Montion Cleared",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.lower_stair_montion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "u7y3ovsm8",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      },
      {
        "id": "avq16iyyput",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 260,
    "y": 1120,
    "wires": [
      [
        "ebf2bdf4.2e0ac"
      ],
      []
    ]
  },
  {
    "id": "71da816c.7fdd7",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - Lower Stair Case - Motion Detected",
    "links": [
      "71531b63.ad2374"
    ],
    "x": 495,
    "y": 1080,
    "wires": []
  },
  {
    "id": "ebf2bdf4.2e0ac",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - Lower Stair Case - Motion Cleared",
    "links": [
      "74821d1a.40d914"
    ],
    "x": 495,
    "y": 1120,
    "wires": []
  },
  {
    "id": "23f07c4a.121d34",
    "type": "comment",
    "z": "813b32cf.d0663",
    "name": "Lower Stair Case",
    "info": "",
    "x": 120,
    "y": 80,
    "wires": []
  },
  {
    "id": "71531b63.ad2374",
    "type": "link in",
    "z": "813b32cf.d0663",
    "name": "ACT - Lower Stair Case - Light",
    "links": [
      "71da816c.7fdd7"
    ],
    "x": 215,
    "y": 140,
    "wires": [
      [
        "73044612.729458",
        "945e9271.c98b2"
      ]
    ]
  },
  {
    "id": "73044612.729458",
    "type": "api-call-service",
    "z": "813b32cf.d0663",
    "name": "Light On",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.ground_floor_hallway",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 420,
    "y": 140,
    "wires": [
      [
        "5aa35e07.f44f7"
      ]
    ]
  },
  {
    "id": "5aa35e07.f44f7",
    "type": "trigger",
    "z": "813b32cf.d0663",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "40",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 610,
    "y": 140,
    "wires": [
      [
        "9cec9ee3.9efa5"
      ]
    ]
  },
  {
    "id": "74821d1a.40d914",
    "type": "link in",
    "z": "813b32cf.d0663",
    "name": "ACT - Lower Stair Case - Light",
    "links": [
      "ebf2bdf4.2e0ac"
    ],
    "x": 215,
    "y": 259,
    "wires": [
      [
        "7260675f.311c88",
        "c3964cda.f7261"
      ]
    ]
  },
  {
    "id": "af9f943c.50fe98",
    "type": "comment",
    "z": "813b32cf.d0663",
    "name": "Detected",
    "info": "",
    "x": 100,
    "y": 140,
    "wires": []
  },
  {
    "id": "ed0a3277.198b2",
    "type": "comment",
    "z": "813b32cf.d0663",
    "name": "Cleared",
    "info": "",
    "x": 90,
    "y": 259,
    "wires": []
  },
  {
    "id": "c3964cda.f7261",
    "type": "trigger",
    "z": "813b32cf.d0663",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "2",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "outputs": 1,
    "x": 610,
    "y": 259,
    "wires": [
      [
        "9cec9ee3.9efa5"
      ]
    ]
  },
  {
    "id": "7260675f.311c88",
    "type": "change",
    "z": "813b32cf.d0663",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 191,
    "wires": [
      [
        "5aa35e07.f44f7"
      ]
    ]
  },
  {
    "id": "9cec9ee3.9efa5",
    "type": "api-call-service",
    "z": "813b32cf.d0663",
    "name": "Light Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.ground_floor_hallway",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 820,
    "y": 191,
    "wires": [
      []
    ]
  },
  {
    "id": "945e9271.c98b2",
    "type": "change",
    "z": "813b32cf.d0663",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 430,
    "y": 229,
    "wires": [
      [
        "c3964cda.f7261"
      ]
    ]
  },
  {
    "id": "c1702ccd.2b40e",
    "type": "function",
    "z": "c9dd75c4.1c8078",
    "name": "Office Blind Swtich",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 690,
    "y": 360,
    "wires": [
      [
        "8922b5d0.a9e5a8"
      ]
    ]
  },
  {
    "id": "8922b5d0.a9e5a8",
    "type": "link out",
    "z": "c9dd75c4.1c8078",
    "name": "SW-OfficeBlind",
    "links": [
      "eed8d52.d13e128"
    ],
    "x": 915,
    "y": 360,
    "wires": []
  },
  {
    "id": "eed8d52.d13e128",
    "type": "link in",
    "z": "127f96c9.345c09",
    "name": "",
    "links": [
      "8922b5d0.a9e5a8"
    ],
    "x": 135,
    "y": 200,
    "wires": [
      [
        "89c85313.0dc0e"
      ]
    ]
  },
  {
    "id": "54da67ee.d67c78",
    "type": "comment",
    "z": "127f96c9.345c09",
    "name": "Blind Control",
    "info": "",
    "x": 190,
    "y": 160,
    "wires": []
  },
  {
    "id": "89c85313.0dc0e",
    "type": "switch",
    "z": "127f96c9.345c09",
    "name": "EventCode",
    "property": "msg.payload.event.event",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "1003",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2003",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 4,
    "x": 290,
    "y": 240,
    "wires": [
      [
        "cced3460.0fc908"
      ],
      [
        "cced3460.0fc908"
      ],
      [],
      []
    ]
  },
  {
    "id": "da3f1fda.cb89d",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Open",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "open_cover",
    "entityId": "cover.office_blind_r,cover.office_blind_l",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1670,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "2734042c.1dddbc",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Blind Up",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "deconz",
    "service": "configure",
    "entityId": "",
    "data": "{\"field\":\"/state\",\"data\":{\"bri_inc\":254,\"transitiontime\":35}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 2340,
    "y": 980,
    "wires": [
      []
    ]
  },
  {
    "id": "8cd0aff2.efc34",
    "type": "function",
    "z": "127f96c9.345c09",
    "name": "Set entity",
    "func": "var entity_id = \"light.office_blind_1\"//env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 2160,
    "y": 980,
    "wires": [
      [
        "2734042c.1dddbc"
      ]
    ]
  },
  {
    "id": "ed9e22c7.05e54",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Stop Listening",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "deconz",
    "service": "configure",
    "entityId": "",
    "data": "{\"field\":\"/state\",\"data\":{\"bri_inc\":0,\"transitiontime\":50}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 2340,
    "y": 1100,
    "wires": [
      []
    ]
  },
  {
    "id": "7d0af89a.4c5728",
    "type": "function",
    "z": "127f96c9.345c09",
    "name": "Set entity",
    "func": "var entity_id = \"cover.office_blind_1\"//env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 2160,
    "y": 1100,
    "wires": [
      [
        "ed9e22c7.05e54"
      ]
    ]
  },
  {
    "id": "5d02786.bbbe388",
    "type": "inject",
    "z": "127f96c9.345c09",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1960,
    "y": 980,
    "wires": [
      [
        "8cd0aff2.efc34"
      ]
    ]
  },
  {
    "id": "315cc933.5e4b96",
    "type": "inject",
    "z": "127f96c9.345c09",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1960,
    "y": 1100,
    "wires": [
      [
        "7d0af89a.4c5728"
      ]
    ]
  },
  {
    "id": "63cd614f.903c3",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Decrease Brightness",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "deconz",
    "service": "configure",
    "entityId": "",
    "data": "{\"field\":\"/state\",\"data\":{\"bri_inc\":-254,\"transitiontime\":35}}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 2380,
    "y": 1040,
    "wires": [
      []
    ]
  },
  {
    "id": "5e5ce46e.75049c",
    "type": "function",
    "z": "127f96c9.345c09",
    "name": "Set entity",
    "func": "var entity_id = \"light.office_blind_1\"//env.get(\"entity_id\")\nmsg.payload = {\n     \"data\" : \n        { \n            \"entity\" : entity_id\n        } \n}\n\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "x": 2160,
    "y": 1040,
    "wires": [
      [
        "63cd614f.903c3"
      ]
    ]
  },
  {
    "id": "e2a8c68.6804a38",
    "type": "inject",
    "z": "127f96c9.345c09",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1960,
    "y": 1040,
    "wires": [
      [
        "5e5ce46e.75049c"
      ]
    ]
  },
  {
    "id": "bb3801ce.9c741",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Close",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "close_cover",
    "entityId": "cover.office_blind_r,cover.office_blind_l",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1670,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "9cfcea98.b09898",
    "type": "deconz-input",
    "z": "8374deef.6aa85",
    "name": "",
    "server": "e26b9e79.671e3",
    "device": {
      "length": 0,
      "prevObject": {
        "length": 0,
        "prevObject": {
          "0": {
            "location": {
              "href": "https://msb396.duckdns.org:8123/api/hassio_ingress/Q4AwlmHe_iFxl0_m-0WJ0hpWDkQ2Z8ODti3RQef9gOs/#flow/8374deef.6aa85",
              "ancestorOrigins": {
                "0": "https://msb396.duckdns.org:8123",
                "1": "https://msb396.duckdns.org:8123"
              },
              "origin": "https://msb396.duckdns.org:8123",
              "protocol": "https:",
              "host": "msb396.duckdns.org:8123",
              "hostname": "msb396.duckdns.org",
              "port": "8123",
              "pathname": "/api/hassio_ingress/Q4AwlmHe_iFxl0_m-0WJ0hpWDkQ2Z8ODti3RQef9gOs/",
              "search": "",
              "hash": "#flow/8374deef.6aa85"
            },
            "jQuery341042627053372033651": {
              "events": {
                "mouseup": [
                  {
                    "type": "mouseup",
                    "origType": "mouseup",
                    "guid": 3,
                    "namespace": ""
                  }
                ],
                "click": [
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6156,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6169,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6179,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6187,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6201,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6207,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6443,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 6449,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7238,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7249,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7259,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7270,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7334,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7340,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7593,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 7599,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8506,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8517,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8527,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8538,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8602,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8608,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8898,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 8904,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9223,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9229,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9589,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9600,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9610,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9621,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9685,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9691,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9965,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 9971,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10289,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10300,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10310,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10321,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10385,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10391,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10398,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 10457,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 11030,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 11041,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 12174,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 12185,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 12562,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 12573,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 13093,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 13104,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 13485,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 13496,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 14219,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 14230,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 14632,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 14643,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 16645,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 16656,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17030,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17041,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17415,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17426,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17898,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17909,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17971,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17977,
                    "namespace": ""
                  },
                  {
                    "type": "click",
                    "origType": "click",
                    "data": null,
                    "guid": 17985,
                    "namespace": ""
                  }
                ]
              },
              "focusin": 3
            }
          },
          "length": 1
        }
      }
    },
    "device_name": "",
    "topic": "",
    "state": "",
    "output": "always",
    "outputAtStartup": true,
    "x": 260,
    "y": 140,
    "wires": [
      [
        "32077e18.60b4c2"
      ],
      []
    ]
  },
  {
    "id": "32077e18.60b4c2",
    "type": "debug",
    "z": "8374deef.6aa85",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 450,
    "y": 140,
    "wires": []
  },
  {
    "id": "92b7f577.2f9ca8",
    "type": "deconz-output",
    "z": "8374deef.6aa85",
    "name": "",
    "server": "e26b9e79.671e3",
    "device": "00:0d:6f:ff:fe:bb:34:3a-01",
    "device_name": "Office Blind 1 : Window covering device",
    "command": "on",
    "commandType": "deconz_cmd",
    "payload": "payload",
    "payloadType": "msg",
    "transitionTime": "",
    "x": 640,
    "y": 260,
    "wires": []
  },
  {
    "id": "70228272.54ec0c",
    "type": "inject",
    "z": "8374deef.6aa85",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 300,
    "y": 260,
    "wires": [
      [
        "92b7f577.2f9ca8"
      ]
    ]
  },
  {
    "id": "7c35d577.fd517c",
    "type": "deconz-output",
    "z": "8374deef.6aa85",
    "name": "",
    "server": "e26b9e79.671e3",
    "device": "00:0d:6f:ff:fe:bb:34:3a-01",
    "device_name": "Office Blind 1 : Window covering device",
    "command": "bri",
    "commandType": "deconz_cmd",
    "payload": "payload",
    "payloadType": "msg",
    "transitionTime": "",
    "x": 640,
    "y": 320,
    "wires": []
  },
  {
    "id": "620f102e.abd63",
    "type": "inject",
    "z": "8374deef.6aa85",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "50",
    "payloadType": "num",
    "x": 290,
    "y": 320,
    "wires": [
      [
        "7c35d577.fd517c"
      ]
    ]
  },
  {
    "id": "2eb20cc3.04a9a4",
    "type": "inject",
    "z": "8374deef.6aa85",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "20",
    "payloadType": "num",
    "x": 290,
    "y": 360,
    "wires": [
      [
        "7c35d577.fd517c"
      ]
    ]
  },
  {
    "id": "7e526230.02642c",
    "type": "inject",
    "z": "8374deef.6aa85",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "255",
    "payloadType": "num",
    "x": 290,
    "y": 400,
    "wires": [
      [
        "7c35d577.fd517c"
      ]
    ]
  },
  {
    "id": "c1f968a1.a74278",
    "type": "deconz-get",
    "z": "8374deef.6aa85",
    "name": "",
    "server": "e26b9e79.671e3",
    "device": "00:0d:6f:ff:fe:bb:34:3a-01",
    "device_name": "Office Blind 1 : Window covering device",
    "state": "0",
    "x": 510,
    "y": 560,
    "wires": [
      [
        "53d90775.57d2e8"
      ]
    ]
  },
  {
    "id": "89e07d4a.66a96",
    "type": "inject",
    "z": "8374deef.6aa85",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 200,
    "y": 560,
    "wires": [
      [
        "c1f968a1.a74278"
      ]
    ]
  },
  {
    "id": "53d90775.57d2e8",
    "type": "debug",
    "z": "8374deef.6aa85",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 820,
    "y": 560,
    "wires": []
  },
  {
    "id": "7530d984.9b13b8",
    "type": "inject",
    "z": "8374deef.6aa85",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "250",
    "payloadType": "num",
    "x": 290,
    "y": 440,
    "wires": [
      [
        "7c35d577.fd517c"
      ]
    ]
  },
  {
    "id": "91e48ab.74b9a78",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Stop",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "stop_cover",
    "entityId": "cover.office_blind_r,cover.office_blind_l",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 870,
    "y": 400,
    "wires": [
      [
        "19041839.a14db8"
      ]
    ]
  },
  {
    "id": "402ad8d2.c2d6c8",
    "type": "deconz-event",
    "z": "8374deef.6aa85",
    "name": "",
    "server": "e26b9e79.671e3",
    "device_name": null,
    "x": 240,
    "y": 780,
    "wires": [
      [
        "f9447d1.15f6f8"
      ]
    ]
  },
  {
    "id": "f9447d1.15f6f8",
    "type": "debug",
    "z": "8374deef.6aa85",
    "name": "",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 480,
    "y": 780,
    "wires": []
  },
  {
    "id": "55214acf.d6a364",
    "type": "stoptimer",
    "z": "127f96c9.345c09",
    "duration": "5",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 1950,
    "y": 880,
    "wires": [
      [
        "16cb6cc1.2df493"
      ],
      [
        "e5eaaf83.bfc7b"
      ]
    ]
  },
  {
    "id": "16cb6cc1.2df493",
    "type": "debug",
    "z": "127f96c9.345c09",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 2120,
    "y": 860,
    "wires": []
  },
  {
    "id": "e5eaaf83.bfc7b",
    "type": "debug",
    "z": "127f96c9.345c09",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 2130,
    "y": 900,
    "wires": []
  },
  {
    "id": "adcc6cbe.2de03",
    "type": "inject",
    "z": "127f96c9.345c09",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1780,
    "y": 880,
    "wires": [
      [
        "55214acf.d6a364"
      ]
    ]
  },
  {
    "id": "fc2f898d.e433f8",
    "type": "trigger",
    "z": "127f96c9.345c09",
    "name": "forward, wait 30 sec, send reset",
    "op1": "",
    "op2": "reset",
    "op1type": "pay",
    "op2type": "str",
    "duration": "30",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 1050,
    "y": 280,
    "wires": [
      [
        "40e6ac74.9cff94"
      ]
    ]
  },
  {
    "id": "40e6ac74.9cff94",
    "type": "switch",
    "z": "127f96c9.345c09",
    "name": "Is Reset",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "reset",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1260,
    "y": 280,
    "wires": [
      [
        "d2007396.20406"
      ],
      [
        "81d2df6e.569be"
      ]
    ]
  },
  {
    "id": "cced3460.0fc908",
    "type": "counter",
    "z": "127f96c9.345c09",
    "name": "",
    "init": "0",
    "step": "1",
    "lower": "",
    "upper": "",
    "mode": "increment",
    "outputs": "1",
    "x": 540,
    "y": 240,
    "wires": [
      [
        "6c425d2f.4fe2c4"
      ]
    ]
  },
  {
    "id": "6c425d2f.4fe2c4",
    "type": "switch",
    "z": "127f96c9.345c09",
    "name": "First Payload",
    "property": "count",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "1",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 730,
    "y": 280,
    "wires": [
      [],
      [
        "fc2f898d.e433f8"
      ],
      [
        "91e48ab.74b9a78"
      ]
    ]
  },
  {
    "id": "d2007396.20406",
    "type": "change",
    "z": "127f96c9.345c09",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "Reset",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 960,
    "y": 200,
    "wires": [
      [
        "cced3460.0fc908"
      ]
    ]
  },
  {
    "id": "81d2df6e.569be",
    "type": "switch",
    "z": "127f96c9.345c09",
    "name": "EventCode",
    "property": "msg.payload.event.event",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2002",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1470,
    "y": 280,
    "wires": [
      [
        "da3f1fda.cb89d"
      ],
      [
        "bb3801ce.9c741"
      ]
    ]
  },
  {
    "id": "19041839.a14db8",
    "type": "change",
    "z": "127f96c9.345c09",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "Reset",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 910,
    "y": 340,
    "wires": [
      [
        "fc2f898d.e433f8",
        "d2007396.20406"
      ]
    ]
  },
  {
    "id": "235c33ec.c11dac",
    "type": "subflow:7341bbf9.74a0c4",
    "z": "73f354e0.89c88c",
    "name": "",
    "env": [
      {
        "name": "Location",
        "value": "Backdoor Open",
        "type": "str"
      },
      {
        "name": "Exturnal",
        "value": "true",
        "type": "bool"
      }
    ],
    "x": 440,
    "y": 500,
    "wires": [
      [
        "84bf06f.7c660f8"
      ]
    ]
  },
  {
    "id": "bbe7c970.7e3718",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Backdoor - Open",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.back_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "b9h2ggymwte",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "bw2sensbajw",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 230,
    "y": 500,
    "wires": [
      [
        "235c33ec.c11dac"
      ],
      []
    ]
  },
  {
    "id": "c6455b2d.15c358",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Backdoor - Closed",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.back_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "awsqo57aegu",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      },
      {
        "id": "gso37lm0u5j",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 230,
    "y": 540,
    "wires": [
      [
        "853bbed1.e9e54"
      ],
      []
    ]
  },
  {
    "id": "853bbed1.e9e54",
    "type": "subflow:7341bbf9.74a0c4",
    "z": "73f354e0.89c88c",
    "name": "",
    "env": [
      {
        "name": "Location",
        "value": "Backdoor Closed",
        "type": "str"
      },
      {
        "name": "Exturnal",
        "value": "true",
        "type": "bool"
      }
    ],
    "x": 440,
    "y": 540,
    "wires": [
      [
        "84bf06f.7c660f8"
      ]
    ]
  },
  {
    "id": "84bf06f.7c660f8",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - ALL",
    "links": [],
    "x": 1175,
    "y": 520,
    "wires": []
  },
  {
    "id": "2f166252.bc5d3e",
    "type": "subflow:7341bbf9.74a0c4",
    "z": "73f354e0.89c88c",
    "name": "",
    "env": [
      {
        "name": "Location",
        "value": "Backdoor Open",
        "type": "str"
      },
      {
        "name": "Exturnal",
        "value": "true",
        "type": "bool"
      }
    ],
    "x": 577.765625,
    "y": 676.75,
    "wires": [
      []
    ]
  },
  {
    "id": "6b24f4dd.773b6c",
    "type": "inject",
    "z": "73f354e0.89c88c",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 360,
    "y": 680,
    "wires": [
      [
        "2f166252.bc5d3e"
      ]
    ]
  },
  {
    "id": "cb61a003.e3d2c",
    "type": "function",
    "z": "7341bbf9.74a0c4",
    "name": "Data",
    "func": "var loc = env.get(\"Location\")\nmsg.payload = \n{\n  \"data\": \n  {\n    \"message\": loc\n  }\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "x": 430,
    "y": 320,
    "wires": [
      [
        "86a3d85c.a0c558"
      ]
    ]
  },
  {
    "id": "86a3d85c.a0c558",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "7341bbf9.74a0c4",
    "name": "",
    "env": [
      {
        "name": "message",
        "value": "PAYLOAD",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      }
    ],
    "x": 640,
    "y": 320,
    "wires": []
  },
  {
    "id": "4de8d384.a15afc",
    "type": "switch",
    "z": "7341bbf9.74a0c4",
    "name": "Trigger Alert",
    "property": "Trigger Alert",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 310,
    "y": 240,
    "wires": [
      [
        "cb61a003.e3d2c"
      ]
    ]
  },
  {
    "id": "a67317f4.79eca8",
    "type": "subflow:7341bbf9.74a0c4",
    "z": "73f354e0.89c88c",
    "name": "",
    "env": [
      {
        "name": "Location",
        "value": "Backdoor Open",
        "type": "str"
      },
      {
        "name": "Trigger Alert",
        "value": "false",
        "type": "bool"
      },
      {
        "name": "Exturnal",
        "value": "true",
        "type": "bool"
      }
    ],
    "x": 580,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "f943da9f.866218",
    "type": "inject",
    "z": "73f354e0.89c88c",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 352.234375,
    "y": 743.25,
    "wires": [
      [
        "a67317f4.79eca8"
      ]
    ]
  },
  {
    "id": "1b53efcf.d93a8",
    "type": "link in",
    "z": "dd183e38.f4949",
    "name": "",
    "links": [
      "7ac86eb4.4a3ae"
    ],
    "x": 135,
    "y": 160,
    "wires": [
      [
        "30a7878d.369348"
      ]
    ]
  },
  {
    "id": "edc78e5e.f25ff",
    "type": "comment",
    "z": "dd183e38.f4949",
    "name": "Blind Control",
    "info": "",
    "x": 190,
    "y": 120,
    "wires": []
  },
  {
    "id": "30a7878d.369348",
    "type": "switch",
    "z": "dd183e38.f4949",
    "name": "EventCode",
    "property": "msg.payload.event.event",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "1003",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2003",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 4,
    "x": 290,
    "y": 200,
    "wires": [
      [
        "a01beafc.4af848"
      ],
      [
        "a01beafc.4af848"
      ],
      [
        "3fae166e.70360a"
      ],
      [
        "3fae166e.70360a"
      ]
    ]
  },
  {
    "id": "94be0294.280df",
    "type": "api-call-service",
    "z": "dd183e38.f4949",
    "name": "Open",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "open_cover",
    "entityId": "cover.kitchen_blind",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1670,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "9dc7e274.1ea2a",
    "type": "api-call-service",
    "z": "dd183e38.f4949",
    "name": "Close",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "close_cover",
    "entityId": "cover.kitchen_blind",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1670,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "3fae166e.70360a",
    "type": "api-call-service",
    "z": "dd183e38.f4949",
    "name": "Stop",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "stop_cover",
    "entityId": "cover.kitchen_blind",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 870,
    "y": 360,
    "wires": [
      [
        "d2e7c12f.9c056"
      ]
    ]
  },
  {
    "id": "5ab2a9f2.5b66f8",
    "type": "trigger",
    "z": "dd183e38.f4949",
    "name": "",
    "op1": "",
    "op2": "reset",
    "op1type": "pay",
    "op2type": "str",
    "duration": "30",
    "extend": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 970,
    "y": 240,
    "wires": [
      [
        "875ca7c4.f8f8d8"
      ]
    ]
  },
  {
    "id": "875ca7c4.f8f8d8",
    "type": "switch",
    "z": "dd183e38.f4949",
    "name": "Is Reset",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "reset",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1210,
    "y": 240,
    "wires": [
      [
        "68be13dd.22ea8c"
      ],
      [
        "2dee86c8.33c9ca"
      ]
    ]
  },
  {
    "id": "a01beafc.4af848",
    "type": "counter",
    "z": "dd183e38.f4949",
    "name": "",
    "init": "0",
    "step": "1",
    "lower": null,
    "upper": null,
    "mode": "increment",
    "outputs": "1",
    "x": 540,
    "y": 200,
    "wires": [
      [
        "26e06e04.2780f2"
      ]
    ]
  },
  {
    "id": "26e06e04.2780f2",
    "type": "switch",
    "z": "dd183e38.f4949",
    "name": "First Payload",
    "property": "count",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "1",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 730,
    "y": 240,
    "wires": [
      [],
      [
        "5ab2a9f2.5b66f8"
      ],
      [
        "3fae166e.70360a"
      ]
    ]
  },
  {
    "id": "68be13dd.22ea8c",
    "type": "change",
    "z": "dd183e38.f4949",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "Reset",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 960,
    "y": 160,
    "wires": [
      [
        "a01beafc.4af848"
      ]
    ]
  },
  {
    "id": "2dee86c8.33c9ca",
    "type": "switch",
    "z": "dd183e38.f4949",
    "name": "EventCode",
    "property": "msg.payload.event.event",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1002",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "2002",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1470,
    "y": 240,
    "wires": [
      [
        "94be0294.280df"
      ],
      [
        "9dc7e274.1ea2a"
      ]
    ]
  },
  {
    "id": "d2e7c12f.9c056",
    "type": "change",
    "z": "dd183e38.f4949",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "Reset",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 910,
    "y": 300,
    "wires": [
      [
        "5ab2a9f2.5b66f8",
        "68be13dd.22ea8c"
      ]
    ]
  },
  {
    "id": "4ef5ed7b.a9b064",
    "type": "function",
    "z": "c9dd75c4.1c8078",
    "name": "Kichen Blind",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "x": 670,
    "y": 400,
    "wires": [
      [
        "7ac86eb4.4a3ae"
      ]
    ]
  },
  {
    "id": "7ac86eb4.4a3ae",
    "type": "link out",
    "z": "c9dd75c4.1c8078",
    "name": "SW-kichenBlind",
    "links": [
      "1b53efcf.d93a8"
    ],
    "x": 915,
    "y": 400,
    "wires": []
  },
  {
    "id": "b5148549.1acb78",
    "type": "comment",
    "z": "dd183e38.f4949",
    "name": "Sun - Up",
    "info": "",
    "x": 160,
    "y": 520,
    "wires": []
  },
  {
    "id": "16141182.94e26e",
    "type": "link out",
    "z": "99d64a3d.f4e418",
    "name": "Sun Below",
    "links": [
      "560c2bf0.c71594",
      "9bf33794.3b0ac8"
    ],
    "x": 815,
    "y": 220,
    "wires": []
  },
  {
    "id": "203edcd4.c6a1f4",
    "type": "link out",
    "z": "99d64a3d.f4e418",
    "name": "Sun Above",
    "links": [
      "e71bdf50.f673",
      "259d8210.9371de"
    ],
    "x": 715,
    "y": 60,
    "wires": []
  },
  {
    "id": "e71bdf50.f673",
    "type": "link in",
    "z": "dd183e38.f4949",
    "name": "",
    "links": [
      "203edcd4.c6a1f4"
    ],
    "x": 115,
    "y": 560,
    "wires": [
      [
        "7936d87a.23d5d8"
      ]
    ]
  },
  {
    "id": "453eddbc.75bda4",
    "type": "api-call-service",
    "z": "dd183e38.f4949",
    "name": "Open",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "open_cover",
    "entityId": "cover.kitchen_blind",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 510,
    "y": 560,
    "wires": [
      []
    ]
  },
  {
    "id": "656480f5.92be5",
    "type": "api-call-service",
    "z": "dd183e38.f4949",
    "name": "Close",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "close_cover",
    "entityId": "cover.kitchen_blind",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 250,
    "y": 660,
    "wires": [
      []
    ]
  },
  {
    "id": "7936d87a.23d5d8",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "dd183e38.f4949",
    "name": "",
    "x": 290,
    "y": 560,
    "wires": [
      [
        "453eddbc.75bda4"
      ],
      []
    ]
  },
  {
    "id": "9e9785ae.c98998",
    "type": "comment",
    "z": "dd183e38.f4949",
    "name": "Sun - Down",
    "info": "",
    "x": 170,
    "y": 620,
    "wires": []
  },
  {
    "id": "560c2bf0.c71594",
    "type": "link in",
    "z": "dd183e38.f4949",
    "name": "",
    "links": [
      "16141182.94e26e"
    ],
    "x": 115,
    "y": 660,
    "wires": [
      [
        "656480f5.92be5"
      ]
    ]
  },
  {
    "id": "c1fe077.49b65f8",
    "type": "comment",
    "z": "127f96c9.345c09",
    "name": "Sun - Up",
    "info": "",
    "x": 180,
    "y": 560,
    "wires": []
  },
  {
    "id": "259d8210.9371de",
    "type": "link in",
    "z": "127f96c9.345c09",
    "name": "",
    "links": [
      "203edcd4.c6a1f4"
    ],
    "x": 135,
    "y": 600,
    "wires": [
      [
        "afc0ecca.c763c"
      ]
    ]
  },
  {
    "id": "afc0ecca.c763c",
    "type": "subflow:cdbc6ec6.2e0ec",
    "z": "127f96c9.345c09",
    "name": "",
    "x": 310,
    "y": 600,
    "wires": [
      [
        "110bdebd.ca9c21"
      ],
      []
    ]
  },
  {
    "id": "fdd88d6f.ef59f",
    "type": "comment",
    "z": "127f96c9.345c09",
    "name": "Sun - Down",
    "info": "",
    "x": 190,
    "y": 660,
    "wires": []
  },
  {
    "id": "9bf33794.3b0ac8",
    "type": "link in",
    "z": "127f96c9.345c09",
    "name": "",
    "links": [
      "16141182.94e26e"
    ],
    "x": 135,
    "y": 700,
    "wires": [
      [
        "ed5c2115.1a5bb"
      ]
    ]
  },
  {
    "id": "110bdebd.ca9c21",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Open",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "open_cover",
    "entityId": "cover.office_blind_r,cover.office_blind_l",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 510,
    "y": 600,
    "wires": [
      []
    ]
  },
  {
    "id": "ed5c2115.1a5bb",
    "type": "api-call-service",
    "z": "127f96c9.345c09",
    "name": "Close",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "cover",
    "service": "close_cover",
    "entityId": "cover.office_blind_r,cover.office_blind_l",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 290,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "701820ba.ea6c3",
    "type": "inject",
    "z": "5625076e.ee59e8",
    "name": "",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 180,
    "y": 1280,
    "wires": [
      [
        "d71681a.9d89d8"
      ]
    ]
  },
  {
    "id": "d71681a.9d89d8",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "5625076e.ee59e8",
    "name": "Test To just matt",
    "env": [
      {
        "name": "message",
        "value": "Only Matt",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      }
    ],
    "x": 500,
    "y": 1280,
    "wires": []
  },
  {
    "id": "6e7223c3.d362ec",
    "type": "inject",
    "z": "99d64a3d.f4e418",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 650,
    "y": 260,
    "wires": [
      [
        "16141182.94e26e"
      ]
    ]
  },
  {
    "id": "f228fea8.09dd9",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "99d64a3d.f4e418",
    "name": "Sun Down",
    "env": [
      {
        "name": "message",
        "value": "Sun down",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Matt",
        "type": "str"
      }
    ],
    "x": 870,
    "y": 260,
    "wires": []
  },
  {
    "id": "2ea9dda2.ab1b62",
    "type": "comment",
    "z": "cf065444.e48a48",
    "name": "Motion Cleared",
    "info": "",
    "x": 160,
    "y": 100,
    "wires": []
  },
  {
    "id": "6c86223f.56848c",
    "type": "link in",
    "z": "cf065444.e48a48",
    "name": "ACT - Door Open",
    "links": [
      "2501395c.638e06"
    ],
    "x": 175,
    "y": 140,
    "wires": [
      [
        "8bc1c5b2.97e8b8",
        "146ede54.3e6d02"
      ]
    ]
  },
  {
    "id": "ae4299d9.2c4bf8",
    "type": "comment",
    "z": "cf065444.e48a48",
    "name": "Motion Detected",
    "info": "",
    "x": 160,
    "y": 240,
    "wires": []
  },
  {
    "id": "fc92a07c.b063",
    "type": "link in",
    "z": "cf065444.e48a48",
    "name": "ACT - Door Closed",
    "links": [
      "d320a708.e46708",
      "e363fe0a.9fd17"
    ],
    "x": 195,
    "y": 280,
    "wires": [
      [
        "7d801816.290c88",
        "37b373ce.736cfc",
        "c5085511.552db8"
      ]
    ]
  },
  {
    "id": "8bc1c5b2.97e8b8",
    "type": "trigger",
    "z": "cf065444.e48a48",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "4",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 650,
    "y": 140,
    "wires": [
      [
        "f8cff860.115978"
      ]
    ]
  },
  {
    "id": "7d801816.290c88",
    "type": "api-call-service",
    "z": "cf065444.e48a48",
    "name": "Turn On - Max",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.top_floor_shower",
    "data": "{\"brightness_pct\":\"100\",\"transition\":\"2\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 360,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "b54a9086.6121a",
    "type": "api-call-service",
    "z": "cf065444.e48a48",
    "name": "Slow off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_off",
    "entityId": "light.top_floor_shower",
    "data": "{\"transition\":\"20\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 1200,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "f8cff860.115978",
    "type": "api-call-service",
    "z": "cf065444.e48a48",
    "name": "Instance Dim",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "light",
    "service": "turn_on",
    "entityId": "light.top_floor_shower",
    "data": "{\"brightness_pct\":\"70\"}",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 950,
    "y": 200,
    "wires": [
      [
        "b54a9086.6121a"
      ]
    ]
  },
  {
    "id": "c5085511.552db8",
    "type": "trigger",
    "z": "cf065444.e48a48",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "nul",
    "op2type": "pay",
    "duration": "20",
    "extend": true,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 610,
    "y": 300,
    "wires": [
      [
        "149cd752.bba601"
      ]
    ]
  },
  {
    "id": "146ede54.3e6d02",
    "type": "change",
    "z": "cf065444.e48a48",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 330,
    "y": 160,
    "wires": [
      [
        "c5085511.552db8"
      ]
    ]
  },
  {
    "id": "37b373ce.736cfc",
    "type": "change",
    "z": "cf065444.e48a48",
    "name": "Reset",
    "rules": [
      {
        "t": "set",
        "p": "reset",
        "pt": "msg",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 330,
    "y": 240,
    "wires": [
      [
        "8bc1c5b2.97e8b8"
      ]
    ]
  },
  {
    "id": "6551a506.78154c",
    "type": "trigger-state",
    "z": "cf065444.e48a48",
    "name": "Manul activetion",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "light.top_floor_shower",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "6u9jwgbwdyc",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "propertyValue": "new_state.context.user_id",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "dfa60723e3ee4e0191c1def891de2021 "
      },
      {
        "id": "knaba3bmk2",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "h98fn841w2l",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 360,
    "y": 300,
    "wires": [
      [
        "c5085511.552db8"
      ],
      []
    ]
  },
  {
    "id": "8d84d315.7f622",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Shower Room - Montion Detected",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.shower_room_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "29m36aldk3e",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "gjbzxf602q5",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 260,
    "y": 1180,
    "wires": [
      [
        "e363fe0a.9fd17"
      ],
      []
    ]
  },
  {
    "id": "6ba6c4a9.b1127c",
    "type": "trigger-state",
    "z": "73f354e0.89c88c",
    "name": "Shower Room  - Montion Cleared",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.shower_room_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "u7y3ovsm8",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      },
      {
        "id": "avq16iyyput",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 260,
    "y": 1220,
    "wires": [
      [
        "2501395c.638e06"
      ],
      []
    ]
  },
  {
    "id": "e363fe0a.9fd17",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD - Shower Room - Motion Detected",
    "links": [
      "fc92a07c.b063"
    ],
    "x": 495,
    "y": 1180,
    "wires": []
  },
  {
    "id": "2501395c.638e06",
    "type": "link out",
    "z": "73f354e0.89c88c",
    "name": "PD -  Shower Room  - Motion Cleared",
    "links": [
      "6c86223f.56848c"
    ],
    "x": 495,
    "y": 1220,
    "wires": []
  },
  {
    "id": "ece9b4a1.137c78",
    "type": "subflow:c47facfc.ae997",
    "z": "a9ef1830.1cde38",
    "name": "",
    "env": [
      {
        "name": "entity_id",
        "value": "light.spare_room",
        "type": "str"
      }
    ],
    "x": 400,
    "y": 160,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "96355f9.42c59a",
    "type": "link in",
    "z": "a9ef1830.1cde38",
    "name": "",
    "links": [
      "f03bd80a.dfe978"
    ],
    "x": 195,
    "y": 160,
    "wires": [
      [
        "ece9b4a1.137c78"
      ]
    ]
  },
  {
    "id": "3941e7f5.bb97d8",
    "type": "function",
    "z": "c9dd75c4.1c8078",
    "name": "Spare room switch",
    "func": "\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "x": 690,
    "y": 440,
    "wires": [
      [
        "f03bd80a.dfe978"
      ]
    ]
  },
  {
    "id": "f03bd80a.dfe978",
    "type": "link out",
    "z": "c9dd75c4.1c8078",
    "name": "SW-kichenBlind",
    "links": [
      "96355f9.42c59a"
    ],
    "x": 915,
    "y": 440,
    "wires": []
  },
  {
    "id": "e6dc0774.d78658",
    "type": "trigger-state",
    "z": "e0877ac4.f74e78",
    "name": "Bath Is wet",
    "server": "5ee4d578.f7736c",
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.water_bath",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "2b53jy80ay5",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "true"
      },
      {
        "id": "2pi79jbuhas",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "previous_state",
        "propertyValue": "old_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "bool",
        "comparatorValue": "false"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "habool",
    "x": 210,
    "y": 680,
    "wires": [
      [
        "91c5f0bc.756d1"
      ],
      []
    ]
  },
  {
    "id": "91c5f0bc.756d1",
    "type": "delay",
    "z": "e0877ac4.f74e78",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "15",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 430,
    "y": 680,
    "wires": [
      [
        "13bcc2ca.36608d"
      ]
    ]
  },
  {
    "id": "13bcc2ca.36608d",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "e0877ac4.f74e78",
    "name": "Bath is ready",
    "env": [
      {
        "name": "message",
        "value": "Bath is ready",
        "type": "str"
      },
      {
        "name": "who",
        "value": "both",
        "type": "str"
      }
    ],
    "x": 660,
    "y": 680,
    "wires": []
  },
  {
    "id": "3c2eef7d.73097",
    "type": "comment",
    "z": "e0877ac4.f74e78",
    "name": "Bath is read",
    "info": "",
    "x": 200,
    "y": 620,
    "wires": []
  },
  {
    "id": "d3bda9f8.8b6968",
    "type": "api-call-service",
    "z": "e0877ac4.f74e78",
    "name": "Turn On Bathtime",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "input_boolean",
    "service": "turn_on",
    "entityId": "input_boolean.bathtime",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "",
    "output_location_type": "none",
    "mustacheAltTags": false,
    "x": 860,
    "y": 720,
    "wires": [
      []
    ]
  },
  {
    "id": "2120159e.4529aa",
    "type": "api-current-state",
    "z": "e0877ac4.f74e78",
    "name": "Bathtime Off",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "false",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.bathtime",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 660,
    "y": 720,
    "wires": [
      [
        "d3bda9f8.8b6968"
      ],
      []
    ]
  },
  {
    "id": "239886c1.e9567a",
    "type": "inject",
    "z": "127f96c9.345c09",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1390,
    "y": 200,
    "wires": [
      [
        "da3f1fda.cb89d"
      ]
    ]
  },
  {
    "id": "277ce0ff.b417c",
    "type": "inject",
    "z": "d73100a9.0d64d",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 2400,
    "y": 460,
    "wires": [
      [
        "33d67a23.de0b26"
      ]
    ]
  },
  {
    "id": "f743da.27023c28",
    "type": "debug",
    "z": "6a3dc053.8b5b6",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 920,
    "y": 440,
    "wires": []
  },
  {
    "id": "7eab6e39.2c36a",
    "type": "api-call-service",
    "z": "c9b308f8.01ef68",
    "name": "Turn Off Light Group",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "debugenabled": false,
    "service_domain": "switch",
    "service": "turn_off",
    "entityId": "group.light_goodnight",
    "data": "",
    "dataType": "json",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "mustacheAltTags": false,
    "x": 260,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "65843285.d8666c",
    "type": "inject",
    "z": "e57ebed4.1e648",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "set-inform http://192.168.1.248:8080/inform",
    "payloadType": "str",
    "x": 210,
    "y": 100,
    "wires": [
      [
        "7a83693d.b06d18"
      ]
    ]
  },
  {
    "id": "7a83693d.b06d18",
    "type": "ssh-client-v2",
    "z": "e57ebed4.1e648",
    "debug": true,
    "ssh": "",
    "hostname": "192.168.1.7",
    "name": "",
    "x": 490,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "ceebadf8.c197",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "84ed1066.f22de",
    "name": "Warning! Feezer is greater then -20C",
    "env": [
      {
        "name": "message",
        "value": "Warning! Feezer is greater then -20C",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      },
      {
        "name": "notification_id",
        "value": "feezer",
        "type": "str"
      },
      {
        "name": "title",
        "value": "Warning! Feezer is greater then -20C",
        "type": "str"
      }
    ],
    "x": 1950,
    "y": 900,
    "wires": []
  },
  {
    "id": "f0b50cbf.af0ad",
    "type": "subflow:a83e69e1.4b2ab8",
    "z": "84ed1066.f22de",
    "name": "Freezer temperature restored",
    "env": [
      {
        "name": "message",
        "value": "Freezer temperature restored",
        "type": "str"
      },
      {
        "name": "who",
        "value": "Both",
        "type": "str"
      },
      {
        "name": "notification_id",
        "value": "feezer",
        "type": "str"
      },
      {
        "name": "title",
        "value": "CLEARED",
        "type": "str"
      }
    ],
    "x": 1460,
    "y": 980,
    "wires": []
  },
  {
    "id": "999a04a0.47c7f8",
    "type": "debug",
    "z": "c9dd75c4.1c8078",
    "name": "deconz_event_unmated",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 850,
    "y": 500,
    "wires": []
  },
  {
    "id": "c00d3c64.963ab8",
    "type": "inject",
    "z": "cf065444.e48a48",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 180,
    "wires": [
      [
        "146ede54.3e6d02"
      ]
    ]
  },
  {
    "id": "149cd752.bba601",
    "type": "api-current-state",
    "z": "cf065444.e48a48",
    "name": "Is on",
    "server": "5ee4d578.f7736c",
    "version": 1,
    "outputs": 2,
    "halt_if": "true",
    "halt_if_type": "bool",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "light.top_floor_shower",
    "state_type": "habool",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "blockInputOverrides": false,
    "x": 790,
    "y": 280,
    "wires": [
      [
        "f8cff860.115978"
      ],
      []
    ]
  },
  {
    "id": "d0823782.284fa8",
    "type": "inject",
    "z": "cf065444.e48a48",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 640,
    "y": 220,
    "wires": [
      [
        "149cd752.bba601"
      ]
    ]
  }
]
